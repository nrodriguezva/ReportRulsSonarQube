
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 1,3cm; /* Márgenes de 2 cm */
        }
        h1 { color: blue; text-align: center; }
        h2 { color: darkred; }
        h3 { color: darkblue; }
        p { font-size: 14px; line-height: 1.6; }
        .severity { font-weight: bold; color: green; }
        .section-title { font-weight: bold; font-style: italic; }
        .page-number { position: fixed; bottom: 10px; right: 10px; font-size: 12px; }
        .toc { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; background-color: #f9f9f9; }
        .toc a { text-decoration: none; color: blue; font-weight: bold; }
        .toc a:hover { text-decoration: underline; }
        .rule { border-bottom: 1px solid #ccc; padding-bottom: 10px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Reporte de Reglas de SonarQube</h1>

    <div class="toc">
        <h2>Tabla de Contenido</h2>
<p><a href="#java">JAVA</a></p><p><a href="#html">HTML</a></p><p><a href="#javascript">JAVASCRIPT</a></p></div><h2 id="java">JAVA</h2>
        <div class="rule">
            <h3>Track uses of "FIXME" tags (java:S1134)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/546">CWE-546 - Suspicious Comment</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>FIXME</code> tags are commonly used to mark places where a bug is suspected, but which the developer wants to deal with later.</p>
<p>Sometimes the developer will not have the time or will simply forget to get back to that tag.</p>
<p>This rule is meant to track those tags and to ensure that they do not go unnoticed.</p>
<pre>
int divide(int numerator, int denominator) {
  return numerator / denominator;              // FIXME denominator value might be  0
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Track uses of "TODO" tags (java:S1135)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/546">CWE-546 - Suspicious Comment</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Developers often use <code>TODO</code> tags to mark areas in the code where additional work or improvements are needed but are not implemented
immediately. However, these <code>TODO</code> tags sometimes get overlooked or forgotten, leading to incomplete or unfinished code. This rule aims to
identify and address unattended <code>TODO</code> tags to ensure a clean and maintainable codebase. This description explores why this is a problem
and how it can be fixed to improve the overall code quality.</p>
<h3>What is the potential impact?</h3>
<p>Unattended <code>TODO</code> tags in code can have significant implications for the development process and the overall codebase.</p>
<p>Incomplete Functionality: When developers leave <code>TODO</code> tags without implementing the corresponding code, it results in incomplete
functionality within the software. This can lead to unexpected behavior or missing features, adversely affecting the end-user experience.</p>
<p>Missed Bug Fixes: If developers do not promptly address <code>TODO</code> tags, they might overlook critical bug fixes and security updates.
Delayed bug fixes can result in more severe issues and increase the effort required to resolve them later.</p>
<p>Impact on Collaboration: In team-based development environments, unattended <code>TODO</code> tags can hinder collaboration. Other team members
might not be aware of the intended changes, leading to conflicts or redundant efforts in the codebase.</p>
<p>Codebase Bloat: The accumulation of unattended <code>TODO</code> tags over time can clutter the codebase and make it difficult to distinguish
between work in progress and completed code. This bloat can make it challenging to maintain an organized and efficient codebase.</p>
<p>Addressing this code smell is essential to ensure a maintainable, readable, reliable codebase and promote effective collaboration among
developers.</p>
<h3>Noncompliant code example</h3>
<pre>
void doSomething() {
  // TODO
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes and enums with private members should have a constructor (java:S1258)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Non-abstract classes and enums with non-<code>static</code>, <code>private</code> members should explicitly initialize those members, either in a
constructor or with a default value.</p>
<h3>Noncompliant code example</h3>
<pre>
class A { // Noncompliant
  private int field;
}
</pre>
<h3>Compliant solution</h3>
<pre>
class A {
  private int field;

  A(int field) {
    this.field = field;
  }
}
</pre>
<h3>Exceptions</h3>
<ul>
  <li> Class implementing a Builder Pattern (name ending with "Builder"). </li>
  <li> <a href="https://docs.oracle.com/javaee/7/tutorial/index.html">Java EE</a> class annotated with:
    <ul>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/annotation/ManagedBean.html">ManagedBean</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/ejb/MessageDriven.html">MessageDriven</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/ejb/Singleton.html">Singleton</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/ejb/Stateful.html">Stateful</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/ejb/Stateless.html">Stateless</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/jws/WebService.html">WebService</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/annotation/WebFilter.html">WebFilter</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/annotation/WebServlet.html">WebServlet</a> </li>
    </ul>  </li>
  <li> Class and field annotated with:
    <ul>
      <li> <a href="https://codehaus-plexus.github.io/plexus-containers/plexus-component-annotations/index.html">Plexus Component Annotations</a>
      </li>
      <li> <a href="https://maven.apache.org/developers/mojo-api-specification.html">Maven Mojo</a> </li>
    </ul>  </li>
  <li> Field annotated with:
    <ul>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/annotation/Resource.html">Resource</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/ejb/EJB.html">EJB</a> </li>
      <li> <a href="https://docs.oracle.com/javaee/7/api/javax/inject/Inject.html">Inject</a> </li>
      <li> <a
      href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">Autowired</a> </li>
    </ul>  </li>
  <li> Class annotated with:
    <ul>
      <li> <a href="https://www.javadoc.io/doc/org.projectlombok/lombok/latest/lombok/Builder.html">Lombok Builder</a> </li>
    </ul>  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"toString()" and "clone()" methods should not return null (java:S2225)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Calling <code>toString()</code> or <code>clone()</code> on an object should always return a string or an object. Returning <code>null</code>
instead contravenes the method’s implicit contract.</p>
<h3>Noncompliant code example</h3>
<pre>
public String toString () {
  if (this.collection.isEmpty()) {
    return null; // Noncompliant
  } else {
    // ...
</pre>
<h3>Compliant solution</h3>
<pre>
public String toString () {
  if (this.collection.isEmpty()) {
    return "";
  } else {
    // ...
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/476">CWE-476 - NULL Pointer Dereference</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/aDdGBQ">CERT, EXP01-J.</a> - Do not use a null in a case where an object is required </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Servlets should not have mutable instance fields (java:S2226)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>If the field is never modified, declare it <code>final</code>.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyServlet extends HttpServlet {
  String apiVersion = "0.9.1"; // Noncompliant, field changes are not thread-safe
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyServlet extends HttpServlet {
  final String apiVersion = "0.9.1"; // Compliant, field cannot be changed
}
</pre>
<h4>Noncompliant code example</h4>
<p>If a field is modified within instance methods, refactor it into a local variable. That variable can be passed as an argument to other functions if
needed.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
public class MyServlet extends HttpServlet {

  String userName; // Noncompliant, field changes are not thread-safe

  @Override
  public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    userName = req.getParameter("userName"); // Different threads may write concurrently to userName
    resp.getOutputStream().print(getGreeting());
  }

  public String getGreeting() { // Unpredictable value in field userName
    return "Hello "+userName+"!";
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
public class MyServlet extends HttpServlet {

  @Override
  public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    String userName = req.getParameter("userName"); // Compliant, local variable instead instance field
    resp.getOutputStream().print(getGreeting(userName));
  }

  public String getGreeting(String userName) { // Compliant, method argument instead instance field
    return "Hello "+userName+"!";
  }
}
</pre>
<h4>Noncompliant code example</h4>
<p>If you still prefer instance state over local variables, consider using <code>ThreadLocal</code> fields. These fields provide a separate instance
of their value for each thread.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
public class MyServlet extends HttpServlet {

  String userName; // Noncompliant, field changes are not thread-safe

  @Override
  public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    userName = req.getParameter("userName"); // Different threads may write concurrently to userName
    resp.getOutputStream().print(getGreeting());
  }

  public String getGreeting() { // Unpredictable value in field userName
    return "Hello "+userName+"!";
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
public class MyServlet extends HttpServlet {

  final ThreadLocal&lt;String&gt; userName = new ThreadLocal&lt;&gt;(); // Compliant, field itself does not change

  @Override
  public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    userName.set(req.getParameter("userName")); // Compliant, own value provided for every thread
    resp.getOutputStream().print(getGreeting());
  }

  public String getGreeting() {
    return "Hello "+userName.get()+"!"; // Compliant, own value provided for every thread
  }
}
</pre>
<h4>Noncompliant code example</h4>
<p>If you have a use case that requires a shared instance state between threads, declare the corresponding fields as <code>static</code> to indicate
your intention and awareness that there is only one instance of the servlet. However, the <code>static</code> modifier alone does not ensure thread
safety. Make sure also to take countermeasures against possible race conditions.</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
public class MyServlet extends HttpServlet {

  public long timestampLastRequest; // Noncompliant, field changes are not thread-safe

  @Override
  public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    timestampLastRequest = System.currentTimeMillis();
    resp.getOutputStream().print(timestampLastRequest); // Race condition
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="4" data-diff-type="compliant">
public class MyServlet extends HttpServlet {

  public static long timestampLastRequest; // Compliant, sharing state is our intention

  @Override
  public void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
    long timestamp;
    synchronized (this) {
      timestamp = timestampLastRequest; // No race condition, synchronized get &amp; set
      timestampLastRequest = System.currentTimeMillis();
    }
    resp.getOutputStream().print(timestamp);
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.devinline.com/2013/08/how-to-make-thread-safe-servlet.html">Nikhil Ranjan: How to make thread safe servlet ?</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222567">Application Security and
  Development: V-222567</a> - The application must not be vulnerable to race conditions. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>processHttpRequest</code> method and methods called from it can be executed by multiple threads within the same servlet instance, and
state changes to the instance caused by these methods are, therefore, not threadsafe.</p>
<p>This is due to the servlet container creating only one instance of each servlet (<code>javax.servlet.http.HttpServlet</code>) and attaching a
dedicated thread to each incoming HTTP request. The same problem exists for <code>org.apache.struts.action.Action</code> but with different
methods.</p>
<p>To prevent unexpected behavior, avoiding mutable states in servlets is recommended. Mutable instance fields should either be refactored into local
variables or made immutable by declaring them <code>final</code>.</p>
<h3>Exceptions</h3>
<ul>
  <li> Fields annotated with <code>@javax.inject.Inject</code>, <code>@javax.ejb.EJB</code>,
  <code>@org.springframework.beans.factory.annotation.Autowired</code>, <code>@javax.annotation.Resource</code> </li>
  <li> Fields initialized in <code>init()</code> or <code>init(ServletConfig config)</code> methods </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Boolean expressions should not be gratuitous (java:S2589)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>Gratuitous boolean expressions are conditions that do not change the evaluation of a program. This issue can indicate logical errors and affect the
correctness of an application, as well as its maintainability.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Gratuitous boolean expressions are suspicious and should be carefully removed from the code.</p>
<p>First, the boolean expression in question should be closely inspected for logical errors. If a mistake was made, it can be corrected so the
condition is no longer gratuitous.</p>
<p>If it becomes apparent that the condition is actually unnecessary, it can be removed. The associated control flow construct (e.g., the
<code>if</code>-statement containing the condition) will be adapted or even removed, leaving only the necessary branches.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
    public void doThings(boolean b, boolean c) {
        a = true;
        if (a) {                // Noncompliant
          doSomething();
        }

        if (b &amp;&amp; a) {           // Noncompliant; "a" is always "true"
          doSomething();
        }

        if (c || !a) {          // Noncompliant; "!a" is always "false"
          doSomething();
        }

        if (c || (!c &amp;&amp; b)) {   // Noncompliant; c || (!c &amp;&amp; b) is equal to c || b
          doSomething();
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
    public void doThings(boolean b, boolean c) {
        a = true;
        if (foo(a)) {
          doSomething();
        }

        if (b) {
          doSomething();
        }

        if (c) {
          doSomething();
        }

        if (c || b) {
          doSomething();
        }
    }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Control flow constructs like <code>if</code>-statements allow the programmer to direct the flow of a program depending on a boolean expression.
However, if the condition is always true or always false, only one of the branches will ever be executed. In that case, the control flow construct and
the condition no longer serve a purpose; they become <em>gratuitous</em>.</p>
<h3>What is the potential impact?</h3>
<p>The presence of gratuitous conditions can indicate a logical error. For example, the programmer <em>intended</em> to have the program branch into
different paths but made a mistake when formulating the branching condition. In this case, this issue might result in a bug and thus affect the
reliability of the application. For instance, it might lead to the computation of incorrect results.</p>
<p>Additionally, gratuitous conditions and control flow constructs introduce unnecessary complexity. The source code becomes harder to understand, and
thus, the application becomes more difficult to maintain.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/571">CWE-571 - Expression is Always True</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/570">CWE-570 - Expression is Always False</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Value-based classes should not be used for locking (java:S3436)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>According to the documentation,</p>
<blockquote>
  <p>A program may produce unpredictable results if it attempts to distinguish two references to equal values of a value-based class, whether directly
  via reference equality or indirectly via an appeal to synchronization…​</p>
</blockquote>
<p>This is because value-based classes are intended to be wrappers for value types, which will be primitive-like collections of data (similar to
<code>struct</code>s in other languages) that will come in future versions of Java.</p>
<blockquote>
  <p>Instances of a value-based class …​</p>
  <ul>
    <li> do not have accessible constructors, but are instead instantiated through factory methods which make no commitment as to the identity of
    returned instances; </li>
  </ul>
</blockquote>
<p>This means that you can’t be sure you’re the only one trying to lock on any given instance of a value-based class, opening your code up to
contention and deadlock issues.</p>
<p>Under Java 8 breaking this rule may not actually break your code, but there are no guarantees of the behavior beyond that.</p>
<p>This rule raises an issue when a known value-based class is used for synchronization. That includes all the classes in the <code>java.time</code>
package except <code>Clock</code>; the date classes for alternate calendars, <code>HijrahDate</code>, <code>JapaneseDate</code>,
<code>MinguoDate</code>, <code>ThaiBuddhistDate</code>; and the optional classes: <code>Optional</code>, <code>OptionalDouble</code>,
<code>OptionalLong</code>, <code>OptionalInt</code>.</p>
<p><strong>Note</strong> that this rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>8</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
Optional&lt;Foo&gt; fOpt = doSomething();
synchronized (fOpt) {  // Noncompliant
  // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/doc-files/ValueBased.html">Value-based classes</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"default" clauses should be last (java:S4524)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>switch</code> can contain a <code>default</code> clause for various reasons: to handle unexpected values, to show that all the cases were
properly considered, etc.</p>
<p>For readability purposes, to help a developer quickly spot the default behavior of a <code>switch</code> statement, it is recommended to put the
<code>default</code> clause at the end of the <code>switch</code> statement.</p>
<p>This rule raises an issue if the <code>default</code> clause is not the last one of the <code>switch</code>'s cases.</p>
<pre>
switch (param) {
  case 0:
    doSomething();
    break;
  default: // Noncompliant: default clause should be the last one
    error();
    break;
  case 1:
    doSomethingElse();
    break;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Lambdas should not have too many lines (java:S5612)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Lambdas (introduced with Java 8) are a very convenient and compact way to inject a behavior without having to create a dedicated class or method.
But those lambdas should be used only if the behavior to be injected can be defined in a few lines of code, otherwise the source code can quickly
become unreadable.</p></p>
            </div>
        <div class="rule">
            <h3>Consecutive AssertJ "assertThat" statements should be chained (java:S5853)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>AssertJ assertions methods targeting the same object can be chained instead of using multiple <code>assertThat</code>. It avoids duplication and
increases the clarity of the code.</p>
<p>This rule raises an issue when multiples <code>assertThat</code> target the same tested value.</p>
<h3>Noncompliant code example</h3>
<pre>
assertThat(someList).hasSize(3);
assertThat(someList).contains("something");
</pre>
<h3>Compliant solution</h3>
<pre>
assertThat(someList)
  .hasSize(3)
  .contains("something");
</pre></p>
            </div>
        <div class="rule">
            <h3>Regexes containing characters subject to normalization should use the CANON_EQ flag (java:S5854)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Characters like <code>'é'</code> can be expressed either as a single code point or as a cluster of the letter <code>'e'</code> and a combining
accent mark. Without the <code>CANON_EQ</code> flag, a regex will only match a string in which the characters are expressed in the same way.</p>
<h3>Noncompliant code example</h3>
<pre>
String s = "e\u0300";
Pattern p = Pattern.compile("é|ë|è"); // Noncompliant
System.out.println(p.matcher(s).replaceAll("e")); // print 'è'
</pre>
<h3>Compliant solution</h3>
<pre>
String s = "e\u0300";
Pattern p = Pattern.compile("é|ë|è", Pattern.CANON_EQ);
System.out.println(p.matcher(s).replaceAll("e")); // print 'e'
</pre></p>
            </div>
        <div class="rule">
            <h3>Regex alternatives should not be redundant (java:S5855)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when multiple branches of a regex alternative match the same input.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>If an alternative in a regular expression only matches things that are already matched by another alternative, that alternative is redundant and
serves no purpose.</p>
<p>In the best case this means that the offending subpattern is merely redundant and should be removed. In the worst case it’s a sign that this regex
does not match what it was intended to match and should be reworked.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
"[ab]|a"   // Noncompliant: the "|a" is redundant because "[ab]" already matches "a"
".*|a"     // Noncompliant: .* matches everything, so any other alternative is redundant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
"[ab]"
".*"
</pre></p>
            </div>
        <div class="rule">
            <h3>Regular expressions should be syntactically valid (java:S5856)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Regular expressions have their own syntax that is understood by regular expression engines. Those engines will throw an exception at runtime if
they are given a regular expression that does not conform to that syntax.</p>
<p>To avoid syntax errors, special characters should be escaped with backslashes when they are intended to be matched literally and references to
capturing groups should use the correctly spelled name or number of the group.</p>
<p>To match a literal string instead of a regular expression, either all special characters should be escaped, the <code>Pattern.LITERAL</code> flag
or methods that don’t use regular expressions should be used.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("([");
str.matches("([");
str.replaceAll("([", "{");
str.matches("(\\w+-(\\d+)");
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("\\(\\[");
Pattern.compile("([", Pattern.LITERAL);
str.equals("([");
str.replace("([", "{");
str.matches("(\\w+)-(\\d+)");
</pre></p>
            </div>
        <div class="rule">
            <h3>Similar tests should be grouped in a single Parameterized test (java:S5976)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When multiple tests differ only by a few hardcoded values they should be refactored as a single "parameterized" test. This reduces the chances of
adding a bug and makes them more readable. Parameterized tests exist in most test frameworks (JUnit, TestNG, etc…​).</p>
<p>The right balance needs of course to be found. There is no point in factorizing test methods when the parameterized version is a lot more complex
than initial tests.</p>
<p>This rule raises an issue when at least 3 tests could be refactored as one parameterized test with less than 4 parameters. Only test methods which
have at least one duplicated statement are considered.</p>
<h3>Noncompliant code example</h3>
<p>with JUnit 5</p>
<pre>
import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.api.Test;

public class AppTest
{
    @Test
    void test_not_null1() {  // Noncompliant. The 3 following tests differ only by one hardcoded number.
      setupTax();
      assertNotNull(getTax(1));
    }

    @Test
    void test_not_null2() {
      setupTax();
      assertNotNull(getTax(2));
    }

    @Test
    void test_not_nul3l() {
      setupTax();
      assertNotNull(getTax(3));
    }

    @Test
    void testLevel1() {  // Noncompliant. The 3 following tests differ only by a few hardcoded numbers.
        setLevel(1);
        runGame();
        assertEquals(playerHealth(), 100);
    }

    @Test
    void testLevel2() {  // Similar test
        setLevel(2);
        runGame();
        assertEquals(playerHealth(), 200);
    }

    @Test
    void testLevel3() {  // Similar test
        setLevel(3);
        runGame();
        assertEquals(playerHealth(), 300);
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.CsvSource;

public class AppTest
{

   @ParameterizedTest
   @ValueSource(ints = {1, 2, 3})
   void test_not_null(int arg) {
     setupTax();
     assertNotNull(getTax(arg));
   }

    @ParameterizedTest
    @CsvSource({
        "1, 100",
        "2, 200",
        "3, 300",
    })
    void testLevels(int level, int health) {
        setLevel(level);
        runGame();
        assertEquals(playerHealth(), health);
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://phauer.com/2019/modern-best-practices-testing-java/#use-parameterized-tests">Modern Best Practices for Testing in Java -
  Philipp Hauer</a> </li>
  <li> <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests">JUnit 5 documentation - Parameterized tests</a>
  </li>
  <li> <a href="https://www.testwithspring.com/lesson/writing-parameterized-tests-with-junit-4/">Writing Parameterized Tests With JUnit 4</a> </li>
  <li> <a href="https://testng.org/#_parameters">TestNG documentation - Parameters</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Tests should use fixed data instead of randomized data (java:S5977)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://phauer.com/2019/modern-best-practices-testing-java/#use-fixed-data-instead-of-randomized-data">Modern Best Practices for
  Testing in Java - Philipp Hauer</a> </li>
  <li> <a href="https://jqwik.net/">Jqwik test engine</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Tests should always:</p>
<ul>
  <li> Make sure that production code behaves as expected, including edge cases. </li>
  <li> Be easy to debug, i.e. understandable and reproducible. </li>
</ul>
<p>Using random values in tests will not necessarily check edge cases, and it will make test logs a lot harder to read. It is better to use easily
readable hardcoded values. If this makes your code bigger you can use helper functions.</p>
<p>There is one valid use case for random data in tests: when testing every value would make tests impractically slow. In this case the best you can
do is use random to test every value on the long run. You should however make sure that random values are logged so that you can reproduce failures.
Some libraries exist to make all this easier. You can for example use property-based testing libraries such as <a
href="https://github.com/jlink/jqwik">jqwik</a>.</p>
<p>This rule raises an issue when <code>new Random()</code> or <code>UUID.randomUUID()</code> are called in test code.</p>
<h3>Noncompliant code example</h3>
<pre>
int userAge = new Random().nextInt(42);  // Noncompliant
UUID userID = UUID.randomUUID(); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
int userAge = 31;
UUID userID = UUID.fromString("00000000-000-0000-0000-000000000001");
</pre></p>
            </div>
        <div class="rule">
            <h3>Exceptions in "throws" clauses should not be superfluous (java:S1130)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Superfluous exceptions within <code>throws</code> clauses have negative effects on the readability and maintainability of the code. An exception in
a <code>throws</code> clause is superfluous if it is:</p>
<ul>
  <li> listed multiple times </li>
  <li> a subclass of another listed exception </li>
  <li> not actually thrown by any execution path of the method </li>
</ul>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
void foo() throws MyException, MyException {}  // Noncompliant; should be listed once
void bar() throws Throwable, Exception {}  // Noncompliant; Exception is a subclass of Throwable
void boo() throws IOException { // Noncompliant; IOException cannot be thrown
  System.out.println("Hi!");
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
void foo() throws MyException {}
void bar() throws Throwable {}
void boo() {
  System.out.println("Hi!");
}
</pre>
<h3>Exceptions</h3>
<p>The rule will not raise any issue for exceptions that cannot be thrown from the method body:</p>
<ul>
  <li> in interface <code>default</code> methods </li>
  <li> in overriding and implementating methods </li>
  <li> in non-private methods that only <code>throw</code>, have empty bodies, or a single return statement. </li>
  <li> in overridable methods (non-final, or not member of a final class, non-static, non-private), if the exception is documented with a proper
  JavaDoc </li>
</ul>
<pre>
interface MyInterface {
  default void defaultMethod() throws IOException {
    System.out.println("Hi!");
  }
  void doSomething() throws IOException;
}

class A implements MyInterface {
  @Override
  void doSomething() throws IOException {
    System.out.println("Hi!");
  }

  public void emptyBody() throws IOException {}

  protected void singleThrowStatement() throws IOException {
    throw new UnsupportedOperationException("This method should be implemented in subclasses");
  }

  Object singleReturnStatement() throws IOException {
    return null;
  }

  /**
   * @throws IOException Overriding classes may throw this exception if they print values into a file
   */
  protected void overridable() throws IOException { // no issue, method is overridable and the exception has proper javadoc
    System.out.println("foo");
  }
}
</pre>
<p>Also, the rule will not raise issues on <code>RuntimeException</code>, or one of its sub-classes, because documenting runtime exceptions which
could be thrown can ultimately help users of the method understand its behavior.</p>
<pre>
class B {
  int possibleDivisionByZero(int a, int b) throws ArithmeticException {
      return a / b;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Strings literals should be placed on the left side when checking for equality (java:S1132)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It is preferable to place string literals on the left-hand side of an <code>equals()</code> or <code>equalsIgnoreCase()</code> method call.</p>
<p>This prevents null pointer exceptions from being raised, as a string literal can never be null by definition.</p>
<h3>Noncompliant code example</h3>
<pre>
String myString = null;

System.out.println("Equal? " + myString.equals("foo"));                        // Noncompliant; will raise a NPE
System.out.println("Equal? " + (myString != null &amp;&amp; myString.equals("foo")));  // Noncompliant; null check could be removed
</pre>
<h3>Compliant solution</h3>
<pre>
System.out.println("Equal?" + "foo".equals(myString));                         // properly deals with the null case
</pre></p>
            </div>
        <div class="rule">
            <h3>Deprecated code should be removed (java:S1133)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule is meant to be used as a way to track code which is marked as being deprecated. Deprecated code should eventually be removed.</p>
<h3>Noncompliant code example</h3>
<pre>
class Foo {
  /**
   * @deprecated
   */
  public void foo() {    // Noncompliant
  }

  @Deprecated            // Noncompliant
  public void bar() {
  }

  public void baz() {    // Compliant
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Exception" should not be caught when not required by called methods (java:S2221)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/396">CWE-396 - Declaration of Catch for Generic Exception</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Catching <code>Exception</code> seems like an efficient way to handle multiple possible exceptions. Unfortunately, it traps all exception types,
both checked and runtime exceptions, thereby casting too broad a net. Indeed, was it really the intention of developers to also catch runtime
exceptions? To prevent any misunderstanding, if both checked and runtime exceptions are really expected to be caught, they should be explicitly listed
in the <code>catch</code> clause.</p>
<p>This rule raises an issue if <code>Exception</code> is caught when it is not explicitly thrown by a method in the <code>try</code> block.</p>
<h3>Noncompliant code example</h3>
<pre>
try {
  // do something that might throw an UnsupportedDataTypeException or UnsupportedEncodingException
} catch (Exception e) { // Noncompliant
  // log exception ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
try {
  // do something
} catch (UnsupportedEncodingException|UnsupportedDataTypeException|RuntimeException e) {
  // log exception ...
}
</pre>
<p>or if runtime exceptions should not be caught:</p>
<pre>
try {
  // do something
} catch (UnsupportedEncodingException|UnsupportedDataTypeException e) {
  // log exception ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Locks should be released on all paths (java:S2222)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>If a lock is acquired and released within a method, then it must be released along all execution paths of that method.</p>
<p>Failing to do so will expose the conditional locking logic to the method’s callers and hence be deadlock-prone.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {
  public void doSomething() {
    Lock lock = new Lock();
    lock.lock(); // Noncompliant
    if (isInitialized()) {
      // ...
      lock.unlock();
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyClass {
  public void doSomething() {
    Lock lock = new Lock();
    if (isInitialized()) {
      lock.lock();
      // ...
      lock.unlock();
    }
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/459">CWE-459 - Incomplete Cleanup</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Methods should not call same-class methods with incompatible "@Transactional" values (java:S2229)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Propagation.html">Spring
  Framework 6 API: Enum Class propagation</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">Spring
  Framework 6 API: Annotation Interface Transactional</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/data-access/transaction/declarative/tx-propagation.html">Spring 6 Documentation:
  Transaction Propagation</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-transactional-propagation-isolation">Baeldung: Transaction Propagation and Isolation in Spring
  @Transactional</a> </li>
  <li> <a href="https://dzone.com/articles/spring-transaction-propagation">DZone: Spring Transaction Propagation in a Nutshell</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Change the corresponding functions into a compatible propagation type.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Noncompliant, call from non-transactional to transactional
}

@Transactional
public void actuallyDoTheThing() {
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Transactional
public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Compliant
}

@Transactional
public void actuallyDoTheThing() {
  // ...
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
@Transactional
public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Noncompliant, call from REQUIRED to REQUIRES_NEW
}

@Transactional(propagation = Propagation.REQUIRES_NEW)
public void actuallyDoTheThing() {
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
@Transactional
public void doTheThing() {
  // ...
  actuallyDoTheThing(); // Compliant, call from REQUIRED to MANDATORY
}

@Transactional(propagation = Propagation.MANDATORY)
public void actuallyDoTheThing() {
  // ...
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Transactional methods have a propagation type parameter in the @Transaction annotation that specifies the requirements about the transactional
context in which the method can be called and how it creates, appends, or suspends an ongoing transaction.</p>
<p>When an instance that contains transactional methods is injected, Spring uses proxy objects to wrap these methods with the actual transaction
code.</p>
<p>However, if a transactional method is called from another method in the same class, the <code>this</code> argument is used as the receiver instance
instead of the injected proxy object, which bypasses the wrapper code. This results in specific transitions from one transactional method to another,
which are not allowed:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>From</th>
      <th>To</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>non-<code>@Transactional</code></p></td>
      <td><p>MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
    </tr>
    <tr>
      <td><p>MANDATORY</p></td>
      <td><p>NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
    </tr>
    <tr>
      <td><p>NESTED</p></td>
      <td><p>NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
    </tr>
    <tr>
      <td><p>NEVER</p></td>
      <td><p>MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
    </tr>
    <tr>
      <td><p>NOT_SUPPORTED</p></td>
      <td><p>MANDATORY, NESTED, REQUIRED, REQUIRES_NEW</p></td>
    </tr>
    <tr>
      <td><p>REQUIRED or <code>@Transactional</code></p></td>
      <td><p>NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
    </tr>
    <tr>
      <td><p>REQUIRES_NEW</p></td>
      <td><p>NESTED, NEVER, NOT_SUPPORTED, REQUIRES_NEW</p></td>
    </tr>
    <tr>
      <td><p>SUPPORTS</p></td>
      <td><p>MANDATORY, NESTED, NEVER, NOT_SUPPORTED, REQUIRED, REQUIRES_NEW</p></td>
    </tr>
  </tbody>
</table></p>
            </div>
        <div class="rule">
            <h3>Conditionally executed code should be reachable (java:S2583)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Conditional expressions which are always <code>true</code> or <code>false</code> can lead to <a
href="https://en.wikipedia.org/wiki/Unreachable_code">unreachable code</a>.</p>
<h3>Noncompliant code example</h3>
<pre>
a = false;
if (a) { // Noncompliant
  doSomething(); // never executed
}

if (!a || b) { // Noncompliant; "!a" is always "true", "b" is never evaluated
  doSomething();
} else {
  doSomethingElse(); // never executed
}
</pre>
<h3>Exceptions</h3>
<p>This rule will not raise an issue in either of these cases:</p>
<ul>
  <li> When the condition is a single <code>final boolean</code> </li>
</ul>
<pre>
final boolean debug = false;
//...
if (debug) {
  // Print something
}
</pre>
<ul>
  <li> When the condition is literally <code>true</code> or <code>false</code>. </li>
</ul>
<pre>
if (true) {
  // do something
}
</pre>
<p>In these cases it is obvious the code is as intended.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/570">CWE-570 - Expression is Always False</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/571">CWE-571 - Expression is Always True</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5dUxBQ">CERT, MSC12-C.</a> - Detect and remove code that has no effect or is never executed
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Overrides should match their parent class methods in synchronization (java:S3551)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/gzdGBQ">CERT, TSM00-J</a> - Do not override thread-safe methods with methods that are not
  thread-safe </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When <code>@Overrides</code> of <code>synchronized</code> methods are not themselves <code>synchronized</code>, the result can be improper
synchronization as callers rely on the thread-safety promised by the parent class.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Parent {

  synchronized void foo() {
    //...
  }
}

public class Child extends Parent {

 @Override
  public void foo () {  // Noncompliant
    // ...
    super.foo();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Parent {

  synchronized void foo() {
    //...
  }
}

public class Child extends Parent {

  @Override
  synchronized void foo () {
    // ...
    super.foo();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Optional" should not be used for parameters (java:S3553)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The Java language authors have been quite frank that <code>Optional</code> was intended for use only as a return type, as a way to convey that a
method may or may not return a value.</p>
<p>And for that, it’s valuable but using <code>Optional</code> on the input side increases the work you have to do in the method without really
increasing the value. With an <code>Optional</code> parameter, you go from having 2 possible inputs: null and not-null, to three: null,
non-null-without-value, and non-null-with-value. Add to that the fact that overloading has long been available to convey that some parameters are
optional, and there’s really no reason to have <code>Optional</code> parameters.</p>
<p>The rule also checks for Guava’s <code>Optional</code>, as it was the inspiration for the JDK <code>Optional</code>. Although it is different in
some aspects (serialization, being recommended for use as collection elements), using it as a parameter type causes exactly the same problems as for
JDK <code>Optional</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public String sayHello(Optional&lt;String&gt; name) {  // Noncompliant
  if (name == null || !name.isPresent()) {
    return "Hello World";
  } else {
    return "Hello " + name;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public String sayHello(String name) {
  if (name == null) {
    return "Hello World";
  } else {
    return "Hello " + name;
  }
}
</pre>
<h3>Exceptions</h3>
<p>No issues will be raised if a method is overriding, as the developer has no control over the signature at this point.</p>
<pre>
@Override
public String sayHello(Optional&lt;String&gt; name) {
  if (name == null || !name.isPresent()) {
    return "Hello World";
  } else {
    return "Hello " + name;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Alternatives in regular expressions should be grouped when used with anchors (java:S5850)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In regular expressions, anchors (<code>^</code>, <code>$</code>, <code>\A</code>, <code>\Z</code> and <code>\z</code>) have higher precedence than
the <code>|</code> operator. So in a regular expression like <code>^alt1|alt2|alt3$</code>, <code>alt1</code> would be anchored to the beginning,
<code>alt3</code> to the end and <code>alt2</code> wouldn’t be anchored at all. Usually the intended behavior is that all alternatives are anchored at
both ends. To achieve this, a non-capturing group should be used around the alternatives.</p>
<p>In cases where it is intended that the anchors only apply to one alternative each, adding (non-capturing) groups around the anchors and the parts
that they apply to will make it explicit which parts are anchored and avoid readers misunderstanding the precedence or changing it because they
mistakenly assume the precedence was not intended.</p>
<h3>Noncompliant code example</h3>
<pre>
^a|b|c$
</pre>
<h3>Compliant solution</h3>
<pre>
^(?:a|b|c)$
</pre>
<p>or</p>
<pre>
^a$|^b$|^c$
</pre>
<p>or, if you do want the anchors to only apply to <code>a</code> and <code>c</code> respectively:</p>
<pre>
(?:^a)|b|(?:c$)
</pre></p>
            </div>
        <div class="rule">
            <h3>Using slow regular expressions is security-sensitive (java:S5852)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Default:</p>
            <p><p>Most of the regular expression engines use <code>backtracking</code> to try all possible execution paths of the regular expression when evaluating
an input, in some cases it can cause performance issues, called <code>catastrophic backtracking</code> situations. In the worst case, the complexity
of the regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger
<code>catastrophic backtracking</code> and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too
with, in this case, a large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you of the complexity if it is not linear.</p>
<p>Note that, due to improvements to the matching algorithm, some cases of exponential runtime complexity have become impossible when run using JDK 9
or later. In such cases, an issue will only be reported if the project’s target Java version is 8 or earlier.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The input is user-controlled. </li>
  <li> The input size is not restricted to a small number of characters. </li>
  <li> There is no timeout in place to limit the regex evaluation time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>To avoid <code>catastrophic backtracking</code> situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen. Note that when performing a full match (e.g. using <code>String.matches</code>), the end of the
regex counts as a pattern that can fail because it will only succeed when the end of the string is reached.</p>
<ul>
  <li> If you have a non-possessive repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different
  possible matches (of possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if
  <code>r</code> contains optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only
  one way to match it).
    <ul>
      <li> When using JDK 9 or later an optimization applies when the repetition is greedy and the entire regex does not contain any back references.
      In that case the runtime will only be polynomial (in case of nested repetitions) or even linear (in case of alternations or optional parts).
      </li>
    </ul>  </li>
  <li> If you have multiple non-possessive repetitions that can match the same contents and are consecutive or are only separated by an optional
  separator or a separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the
  number of problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different
  things and <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>'_'</code> and can’t match that <code>'_'</code>.
  However, <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li>
  <li> If you’re performing a partial match (such as by using <code>Matcher.find</code>, <code>String.split</code>, <code>String.replaceAll</code>
  etc.) and the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails,
  the regex engine will try again starting at the next index. This means that any unbounded repetition (even a possessive one), if it’s followed by a
  pattern that can fail, can cause quadratic runtime on some inputs. For example <code>str.split("\\s*,")</code> will run in quadratic time on strings
  that consist entirely of spaces (or at least contain large sequences of spaces, not followed by a comma). </li>
</ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul>
  <li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>+</code>
  for instance. </li>
  <li> Refactor <code>nested quantifiers</code> to limit the number of way the inner group can be matched by the outer quantifier, for instance this
  nested quantifier situation <code>(ba+)+</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists
  exactly one <code>b</code> char per repetition of the group. </li>
  <li> Optimize regular expressions with <code>possessive quantifiers</code> and <code>atomic grouping</code>. </li>
  <li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li>
</ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when using partial
matches, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul>
  <li> Solve the problem without regular expressions </li>
  <li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2">RE2</a> or <a
  href="https://github.com/google/re2j">RE2/J</a>. </li>
  <li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split("\\s*,\\s*")</code> with <code>str.split(",")</code> and
  then trimming the spaces from the strings as a second step. </li>
  <li> When using <code>Matcher.find()</code>, it is often possible to make the regex infallible by making all the parts that could fail optional,
  which will prevent backtracking. Of course this means that you’ll accept more strings than intended, but this can be handled by using capturing
  groups to check whether the optional parts were matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code>
  could be replaced with <code>x*(y)?</code> and then the call to <code>matcher.find()</code> could be replaced with <code>matcher.find() &amp;&amp;
  matcher.group(1) != null</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>The first regex evaluation will never end in <code>JDK</code> &lt;= 9 and the second regex evaluation will never end in any versions of the
<code>JDK</code>:</p>
<pre>
java.util.regex.Pattern.compile("(a+)+").matcher(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!").matches(); // Sensitive

java.util.regex.Pattern.compile("(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))+h)ahbfhba|c|i)*").matcher(
"hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi"+
"cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi"+
"chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch"+
"chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh"+
"ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih"+
"iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci").matches(); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues:</p>
<pre>
java.util.regex.Pattern.compile("(a+)++").matcher(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!").matches(); // Compliant

java.util.regex.Pattern.compile("(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))+h)ahbfhba|c|i)*+").matcher(
"hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi"+
"cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi"+
"chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch"+
"chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh"+
"ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih"+
"iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci").matches(); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li>
  <li> <a
  href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Most of the regular expression engines use <code>backtracking</code> to try all possible execution paths of the regular expression when evaluating
an input, in some cases it can cause performance issues, called <code>catastrophic backtracking</code> situations. In the worst case, the complexity
of the regular expression is exponential in the size of the input, this means that a small carefully-crafted input (like 20 chars) can trigger
<code>catastrophic backtracking</code> and cause a denial of service of the application. Super-linear regex complexity can lead to the same impact too
with, in this case, a large carefully-crafted input (thousands chars).</p>
<p>This rule determines the runtime complexity of a regular expression and informs you of the complexity if it is not linear.</p>
<p>Note that, due to improvements to the matching algorithm, some cases of exponential runtime complexity have become impossible when run using JDK 9
or later. In such cases, an issue will only be reported if the project’s target Java version is 8 or earlier.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>To avoid <code>catastrophic backtracking</code> situations, make sure that none of the following conditions apply to your regular expression.</p>
<p>In all of the following cases, catastrophic backtracking can only happen if the problematic part of the regex is followed by a pattern that can
fail, causing the backtracking to actually happen. Note that when performing a full match (e.g. using <code>String.matches</code>), the end of the
regex counts as a pattern that can fail because it will only succeed when the end of the string is reached.</p>
<ul>
  <li> If you have a non-possessive repetition <code>r*</code> or <code>r*?</code>, such that the regex <code>r</code> could produce different
  possible matches (of possibly different lengths) on the same input, the worst case matching time can be exponential. This can be the case if
  <code>r</code> contains optional parts, alternations or additional repetitions (but not if the repetition is written in such a way that there’s only
  one way to match it).
    <ul>
      <li> When using JDK 9 or later an optimization applies when the repetition is greedy and the entire regex does not contain any back references.
      In that case the runtime will only be polynomial (in case of nested repetitions) or even linear (in case of alternations or optional parts).
      </li>
    </ul>  </li>
  <li> If you have multiple non-possessive repetitions that can match the same contents and are consecutive or are only separated by an optional
  separator or a separator that can be matched by both of the repetitions, the worst case matching time can be polynomial (O(n^c) where c is the
  number of problematic repetitions). For example <code>a*b*</code> is not a problem because <code>a*</code> and <code>b*</code> match different
  things and <code>a*_a*</code> is not a problem because the repetitions are separated by a <code>'_'</code> and can’t match that <code>'_'</code>.
  However, <code>a*a*</code> and <code>.*_.*</code> have quadratic runtime. </li>
  <li> If you’re performing a partial match (such as by using <code>Matcher.find</code>, <code>String.split</code>, <code>String.replaceAll</code>
  etc.) and the regex is not anchored to the beginning of the string, quadratic runtime is especially hard to avoid because whenever a match fails,
  the regex engine will try again starting at the next index. This means that any unbounded repetition (even a possessive one), if it’s followed by a
  pattern that can fail, can cause quadratic runtime on some inputs. For example <code>str.split("\\s*,")</code> will run in quadratic time on strings
  that consist entirely of spaces (or at least contain large sequences of spaces, not followed by a comma). </li>
</ul>
<p>In order to rewrite your regular expression without these patterns, consider the following strategies:</p>
<ul>
  <li> If applicable, define a maximum number of expected repetitions using the bounded quantifiers, like <code>{1,5}</code> instead of <code>+</code>
  for instance. </li>
  <li> Refactor <code>nested quantifiers</code> to limit the number of way the inner group can be matched by the outer quantifier, for instance this
  nested quantifier situation <code>(ba+)+</code> doesn’t cause performance issues, indeed, the inner group can be matched only if there exists
  exactly one <code>b</code> char per repetition of the group. </li>
  <li> Optimize regular expressions with <code>possessive quantifiers</code> and <code>atomic grouping</code>. </li>
  <li> Use negated character classes instead of <code>.</code> to exclude separators where applicable. For example the quadratic regex
  <code>.*_.*</code> can be made linear by changing it to <code>[^_]*_.*</code> </li>
</ul>
<p>Sometimes it’s not possible to rewrite the regex to be linear while still matching what you want it to match. Especially when using partial
matches, for which it is quite hard to avoid quadratic runtimes. In those cases consider the following approaches:</p>
<ul>
  <li> Solve the problem without regular expressions </li>
  <li> Use an alternative non-backtracking regex implementations such as Google’s <a href="https://github.com/google/re2">RE2</a> or <a
  href="https://github.com/google/re2j">RE2/J</a>. </li>
  <li> Use multiple passes. This could mean pre- and/or post-processing the string manually before/after applying the regular expression to it or
  using multiple regular expressions. One example of this would be to replace <code>str.split("\\s*,\\s*")</code> with <code>str.split(",")</code> and
  then trimming the spaces from the strings as a second step. </li>
  <li> When using <code>Matcher.find()</code>, it is often possible to make the regex infallible by making all the parts that could fail optional,
  which will prevent backtracking. Of course this means that you’ll accept more strings than intended, but this can be handled by using capturing
  groups to check whether the optional parts were matched or not and then ignoring the match if they weren’t. For example the regex <code>x*y</code>
  could be replaced with <code>x*(y)?</code> and then the call to <code>matcher.find()</code> could be replaced with <code>matcher.find() &amp;&amp;
  matcher.group(1) != null</code>. </li>
</ul>
<h2>Compliant Solution</h2>
<p>Possessive quantifiers do not keep backtracking positions, thus can be used, if possible, to avoid performance issues:</p>
<pre>
java.util.regex.Pattern.compile("(a+)++").matcher(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!").matches(); // Compliant

java.util.regex.Pattern.compile("(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))+h)ahbfhba|c|i)*+").matcher(
"hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi"+
"cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi"+
"chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch"+
"chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh"+
"ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih"+
"iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci").matches(); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1333">CWE-1333 - Inefficient Regular Expression Complexity</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS">owasp.org</a> - OWASP Regular expression Denial
  of Service - ReDoS </li>
  <li> <a
  href="https://web.archive.org/web/20220506215733/https://stackstatus.net/post/147710624694/outage-postmortem-july-20-2016">stackstatus.net(archived)</a> - Outage Postmortem - July 20, 2016 </li>
  <li> <a href="https://www.regular-expressions.info/catastrophic.html">regular-expressions.info</a> - Runaway Regular Expressions: Catastrophic
  Backtracking </li>
  <li> <a
  href="https://docs.microsoft.com/en-us/dotnet/standard/base-types/backtracking-in-regular-expressions#backtracking-with-nested-optional-quantifiers">docs.microsoft.com</a> - Backtracking with Nested Optional Quantifiers </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The input is user-controlled. </li>
  <li> The input size is not restricted to a small number of characters. </li>
  <li> There is no timeout in place to limit the regex evaluation time. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>The first regex evaluation will never end in <code>JDK</code> &lt;= 9 and the second regex evaluation will never end in any versions of the
<code>JDK</code>:</p>
<pre>
java.util.regex.Pattern.compile("(a+)+").matcher(
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"+
"aaaaaaaaaaaaaaa!").matches(); // Sensitive

java.util.regex.Pattern.compile("(h|h|ih(((i|a|c|c|a|i|i|j|b|a|i|b|a|a|j))+h)ahbfhba|c|i)*").matcher(
"hchcchicihcchciiicichhcichcihcchiihichiciiiihhcchi"+
"cchhcihchcihiihciichhccciccichcichiihcchcihhicchcciicchcccihiiihhihihihi"+
"chicihhcciccchihhhcchichchciihiicihciihcccciciccicciiiiiiiiicihhhiiiihchccch"+
"chhhhiiihchihcccchhhiiiiiiiicicichicihcciciihichhhhchihciiihhiccccccciciihh"+
"ichiccchhicchicihihccichicciihcichccihhiciccccccccichhhhihihhcchchihih"+
"iihhihihihicichihiiiihhhhihhhchhichiicihhiiiiihchccccchichci").matches(); // Sensitive
</pre>
</p>
            </div>
        <div class="rule">
            <h3>Character classes should be preferred over reluctant quantifiers in regular expressions (java:S5857)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using reluctant quantifiers (also known as lazy or non-greedy quantifiers) in patterns can often lead to needless backtracking, making the regex
needlessly inefficient and potentially vulnerable to <a href="https://www.regular-expressions.info/catastrophic.html">catastrophic backtracking</a>.
Particularly when using <code>.*?</code> or <code>.+?</code> to match anything up to some terminating character, it is usually a better idea to
instead use a greedily or possessively quantified negated character class containing the terminating character. For example <code>&lt;.+?&gt;</code>
should be replaced with <code>&lt;[^&gt;]++&gt;</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
&lt;.+?&gt;
".*?"
</pre>
<h3>Compliant solution</h3>
<pre>
&lt;[^&gt;]++&gt;
"[^"]*+"
</pre>
<p>or</p>
<pre>
&lt;[^&gt;]+&gt;
"[^"]*"
</pre>
<h3>Exceptions</h3>
<p>This rule only applies in cases where the reluctant quantifier can easily be replaced with a negated character class. That means the repetition has
to be terminated by a single character or character class. Patterns such as the following, where the alternatives without reluctant quantifiers are
more complicated, are therefore not subject to this rule:</p>
<pre>
&lt;!--.*?--&gt;
/\*.*?\*/
</pre></p>
            </div>
        <div class="rule">
            <h3>Spring's ModelAndViewAssert assertions should be used instead of other assertions (java:S5970)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The Spring framework comes with dedicated classes to help writing better and simpler unit tests. In particular, when testing applications built on
top of Spring MVC, it is recommended to use Spring’s <code>ModelAndViewAssert</code> assertions class, instead of manually testing MVC’s
properties.</p>
<p>&nbsp;</p>
<p>This rule raises an issue when&nbsp;Spring’s <code>ModelAndViewAssert</code> assertions should be used instead of manual testing.</p>
<h3>Noncompliant code example</h3>
<pre>
ModelAndView mav = getMyModelAndView();

Assert.assertEquals("register", mav.getViewName());
Assert.assertTrue((Boolean) mav.getModelMap().get("myAttribute"));
Assert.assertFalse((Boolean) mav.getModelMap().get("myAttribute"));
Assert.assertEquals(myObject, mav.getModelMap().get("myAttribute"));
</pre>
<h3>Compliant solution</h3>
<pre>
ModelAndView mav = getMyModelAndView();

ModelAndViewAssert.assertViewName(mav, "register");
ModelAndViewAssert.assertModelAttributeValue(mav, "myAttribute", Boolean.TRUE);
ModelAndViewAssert.assertModelAttributeValue(mav, "myAttribute", Boolean.FALSE);
ModelAndViewAssert.assertModelAttributeValue(mav, "myAttribute", myObject);
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/testing.html#unit-testing-spring-mvc">Unit Testing
  Spring MVC</a> </li>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/5.2.8.RELEASE/javadoc-api/org/springframework/test/web/ModelAndViewAssert.html">ModelAndViewAssert Javadoc</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Tests should be stable (java:S5973)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> TestNG documentation - <a href="https://testng.org/#_annotations">Annotations</a> </li>
  <li> Spotify Engineering - <a
  href="https://engineering.atspotify.com/2019/11/18/test-flakiness-methods-for-identifying-and-dealing-with-flaky-tests/">Test Flakiness - Methods
  for identifying and dealing with flaky tests</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Unstable / flaky tests are tests which sometimes pass and sometimes fail, without any code change. Obviously, they slow down developments when
developers have to rerun failed tests. However, the real problem is that you can’t completely trust these tests, they might fail for many different
reasons and you don’t know if any of them will happen in production.</p>
<p>Some tools, such as TestNG, enable developers to automatically retry flaky tests. This might be acceptable as a temporary solution, but it should
eventually be fixed. The more flaky tests you add, the more chances there are for a bug to arrive in production.</p>
<p>This rule raises an issue when the annotation <code>org.testng.annotations.Test</code> is given a <code>successPercentage</code> argument with a
value lower than <code>100</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
import org.testng.annotations.Test;

public class PercentageTest {
    @Test(successPercentage = 80, invocationCount = 10)  // Noncompliant. The test is allowed to fail 2 times.
    public void flakyTest() {
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Annotated Mockito objects should be initialized (java:S5979)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://site.mockito.org/javadoc/current/org/mockito/MockitoAnnotations.html">Mockito documentation - MockitoAnnotations</a> </li>
  <li> <a href="https://site.mockito.org/javadoc/current/org/mockito/junit/MockitoRule.html">Mockito documentation - MockitoRule </a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Objects annotated with Mockito annotations <code>@Mock</code>,&nbsp;<code>@Spy</code>,&nbsp;<code>@Captor</code>,&nbsp;or <code>@InjectMocks</code>
need to be initialized explicitly.</p>
<p>There are several ways to do this:</p>
<ul>
  <li> Call <code>MockitoAnnotations.openMocks(this)</code> or&nbsp;<code>MockitoAnnotations.initMocks(this)</code>&nbsp;in a setup method </li>
  <li> Annotate test class with&nbsp;<code>@RunWith(MockitoJUnitRunner.class)</code>&nbsp;(JUnit 4) </li>
  <li> Annotate test class with&nbsp;<code>@ExtendWith(MockitoExtension.class)</code>&nbsp;(JUnit 5 Jupiter) </li>
  <li> Use&nbsp;<code>@Rule public MockitoRule rule = MockitoJUnit.rule();</code> </li>
</ul>
<p>Test using uninitialized mocks will fail.</p>
<p>Note that this only applies to annotated Mockito objects. It is not necessary to initialize objects instantiated via <code>Mockito.mock()</code> or
<code>Mockito.spy()</code>.</p>
<p>This rule raises an issue when a test class uses uninitialized mocks.</p>
<h3>Noncompliant code example</h3>
<pre>
public class FooTest { // Noncompliant: Mockito initialization missing
  @Mock private Bar bar;

  @Spy private Baz baz;

  @InjectMocks private Foo fooUnderTest;

  @Test
  void someTest() {
    // test something ...
  }

  @Nested
  public class Nested {
    @Mock
    private Bar bar;
  }
</pre>
<h3>Compliant solution</h3>
<pre>
@RunWith(MockitoJUnitRunner.class)
public class FooTest {
  @Mock private Bar bar;
  // ...
}
</pre>
<pre>
@ExtendWith(MockitoExtension.class)
public class FooTest {
  @Mock private Bar bar;
  // ...
}
</pre>
<pre>
public class FooTest {
  @Rule
  public MockitoRule rule = MockitoJUnit.rule();

  @Mock private Bar bar;
  // ...
}
</pre>
<pre>
public class FooTest {
  @Mock private Bar bar;
  // ...

  @BeforeEach
  void setUp() {
    MockitoAnnotations.openMocks(this);
  }
  // ...
}
</pre>
<pre>
public class FooTest {
  @Mock private Bar bar;
  // ...

  @Before
  void setUp() {
    MockitoAnnotations.initMocks(this);
  }
  // ...
}
</pre>
<pre>
@ExtendWith(MockitoExtension.class)
public class FooTest {
  @Nested
  public class Nested {
    @Mock
    private Bar bar;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"@Autowired" should be used when multiple constructors are provided (java:S6829)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>The <code>@Autowired</code> annotation in Spring is used for automatic dependency injection. It allows Spring to resolve and inject the required
beans into your bean. For example to inject a <code>@Repository</code> object into a <code>@Service</code>.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use the <code>@Autowired</code> annotation to specify which constructor to use for auto-wiring.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Component
public class ExampleClass { // Noncompliant, multiple constructors present and no @Autowired annotation to specify which one to use

    private final DependencyClass1 dependency1;

    public ExampleClass() {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    public ExampleClass(DependencyClass1 dependency1) {
        this.dependency1 = dependency1;
    }

    // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Component
public class ExampleClass {

    private final DependencyClass1 dependency1;

    public ExampleClass() {
        throw new UnsupportedOperationException("Not supported yet.");
    }

    @Autowired
    public ExampleClass(DependencyClass1 dependency1) {
        this.dependency1 = dependency1;
    }

    // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring - <a href="https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired.html">Annotation Config:
  Autowired</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Java Guides - <a href="https://www.javaguides.net/2023/08/unsatisfieddependencyexception-in.html">UnsatisfiedDependencyException in Spring
  Boot</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The Spring dependency injection mechanism cannot identify which constructor to use for auto-wiring when multiple constructors are present in a
class. This ambiguity can cause the application to crash at runtime, and it makes the code less clear to understand and more complex to extend and
maintain.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <strong>Incorrect Instantiation</strong>: the wrong constructor is selected for instantiation, leading to a bean not being correctly
  initialized. </li>
  <li> <strong>Unsatisfied Dependency Exception</strong>: the constructor selected by Spring requires beans that are not available in the Spring
  context. </li>
  <li> <strong>Non-Deterministic Behavior</strong>: the constructor selected by Spring can vary, based on the number of dependencies that can be
  satisfied at runtime, leading to unpredictable application behavior. </li>
  <li> <strong>Maintainability Issues</strong>: adding more constructors in the future could lead to further confusion and potential bugs. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Methods should not have too many return statements (java:S1142)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Having too many return statements in a method increases the method’s essential complexity because the flow of execution is broken each time a
return statement is encountered. This makes it harder to read and understand the logic of the method.</p>
<h3>Noncompliant code example</h3>
<p>With the default threshold of 3:</p>
<pre>
public boolean myMethod() { // Noncompliant; there are 4 return statements
  if (condition1) {
    return true;
  } else {
    if (condition2) {
      return false;
    } else {
      return true;
    }
  }
  return false;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Jump statements should not occur in "finally" blocks (java:S1143)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/584">CWE-584 - Return Inside Finally Block</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/BTdGBQ">CERT, ERR04-J.</a> - Do not complete abruptly from a finally block </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Using <code>return</code>, <code>break</code>, <code>throw</code>, and so on from a <code>finally</code> block suppresses the propagation of any
unhandled <code>Throwable</code> which was thrown in the <code>try</code> or <code>catch</code> block.</p>
<p>This rule raises an issue when a jump statement (<code>break</code>, <code>continue</code>, <code>return</code>, <code>throw</code>, and
<code>goto</code>) would force control flow to leave a <code>finally</code> block.</p>
<h3>Noncompliant code example</h3>
<pre>
public static void main(String[] args) {
  try {
    doSomethingWhichThrowsException();
    System.out.println("OK");   // incorrect "OK" message is printed
  } catch (RuntimeException e) {
    System.out.println("ERROR");  // this message is not shown
  }
}

public static void doSomethingWhichThrowsException() {
  try {
    throw new RuntimeException();
  } finally {
    for (int i = 0; i &lt; 10; i ++) {
      //...
      if (q == i) {
        break; // ignored
      }
    }

    /* ... */
    return;      // Noncompliant - prevents the RuntimeException from being propagated
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public static void main(String[] args) {
  try {
    doSomethingWhichThrowsException();
    System.out.println("OK");
  } catch (RuntimeException e) {
    System.out.println("ERROR");  // "ERROR" is printed as expected
  }
}

public static void doSomethingWhichThrowsException() {
  try {
    throw new RuntimeException();
  } finally {
    for (int i = 0; i &lt; 10; i ++) {
      //...
      if (q == i) {
        break; // ignored
      }
    }

    /* ... */
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Unused "private" methods should be removed (java:S1144)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a private method is never referenced in the code.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A method that is never called is dead code, and should be removed. Cleaning out dead code decreases the size of the maintained codebase, making it
easier to understand the program and preventing bugs from being introduced.</p>
<p>This rule detects methods that are never referenced from inside a translation unit, and cannot be referenced from the outside.</p>

<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Foo implements Serializable
{
  public static void doSomething() {
    Foo foo = new Foo();
    ...
  }

  private void unusedPrivateMethod() {...}
  private void writeObject(ObjectOutputStream s) {...}  //Compliant, relates to the java serialization mechanism
  private void readObject(ObjectInputStream in) {...}  //Compliant, relates to the java serialization mechanism
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class Foo implements Serializable
{
  public static void doSomething(){
    Foo foo = new Foo();
    ...
  }

  private void writeObject(ObjectOutputStream s) {...}  //Compliant, relates to the java serialization mechanism
  private void readObject(ObjectInputStream in) {...}  //Compliant, relates to the java serialization mechanism
}
</pre>
<h3>Exceptions</h3>
<p>This rule doesn’t raise issues for:</p>
<ul>
  <li> annotated methods </li>
  <li> methods with parameters that are annotated with <code>@javax.enterprise.event.Observes</code> </li>
</ul>
<p>The rule does not take reflection into account, which means that issues will be raised on <code>private</code> methods that are only accessed using
the reflection API.</p></p>
            </div>
        <div class="rule">
            <h3>Exit methods should not be called (java:S1147)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/382">CWE-382 - Use of System.exit()</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/7zZGBQ">CERT, ERR09-J.</a> - Do not allow untrusted code to terminate the JVM </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Calling <code>System.exit(int status)</code> or <code>Rutime.getRuntime().exit(int status)</code> calls the shutdown hooks and shuts downs the
entire Java virtual machine. Calling <code>Runtime.getRuntime().halt(int)</code> does an immediate shutdown, without calling the shutdown hooks, and
skipping finalization.</p>
<p>Each of these methods should be used with extreme care, and only when the intent is to stop the whole Java process. For instance, none of them
should be called from applications running in a J2EE container.</p>
<h3>Noncompliant code example</h3>
<pre>
System.exit(0);
Runtime.getRuntime().exit(0);
Runtime.getRuntime().halt(0);
</pre>
<h3>Exceptions</h3>
<p>These methods are ignored inside <code>main</code>.</p></p>
            </div>
        <div class="rule">
            <h3>A "while" loop should be used instead of a "for" loop (java:S1264)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
for (;condition;) { /*...*/ } // Noncompliant; only the condition is specified
</pre>
<p>When only the condition expression is defined in a <code>for</code> loop, a <code>while</code> loop should be used instead to increase readability.
A <code>while</code> loop consists of a single loop condition and allows a block of code to be executed repeatedly as long as the specified condition
is true.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
while (condition) { /*...*/ }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/for.html">Java SE - The for Statement</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>for</code> loop is a type of loop construct that allows a block of code to be executed repeatedly for a fixed number of times. The
<code>for</code> loop is typically used when the number of iterations is known in advance and consists of three parts:</p>
<ul>
  <li> The initialization statement is executed once at the beginning of the loop. It is used to initialize the loop counter or any other variables
  that may be used in the loop. </li>
  <li> The loop condition is evaluated at the beginning of each iteration, and if it is <code>true</code>, the code inside the loop is executed. </li>
  <li> The update statement is executed at the end of each iteration and is used to update the loop counter or any other variables that may be used in
  the loop. </li>
</ul>
<pre>
for (initialization; termination; increment) { /*...*/ }
</pre>
<p>All three statements are optional. However, when the initialization and update statements are not used, it can be unclear to the reader what the
loop counter is and how it is being updated. This can make the code harder to understand and maintain.</p></p>
            </div>
        <div class="rule">
            <h3>Reflection should not be used to check non-runtime annotations (java:S2109)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Denoted by the "@" symbol, annotations are metadata that can be added to classes, methods, and variables for various purposes such as
documentation, code analysis, and runtime processing.</p>
<p>Annotations have retention policies that determine in which context they are retained and available for use. There are three retention policies for
annotations:</p>
<ul>
  <li> <code>RetentionPolicy.SOURCE</code> - Annotations are only available during compilation and code analysis. They are not included in the
  compiled class file and are not available at runtime. E.G. <code>@Override</code>, <code>@SuppressWarnings</code> </li>
  <li> <code>RetentionPolicy.CLASS</code> - Annotations are included in the compiled class file providing information to the compiler, but they are
  not retained by the JVM at runtime. This is the default retention policy. E.G. <code>@PreviewFeature</code> </li>
  <li> <code>RetentionPolicy.RUNTIME</code> - Annotations are included in the compiled class file and available at runtime. They can be accessed and
  used by the program through reflection. E.G. <code>@FunctionalInterface</code>, <code>@Deprecated</code> </li>
</ul>
<p>It is important to understand that only annotations having the <code>RUNTIME</code> retention policy can be accessed at runtime using reflection.
For example, the following if condition is true when the method argument is the <code>java.util.function.Function</code> class:</p>
<pre>
void execute(Class&lt;?&gt; cls) {
  if (cls.isAnnotationPresent(FunctionalInterface.class)) {
    // ...
  }
}
</pre>
<p>Therefore, it is an issue to use reflection in combination with annotations with the <code>SOURCE</code> or <code>CLASS</code> retention policy
because they are not present at runtime. For example, in the JVM source code, the <code>hashCode()</code> method of the <code>Integer</code> class has
the <code>@Override</code> annotation. However, the following if condition will always be false even if the method argument is the
<code>Integer#hashCode()</code> method because <code>@Override</code> has the <code>SOURCE</code> retention policy:</p>
<pre>
void execute(Method method) {
  if (method.isAnnotationPresent(Override.class)) { // Noncompliant, if condition will always be false because
                                                    // @Override is declared with @Retention(RetentionPolicy.SOURCE)
    // ...
  }
}
</pre>
<p>This rule detects improper reflective access on annotations having the <code>SOURCE</code> or <code>CLASS</code> retention policy.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/annotation/RetentionPolicy.html">Oracle SDK -
  java.lang.annotation.RetentionPolicy</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"BigDecimal(double)" should not be used (java:S2111)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>BigDecimal</code> is used to represents immutable, arbitrary-precision signed decimal numbers.</p>
<p>Differently from the <code>BigDecimal</code>, the <code>double</code> primitive type and the <code>Double</code> type have limited precision due to
the use of double-precision 64-bit IEEE 754 floating point. Because of floating point imprecision, the <code>BigDecimal(double)</code> constructor can
be somewhat unpredictable.</p>
<p>For example writing <code>new BigDecimal(0.1)</code> doesn’t create a BigDecimal which is exactly equal to 0.1, but it is equal to
0.1000000000000000055511151231257827021181583404541015625. This is because 0.1 cannot be represented exactly as a double (or, for that matter, as a
binary fraction of any finite length).</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/math/BigDecimal.html">Oracle - BigDecimal</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/kzdGBQ">CERT, NUM10-J</a> - Do not construct BigDecimal objects from floating-point literals
  </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use <code>BigDecimal.valueOf</code>, which uses a string under the covers to eliminate floating point rounding errors, or the constructor that
takes a <code>String</code> argument.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
double d = 1.1;

BigDecimal bd1 = new BigDecimal(d);   // Noncompliant
BigDecimal bd2 = new BigDecimal(1.1); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
double d = 1.1;

BigDecimal bd1 = BigDecimal.valueOf(d); // Compliant
BigDecimal bd2 = new BigDecimal("1.1"); // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>"URL.hashCode" and "URL.equals" should be avoided (java:S2112)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Use the <code>URI</code> class until access to the resource is actually needed.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void checkUrl(URL url) {
  Set&lt;URL&gt; sites = new HashSet&lt;URL&gt;();               // Noncompliant

  URL homepage = new URL("http://sonarsource.com");  // Compliant
  if (homepage.equals(url)) {                        // Noncompliant
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void checkUrl(URL url) {
  Set&lt;URI&gt; sites = new HashSet&lt;URI&gt;();               // Compliant

  URI homepage = new URI("http://sonarsource.com");  // Compliant
  URI uri = url.toURI();
  if (homepage.equals(uri)) {                        // Compliant
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/net/URL.html">Oracle Java SE - java.net.URL</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>equals</code> and <code>hashCode</code> methods of <code>java.net.URL</code> may trigger a name service lookup (typically DNS) to resolve
the hostname or IP address. Depending on the configuration, and network status, this lookup can be time-consuming.</p>
<p>On the other hand, the <code>URI</code> class does not perform such lookups and is a better choice unless you specifically require the
functionality provided by <code>URL</code>.</p>
<p>In general, it is better to use the <code>URI</code> class until access to the resource is actually needed, at which point you can convert the
<code>URI</code> to a <code>URL</code> using <code>URI.toURL()</code>.</p>
<p>This rule checks for uses of <code>URL</code> 's in <code>Map</code> and <code>Set</code> , and for explicit calls to the <code>equals</code> and
<code>hashCode</code> methods. It suggests reconsidering the use of <code>URL</code> in such scenarios to avoid potential performance issues related
to name service lookups.</p></p>
            </div>
        <div class="rule">
            <h3>Collections should not be passed as arguments to their own methods (java:S2114)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Passing a collection as an argument to the collection’s own method is either an error - some other argument was intended - or simply nonsensical
code.</p>
<p>Further, because some methods require that the argument remain unmodified during the execution, passing a collection to itself can result in
undefined behavior.</p>
<h3>Noncompliant code example</h3>
<pre>
List &lt;Object&gt; objs = new ArrayList&lt;Object&gt;();
objs.add("Hello");

objs.add(objs); // Noncompliant; StackOverflowException if objs.hashCode() called
objs.addAll(objs); // Noncompliant; behavior undefined
objs.containsAll(objs); // Noncompliant; always true
objs.removeAll(objs); // Noncompliant; confusing. Use clear() instead
objs.retainAll(objs); // Noncompliant; NOOP
</pre></p>
            </div>
        <div class="rule">
            <h3>A secure password should be used when connecting to a database (java:S2115)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>When accessing a database, an empty password should be avoided as it introduces a weakness.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code uses an empty password to connect to a Postgres database.</p>
<p>The vulnerability can be fixed by using a strong password retrieved from Properties. This <code>database.password</code> property is set during
deployment. Its value should be strong and different for each database.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="201" data-diff-type="noncompliant">
Connection conn = DriverManager.getConnection("jdbc:derby:memory:myDB;create=true", "login", ""); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="201" data-diff-type="compliant">
String password = System.getProperty("database.password");
Connection conn = DriverManager.getConnection("jdbc:derby:memory:myDB;create=true", "login", password);
</pre>
<h3>Pitfalls</h3>
<h4>Hard-coded passwords</h4>
<p>It could be tempting to replace the empty password with a hard-coded one. Hard-coding passwords in the code can pose significant security risks.
Here are a few reasons why it is not recommended:</p>
<ol>
  <li> Security Vulnerability: Hard-coded passwords can be easily discovered by anyone who has access to the code, such as other developers or
  attackers. This can lead to unauthorized access to the database and potential data breaches. </li>
  <li> Lack of Flexibility: Hard-coded passwords make it difficult to change the password without modifying the code. If the password needs to be
  updated, it would require recompiling and redeploying the code, which can be time-consuming and error-prone. </li>
  <li> Version Control Issues: Storing passwords in code can lead to version control issues. If the code is shared or stored in a version control
  system, the password will be visible to anyone with access to the repository, which is a security risk. </li>
</ol>
<p>To mitigate these risks, it is recommended to use secure methods for storing and retrieving passwords, such as using environment variables,
configuration files, or secure key management systems. These methods allow for better security, flexibility, and separation of sensitive information
from the codebase.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/environment/properties.html">Java Properties</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When a database does not require a password for authentication, it allows anyone to access and manipulate the data stored within it. Exploiting
this vulnerability typically involves identifying the target database and establishing a connection to it without the need for any authentication
credentials.</p>
<h3>What is the potential impact?</h3>
<p>Once connected, an attacker can perform various malicious actions, such as viewing, modifying, or deleting sensitive information, potentially
leading to data breaches or unauthorized access to critical systems. It is crucial to address this vulnerability promptly to ensure the security and
integrity of the database and the data it contains.</p>
<h4>Unauthorized Access to Sensitive Data</h4>
<p>When a database lacks a password for authentication, it opens the door for unauthorized individuals to gain access to sensitive data. This can
include personally identifiable information (PII), financial records, intellectual property, or any other confidential information stored in the
database. Without proper access controls in place, malicious actors can exploit this vulnerability to retrieve sensitive data, potentially leading to
identity theft, financial loss, or reputational damage.</p>
<h4>Compromise of System Integrity</h4>
<p>Without a password requirement, unauthorized individuals can gain unrestricted access to a database, potentially compromising the integrity of the
entire system. Attackers can inject malicious code, alter configurations, or manipulate data within the database, leading to system malfunctions,
unauthorized system access, or even complete system compromise. This can disrupt business operations, cause financial losses, and expose the
organization to further security risks.</p>
<h4>Unwanted Modifications or Deletions</h4>
<p>The absence of a password for database access allows anyone to make modifications or deletions to the data stored within it. This poses a
significant risk, as unauthorized changes can lead to data corruption, loss of critical information, or the introduction of malicious content. For
example, an attacker could modify financial records, tamper with customer orders, or delete important files, causing severe disruptions to business
processes and potentially leading to financial and legal consequences.</p>
<p>Overall, the lack of a password configured to access a database poses a serious security risk, enabling unauthorized access, data breaches, system
compromise, and unwanted modifications or deletions. It is essential to address this vulnerability promptly to safeguard sensitive data, maintain
system integrity, and protect the organization from potential harm.</p></p>
            </div>
        <div class="rule">
            <h3>"hashCode" and "toString" should not be called on array instances (java:S2116)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Use relevant static <code>Arrays</code> method.</p>
<ul>
  <li> <code>Arrays.hashCode</code> or <code>Arrays.deepHashCode</code> </li>
  <li> <code>Arrays.toString</code> or <code>Arrays.deepToString</code> </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public static void main(String[] args) {
    String argStr = args.toString();       // Noncompliant
    int argHash = args.hashCode();         // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public static void main(String[] args) {
    String argStr = Arrays.toString(args); // Compliant
    int argHash = Arrays.hashCode(args);   // Compliant
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The purpose of the <code>hashCode</code> method is to return a hash code based on the contents of the object. Similarly, the purpose of the
<code>toString</code> method is to provide a textual representation of the object’s contents.</p>
<p>Calling <code>hashCode()</code> and <code>toString()</code> directly on array instances should be avoided because the default implementations
provided by the <code>Object</code> class do not provide meaningful results for arrays. <code>hashCode()</code> returns the array’s "identity hash
code", and <code>toString()</code> returns nearly the same value. Neither method’s output reflects the array’s contents.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Arrays.html">Oracle Java SE - Arrays API</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://github.com/google/error-prone/blob/master/docs/bugpattern/ArrayHashCode.md">Error Prone - ArrayHashCode</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Methods with Spring proxying annotations should be public (java:S2230)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Async.html">Spring
  Framework API - Annotation Interface Async</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">Spring
  Framework API - Annotation Interface Transactional</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-async">Baeldung - How To Do @Async in Spring</a> </li>
  <li> <a href="https://stackoverflow.com/questions/22561775/spring-async-ignored">Stack Overflow - Spring @Async ignored</a> </li>
  <li> <a href="https://stackoverflow.com/questions/4396284/does-spring-transactional-attribute-work-on-a-private-method">Stack Overflow - Does Spring
  @Transactional attribute work on a private method?</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Declare the method <code>public</code>. Note that this action alone does not resolve the issue of direct instance calls from within the same class
(see rule <a href='/coding_rules#rule_key=java%3AS6809'>S6809</a>), but it is a required precondition to fix it.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Async
private Future&lt;String&gt; asyncMethodWithReturnType() { // Noncompliant, no proxy generated and
    return "Hellow, world!";                         // can only be invoked from same class
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Async
public Future&lt;String&gt; asyncMethodWithReturnType() { // Compliant
    return "Hellow, world!";
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Marking a non-public method <code>@Async</code> or <code>@Transactional</code> is misleading because Spring does not recognize non-public methods,
and so makes no provision for their proper invocation. Nor does Spring make provision for the methods invoked by the method it called.</p>
<p>Therefore marking a private method, for instance, @Transactional can only result in a runtime error or exception if the method is annotated as
@Transactional.</p></p>
            </div>
        <div class="rule">
            <h3>"ResultSet.isLast()" should not be used (java:S2232)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/ResultSet.html#isLast--">Java SE 8 API Specification: ResultSet.isLast()</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Refactor your code to use <code>ResultSet.next()</code> instead of <code>ResultSet.isLast()</code>. Be cautious of its different semantics and side
effects on cursor positioning in the result set. Verify that your program logic is still valid under these side effects and otherwise adjust it.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
ResultSet results = stmt.executeQuery("SELECT name, address FROM PERSON");
StringBuilder sb = new StringBuilder();
while (results.next() &amp;&amp; !results.isLast()) { // Noncompliant
  sb.append(results.getString("name") + ", ");
}
sb.append(results.getString("name"));
String formattedNames = sb.toString();
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
ResultSet results = stmt.executeQuery("SELECT name, address FROM PERSON");
List&lt;String&gt; names = new ArrayList&lt;&gt;();
while (results.next()) { // Compliant, and program logic refactored
  names.add(results.getString("name"));
}
String formattedNames =  names.stream().collect(Collectors.joining(", "));
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>There are several reasons to avoid using this method:</p>
<ol>
  <li> It is optionally available only for result sets of type <code>ResultSet.TYPE_FORWARD_ONLY</code>. Database drivers will throw an exception if
  not supported. </li>
  <li> The method can be expensive to execute as the database driver may need to fetch ahead one row to determine whether the current row is the last
  in the result set. The documentation of the method explicitly mentions this fact. </li>
  <li> What "the cursor is on the last row" means for an empty <code>ResultSet</code> is unclear. Database drivers may return <code>true</code> or
  <code>false</code> in this case . </li>
</ol>
<p><code>ResultSet.next()</code> is a good alternative to <code>ResultSet.isLast()</code> as it does not have the mentioned issues. It is always
supported and, as per specification, returns <code>false</code> for empty result sets.</p></p>
            </div>
        <div class="rule">
            <h3>Parameters should be passed in the correct order (java:S2234)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the names of parameters in a method call match the names of the method arguments, it contributes to clearer, more readable code. However, when
the names match, but are passed in a different order than the method arguments, it indicates a mistake in the parameter order which will likely lead
to unexpected results.</p>
<h3>Noncompliant code example</h3>
<pre>
public double divide(int divisor, int dividend) {
  return divisor/dividend;
}

public void doTheThing() {
  int divisor = 15;
  int dividend = 5;

  double result = divide(dividend, divisor);  // Noncompliant; operation succeeds, but result is unexpected
  //...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public double divide(int divisor, int dividend) {
  return divisor/dividend;
}

public void doTheThing() {
  int divisor = 15;
  int dividend = 5;

  double result = divide(divisor, dividend);
  //...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"IllegalMonitorStateException" should not be caught (java:S2235)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>IllegalMonitorStateException</code> is an exception that occurs when a thread tries to perform an operation on an object’s monitor that
it does not own. This exception is typically thrown when a method like <code>wait()</code>, <code>notify()</code>, or <code>notifyAll()</code> is
called outside a synchronized block or method.</p>
<p><code>IllegalMonitorStateException</code> is specifically designed to be an unchecked exception to point out a programming mistake. This exception
serves as a reminder for developers to rectify their code by correctly acquiring and releasing locks using synchronized blocks or methods. It also
emphasizes the importance of calling monitor-related methods on the appropriate objects to ensure proper synchronization.</p>
<p>Catching and handling this exception can mask underlying synchronization issues and lead to unpredictable behavior.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doSomething() {
  try {
    anObject.notify();
  } catch(IllegalMonitorStateException e) { // Noncompliant
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public void doSomething() {
  synchronized(anObject) {
    anObject.notify();
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/IllegalMonitorStateException.html">Oracle Java SE -
  IllegalMonitorStateException</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Methods "wait(...)", "notify()" and "notifyAll()" should not be called on Thread instances (java:S2236)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Thread.html">Oracle Java SE - Thread</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Object.html">Oracle Java SE - Object</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Java, the <code>Thread</code> class represents a thread of execution. Synchronization between threads is typically achieved using objects or
shared resources.</p>
<p>The methods <code>wait(…​)</code>, <code>notify()</code>, and <code>notifyAll()</code> are related to the underlying object’s monitor and are
designed to be called on objects that act as locks or monitors for synchronization. These methods are available on Java <code>Object</code> and,
therefore, automatically inherited by all objects, including <code>Thread.</code></p>
<p>Calling these methods on a <code>Thread</code> may corrupt the behavior of the JVM, which relies on them to change the state of the thread
(<code>BLOCKED,</code> <code>WAITING,</code>…​).</p>
<h3>Noncompliant code example</h3>
<pre>
Thread myThread = new Thread(new RunnableJob());
...
myThread.wait(); // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Whitespace and control characters in literals should be explicit (java:S2479)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Non-encoded control characters and whitespace characters are often injected in the source code because of a bad manipulation. They are either
invisible or difficult to recognize, which can result in bugs when the string is not what the developer expects. If you actually need to use a control
character use their encoded version (ex: ASCII <code>\n,\t,</code>…​ or Unicode <code>U+000D, U+0009,</code>…​).</p>
<p>This rule raises an issue when the following characters are seen in a literal string:</p>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/ASCII#Control_characters">ASCII control character</a>. (character index &lt; 32 or = 127) </li>
  <li> Unicode <a href="https://en.wikipedia.org/wiki/Unicode_character_property#Whitespace">whitespace characters</a>. </li>
  <li> Unicode <a href="https://en.wikipedia.org/wiki/C0_and_C1_control_codes">C0 control characters</a> </li>
  <li> Unicode characters <code>U+200B, U+200C, U+200D, U+2060, U+FEFF, U+2028, U+2029</code> </li>
</ul>
<p>No issue will be raised on the simple space character. Unicode <code>U+0020</code>, ASCII 32.</p>
<h3>Noncompliant code example</h3>
<pre>
String tabInside = "A	B";  // Noncompliant, contains a tabulation
String zeroWidthSpaceInside = "foo​bar"; // Noncompliant, it contains a U+200B character inside
char tab = '	';
</pre>
<h3>Compliant solution</h3>
<pre>
String tabInside = "A\tB";  // Compliant, uses escaped value
String zeroWidthSpaceInside = "foo\u200Bbar";  // Compliant, uses escaped value
char tab = '\t';
</pre></p>
            </div>
        <div class="rule">
            <h3>Value-based objects should not be serialized (java:S3437)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>According to the documentation,</p>
<blockquote>
  <p>A program may produce unpredictable results if it attempts to distinguish two references to equal values of a value-based class, whether directly
  via reference equality or indirectly via an appeal to synchronization, identity hashing, serialization…​</p>
</blockquote>
<p>For example (credit to Brian Goetz), imagine Foo is a value-based class:</p>
<pre>
Foo[] arr = new Foo[2];
arr[0] = new Foo(0);
arr[1] = new Foo(0);
</pre>
<p>Serialization promises that on deserialization of arr, elements 0 and 1 will not be aliased. Similarly, in:</p>
<pre>
Foo[] arr = new Foo[2];
arr[0] = new Foo(0);
arr[1] = arr[0];
</pre>
<p>Serialization promises that on deserialization of <code>arr</code>, elements 0 and 1 <strong>will</strong> be aliased.</p>
<p>While these promises are coincidentally fulfilled in current implementations of Java, that is not guaranteed in the future, particularly when true
value types are introduced in the language.</p>
<p>This rule raises an issue when a <code>Serializable</code> class defines a non-transient, non-static field field whose type is a known serializable
value-based class. Known serializable value-based classes are: all the classes in the <code>java.time</code> package except <code>Clock</code>; the
date classes for alternate calendars: <code>HijrahDate</code>, <code>JapaneseDate</code>, <code>MinguoDate</code>, <code>ThaiBuddhistDate</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
class MyClass implements Serializable {
  private HijrahDate date;  // Noncompliant; mark this transient
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
class MyClass implements Serializable {
  private transient HijrahDate date;
  // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/doc-files/ValueBased.html">Value-based classes</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Track uses of disallowed classes (java:S3688)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule allows banning certain classes.</p>
<h3>Noncompliant code example</h3>
<p>Given parameters:</p>
<ul>
  <li> className:java.lang.String </li>
</ul>
<pre>
String name;  // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>"@Deprecated" code marked for removal should never be used (java:S5738)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Usage of deprecated classes, interfaces, and their methods explicitly marked for removal is discouraged. A developer should either migrate to
alternative methods or refactor the code to avoid the deprecated ones.</p>

<h4>Noncompliant code example</h4>
<pre>
/**
 * @deprecated As of release 1.3, replaced by {@link #Fee}. Will be dropped with release 1.4.
 */
@Deprecated(forRemoval=true)
public class Foo { ... }

public class Bar {
  /**
   * @deprecated  As of release 1.7, replaced by {@link #doTheThingBetter()}
   */
  @Deprecated(forRemoval=true)
  public void doTheThing() { ... }

  public void doTheThingBetter() { ... }

  /**
   * @deprecated As of release 1.14 due to poor performances.
   */
  @Deprecated(forRemoval=false)
  public void doTheOtherThing() { ... }
}

public class Qix extends Bar {
  @Override
  public void doTheThing() { ... } // Noncompliant; don't override a deprecated method marked for removal
}

public class Bar extends Foo {  // Noncompliant; Foo is deprecated and will be removed

  public void myMethod() {
    Bar bar = new Bar();  // okay; the class isn't deprecated
    bar.doTheThing();  // Noncompliant; doTheThing method is deprecated and will be removed

    bar.doTheOtherThing(); // Okay; deprecated, but not marked for removal
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>With the introduction of Java 9, the standard annotation class <code>java.lang.Deprecated</code> has been updated with new parameters. Notably, a
boolean parameter <code>forRemoval</code> has been added to clearly signify whether the deprecated code is intended to be removed in the future. This
is indicated with <code>forRemoval=true</code>. The javadoc of the annotation explicitly mentions the following:</p>
<blockquote>
  <p>This annotation type has a boolean-valued element <code>forRemoval</code>. A value of <code>true</code> indicates intent to remove the annotated
  program element in a future version. A value of <code>false</code> indicates that use of the annotated program element is discouraged, but at the
  time the program element was annotated, there was no specific intent to remove it.</p>
</blockquote>
<p>While it is generally recommended for developers to steer clear of using deprecated classes, interfaces, and their deprecated members, those
already marked for removal will surely block you from upgrading your dependency. Usage of deprecated code should be avoided or eliminated as soon as
possible to prevent accumulation and allow a smooth upgrade of dependencies.</p>
<p>The deprecated code is usually no longer maintained, can contain some bugs or vulnerabilities, and usually indicates that there is a better way to
do the same thing. Removing it can even lead to significant improvement of your software.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/477">CWE-477 - Use of Obsolete Functions</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/6TdGBQ">CERT, MET02-J.</a> - Do not use deprecated or obsolete classes or methods </li>
  <li> RSPEC-1874 for standard deprecation use </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Names of regular expressions named groups should be used (java:S5860)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Why use named groups only to never use any of them later on in the code?</p>
<p>This rule raises issues every time named groups are:</p>
<ul>
  <li> defined but never called anywhere in the code through their name; </li>
  <li> defined but called elsewhere in the code by their number instead; </li>
  <li> referenced while not defined. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
String date = "01/02";

Pattern datePattern = Pattern.compile("(?&lt;month&gt;[0-9]{2})/(?&lt;year&gt;[0-9]{2})");
Matcher dateMatcher = datePattern.matcher(date);

if (dateMatcher.matches()) {
  checkValidity(dateMatcher.group(1), dateMatcher.group(2));  // Noncompliant - numbers instead of names of groups are used
  checkValidity(dateMatcher.group("day")); // Noncompliant - there is no group called "day"
}

// ...

String score = "14:1";

Pattern scorePattern = Pattern.compile("(?&lt;player1&gt;[0-9]+):(?&lt;player2&gt;[0-9]+)"); // Noncompliant - named groups are never used
Matcher scoreMatcher = scorePattern.matcher(score);

if (scoreMatcher.matches()) {
  checkScore(score);
}
</pre>
<h3>Compliant solution</h3>
<pre>
String date = "01/02";

Pattern datePattern = Pattern.compile("(?&lt;month&gt;[0-9]{2})/(?&lt;year&gt;[0-9]{2})");
Matcher dateMatcher = datePattern.matcher(date);

if (dateMatcher.matches()) {
  checkValidity(dateMatcher.group("month"), dateMatcher.group("year"));
}

// ...

String score = "14:1";

Pattern scorePattern = Pattern.compile("(?&lt;player1&gt;[0-9]+):(?&lt;player2&gt;[0-9]+)");
Matcher scoreMatcher = scorePattern.matcher(score);

if (scoreMatcher.matches()) {
  checkScore(scoreMatcher.group("player1"));
  checkScore(scoreMatcher.group("player2"));
}
</pre>
<p>Or, using dedicated variables instead of group names:</p>
<pre>
String score = "14:1";

String player = "([0-9]+)";
String gameScore = player + ":" + player;

Pattern scorePattern = Pattern.compile(gameScore);
Matcher scoreMatcher = scorePattern.matcher(score);

if (scoreMatcher.matches()) {
  checkScore(score);
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Case insensitive Unicode regular expressions should enable the "UNICODE_CASE" flag (java:S5866)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>By default case insensitivity only affects letters in the ASCII range. This can be changed by either passing <code>Pattern.UNICODE_CASE</code> or
<code>Pattern.UNICODE_CHARACTER_CLASS</code> as an argument to <code>Pattern.compile</code> or using <code>(?u)</code> or <code>(?U)</code> within the
regex.</p>
<p>If not done, regular expressions involving non-ASCII letters will still handle those letters as being case sensitive.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("söme pättern", Pattern.CASE_INSENSITIVE);
str.matches("(?i)söme pättern");
str.matches("(?i:söme) pättern");
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("söme pättern", Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CASE);
str.matches("(?iu)söme pättern");
str.matches("(?iu:söme) pättern");

// UNICODE_CHARACTER_CLASS implies UNICODE_CASE
Pattern.compile("söme pättern", Pattern.CASE_INSENSITIVE | Pattern.UNICODE_CHARACTER_CLASS);
str.matches("(?iU)söme pättern");
str.matches("(?iU:söme) pättern");
</pre></p>
            </div>
        <div class="rule">
            <h3>Unicode-aware versions of character classes should be preferred (java:S5867)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When using POSIX classes like <code>\p{Alpha}</code> without the <code>UNICODE_CHARACTER_CLASS</code> flag or when using hard-coded character
classes like <code>"[a-zA-Z]"</code>, letters outside of the ASCII range, such as umlauts, accented letters or letter from non-Latin languages, won’t
be matched. This may cause code to incorrectly handle input containing such letters.</p>
<p>To correctly handle non-ASCII input, it is recommended to use Unicode classes like <code>\p{IsAlphabetic}</code>. When using POSIX classes, Unicode
support should be enabled by either passing <code>Pattern.UNICODE_CHARACTER_CLASS</code> as a flag to <code>Pattern.compile</code> or by using
<code>(?U)</code> inside the regex.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("[a-zA-Z]");
Pattern.compile("\\p{Alpha}");
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("\\p{IsAlphabetic}"); // matches all letters from all languages
Pattern.compile("\\p{IsLatin}"); // matches latin letters, including umlauts and other non-ASCII variations
Pattern.compile("\\p{Alpha}", Pattern.UNICODE_CHARACTER_CLASS);
Pattern.compile("(?U)\\p{Alpha}");
</pre></p>
            </div>
        <div class="rule">
            <h3>Bean names should adhere to the naming conventions (java:S6830)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring Framework Documentation - <a href="https://docs.spring.io/spring-framework/reference/core/beans/definition.html#beans-beanname">3.3 Bean
  overview</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Java Guides - <a href="https://www.javaguides.net/2019/03/spring-boot-best-practices.html">Spring Boot Best Practices</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Change the bean’s name to adhere to the naming conventions. Names should be camel-cased and start with a lowercase letter, for example,
<code>myBean</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Bean(name = "MyBean") // Noncompliant, the first letter of the name should be lowercase
public MyBean myBean() {
    ...
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Bean(name = "myBean") // Compliant
public MyBean myBean() {
    ...
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
@Service("my_service") // Noncompliant, the name should be camel-cased
public class MyService {
    ...
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
@Service("myService") // Compliant
public class MyService {
    ...
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Consistent naming of beans is important for the readability and maintainability of the code. More precisely, according to the Spring
documentation:</p>
<pre>
Naming beans consistently makes your configuration easier to read and understand. Also, if you use Spring AOP, it helps a lot when applying advice to a set of beans related by name.
</pre>
<p>Not following accepted conventions can introduce inconsistent naming, especially when multiple developers work on the same project, leading to
technical debt.</p>
<p>The spring documentation establishes a naming convention that consists of camel-cased names with a leading lowercase letter.</p>
<p>This rule raises an issue when a bean name defined in one of the following annotations does not adhere to the naming convention:</p>
<ul>
  <li> <code>@Bean</code> </li>
  <li> <code>@Configuration</code> </li>
  <li> <code>@Controller</code> </li>
  <li> <code>@Component</code> </li>
  <li> <code>@Qualifier</code> </li>
  <li> <code>@Repository</code> </li>
  <li> <code>@Service</code> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Non-singleton Spring beans should not be injected into singleton beans (java:S6832)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Spring, singleton beans and their dependencies are initialized when the application context is created.</p>
<p>If a <code>Singleton</code> bean depends on a bean with a shorter-lived scope (like <code>Request</code> or <code>Session</code> beans), it retains
the same instance of that bean, even when new instances are created for each Request or Session. This mismatch can cause unexpected behavior and bugs,
as the Singleton bean doesn’t interact correctly with the new instances of the shorter-lived bean.</p>
<p>This rule raises an issue when non-singleton beans are injected into a singleton bean.</p>
<h3>What is the potential impact?</h3>
<p>When a <code>Singleton</code> bean has a dependency on a bean with a shorter-lived scope, it can lead to the following issues:</p>
<ul>
  <li> <strong>Data inconsistency</strong>: any state change in the shorter-lived bean will not be reflected in the Singleton bean. </li>
  <li> <strong>Incorrect behavior</strong>: using the same instance of the shorter-lived bean, when a new instance is supposed to be created for each
  new request or session. </li>
  <li> <strong>Memory leaks</strong>: preventing garbage collection of a shorter-lived bean that allocates a significant amount of data over time.
  </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>In Spring the scope of a bean defines the lifecycle and visibility of that bean in the Spring container. There are six scopes:</p>
<ul>
  <li> <strong>Singleton</strong>: default, one instance per Spring container </li>
  <li> <strong>Prototype</strong>: a new instance per bean request </li>
  <li> <strong>Request</strong>: a new instance per HTTP request </li>
  <li> <strong>Session</strong>: a new instance per HTTP session </li>
  <li> <strong>Application</strong>: a new instance per ServletContext </li>
  <li> <strong>Websocket</strong>: a new instance per Websocket session </li>
</ul>
<p>The last four scopes mentioned, request, session, application and websocket, are only available in a web-aware application.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring Framework - <a href="https://docs.spring.io/spring-framework/reference/core/beans/factory-scopes.html">Factory Scopes</a> </li>
  <li> Spring Framework - <a href="https://docs.spring.io/spring-framework/reference/core/beans/standard-annotations.html#beans-inject-named">Beans
  Inject Named</a> </li>
  <li> Spring Framework - <a href="https://docs.spring.io/spring-framework/reference/core/beans/dependencies/factory-method-injection.html">Method
  Injection</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Baeldung - <a href="https://www.baeldung.com/spring-bean-scopes">Spring Bean Scopes</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Inject a shorter-lived bean into a <code>Singleton</code> bean using <strong>ApplicationContext</strong>, <strong>Factories</strong> or
<strong>Providers</strong>.</p>

<h4>Noncompliant code example</h4>
<p>When a <code>Singleton</code> bean auto-wires a <code>Request</code> bean, the dependency is resolved at instantiation time and thus the same
instance is used for each HTTP request.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Component
@Scope(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
public class RequestBean {
    //...
}

public class SingletonBean {
    @Autowired
    private final RequestBean requestBean; // Noncompliant, the same instance of RequestBean is used for each HTTP request.

    public RequestBean getRequestBean() {
        return requestBean;
    }
}
</pre>
<h4>Compliant solution</h4>
<p>Instead, use a <code>ObjectFactory&lt;RequestBean&gt;</code>, <code>ObjectProvider&lt;RequestBean&gt;</code>, or
<code>Provider&lt;RequestBean&gt;</code> as injection point (as for <a
href="https://docs.spring.io/spring-framework/reference/core/beans/standard-annotations.html#beans-inject-named">JSR-330</a>).</p>
<p>Such a dependency is resolved at runtime, allowing for actual injection of a new instance of the shorter-lived bean on each HTTP request.</p>
<pre data-diff-id="1" data-diff-type="compliant">
@Component
@Scope(value = WebApplicationContext.SCOPE_REQUEST, proxyMode = ScopedProxyMode.TARGET_CLASS)
public class RequestBean {
    //...
}

public class SingletonBean {
    private final ObjectFactory&lt;RequestBean&gt; requestBeanFactory;

    @Autowired
    public SingletonBean(ObjectFactory&lt;RequestBean&gt; requestBeanFactory) {
        this.requestBeanFactory = requestBeanFactory;
    }

    public RequestBean getRequestBean() {
        return requestBeanFactory.getObject();
    }
}
</pre>
<h4>Noncompliant code example</h4>
<p>When a <code>Singleton</code> bean auto-wires a <code>Prototype</code> bean, the dependency is resolved at instantiation time and thus the same
instance is used for each bean request.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
@Component
@Scope("prototype")
public class PrototypeBean {
    public Object execute() {
      //...
    }
}

public class SingletonBean {
    private PrototypeBean prototypeBean;

    @Autowired
    public SingletonBean(PrototypeBean prototypeBean) { // Noncompliant, the same instance of PrototypeBean is used for each bean request.
      this.prototypeBean = prototypeBean;
    }

    public Object process() {
        return prototypeBean.execute();
    }
}
</pre>
<h4>Compliant solution</h4>
<p>Using the <code>ApplicationContext</code> to retrieve a new instance of a <code>Prototype</code> bean on each bean request.</p>
<pre data-diff-id="2" data-diff-type="compliant">
@Component
@Scope("prototype")
public class PrototypeBean {
    public Object execute() {
      //...
    }
}

public class SingletonBean implements ApplicationContextAware {
    private ApplicationContext applicationContext;

    @Autowired
    public SingletonBean(ApplicationContext applicationContext) {
      this.applicationContext = applicationContext;
    }

    public Object process() {
        PrototypeBean prototypeBean = createPrototypeBean();
        return prototypeBean.execute();
    }

    protected PrototypeBean createPrototypeBean() {
        return this.applicationContext.getBean("prototypeBean", PrototypeBean.class);
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"@Controller" should be replaced with "@RestController" (java:S6833)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Classes annotated as <code>@Controller</code> in Spring are responsible for handling incoming web requests. When annotating methods or the entire
controller with <code>@ResponseBody</code>, the return value of said methods will be serialized and set as the response body. In other words, it tells
the Spring framework that this method does not produce a view. This mechanism is commonly used to create API endpoints.</p>
<p>Spring provides <code>@RestController</code> as a convenient annotation to replace the combination of <code>@Controller</code> and
<code>@ResponseBody</code>. The two are functionally identical, so the single annotation approach is preferred.</p>
<p>This rule will raise an issue on a class that is annotated with <code>@Controller</code> if:</p>
<ul>
  <li> the class is also annotated with <code>@ResponseBody</code> or </li>
  <li> all methods in said class are annotated with <code>@ResponseBody</code>. </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> Spring Guides - <a href="https://spring.io/guides/gs/rest-service/">Building a RESTful Web Service</a> </li>
  <li> Baeldung - <a href="https://www.baeldung.com/spring-controller-vs-restcontroller">The Spring @Controller and @RestController Annotations</a>
  </li>
  <li> Baeldung - <a href="https://www.baeldung.com/spring-request-response-body">Spring’s RequestBody and ResponseBody Annotations</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace the <code>@Controller</code> annotation with the <code>@RestController</code> annotation and remove all <code>@ResponseBody</code>
annotations from the class and its methods.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Controller
@ResponseBody
public class MyController {
    @GetMapping("/hello")
    public String hello() {
        return "Hello World!";
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@RestController
public class MyController {
    @GetMapping("/hello")
    public String hello() {
        return "Hello World!";
    }
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
@Controller
public class MyController {
    @ResponseBody
    @GetMapping("/hello")
    public String hello() {
        return "Hello World!";
    }

    @ResponseBody
    @GetMapping("/foo")
    public String foo() {
        return "Foo";
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
@RestController
public class MyController {
    @GetMapping("/hello")
    public String hello() {
        return "Hello World!";
    }

    @GetMapping("/foo")
    public String foo() {
        return "Foo";
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Limited dependence should be placed on operator precedence (java:S864)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/YdYxBQ">CERT, EXP00-C.</a> - Use parentheses for precedence of operation </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ZzZGBQ">CERT, EXP53-J.</a> - Use parentheses for precedence of operation </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/783">CWE-783 - Operator Precedence Logic Error</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The rules of operator precedence are complicated and can lead to errors. For this reason, parentheses should be used for clarification in complex
statements. However, this does not mean that parentheses should be gratuitously added around every operation.</p>
<p>This rule raises issues when <code>&amp;&amp;</code> and <code>||</code> are used in combination, when assignment and equality or relational
operators are used together in a condition, and for other operator combinations according to the following table:</p>
<table>
  <colgroup>
    <col style="width: 16.6666%;">
    <col style="width: 16.6666%;">
    <col style="width: 16.6666%;">
    <col style="width: 16.6666%;">
    <col style="width: 16.6666%;">
    <col style="width: 16.667%;">
  </colgroup>
  <thead>
    <tr>
      <th></th>
      <th><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></th>
      <th><code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>&gt;&gt;&gt;</code></th>
      <th><code>&amp;</code></th>
      <th><code>^</code></th>
      <th><code>|</code></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code></p></td>
      <td></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
    </tr>
    <tr>
      <td><p><code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>&gt;&gt;&gt;</code></p></td>
      <td><p>x</p></td>
      <td></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
    </tr>
    <tr>
      <td><p><code>&amp;</code></p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
    </tr>
    <tr>
      <td><p><code>^</code></p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td></td>
      <td><p>x</p></td>
    </tr>
    <tr>
      <td><p><code>|</code></p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td><p>x</p></td>
      <td></td>
    </tr>
  </tbody>
</table>
<p>This rule also raises an issue when the "true" or "false" expression of a ternary operator is not trivial and not wrapped inside parentheses.</p>
<h3>Noncompliant code example</h3>
<pre>
x = a + b - c;
x = a + 1 &lt;&lt; b;  // Noncompliant
y = a == b ? a * 2 : a + b;  // Noncompliant

if ( a &gt; b || c &lt; d || a == d) {...}
if ( a &gt; b &amp;&amp; c &lt; d || a == b) {...}  // Noncompliant
if (a = f(b,c) == 1) { ... } // Noncompliant; == evaluated first
</pre>
<h3>Compliant solution</h3>
<pre>
x = a + b - c;
x = (a + 1) &lt;&lt; b;
y = a == b ? (a * 2) : (a + b);

if ( a &gt; b || c &lt; d || a == d) {...}
if ( (a &gt; b &amp;&amp; c &lt; d) || a == b) {...}
if ( (a = f(b,c)) == 1) { ... }
</pre></p>
            </div>
        <div class="rule">
            <h3>Try-catch blocks should not be nested (java:S1141)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Nesting <code>try</code>/<code>catch</code> blocks severely impacts the readability of source code because it makes it too difficult to understand
which block will catch which exception.</p></p>
            </div>
        <div class="rule">
            <h3>Synchronized classes "Vector", "Hashtable", "Stack" and "StringBuffer" should not be used (java:S1149)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Early classes of the Java API, such as <code>Vector</code>, <code>Hashtable</code> and <code>StringBuffer</code>, were synchronized to make them
thread-safe. However, synchronization has a significant negative impact on performance, even when using these collections from a single thread.</p>
<p>It is often best to use their non-synchronized counterparts:</p>
<ul>
  <li> <code>ArrayList</code> or <code>LinkedList</code> instead of <code>Vector</code> </li>
  <li> <code>Deque</code> instead of <code>Stack</code> </li>
  <li> <code>HashMap</code> instead of <code>Hashtable</code> </li>
  <li> <code>StringBuilder</code> instead of <code>StringBuffer</code> </li>
</ul>
<p>Even when used in synchronized contexts, you should think twice before using their synchronized counterparts, since their usage can be costly. If
you are confident the usage is legitimate, you can safely ignore this warning.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
Vector&lt;Cat&gt; cats = new Vector&lt;&gt;();
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
ArrayList&lt;Cat&gt; cats = new ArrayList&lt;&gt;();
</pre>
<h3>Exceptions</h3>
<p>Usage of these synchronized classes is ignored in the signatures of overriding methods.</p>
<pre>
@Override
public Vector getCats() {...} // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Package declaration should match source file directory (java:S1598)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-declared-expected-package-error">Baeldung - Fixing the "Declared package does not match the expected
  package" Error</a> </li>
  <li> <a href="https://www.baeldung.com/java-file-vs-file-path-separator">Stackoverflow - Why do java source files require package declarations?</a>
  </li>
  <li> <a
  href="https://www.tutorialspoint.com/what-are-the-best-practices-to-keep-in-mind-while-using-packages-in-java#:~:text=Naming%20conventions%20and%20best%20practices%20for%20packages">tutorialspoint - What are the best practices to keep in mind while using packages in Java?</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Either move the source file so that the relative file path within the source directory matches the package name, or change the package name so that
it matches the relative file path.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
// file: src/main/foo/Fubar.java
package com.foo.bar;

class Fubar {
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
// file: src/main/com/foo/bar/Fubar.java
package com.foo.bar;

class Fubar {
}
</pre>
<pre>
// file: src/main/foo/Fubar.java
package foo;

class Fubar {
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The purpose of Java packages is to give structure to your project. A structure helps to mentally break down a project into smaller parts,
simplifying readers' understanding of how components are connected and how they interact.</p>
<p>By convention, the source files' directory structure should replicate the project’s package structure. This is for the following reasons:</p>
<ol>
  <li> The mapping between the package name and the location of the source file of a class is straightforward. That is, the path to the source file is
  easier to find for a given fully qualified class name. </li>
  <li> If two different structures are applied to the same project - one to the packages but another to the source file directories - this confuses
  developers while not providing any benefit. </li>
  <li> The directory structure of the class files generated by the compiler will match the package structure, no matter the source file’s directory.
  It would not make sense to have one directory structure for the generated class files but a different one for the associated source files. </li>
</ol>
<p>Similarly, a source directory should not have the character <code>.</code> in its name, as this would make it impossible to match the directory to
the package structure.</p></p>
            </div>
        <div class="rule">
            <h3>Invalid "Date" values should not be used (java:S2110)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Whether the valid value ranges for <code>Date</code> fields start with 0 or 1 varies by field. For instance, month starts at 0, and day of month
starts at 1. Enter a date value that goes past the end of the valid range, and the date will roll without error or exception. For instance, enter 12
for month, and you’ll get January of the following year.</p>
<p>This rule checks for bad values used in conjunction with <code>java.util.Date</code>, <code>java.sql.Date</code>, and
<code>java.util.Calendar</code>. Specifically, values outside of the valid ranges:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Field</th>
      <th>Valid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>month</p></td>
      <td><p>0-11</p></td>
    </tr>
    <tr>
      <td><p>date (day)</p></td>
      <td><p>0-31</p></td>
    </tr>
    <tr>
      <td><p>hour</p></td>
      <td><p>0-23</p></td>
    </tr>
    <tr>
      <td><p>minute</p></td>
      <td><p>0-60</p></td>
    </tr>
    <tr>
      <td><p>second</p></td>
      <td><p>0-61</p></td>
    </tr>
  </tbody>
</table>
<p>Note that this rule does not check for invalid leap years, leap seconds (second = 61), or invalid uses of the 31st day of the month.</p>
<h3>Noncompliant code example</h3>
<pre>
Date d = new Date();
d.setDate(25);
d.setYear(2014);
d.setMonth(12);  // Noncompliant; rolls d into the next year

Calendar c = new GregorianCalendar(2014, 12, 25);  // Noncompliant
if (c.get(Calendar.MONTH) == 12) {  // Noncompliant; invalid comparison
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
Date d = new Date();
d.setDate(25);
d.setYear(2014);
d.setMonth(11);

Calendar c = new Gregorian Calendar(2014, 11, 25);
if (c.get(Calendar.MONTH) == 11) {
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"writeObject" argument must implement "Serializable" (java:S2118)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/io/Serializable.html">Oracle Java SE - Serializable</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/io/ObjectOutputStream.html">Oracle Java SE - ObjectOutputStream</a>
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Serialization is a platform-independent mechanism for writing the state of an object into a byte-stream. For serializing the object, we call the
<code>writeObject()</code> method of <code>java.io.ObjectOutputStream</code> class. Only classes that implement <code>Serializable</code> or extend a
class that does it can successfully be serialized (or de-serialized).</p>
<p>Attempting to write a class with the <code>writeObject</code> method of the <code>ObjectOutputStream</code> class that does not implement
<code>Serializable</code> or extends a class that implements it, will throw an <code>IOException</code>.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The object class passed as an argument to the <code>writeObject</code> must implement <code>Serializable</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Vegetable {
  // ...
}

public class Menu {
  public void meal(ObjectOutputStream oos) throws IOException {
    Vegetable veg = new Vegetable();
    oos.writeObject(veg);  // Noncompliant
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Vegetable implements Serializable {
  // ...
}

public class Menu {
  public void meal(ObjectOutputStream oos) throws IOException {
    Vegetable veg = new Vegetable();
    oos.writeObject(veg);
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Random" objects should be reused (java:S2119)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Define and reuse the <code>Random</code> object.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyClass {

    public void doSomethingCommon() {
      Random random = new Random();        // Noncompliant - new instance created with each invocation
      int rValue = random.nextInt();
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class MyClass {
    private Random random = new Random();  // Compliant

    public void doSomethingCommon() {
      int rValue = this.random.nextInt();
    }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Creating a new <code>Random</code> object each time a random value is needed is inefficient and may produce numbers that are not random, depending
on the JDK. For better efficiency and randomness, create a single <code>Random</code>, store it, and reuse it.</p>
<p>The <code>Random()</code> constructor tries to set the seed with a distinct value every time. However, there is no guarantee that the seed will be
randomly or uniformly distributed. Some JDK will use the current time as seed, making the generated numbers not random.</p>
<p>This rule finds cases where a new <code>Random</code> is created each time a method is invoked.</p>
<h3>Exceptions</h3>
<p>This rule doesn’t apply to classes that use a <code>Random</code> in their constructors or the static <code>main</code> function and nowhere
else.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Random.html">Oracle Java SE - Random</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://www.baeldung.com/java-generating-random-numbers">Baeldung - generating random number</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"collect" should be used with "Streams" instead of "list::add" (java:S2203)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>While you can use either <code>forEach(list::add)</code> or <code>collect</code> with a <code>Stream</code>, <code>collect</code> is by far the
better choice because it’s automatically thread-safe and parallellizable.</p>
<h3>Noncompliant code example</h3>
<pre>
List&lt;String&gt; bookNames = new ArrayList&lt;&gt;();
books.stream().filter(book -&gt; book.getIsbn().startsWith("0"))
                .map(Book::getTitle)
                .forEach(bookNames::add);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
List&lt;String&gt; bookNames = books.stream().filter(book -&gt; book.getIsbn().startsWith("0"))
                .map(Book::getTitle)
                .collect(Collectors.toList());
</pre></p>
            </div>
        <div class="rule">
            <h3>"private" and "final" methods that don't access instance data should be "static" (java:S2325)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Non-overridable methods (<code>private</code> or <code>final</code>) that don’t access instance data can be <code>static</code> to prevent any
misunderstanding about the contract of the method.</p>
<h3>Noncompliant code example</h3>
<pre>
class Utilities {
  private static String magicWord = "magic";

  private String getMagicWord() { // Noncompliant
    return magicWord;
  }

  private void setMagicWord(String value) { // Noncompliant
    magicWord = value;
  }

}
</pre>
<h3>Compliant solution</h3>
<pre>
class Utilities {
  private static String magicWord = "magic";

  private static String getMagicWord() {
    return magicWord;
  }

  private static void setMagicWord(String value) {
    magicWord = value;
  }

}
</pre>
<h3>Exceptions</h3>
<p>When <code>java.io.Serializable</code> is implemented the following three methods are excluded by the rule:</p>
<ul>
  <li> <code>private void writeObject(java.io.ObjectOutputStream out) throws IOException;</code> </li>
  <li> <code>private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException;</code> </li>
  <li> <code>private void readObjectNoData() throws ObjectStreamException;</code> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Blocks should be synchronized on "private final" fields (java:S2445)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/412">CWE-412 - Unrestricted Externally Accessible Lock</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/413">CWE-413 - Improper Resource Locking</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/djdGBQ">CERT, LCK00-J.</a> - Use private final lock objects to synchronize classes that may
  interact with untrusted code </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Synchronizing on a class field synchronizes not on the field itself, but on the object assigned to it. So synchronizing on a non-<code>final</code>
field makes it possible for the field’s value to change while a thread is in a block synchronized on the old value. That would allow a second thread,
synchronized on the new value, to enter the block at the same time.</p>
<p>The story is very similar for synchronizing on parameters; two different threads running the method in parallel could pass two different object
instances in to the method as parameters, completely undermining the synchronization.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
private String color = "red";

private void doSomething(){
  synchronized(color) {  // Noncompliant; lock is actually on object instance "red" referred to by the color variable
    //...
    color = "green"; // other threads now allowed into this block
    // ...
  }
  synchronized(new Object()) { // Noncompliant this is a no-op.
     // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
private String color = "red";
private final Object lockObj = new Object();

private void doSomething(){
  synchronized(lockObj) {
    //...
    color = "green";
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"notifyAll()" should be preferred over "notify()" (java:S2446)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>notify</code> and <code>notifyAll</code> both wake up sleeping threads waiting on the object’s monitor, but <code>notify</code> only wakes up
one single thread, while <code>notifyAll</code> wakes them all up. Unless you do not care which specific thread is woken up, <code>notifyAll</code>
should be used instead.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyThread implements Runnable {
  Object lock = new Object();

  @Override
  public void run() {
    synchronized(lock) {
      // ...
      lock.notify();  // Noncompliant
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
class MyThread implements Runnable {
  Object lock = new Object();

  @Override
  public void run() {
    synchronized(lock) {
      // ...
      lock.notifyAll();
    }
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/MTdGBQ">CERT, THI02-J.</a> - Notify all waiting threads rather than a single thread </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Cipher Block Chaining IVs should be unpredictable (java:S3329)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/329">CWE-329 - Not Using an Unpredictable IV with CBC Mode</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/780">CWE-780 - Use of RSA Algorithm without OAEP</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.nio.charset.StandardCharsets;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidKeyException;
import java.security.InvalidAlgorithmParameterException;
import javax.crypto.Cipher;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import javax.crypto.NoSuchPaddingException;

public void encrypt(String key, String plainText) {

    byte[] RandomBytes = "7cVgr5cbdCZVw5WY".getBytes(StandardCharsets.UTF_8);

    IvParameterSpec iv   = new IvParameterSpec(RandomBytes);
    SecretKeySpec keySpec = new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), "AES");

    try {
        Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv);

    } catch(NoSuchAlgorithmException|InvalidKeyException|
            NoSuchPaddingException|InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>In this example, the code explicitly uses a number generator that is considered <strong>strong</strong>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import java.nio.charset.StandardCharsets;
import java.security.SecureRandom;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidKeyException;
import java.security.InvalidAlgorithmParameterException;
import javax.crypto.Cipher;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import javax.crypto.NoSuchPaddingException;

public void encrypt(String key, String plainText) {

    SecureRandom random = new SecureRandom();
    byte[] randomBytes  = new byte[128];
    random.nextBytes(randomBytes);

    IvParameterSpec iv   = new IvParameterSpec(randomBytes);
    SecretKeySpec keySpec = new SecretKeySpec(key.getBytes(StandardCharsets.UTF_8), "AES");

    try {
        Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
        cipher.init(Cipher.ENCRYPT_MODE, keySpec, iv);

    } catch(NoSuchAlgorithmException|InvalidKeyException|
            NoSuchPaddingException|InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use unique IVs</h4>
<p>To ensure high security, initialization vectors must meet two important criteria:</p>
<ul>
  <li> IVs must be unique for each encryption operation. </li>
  <li> For CBC and CFB modes, a secure FIPS-compliant random number generator should be used to generate unpredictable IVs. </li>
</ul>
<p>The IV does not need be secret, so the IV or information sufficient to determine the IV may be transmitted along with the ciphertext.</p>
<p>In the previous non-compliant example, the problem is not that the IV is hard-coded.<br> It is that the same IV is used for multiple encryption
attempts.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In the mode Cipher Block Chaining (CBC), each block is used as cryptographic input for the next block. For this reason, the first block requires an
initialization vector (IV), also called a "starting variable" (SV).</p>
<p>If the same IV is used for multiple encryption sessions or messages, each new encryption of the same plaintext input would always produce the same
ciphertext output. This may allow an attacker to detect patterns in the ciphertext.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, a company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p></p>
            </div>
        <div class="rule">
            <h3>Tests should be kept in a dedicated source directory (java:S3414)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It is a good practice to isolate test classes in a separate package so that what is shipped to production is neither polluted by nor bloated with
them. Further, including unit tests in code assemblies could affect build processes.</p>
<p>This rule raises an issue when test classes are found in projects containing non-test-related code.</p></p>
            </div>
        <div class="rule">
            <h3>Optional value should only be accessed after calling isPresent() (java:S3655)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/476">CWE-476 - NULL Pointer Dereference</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>Optional</code> value can hold either a value or not. The value held in the <code>Optional</code> can be accessed using the
<code>get()</code> method, but it will throw a</p>
<p><code>NoSuchElementException</code> if there is no value present. To avoid the exception, calling the <code>isPresent()</code> or <code>!
isEmpty()</code> method should always be done before any call to <code>get()</code>.</p>
<p>Alternatively, note that other methods such as <code>orElse(...)</code>, <code>orElseGet(...)</code> or <code>orElseThrow(...)</code> can be used
to specify what to do with an empty <code>Optional</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
Optional&lt;String&gt; value = this.getOptionalValue();

// ...

String stringValue = value.get(); // Noncompliant
</pre>
<pre>
if (methodThatReturnsOptional().isEmpty()) {
  throw new NotFoundException();
}
String value = methodThatReturnsOptional().get(); // Noncompliant: indirect access, we consider that two consecutive calls can return different values.
</pre>
<h3>Compliant solution</h3>
<pre>
this.getOptionalValue().ifPresent(stringValue -&gt;
  // Do something with stringValue
);
</pre>
<p>or</p>
<pre>
Optional&lt;String&gt; value = this.getOptionalValue();

// ...

if (value.isPresent()) {
  String stringValue = value.get();
}
</pre>
<p>or</p>
<pre>
Optional&lt;String&gt; value = this.getOptionalValue();

// ...

String stringValue = value.orElse("default");
</pre>
<pre>
Optional&lt;String&gt; optional = methodThatReturnsOptional();
if (optional.isEmpty()) {
  throw new NotFoundException();
}
String value = optional.get();
</pre></p>
            </div>
        <div class="rule">
            <h3>Cognitive Complexity of methods should not be too high (java:S3776)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when the code cognitive complexity of a function is above a certain threshold.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Cognitive Complexity is a measure of how hard it is to understand the control flow of a unit of code. Code with high cognitive complexity is hard
to read, understand, test, and modify.</p>
<p>As a rule of thumb, high cognitive complexity is a sign that the code should be refactored into smaller, easier-to-manage pieces.</p>
<h3>Which syntax in code does impact cognitive complexity score?</h3>
<p>Here are the core concepts:</p>
<ul>
  <li> <strong>Cognitive complexity is incremented each time the code breaks the normal linear reading flow.</strong><br> This concerns, for example,
  loop structures, conditionals, catches, switches, jumps to labels, and conditions mixing multiple operators. </li>
  <li> <strong>Each nesting level increases complexity.</strong><br> During code reading, the deeper you go through nested layers, the harder it
  becomes to keep the context in mind. </li>
  <li> <strong>Method calls are free</strong><br> A well-picked method name is a summary of multiple lines of code. A reader can first explore a
  high-level view of what the code is performing then go deeper and deeper by looking at called functions content.<br> <em>Note:</em> This does not
  apply to recursive calls, those will increment cognitive score. </li>
</ul>
<p>The method of computation is fully detailed in the pdf linked in the resources.</p>
<h3>Exceptions</h3>
<p><code>equals</code> and <code>hashCode</code> methods are ignored because they might be automatically generated and might end up being difficult to
understand, especially in the presence of many fields.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Sonar - <a href="https://www.sonarsource.com/docs/CognitiveComplexity.pdf">Cognitive Complexity</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Sonar Blog - <a href="https://www.sonarsource.com/blog/5-clean-code-tips-for-reducing-cognitive-complexity/">5 Clean Code Tips for Reducing
  Cognitive Complexity</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Reducing cognitive complexity can be challenging.<br> Here are a few suggestions:</p>
<ul>
  <li> <strong>Extract complex conditions in a new function.</strong><br> Mixed operators in condition will increase complexity. Extracting the
  condition in a new function with an appropriate name will reduce cognitive load. </li>
  <li> <strong>Break down large functions.</strong><br> Large functions can be hard to understand and maintain. If a function is doing too many
  things, consider breaking it down into smaller, more manageable functions. Each function should have a single responsibility. </li>
  <li> <strong>Avoid deep nesting by returning early.</strong><br> To avoid the nesting of conditions, process exceptional cases first and return
  early. </li>
</ul>

<p><strong>Extraction of a complex condition in a new function.</strong></p>
<h4>Noncompliant code example</h4>
<p>The code is using a complex condition and has a cognitive cost of 3.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
double calculateFinalPrice(User user, Cart cart) {
  double total = calculateTotal(cart);
  if (user.hasMembership()                            // +1 (if)
    &amp;&amp; user.ordersCount() &gt; 10                        // +1 (more than one condition)
    &amp;&amp; user.isAccountActive()
    &amp;&amp; !user.hasDiscount()
    || user.ordersCount() == 1) {                    // +1 (change of operator in condition)
    total = applyDiscount(user, total);
  }
  return total;
}
</pre>
<h4>Compliant solution</h4>
<p>Even if the cognitive complexity of the whole program did not change, it is easier for a reader to understand the code of the
<code>calculateFinalPrice</code> function, which now only has a cognitive cost of 1.</p>
<pre data-diff-id="1" data-diff-type="compliant">
double calculateFinalPrice(User user, Cart cart) {
  double total = calculateTotal(cart);
  if (isEligibleForDiscount(user)) {                  // +1 (if)
    total = applyDiscount(user, total);
  }
  return total;
}

boolean isEligibleForDiscount(User user) {
  return user.hasMembership()
    &amp;&amp; user.ordersCount() &gt; 10                        // +1 (more than one condition)
    &amp;&amp; user.isAccountActive()
    &amp;&amp; !user.hasDiscount()
    || user.ordersCount() == 1;                       // +1 (change of operator in condition)
}
</pre>
<p><strong>Break down large functions.</strong></p>
<h4>Noncompliant code example</h4>
<p>For example, consider a function that calculates the total price of a shopping cart, including sales tax and shipping.<br> <em>Note:</em> The code
is simplified here, to illustrate the purpose. Please imagine there is more happening in the <code>for</code> loops.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
double calculateTotal(Cart cart) {
  double total = 0;
  for (Item item : cart.items()) {       // +1 (for)
    total += item.price;
  }

  // calculateSalesTax
  for (Item item : cart.items()) {       // +1 (for)
    total += 0.2 * item.price;
  }

  //calculateShipping
  total += 5 * cart.items().size();

  return total;
}
</pre>
<p>This function could be refactored into smaller functions: The complexity is spread over multiple functions and the complex
<code>calculateTotal</code> has now a complexity score of zero.</p>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
double calculateTotal(Cart cart) {
  double total = 0;
  total = calculateSubtotal(cart, total);
  total += calculateSalesTax(cart, total);
  total += calculateShipping(cart, total);

  return total;
}

double calculateShipping(Cart cart, double total) {
  total += 5 * cart.items().size();
  return total;
}

double calculateSalesTax(Cart cart, double total) {
  for (Item item : cart.items()) {       // +1 (for)
    total += 0.2 * item.price;
  }
  return total;
}

double calculateSubtotal(Cart cart, double total) {
  for (Item item : cart.items()) {       // +1 (for)
    total += item.price;
  }
  return total;
}
</pre>
<p><strong>Avoid deep nesting by returning early.</strong></p>
<h4>Noncompliant code example</h4>
<p>The below code has a cognitive complexity of 6.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
double calculateDiscount(double price, User user) {
  if (isEligibleForDiscount(user)) {      // +1 ( if )
    if (user.hasMembership()) {           // +2 ( nested if )
      return price * 0.9;
    } else if (user.ordersCount() == 1) { // +1 ( else )
      return price * 0.95;
    } else {                              // +1 ( else )
      return price;
    }
  } else {                                // +1 ( else )
    return price;
  }
}
</pre>
<h4>Compliant solution</h4>
<p>Checking for the edge case first flattens the <code>if</code> statements and reduces the cognitive complexity to 3.</p>
<pre data-diff-id="3" data-diff-type="compliant">
double calculateDiscount(double price, User user) {
  if (!isEligibleForDiscount(user)) {     // +1 ( if )
    return price;
  }
  if (user.hasMembership()) {             // +1
    return price * 0.9;
  }
  if (user.ordersCount() == 1) {          // +1 ( if )
    return price * 0.95;
  }
  return price;
}
</pre>
<h3>Pitfalls</h3>
<p>As this code is complex, ensure that you have unit tests that cover the code before refactoring.</p></p>
            </div>
        <div class="rule">
            <h3>Assertions should not compare an object to itself (java:S5863)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Assertions comparing an object to itself are more likely to be bugs due to developer’s carelessness.</p>
<p>This rule raises an issue when the actual expression matches the expected expression.</p>
<h3>Noncompliant code example</h3>
<pre>
assertThat(actual).isEqualTo(actual); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
assertThat(actual).isEqualTo(expected);
</pre>
<h3>Exceptions</h3>
<p>In a unit test validating the <code>equals(...)</code> and <code>hashCode()</code> methods, it’s legitimate to compare an object to itself. This
rule does not raise an issue for <code>isEqualTo</code>, <code>assertEquals</code> or <code>hasSameHashCodeAs</code> when the unit test name contains
(case insensitive): <code>equal</code>, <code>hash_?code</code>, <code>object_?method</code>. For example, in tests with the following names:
<code>test_equals</code>, <code>testEqual</code>, <code>test_hashCode</code>, <code>test_hash_code</code>, <code>test_object_methods</code>.</p>
<pre>
class MyClassTest {
  @Test
  void test_equals_and_hash_code() {
    MyClass obj = new MyClass();
    assertThat(obj).isEqualTo(obj); // Compliant
    assertThat(obj).hasSameHashCodeAs(obj); // Compliant
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Unicode Grapheme Clusters should be avoided inside regex character classes (java:S5868)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When placing Unicode <a href="https://unicode.org/glossary/#grapheme_cluster">Grapheme Clusters</a> (characters which require to be encoded in
multiple <a href="https://unicode.org/glossary/#code_point">Code Points</a>) inside a character class of a regular expression, this will likely lead
to unintended behavior.</p>
<p>For instance, the grapheme cluster <code>c̈</code> requires two code points: one for <code>'c'</code>, followed by one for the <em>umlaut</em>
modifier <code>'\u{0308}'</code>. If placed within a character class, such as <code>[c̈]</code>, the regex will consider the character class being the
enumeration <code>[c\u{0308}]</code> instead. It will, therefore, match every <code>'c'</code> and every <em>umlaut</em> that isn’t expressed as a
single codepoint, which is extremely unlikely to be the intended behavior.</p>
<p>This rule raises an issue every time Unicode Grapheme Clusters are used within a character class of a regular expression.</p>
<h3>Noncompliant code example</h3>
<pre>
"cc̈d̈d".replaceAll("[c̈d̈]", "X"); // Noncompliant, print "XXXXXX" instead of expected "cXXd".
</pre>
<h3>Compliant solution</h3>
<pre>
"cc̈d̈d".replaceAll("c̈|d̈", "X"); // print "cXXd"
</pre></p>
            </div>
        <div class="rule">
            <h3>Character classes in regular expressions should not contain the same character twice (java:S5869)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Character classes in regular expressions are a convenient way to match one of several possible characters by listing the allowed characters or
ranges of characters. If the same character is listed twice in the same character class or if the character class contains overlapping ranges, this
has no effect.</p>
<p>Thus duplicate characters in a character class are either a simple oversight or a sign that a range in the character class matches more than is
intended or that the author misunderstood how character classes work and wanted to match more than one character. A common example of the latter
mistake is trying to use a range like <code>[0-99]</code> to match numbers of up to two digits, when in fact it is equivalent to <code>[0-9]</code>.
Another common cause is forgetting to escape the <code>-</code> character, creating an unintended range that overlaps with other characters in the
character class.</p>
<h3>Noncompliant code example</h3>
<pre>
str.matches("[0-99]") // Noncompliant, this won't actually match strings with two digits
str.matches("[0-9.-_]") // Noncompliant, .-_ is a range that already contains 0-9 (as well as various other characters such as capital letters)
</pre>
<h3>Compliant solution</h3>
<pre>
str.matches("[0-9]{1,2}")
str.matches("[0-9.\\-_]")
</pre></p>
            </div>
        <div class="rule">
            <h3>"@Qualifier" should not be used on "@Bean" methods (java:S6831)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/bean-annotation.html">Spring Framework - Using the @Bean
  Annotation</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired-qualifiers.html">Spring Framework - Using
  @Qualifier</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-qualifier-annotation">Baeldung - Spring @Qualifier Annotation</a> </li>
  <li> <a href="https://www.baeldung.com/spring-bean-annotations">Baeldung - Spring Bean Annotations</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Spring Framework, the <code>@Qualifier</code> annotation is typically used to disambiguate between multiple beans of the same type when
auto-wiring dependencies. It is not necessary to use <code>@Qualifier</code> when defining a bean using the <code>@Bean</code> annotation because the
bean’s name can be explicitly specified using the <code>name</code> attribute or derived from the method name. Using <code>@Qualifier</code> on
<code>@Bean</code> methods can lead to confusion and redundancy. Beans should be named appropriately using either the <code>name</code> attribute of
the <code>@Bean</code> annotation or the method name itself.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Configuration
public class MyConfiguration {
  @Bean
  @Qualifier("myService")
  public MyService myService() {
    // ...
    return new MyService();
  }

  @Bean
  @Qualifier("betterService")
  public MyService aBetterService() {
    // ...
    return new MyService();
  }

  @Bean
  @Qualifier("evenBetterService")
  public MyService anEvenBetterService() {
    // ...
    return new MyService();
  }

  @Bean
  @Qualifier("differentService")
  public MyBean aDifferentService() {
    // ...
    return new MyBean();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
@Configuration
public class MyConfiguration {
  @Bean
  public MyService myService() {
    // ...
    return new MyService();
  }

  @Bean(name="betterService")
  public MyService aBetterService() {
    // ...
    return new MyService();
  }

  @Bean(name="evenBetterService")
  public MyService anEvenBetterService() {
    // ...
    return new MyService();
  }

  @Bean(name="differentService")
  public MyBean aDifferentService() {
    // ...
    return new MyBean();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Superfluous "@ResponseBody" annotations should be removed (java:S6837)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Remove the <code>@ResponseBody</code> annotation from the class or method.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@RestController
public class MyController {
  @ResponseBody // Noncompliant, the @RestController annotation already implies @ResponseBody
  @RequestMapping("/hello")
  public String hello() {
    return "Hello World!";
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@RestController
public class MyController {
  @RequestMapping("/hello")
  public String hello() {
    return "Hello World!";
  }
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
@RestController
@ResponseBody // Noncompliant, the @RestController annotation already implies @ResponseBody
public class MyController {
  @RequestMapping("/hello")
  public String hello() {
    return "Hello World!";
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
@RestController
public class MyController {
  @RequestMapping("/hello")
  public String hello() {
    return "Hello World!";
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The Spring framework’s <code>@RestController</code> annotation is equivalent to using the <code>@Controller</code> and <code>@ResponseBody</code>
annotations together. As such, it is redundant to add a <code>@ResponseBody</code> annotation when the class is already annotated with
<code>@RestController</code>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> Spring Guides - <a href="https://spring.io/guides/gs/rest-service/">Building a RESTful Web Service</a> </li>
  <li> Baeldung - <a href="https://www.baeldung.com/spring-controller-vs-restcontroller">The Spring @Controller and @RestController Annotations</a>
  </li>
  <li> Baeldung - <a href="https://www.baeldung.com/spring-request-response-body">Spring’s RequestBody and ResponseBody Annotations</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"@Bean" methods for Singleton should not be invoked in "@Configuration" when proxyBeanMethods is false (java:S6838)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Configuration.html#proxyBeanMethods()">Configuration - proxyBeanMethods</a> </li>
  <li> Spring - <a href="https://docs.spring.io/spring-framework/reference/core/aop/proxying.html">Proxying Mechanisms</a> </li>
  <li> Spring - <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/bean-annotation.html#beans-java-dependencies">Bean
  Annotation - Dependencies</a> </li>
  <li> GitHub - <a href="https://github.com/cglib/cglib/wiki">CGLIB</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Medium - <a href="https://blog.devgenius.io/demystifying-proxy-in-spring-3ab536046b11">Demystifying Proxy in Spring</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Spring proxies are based on the <strong>Proxy design pattern</strong> and serve as intermediaries to other resources, offering extra features at a
slight performance penalty. For example, they facilitate lazy resource initialization and data caching.</p>
<p>The <code>@Configuration</code> annotation enables this mechanism by default through the <code>proxyBeanMethods</code> attribute set to
<code>true</code>. This ensures that the <code>@Bean</code> methods are proxied in order to enforce bean lifecycle behavior, e.g. to return shared
singleton bean instances even in case of direct <code>@Bean</code> method calls in user code. This functionality is achieved via method interception,
implemented through a runtime-generated <strong><a href="https://github.com/cglib/cglib/wiki">CGLIB</a></strong> subclass.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When setting the <code>proxyBeanMethods</code> attribute to <code>false</code> the <code>@Bean</code> methods are not proxied and this is similar
to removing the <code>@Configuration</code> stereotype. In this scenario, <code>@Bean</code> methods within the <code>@Configuration</code> annotated
class operate in <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html"><em>lite
mode</em></a>, resulting in a new bean creation each time the method is invoked.</p>
<p>For <code>Singleton</code> beans, this could cause unexpected outcomes as the bean is created multiple times instead of being created once and
cached.</p>
<p>The rule raises an issue when the <code>proxyBeanMethods</code> attribute is set to <code>false</code> and the <code>@Bean</code> method of a
<code>Singleton</code> bean is directly invoked in the <code>@Configuration</code> annotated class code.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The issue can be fixed in the following ways:</p>
<ul>
  <li> Not invoking the <code>@Bean</code> method directly, but rather injecting the bean in the context and using it, by means of <code>@Bean</code>
  <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/bean-annotation.html#beans-java-dependencies">method parameters</a>.
  </li>
  <li> If the performance penalty is negligible, consider not disabling the <code>proxyBeanMethods</code> attribute, so that the <code>@Bean</code>
  methods are proxied and the bean lifecycle is enforced. </li>
</ul>

<h4>Noncompliant code example</h4>
<p>In the example below, every instance of <code>PrototypeBean</code> will have a different instance of <code>SingletonBean</code>, as
<code>singletonBean()</code> is called directly from <code>prototypeBean()</code>.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Configuration(proxyBeanMethods = false)
class ConfigurationExample {
  @Bean
  public SingletonBean singletonBean() {
    return new SingletonBean();
  }

  @Bean
  @Scope("prototype")
  public PrototypeBean prototypeBean() {
    return new PrototypeBean(singletonBean()); // Noncompliant, the singletonBean is created every time a prototypeBean is created
  }

  class SingletonBean {
    // ...
  }

  class PrototypeBean {
    // ...

    public PrototypeBean(SingletonBean singletonBean) {
      // ...
    }

    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<p>The compliant solution relies on the <code>@Bean</code> method parameter to automatically inject the <code>SingletonBean</code> from the
<code>ApplicationContext</code>. This way every instance of <code>PrototypeBean</code> will have the same instance of <code>SingletonBean</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
@Configuration(proxyBeanMethods = false)
class ConfigurationExample {
  @Bean
  public SingletonBean singletonBean() {
    return new SingletonBean();
  }

  @Bean
  @Scope("prototype")
  public PrototypeBean prototypeBean(SingletonBean singletonBean) { // Compliant, the singletonBean is injected in the context and used by every prototypeBean
    return new PrototypeBean(singletonBean);
  }

  class SingletonBean {
    // ...
  }

  class PrototypeBean {
    // ...

    public PrototypeBean(SingletonBean singletonBean) {
      // ...
    }

    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Increment (++) and decrement (--) operators should not be used in a method call or mixed with other operators in an expression (java:S881)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The use of increment and decrement operators in method calls or in combination with other arithmetic operators is not recommended, because:</p>
<ul>
  <li> It can significantly impair the readability of the code. </li>
  <li> It introduces additional side effects into a statement, with the potential for undefined behavior. </li>
  <li> It is safer to use these operators in isolation from any other arithmetic operators. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
u8a = ++u8b + u8c--;
foo = bar++ / 4;
</pre>
<h3>Compliant solution</h3>
<p>The following sequence is clearer and therefore safer:</p>
<pre>
++u8b;
u8a = u8b + u8c;
u8c--;
foo = bar / 4;
bar++;
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/StYxBQ">CERT, EXP30-C.</a> - Do not depend on the order of evaluation for side effects </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/IXw-BQ">CERT, EXP50-CPP.</a> - Do not depend on the order of evaluation for side effects </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/NDdGBQ">CERT, EXP05-J.</a> - Do not follow a write by a subsequent write or read of the same
  object within an expression </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Track uses of "NOSONAR" comments (java:NoSonar)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Any issue to quality rule can be deactivated with the <code>NOSONAR</code> marker. This marker is pretty useful to exclude false-positive results
but it can also be used abusively to hide real quality flaws.</p>
<p>This rule raises an issue when <code>NOSONAR</code> is used.</p></p>
            </div>
        <div class="rule">
            <h3>Redundant pairs of parentheses should be removed (java:S1110)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Parentheses can disambiguate the order of operations in complex expressions and make the code easier to understand.</p>
<pre>
a = (b * c) + (d * e); // Compliant: the intent is clear.
</pre>
<p>Redundant parentheses are parenthesis that do not change the behavior of the code, and do not clarify the intent. They can mislead and complexify
the code. They should be removed.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
int x = ((y / 2 + 1)); // Noncompliant

if (a &amp;&amp; ((x + y &gt; 0))) { // Noncompliant
  return ((x + 1)); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
int x = (y / 2 + 1);

if (a &amp;&amp; (x + y &gt; 0)) {
  return (x + 1);
}
</pre></p>
            </div>
        <div class="rule">
            <h3>The "Object.finalize()" method should not be called (java:S1111)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Before it reclaims storage from an object that is no longer referenced, the garbage collector calls <code>finalize()</code> on the object.</p>
<p>This is a good time to release resources held by the object.</p>
<p>Because the general contract is that the <code>finalize</code> method should only be called once per object, calling this method explicitly is
misleading and does not respect this contract.</p>
<h3>What is the potential impact?</h3>
<p>An explicit call to an object’s finalize method will perform operations that most likely were supposed to be performed only when the object was not
referenced anymore by any thread.</p>
<p>Since it is an acceptable practice to override the finalize method in any subclass of <code>Object</code>, by invoking it explicitly, we will run
code that was designed to only be ran at a different time.</p>
<h3>Noncompliant code example</h3>
<pre>
public void dispose() throws Throwable {
  this.finalize();                       // Noncompliant
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-12.html#jls-12.6">docs.oracle.com</a> - Finalization of Class Instances </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/586">CWE-586 - Explicit Call to Finalize()</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/4jZGBQ">CERT, MET12-J.</a> - Do not use finalizers </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>The "Object.finalize()" method should not be overridden (java:S1113)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Before it reclaims storage from an object that is no longer referenced, the garbage collector calls <code>finalize()</code> on the object.</p>
<p>But there is no guarantee that this method will be called as soon as the last references to the object are removed.</p>
<p>It can be few microseconds to few minutes later.</p>
<p>For this reason relying on overriding the <code>finalize()</code> method to release resources or to update the state of the program is highly
discouraged.</p>
<h3>What is the potential impact?</h3>
<p>More unexpected issues can be caused by relying on the <code>finalize()</code> method to perform important operations on the application state:</p>
<ul>
  <li> The JVM might terminate without ever calling this method on a particular object, leaving an unexpected or incomplete state of the program </li>
  <li> Uncaught exceptions will be ignored inside this method, making it harder to detect issues that could have been logged otherwise </li>
  <li> Finalizer methods can also be invoked concurrently, even on single-threaded applications, making it hard to maintain desired program invariants
  </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {

  @Override
  protected void finalize() { // Noncompliant
    releaseSomeResources();
  }

}
</pre>
<h3>Exceptions</h3>
<p>It is allowed to override the <code>finalize()</code> method as <code>final</code> method with an empty body, to prevent the <em>finalizer
attack</em> as described in <em>MET12-J-EX1</em>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-12.html#jls-12.6">docs.oracle.com</a> - Finalization of Class Instances </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/4jZGBQ">CERT, MET12-J.</a> - Do not use finalizers </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Local variables should not shadow class fields (java:S1117)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shadowing occurs when a local variable has the same name as a variable or a field in an outer scope.</p>
<p>This can lead to three main problems:</p>
<ul>
  <li> Confusion: The same name can refer to different variables in different parts of the scope, making the code hard to read and understand. </li>
  <li> Unintended Behavior: You might accidentally use the wrong variable, leading to hard-to-detect bugs. </li>
  <li> Maintenance Issues: If the inner variable is removed or renamed, the code’s behavior might change unexpectedly because the outer variable is
  now being used. </li>
</ul>
<p>To avoid these problems, rename the shadowing, shadowed, or both identifiers to accurately represent their purpose with unique and meaningful
names.</p>
<p>This rule focuses on variables in methods that shadow a field.</p>
<h3>Noncompliant code example</h3>
<pre>
class Foo {
  public int myField;

  public void doSomething() {
    int myField = 0; // Noncompliant
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/display/java/DCL51-J.+Do+not+shadow+or+obscure+identifiers+in+subscopes">DCL51-J. Do not
  shadow or obscure identifiers in subscopes</a> </li>
</ul>
<h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS2176'>S2176</a> - Class names should not shadow interfaces or superclasses </li>
  <li> <a href='/coding_rules#rule_key=java%3AS2387'>S2387</a> - Child class fields should not shadow parent class fields </li>
  <li> <a href='/coding_rules#rule_key=java%3AS4977'>S4977</a> - Type parameters should not shadow other type parameters </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Utility classes should not have public constructors (java:S1118)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>To prevent the class from being instantiated, you should define a non-public constructor. This will prevent the compiler from implicitly generating
a public parameterless constructor.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class StringUtils { // Noncompliant

  public static String concatenate(String s1, String s2) {
    return s1 + s2;
  }

}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class StringUtils { // Compliant

  private StringUtils() {
    throw new IllegalStateException("Utility class");
  }

  public static String concatenate(String s1, String s2) {
    return s1 + s2;
  }

}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Whenever there are portions of code that are duplicated and do not depend on the state of their container class, they can be centralized inside a
"utility class". A utility class is a class that only has static members, hence it should not be instantiated.</p>
<h3>Exceptions</h3>
<p>When a class contains <code>public static void main(String[] args)</code> method it is not considered as a utility class and will be ignored by
this rule.</p></p>
            </div>
        <div class="rule">
            <h3>Labels should not be used (java:S1119)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Labels are not commonly used in Java, and many developers do not understand how they work. Moreover, their usage makes the control flow harder to
follow, which reduces the code’s readability.</p>
<h3>Noncompliant code example</h3>
<pre>
int matrix[][] = {
  {1, 2, 3},
  {4, 5, 6},
  {7, 8, 9}
};

outer: for (int row = 0; row &lt; matrix.length; row++) {   // Non-Compliant
  for (int col = 0; col &lt; matrix[row].length; col++) {
    if (col == row) {
      continue outer;
    }
    System.out.println(matrix[row][col]);                // Prints the elements under the diagonal, i.e. 4, 7 and 8
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
for (int row = 1; row &lt; matrix.length; row++) {          // Compliant
  for (int col = 0; col &lt; row; col++) {
    System.out.println(matrix[row][col]);                // Also prints 4, 7 and 8
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Collections.EMPTY_LIST", "EMPTY_MAP", and "EMPTY_SET" should not be used (java:S1596)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html">Oracle - Java™ Platform, Standard Edition 8 API Specification,
  Class Collections</a> </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/generics/rawTypes.html">Oracle - The Java™ Tutorials - Raw Types</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-generics">Baeldung - The Basics of Java Generics</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when the <code>Collections.EMPTY_*</code> fields are used instead of the <code>Collections.empty*()</code> methods.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use:</p>
<ul>
  <li> <code>Collections.emptyList()</code> instead of <code>Collections.EMPTY_LIST</code> </li>
  <li> <code>Collections.emptySet()</code> instead of <code>Collections.EMPTY_SET</code> </li>
  <li> <code>Collections.emptyMap()</code> instead of <code>Collections.EMPTY_MAP</code> </li>
</ul>
<p>In addition, there are variants of <code>Collections.empty*()</code> available also for other collection interfaces, such as
<code>Collections.emptyIterator()</code>, <code>Collections.emptyNavigableMap()</code>, <code>Collections.emptySortedSet()</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
List&lt;String&gt; collection1 = Collections.EMPTY_LIST;     // Noncompliant, raw List
Set&lt;Float&gt; collection2 = Collections.EMPTY_SET;        // Noncompliant, raw Set
Map&lt;Int, String&gt; collection3 = Collections.EMPTY_MAP;  // Noncompliant, raw Map
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
List&lt;String&gt; collection1 = Collections.emptyList();    // Compliant, List&lt;String&gt;
Set&lt;Float&gt; collection2 = Collections.emptySet();       // Compliant, Set&lt;Float&gt;
Map&lt;Int, String&gt; collection3 = Collections.emptyMap(); // Compliant, Map&lt;Int, String&gt;
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Generic types (types with type parameters) have been introduced into Java with language version 1.5. If type parameters are specified for a class
or method, it is still possible to ignore them to keep backward compatibility with older code, which is called the <em>raw type</em> of the class or
interface.</p>
<p>Using raw type expressions is highly discouraged because the compiler cannot perform static type checking on them. This means that the compiler
will not report typing errors about them at compile time, but a <code>ClassCastException</code> will be thrown during runtime.</p>
<p>In Java 1.5, generics were also added to the Java collections API, and the data structures in <code>java.util</code>, such as <code>List</code>,
<code>Set</code>, or <code>Map</code>, now feature type parameters. <code>Collections.EMPTY_LIST</code>, <code>Collections.EMPTY_SET</code>, and
<code>Collections.EMPTY_MAP</code> are relics from before generics, and they return raw lists, sets, or maps, with the limitations mentioned
above.</p></p>
            </div>
        <div class="rule">
            <h3>"compareTo" results should not be checked for specific values (java:S2200)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Assuming that a comparator or <code>compareTo</code> method always returns -1 or 1 if the first operand is less than or greater than the second is
incorrect.</p>
<p>The specifications for both methods, <code>Comparator.compare</code> and <code>Comparable.compareTo</code>, state that their return value is "a
negative integer, zero, or a positive integer as this object is less than, equal to, or greater than the specified object." Even if a specific
comparator always returns -1, 0, or 1, this is only an implementation detail, not the API contract developers can rely on.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace</p>
<ul>
  <li> <code>== -1</code> with <code>&lt; 0</code> (the first operand is less than the second) </li>
  <li> <code>== 1</code> with <code>&gt; 0</code> (the first operand is greater than the second) </li>
  <li> <code>!= -1</code> with <code>&gt;= 0</code> (the first operand is greater than or equal to the second) </li>
  <li> <code>!= 1</code> with <code>&lt;= 0</code> (the first operand is less than or equal to the second) </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Main {

  boolean isAGreaterThanB(Comparable&lt;Integer&gt; a, Integer b) {
    return a.compareTo(b) == 1; // Noncompliant, check for constant return value
  }

  public static void main(String[] args) {
    ByteComparator comparator = new ByteComparator();
    if (comparator.compare((byte) 23, (byte) 42) == -1) { // Noncompliant, check for constant return value
      System.out.println("23 &lt; 42");
    } else {
      System.out.println("23 &gt;= 42");
    }
  }

  static class ByteComparator implements Comparator&lt;Byte&gt; {
    @Override
    public int compare(Byte a, Byte b) {
      return a - b;
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Main {

  boolean isAGreaterThanB(Comparable&lt;Integer&gt; a, Integer b) {
    return a.compareTo(b) &gt; 0; // Compliant, check for positive return value
  }

  public static void main(String[] args) {
    ByteComparator comparator = new ByteComparator();
    if (comparator.compare((byte) 23, (byte) 42) &lt; 0) { // Compliant, check for negative return value
      System.out.println("23 &lt; 42");
    } else {
      System.out.println("23 &gt;= 42");
    }
  }

  static class ByteComparator implements Comparator&lt;Byte&gt; {
    @Override
    public int compare(Byte a, Byte b) {
      return a - b;
    }
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html#compareTo-T-">Java SE 8 API Specification:
  Comparable.compareTo</a> </li>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html#compare-T-T-">Java SE 8 API Specification: Comparator.compare</a>
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Return values from functions without side effects should not be ignored (java:S2201)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the call to a function doesn’t have any side effects, what is the point of making the call if the results are ignored? In such case, either
the function call is useless and should be dropped or the source code doesn’t behave as expected.</p>
<p>To prevent generating any false-positives, this rule triggers an issue only on the following predefined list of immutable classes in the Java API
:</p>
<ul>
  <li> <code>java.lang.String</code> </li>
  <li> <code>java.lang.Boolean</code> </li>
  <li> <code>java.lang.Integer</code> </li>
  <li> <code>java.lang.Double</code> </li>
  <li> <code>java.lang.Float</code> </li>
  <li> <code>java.lang.Byte</code> </li>
  <li> <code>java.lang.Character</code> </li>
  <li> <code>java.lang.Short</code> </li>
  <li> <code>java.lang.StackTraceElement</code> </li>
  <li> <code>java.time.DayOfWeek</code> </li>
  <li> <code>java.time.Duration</code> </li>
  <li> <code>java.time.Instant</code> </li>
  <li> <code>java.time.LocalDate</code> </li>
  <li> <code>java.time.LocalDateTime</code> </li>
  <li> <code>java.time.LocalTime</code> </li>
  <li> <code>java.time.Month</code> </li>
  <li> <code>java.time.MonthDay</code> </li>
  <li> <code>java.time.OffsetDateTime</code> </li>
  <li> <code>java.time.OffsetTime</code> </li>
  <li> <code>java.time.Period</code> </li>
  <li> <code>java.time.Year</code> </li>
  <li> <code>java.time.YearMonth</code> </li>
  <li> <code>java.time.ZonedDateTime</code> </li>
  <li> <code>java.math.BigInteger</code> </li>
  <li> <code>java.math.BigDecimal</code> </li>
  <li> <code>java.util.Optional</code> </li>
</ul>
<p>As well as methods of the following classes:</p>
<ul>
  <li> <code>java.util.Collection</code>:
    <ul>
      <li> <code>size()</code> </li>
      <li> <code>isEmpty()</code> </li>
      <li> <code>contains(...)</code> </li>
      <li> <code>containsAll(...)</code> </li>
      <li> <code>iterator()</code> </li>
      <li> <code>toArray()</code> </li>
    </ul>  </li>
  <li> <code>java.util.Map</code>:
    <ul>
      <li> <code>size()</code> </li>
      <li> <code>isEmpty()</code> </li>
      <li> <code>containsKey(...)</code> </li>
      <li> <code>containsValue(...)</code> </li>
      <li> <code>get(...)</code> </li>
      <li> <code>getOrDefault(...)</code> </li>
      <li> <code>keySet()</code> </li>
      <li> <code>entrySet()</code> </li>
      <li> <code>values()</code> </li>
    </ul>  </li>
  <li> <code>java.util.stream.Stream</code>
    <ul>
      <li> <code>toArray</code> </li>
      <li> <code>reduce</code> </li>
      <li> <code>collect</code> </li>
      <li> <code>min</code> </li>
      <li> <code>max</code> </li>
      <li> <code>count</code> </li>
      <li> <code>anyMatch</code> </li>
      <li> <code>allMatch</code> </li>
      <li> <code>noneMatch</code> </li>
      <li> <code>findFirst</code> </li>
      <li> <code>findAny</code> </li>
      <li> <code>toList</code> </li>
    </ul>  </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
public void handle(String command){
  command.toLowerCase(); // Noncompliant; result of method thrown away
  ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void handle(String command){
  String formattedCommand = command.toLowerCase();
  ...
}
</pre>
<h3>Exceptions</h3>
<p>This rule will not raise an issue when both these conditions are met:</p>
<ul>
  <li> The method call is in a <code>try</code> block with an associated <code>catch</code> clause. </li>
  <li> The method name starts with "parse", "format", "decode" or "valueOf" or the method is <code>String.getBytes(Charset)</code>. </li>
</ul>
<pre>
private boolean textIsInteger(String textToCheck) {

    try {
        Integer.parseInt(textToCheck, 10); // OK
        return true;
    } catch (NumberFormatException ignored) {
        return false;
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/xzdGBQ">CERT, EXP00-J.</a> - Do not ignore values returned by methods </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>".equals()" should not be used to test the values of "Atomic" classes (java:S2204)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/package-summary.html">Java SE 8 API Specification: Package
  "java.util.concurrent.atomic"</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://programming.guide/java/atomicinteger-equals.html">Programming.Guide: AtomicInteger and equals / Comparable</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><ul>
  <li> To compare the number value of two instances <code>a</code> and <code>b</code> of <code>AtomicInteger</code> or <code>AtomicLong</code>, use
  <code>a.get() == b.get()</code> instead of <code>a.equals(b)</code>. </li>
  <li> If you want to check for object identity, use <code>a == b</code> instead of <code>a.equals(b)</code> to clarify your intention. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Boolean isSameNumberValue(AtomicLong a, AtomicLong b) {
  return a.equals(b); // Noncompliant, this is true only if a == b
}

Boolean isSameReference(AtomicLong a, AtomicLong b) {
  return a.equals(b); // Noncompliant, because misleading
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Boolean isSameNumberValue(AtomicLong a, AtomicLong b) {
  return a.get() == b.get(); // Compliant
}

Boolean isSameReference(AtomicLong a, AtomicLong b) {
  return a == b; // Compliant
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>equals</code> method in <code>AtomicInteger</code> and <code>AtomicLong</code> returns <code>true</code> only if two instances are
identical, not if they represent the same number value.</p>
<p>This is because <code>equals</code> is not part of the API contract of these classes, and they do not override the method inherited from
<code>java.lang.Object</code>. Although both classes implement the <code>Number</code> interface, assertions about <code>equals</code> comparing
number values are not part of that interface either. Only the API contract of implementing classes like <code>Integer</code>, <code>Long</code>,
<code>Float</code>, <code>BigInteger</code>, etc., provides such assertions.</p></p>
            </div>
        <div class="rule">
            <h3>Wildcard imports should not be used (java:S2208)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using wildcards in imports may look cleaner as it reduces the number of lines in the import section and simplifies the code.<br> On the other hand,
it makes the code harder to maintain:</p>
<ul>
  <li> It reduces code readability as developers will have a hard time knowing where names come from. </li>
  <li> It could lead to conflicts between names defined locally and the ones imported. </li>
  <li> It could later raise conflicts on dependency upgrade or Java version migration, as a wildcard import that works today might be broken tomorrow.
  </li>
</ul>
<p>That is why it is better to import only the specific classes or modules you need.</p>
<h3>Exceptions</h3>
<p>Static imports are ignored by this rule. For example:</p>
<pre>
import static java.lang.Math.*;
</pre>
<p>will not raise an issue;</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Depending on your IDE you can solve this issue almost <strong>automatically</strong>:<br> Look for <strong>Organize/Optimize imports</strong>
actions. These actions can also often be applied automatically on save.<br> <em>Note:</em> To make this work properly, you must adjust IDE settings to
use a very high <code>allowed class count usage</code> before using wildcards.</p>
<p>Resolving this issue <strong>manually</strong> will require a step-by-step approach:</p>
<ol>
  <li> Remove one wildcard import and note down compilation failures. </li>
  <li> For each missing class, import it back with the package prefix. </li>
  <li> When the code compiles again, proceed with the next wildcard import. </li>
</ol>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.sql.*; // Noncompliant
import java.util.*; // Noncompliant

private Date date; // Date class exists in java.sql and java.util. Which one is this?
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.sql.Date;
import java.util.List;
import java.util.ArrayList;

private Date date;
</pre></p>
            </div>
        <div class="rule">
            <h3>"static" members should be accessed statically (java:S2209)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>While it is <em>possible</em> to access <code>static</code> members from a class instance, it’s bad form, and considered by most to be misleading
because it implies to the readers of your code that there’s an instance of the member per class instance.</p>
<h3>Noncompliant code example</h3>
<pre>
public class A {
  public static int counter = 0;
}

public class B {
  private A first = new A();
  private A second = new A();

  public void runUpTheCount() {
    first.counter ++;  // Noncompliant
    second.counter ++;  // Noncompliant. A.counter is now 2, which is perhaps contrary to expectations
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class A {
  public static int counter = 0;
}

public class B {
  private A first = new A();
  private A second = new A();

  public void runUpTheCount() {
    A.counter ++;  // Compliant
    A.counter ++;  // Compliant
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Unused type parameters should be removed (java:S2326)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Type parameters that aren’t used are dead code, which can only distract and possibly confuse developers during maintenance. Therefore, unused type
parameters should be removed.</p>
<h3>Noncompliant code example</h3>
<pre>
int &lt;T&gt; Add(int a, int b) // Noncompliant; &lt;T&gt; is ignored
{
  return a + b;
}
</pre>
<h3>Compliant solution</h3>
<pre>
int Add(int a, int b)
{
  return a + b;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes with only "static" methods should not be instantiated (java:S2440)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS1118'>S1118</a> - Utility classes should not have public constructors </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>static</code> methods can be accessed without an instance of the enclosing class, so there’s no reason to instantiate a class that has only
<code>static</code> methods.</p>
<h3>Noncompliant code example</h3>
<pre>
public class TextUtils {
  public static String stripHtml(String source) {
    return source.replaceAll("&lt;[^&gt;]+&gt;", "");
  }
}

public class TextManipulator {

  // ...

  public void cleanText(String source) {
    TextUtils textUtils = new TextUtils(); // Noncompliant

    String stripped = textUtils.stripHtml(source);

    //...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class TextUtils {
  public static String stripHtml(String source) {
    return source.replaceAll("&lt;[^&gt;]+&gt;", "");
  }
}

public class TextManipulator {

  // ...

  public void cleanText(String source) {
    String stripped = TextUtils.stripHtml(source);

    //...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Non-serializable objects should not be stored in "javax.servlet.http.HttpSession" instances (java:S2441)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/579">CWE-579 - J2EE Bad Practices: Non-serializable Object Stored in Session</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>HttpSession</code> s are managed by web servers and can be serialized and stored on disk as the server manages its memory use in a process
called "passivation" (and later restored during "activation").</p>
<p>Even though <code>HttpSession</code> does not extend <code>Serializable</code>, you must nonetheless assume that it will be serialized. If
non-serializable objects are stored in the session, serialization might fail.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Address {
  //...
}

HttpSession session = request.getSession();
session.setAttribute("address", new Address());  // Noncompliant; Address isn't serializable
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class Address implements Serializable {
  //...
}

HttpSession session = request.getSession();
session.setAttribute("address", new Address());
</pre></p>
            </div>
        <div class="rule">
            <h3>Synchronizing on a "Lock" object should be avoided (java:S2442)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>java.util.concurrent.locks.Lock</code> offers far more powerful and flexible locking operations than are available with
<code>synchronized</code> blocks. So synchronizing on a <code>Lock</code> instance throws away the power of the object, as it overrides its better
locking mechanisms. Instead, such objects should be locked and unlocked using one of their <code>lock</code> and <code>unlock</code> method
variants.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
Lock lock = new MyLockImpl();
synchronized(lock) {  // Noncompliant
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
Lock lock = new MyLockImpl();
if (lock.tryLock()) {
  try {
    // ...
  } finally {
    lock.unlock();
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/qjdGBQ">CERT, LCK03-J.</a> - Do not synchronize on the intrinsic locks of high-level concurrency
  objects </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Lazy initialization of "static" fields should be "synchronized" (java:S2444)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In a multi-threaded situation, un-<code>synchronized</code> lazy initialization of static fields could mean that a second thread has access to a
half-initialized object while the first thread is still creating it. Allowing such access could cause serious bugs. Instead. the initialization block
should be <code>synchronized</code>.</p>
<p>Similarly, updates of such fields should also be <code>synchronized</code>.</p>
<p>This rule raises an issue whenever a lazy static initialization is done on a class with at least one <code>synchronized</code> method, indicating
intended usage in multi-threaded applications.</p>
<h3>Noncompliant code example</h3>
<pre>
private static Properties fPreferences = null;

private static Properties getPreferences() {
        if (fPreferences == null) {
            fPreferences = new Properties(); // Noncompliant
            fPreferences.put("loading", "true");
            fPreferences.put("filterstack", "true");
            readPreferences();
        }
        return fPreferences;
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
private static Properties fPreferences = null;

private static synchronized Properties getPreferences() {
        if (fPreferences == null) {
            fPreferences = new Properties();
            fPreferences.put("loading", "true");
            fPreferences.put("filterstack", "true");
            readPreferences();
        }
        return fPreferences;
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Multiline blocks should be enclosed in curly braces (java:S2681)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Having inconsistent indentation and omitting curly braces from a control structure, such as an <code>if</code> statement or <code>for</code> loop,
is misleading and can induce bugs.</p>
<p>This rule raises an issue when the indentation of the lines after a control structure indicates an intent to include those lines in the block, but
the omission of curly braces means the lines will be unconditionally executed once.</p>
<p>The following patterns are recognized:</p>
<pre>
if (condition)
  firstActionInBlock();
  secondAction();  // Noncompliant: secondAction is executed unconditionally
thirdAction();
</pre>
<pre>
if (condition) firstActionInBlock(); secondAction();  // Noncompliant: secondAction is executed unconditionally
</pre>
<pre>
if (condition) firstActionInBlock();
  secondAction();  // Noncompliant: secondAction is executed unconditionally
</pre>
<pre>
if (condition); secondAction();  // Noncompliant: secondAction is executed unconditionally
</pre>
<pre>
for (int i = 0; i &lt; array.length; i++)
  str = array[i];
  doTheThing(str);  // Noncompliant: executed only on the last element
</pre>
<p>Note that this rule considers tab characters to be equivalent to 1 space. When mixing spaces and tabs, a code may look fine in one editor but be
confusing in another configured differently.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/483">CWE-483 - Incorrect Block Delimitation</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/MzZGBQ">CERT, EXP52-J.</a> - Use braces for the body of an if, for, or while statement </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Files opened in append mode should not be used with "ObjectOutputStream" (java:S2689)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://docs.jboss.org/jbossas/javadoc/4.0.2/org/jboss/util/stream/AppendingObjectOutputStream.java.html">JBoss -
  AppendingObjectOutputStream</a> </li>
</ul>
<h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/io/ObjectOutputStream.html">Oracle SE 20 - ObjectOutputStream</a>
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>An <code>ObjectOutputStream</code> writes primitive data types and graphs of Java objects to an <code>OutputStream</code>. The objects can be read
(reconstituted) using an <code>ObjectInputStream</code>.</p>
<p>When <code>ObjectOutputStream</code> is used with files opened in append mode, it can cause data corruption and unexpected behavior. This is
because when <code>ObjectOutputStream</code> is created, it writes metadata to the output stream, which can conflict with the existing metadata when
the file is opened in append mode. This can lead to errors and data loss.</p>
<p>When used with serialization, an <code>ObjectOutputStream</code> first writes the serialization stream header. This header should appear once per
file at the beginning. When you’re trying to read your object(s) back from the file, only the first one will be read successfully, and a
<code>StreamCorruptedException</code> will be thrown after that.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Open the file to use the default action (writes stream header).</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
FileOutputStream fos = new FileOutputStream(fileName , true);  // fos opened in append mode
ObjectOutputStream out = new ObjectOutputStream(fos);  // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
FileOutputStream fos = new FileOutputStream(fileName);
ObjectOutputStream out = new ObjectOutputStream(fos);
</pre></p>
            </div>
        <div class="rule">
            <h3>Disabling CSRF protections is security-sensitive (java:S4502)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Compliant Solution</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using">Spring Security</a> CSRF protection is enabled
by default, do not disable it:</p>
<pre>
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    // http.csrf().disable(); // Compliant
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-community/attacks/csrf">Cross-Site Request Forgery</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222603">Application Security and
  Development: V-222603</a> - The application must protect from Cross-Site Request Forgery (CSRF) vulnerabilities. </li>
  <li> PortSwigger - <a href="https://portswigger.net/research/web-storage-the-lesser-evil-for-session-tokens">Web storage: the lesser evil for
  session tokens</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using">Spring Security</a> provides by default a
protection against CSRF attacks which can be disabled:</p>
<pre>
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http.csrf().disable(); // Sensitive: csrf protection is entirely disabled
   // or
    http.csrf().ignoringAntMatchers("/route/"); // Sensitive: csrf protection is disabled for specific routes
  }
}
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>A cross-site request forgery (CSRF) attack occurs when a trusted user of a web application can be forced, by an attacker, to perform sensitive
actions that he didn’t intend, such as updating his profile or sending a message, more generally anything that can change the state of the
application.</p>
<p>The attacker can trick the user/victim to click on a link, corresponding to the privileged action, or to visit a malicious web site that embeds a
hidden web request and as web browsers automatically include cookies, the actions can be authenticated and sensitive.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The web application uses cookies to authenticate users. </li>
  <li> There exist sensitive operations in the web application that can be performed when the user is authenticated. </li>
  <li> The state / resources of the web application can be modified by doing HTTP POST or HTTP DELETE requests for example. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Protection against CSRF attacks is strongly recommended:
    <ul>
      <li> to be activated by default for all <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">unsafe HTTP
      methods</a>. </li>
      <li> implemented, for example, with an unguessable CSRF token </li>
    </ul>  </li>
  <li> Of course all sensitive operations should not be performed with <a
  href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods">safe HTTP</a> methods like <code>GET</code> which are designed to be
  used only for information retrieval. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using">Spring Security</a> provides by default a
protection against CSRF attacks which can be disabled:</p>
<pre>
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    http.csrf().disable(); // Sensitive: csrf protection is entirely disabled
   // or
    http.csrf().ignoringAntMatchers("/route/"); // Sensitive: csrf protection is disabled for specific routes
  }
}
</pre>
<h2>Compliant Solution</h2>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-using">Spring Security</a> CSRF protection is enabled
by default, do not disable it:</p>
<pre>
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

  @Override
  protected void configure(HttpSecurity http) throws Exception {
    // http.csrf().disable(); // Compliant
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-community/attacks/csrf">Cross-Site Request Forgery</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222603">Application Security and
  Development: V-222603</a> - The application must protect from Cross-Site Request Forgery (CSRF) vulnerabilities. </li>
  <li> PortSwigger - <a href="https://portswigger.net/research/web-storage-the-lesser-evil-for-session-tokens">Web storage: the lesser evil for
  session tokens</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>AssertJ configuration should be applied (java:S5831)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>org.assertj.core.configuration.Configuration</code> will be effective only once you call <code>Configuration.apply()</code> or
<code>Configuration.applyAndDisplay()</code>.</p>
<p>This rule raises an issue when configurations are set without the appropriate call to apply them.</p>
<h3>Noncompliant code example</h3>
<pre>
Configuration configuration = new Configuration(); // Noncompliant, this configuration will not be applied.
configuration.setComparingPrivateFields(true);
</pre>
<h3>Compliant solution</h3>
<pre>
Configuration configuration = new Configuration();
configuration.setComparingPrivateFields(true);
configuration.applyAndDisplay();
// Alternatively: configuration.apply();
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://assertj.github.io/doc/#assertj-configuration">AssertJ configuration documentation</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>AssertJ methods setting the assertion context should come before an assertion (java:S5833)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Describing, setting error message or adding a comparator in <a href="https://assertj.github.io/doc/">AssertJ</a> must be done before calling the
assertion, otherwise, settings will not be taken into account.</p>
<p>This rule raises an issue when one of the method (with all similar methods):</p>
<ul>
  <li> <code>as</code> </li>
  <li> <code>describedAs</code> </li>
  <li> <code>withFailMessage</code> </li>
  <li> <code>overridingErrorMessage</code> </li>
  <li> <code>usingComparator</code> </li>
  <li> <code>usingElementComparator</code> </li>
  <li> <code>extracting</code> </li>
  <li> <code>filteredOn</code> </li>
</ul>
<p>is called without calling an AssertJ assertion afterward.</p>
<h3>Noncompliant code example</h3>
<pre>
assertThat(actual).isEqualTo(expected).as("Description"); // Noncompliant
assertThat(actual).isEqualTo(expected).withFailMessage("Fail message"); // Noncompliant
assertThat(actual).isEqualTo(expected).usingComparator(new CustomComparator()); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
assertThat(actual).as("Description").isEqualTo(expected);
assertThat(actual).withFailMessage("Fail message").isEqualTo(expected);
assertThat(actual).usingComparator(new CustomComparator()).isEqualTo(expected);
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://assertj.github.io/doc/#calling-as-after-the-assertion">AssertJ incorrect usage documentation</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"@Value" annotation should inject property or SpEL expression (java:S6804)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The purpose of the <code>@Value</code> annotation in <code>org.springframework.beans.factory.annotation</code> is to inject a value into a field or
method based on the Spring context after it has been established.</p>
<p>If the annotation does not include an expression (either Spring Expression Language or a property injection), the injected value is a simple
constant that does not depend on the Spring context, making the annotation replaceable with a standard field initialization statement.</p>
<p>This not only implies the redundant use of <code>@Value</code>, but could also indicate an error where the expression indicators (<code>#</code>,
<code>$</code>) were omitted by mistake.</p>
<h3>Exceptions</h3>
<p>This rule does not raise an issue if <code>@Value</code> is applied to a method or method argument, because the annotation has the side effect that
the method is called.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><ul>
  <li> If a property is to be injected, use <code>${propertyName}</code> instead of <code>propertyName</code>. </li>
  <li> If a SpEL expression is to be evaluated, use <code>#{expression}</code> instead of <code>expression</code>. </li>
  <li> If you intend to initialize a field with a simple value or with an expression that does not depend on the Spring context, use a standard field
  initialization statement. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Value("catalog.name") // Noncompliant, this will not inject the property
String catalog;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Value("${catalog.name}") // Compliant
String catalog;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
@Value("book.topics[0]") // Noncompliant, this will not evaluate the expression
Topic topic;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
@Value("#{book.topics[0]}") // Compliant
Topic topic;
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="3" data-diff-type="noncompliant">
@Value("Hello, world!") // Noncompliant, this use of @Value is redundant
String greeting;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
String greeting = "Hello, world!"; // Compliant
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Value.html">Spring
  Framework API - Annotation Interface Value</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-value-annotation">Baeldung - A Quick Guide to Spring @Value</a> </li>
  <li> <a href="https://www.digitalocean.com/community/tutorials/spring-value-annotation">DigitalOcean - Spring @Value Annotation</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule reports when the Spring <code>@Value</code> annotation injects a simple value that does not contain an expression.</p></p>
            </div>
        <div class="rule">
            <h3>Methods with Spring proxy should not be called via "this" (java:S6809)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace calls to <code>@Async</code>, <code>@Cacheable</code> or <code>@Transactional</code> methods via <code>this</code> with calls on an
instance that was injected by Spring (<code>@Autowired</code>, <code>@Resource</code> or <code>@Inject</code>). The injected instance is a proxy on
which the methods can be invoked safely.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Service
public class AsyncNotificationProcessor implements NotificationProcessor {

  @Override
  public void process(Notification notification) {
    processAsync(notification); // Noncompliant, call bypasses proxy
    retrieveNotification(notification.id); // Noncompliant, call bypasses proxy and will not be cached
  }

  @Async
  public processAsync(Notification notification) {
    // ...
  }

  @Cacheable
  public Notification retrieveNotification(Long id) {
    // ...
  }

}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Service
public class AsyncNotificationProcessor implements NotificationProcessor {

  @Resource
  private AsyncNotificationProcessor

  @Override
  public void process(Notification notification) {
    asyncNotificationProcessor.processAsync(notification); // Compliant, call via injected proxy
    asyncNotificationProcessor.retrieveNotification(notification.id); // Compliant, the call will be cached
  }

  @Async
  public processAsync(Notification notification) {
    // ...
  }

  @Cacheable
  public Notification retrieveNotification(Long id) {
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A method annotated with Spring’s <code>@Async</code>, <code>@Cacheable</code> or <code>@Transactional</code> annotations will not work as expected
if invoked directly from within its class.</p>
<p>This is because Spring generates a proxy class with wrapper code to manage the method’s asynchronicity (<code>@Async</code>), to cache methods
invocations (<code>@Cacheable</code>), or to handle the transaction (<code>@Transactional</code>). However, when called using <code>this</code>, the
proxy instance is bypassed, and the method is invoked directly without the required wrapper code.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Async.html">Spring
  Framework API - Annotation Interface Async</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">Spring
  Framework API - Annotation Interface Transactional</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/cache/annotation/Cacheable.html">Spring Framework
  API - Annotation Interface Cacheable</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-async">Baeldung - How To Do @Async in Spring</a> </li>
  <li> <a href="https://stackoverflow.com/questions/22561775/spring-async-ignored">Stack Overflow - Spring @Async ignored</a> </li>
  <li> <a href="https://stackoverflow.com/questions/4396284/does-spring-transactional-attribute-work-on-a-private-method">Stack Overflow - Does Spring
  @Transactional attribute work on a private method?</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/integration/cache/annotations.html#cache-annotations-cacheable">Spring docs, The
  @Cacheable Annotation</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Motion Sensor should not use gyroscope (java:S6923)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>The <code>android.hardware.SensorManager#getDefaultSensor</code> offers two types of Motion Sensors:</p>
<ul>
  <li> <code>TYPE_ROTATION_VECTOR:</code> a combination of the gyroscope, accelerometer, and magnetometer. </li>
  <li> <code>TYPE_GEOMAGNETIC_ROTATION_VECTOR:</code> a combination of the accelerometer and magnetometer. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace <code>TYPE_ROTATION_VECTOR</code> with <code>TYPE_GEOMAGNETIC_ROTATION_VECTOR</code> when retrieving the Motion Sensor.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class BackGroundActivity extends Activity {

    private Sensor motionSensor;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        SensorManager sensorManager = (SensorManager) getSystemService(Context.SENSOR_SERVICE);
        motionSensor = sensorManager.getDefaultSensor(Sensor.TYPE_ROTATION_VECTOR); // Noncompliant
        // ..
    }
    //..
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class BackGroundActivity extends Activity {

    private Sensor motionSensor;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        SensorManager sensorManager = (SensorManager) getSystemService(Context.SENSOR_SERVICE);
        motionSensor = sensorManager.getDefaultSensor(Sensor.TYPE_GEOMAGNETIC_ROTATION_VECTOR); // Compliant
        // ..
    }
    //..
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://source.android.com/docs/core/interaction/sensors/power-use">Android - Low Power Sensors</a> </li>
  <li> <a href="https://developer.android.com/develop/sensors-and-location/sensors/sensors_motion">Android - Motion Sensors</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The battery life is a major concern for mobile devices and choosing the right Sensor is very important to reduce the power usage and extend the
battery life.</p>
<p>It is recommended, for reducing the power usage, to use <code>TYPE_GEOMAGNETIC_ROTATION_VECTOR</code> for <em>background tasks</em>,
<em>long-running tasks</em> and other tasks not requiring accurate motion detection.</p>
<p>The rule reports an issue when <code>android.hardware.SensorManager#getDefaultSensor</code> uses <code>TYPE_ROTATION_VECTOR</code> instead of
<code>TYPE_GEOMAGNETIC_ROTATION_VECTOR</code>.</p></p>
            </div>
        <div class="rule">
            <h3>Empty statements should be removed (java:S1116)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5dUxBQ">CERT, MSC12-C.</a> - Detect and remove code that has no effect or is never executed
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/IDZGBQ">CERT, MSC51-J.</a> - Do not place a semicolon immediately following an if, for, or while
  condition </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/WtYxBQ">CERT, EXP15-C.</a> - Do not place a semicolon on the same line as an if, for, or while
  statement </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Empty statements represented by a semicolon <code>;</code> are statements that do not perform any operation. They are often the result of a typo or
a misunderstanding of the language syntax. It is a good practice to remove empty statements since they don’t add value and lead to confusion and
errors.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void doSomething() {
  ; // Noncompliant - was used as a kind of TODO marker
}

void doSomethingElse() {
  System.out.println("Hello, world!");; // Noncompliant - double ;
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void doSomething() {}

void doSomethingElse() {
  System.out.println("Hello, world!");
  // ...
  for (int i = 0; i &lt; 3; i++) ; // Compliant if unique statement of a loop
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Boolean literals should not be redundant (java:S1125)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A boolean literal can be represented in two different ways: <code>true</code> or <code>false</code>. They can be combined with logical operators
(<code>!, &amp;&amp;, ||, ==, !=</code>) to produce logical expressions that represent truth values. However, comparing a boolean literal to a
variable or expression that evaluates to a boolean value is unnecessary and can make the code harder to read and understand. The more complex a
boolean expression is, the harder it will be for developers to understand its meaning and expected behavior, and it will favour the introduction of
new bugs.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Remove redundant boolean literals from expressions to improve readability and make the code more maintainable.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
if (booleanMethod() == true) { /* ... */ }
if (booleanMethod() == false) { /* ... */ }
if (booleanMethod() || false) { /* ... */ }
doSomething(!false);
doSomething(booleanMethod() == true);

booleanVariable = booleanMethod() ? true : false;
booleanVariable = booleanMethod() ? true : exp;
booleanVariable = booleanMethod() ? false : exp;
booleanVariable = booleanMethod() ? exp : true;
booleanVariable = booleanMethod() ? exp : false;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
if (booleanMethod()) { /* ... */ }
if (!booleanMethod()) { /* ... */ }
if (booleanMethod()) { /* ... */ }
doSomething(true);
doSomething(booleanMethod());

booleanVariable = booleanMethod();
booleanVariable = booleanMethod() || exp;
booleanVariable = !booleanMethod() &amp;&amp; exp;
booleanVariable = !booleanMethod() || exp;
booleanVariable = booleanMethod() &amp;&amp; exp;
</pre></p>
            </div>
        <div class="rule">
            <h3>Return of boolean expressions should not be wrapped into an "if-then-else" statement (java:S1126)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Return of boolean literal statements wrapped into <code>if-then-else</code> ones should be simplified.</p>
<p>Similarly, method invocations wrapped into <code>if-then-else</code> differing only from boolean literals should be simplified into a single
invocation.</p>
<h3>Noncompliant code example</h3>
<pre>
boolean foo(Object param) {
  if (expression) { // Noncompliant
    bar(param, true, "qix");
  } else {
    bar(param, false, "qix");
  }

  if (expression) {  // Noncompliant
    return true;
  } else {
    return false;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
boolean foo(Object param) {
  bar(param, expression, "qix");

  return expression;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"switch" statements should not have too many "case" clauses (java:S1479)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When <code>switch</code> statements have large sets of <code>case</code> clauses, it is usually an attempt to map two sets of data. A real map
structure would be more readable and maintainable, and should be used instead.</p>
<h3>Exceptions</h3>
<p>This rule ignores <code>switch</code>es over <code>Enum</code>s and empty, fall-through cases.</p></p>
            </div>
        <div class="rule">
            <h3>Local variables should not be declared and then immediately returned or thrown (java:S1488)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Declaring a variable only to immediately return or throw it is considered a bad practice because it adds unnecessary complexity to the code. This
practice can make the code harder to read and understand, as it introduces an extra step that doesn’t add any value. Instead of declaring a variable
and then immediately returning or throwing it, it is generally better to return or throw the value directly. This makes the code cleaner, simpler, and
easier to understand.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Declaring a variable only to immediately return or throw it is considered a bad practice because it adds unnecessary complexity to the code. To fix
the issue, return or throw the value directly.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public long computeDurationInMilliseconds() {
  long duration = (((hours * 60) + minutes) * 60 + seconds) * 1000;
  return duration;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public long computeDurationInMilliseconds() {
  return (((hours * 60) + minutes) * 60 + seconds) * 1000;
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
public void doSomething() {
  RuntimeException myException = new RuntimeException();
  throw myException;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
public void doSomething() {
  throw new RuntimeException();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"null" should not be returned from a "Boolean" method (java:S2447)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/476">CWE-476 - NULL Pointer Dereference</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/aDdGBQ">CERT, EXP01-J.</a> - Do not use a null in a case where an object is required </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Callers of a <code>Boolean</code> method may be expecting to receive <code>true</code> or <code>false</code> in response. But <code>Boolean</code>
objects can take <code>null</code> as a possible value. <code>Boolean</code> methods should not return <code>null</code> unless the code is annotated
appropriately. With the proper annotation, the caller is aware that the returned value could be null.</p>
<h3>Noncompliant code example</h3>
<pre>
public Boolean isUsable() {
  // ...
  return null;  // Noncompliant
}

public void caller() {
  if (isUsable()) { // A NullPointerException might occur here
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
@javax.annotation.Nullable
public Boolean isUsable() {
  // ...
  return null;
}

@javax.annotation.CheckForNull
public Boolean isUsable() {
  // ...
  return null;
}

public void caller() {
  if (Boolean.True.equals(isUsable())) { // This caller knows to check and avoid ambiguity
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Instance methods should not write to "static" fields (java:S2696)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222567">Application Security and
  Development: V-222567</a> - The application must not be vulnerable to race conditions. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Correctly updating a <code>static</code> field from a non-static method is tricky to get right and could easily lead to bugs if there are multiple
class instances and/or multiple threads in play. Ideally, <code>static</code> fields are only updated from <code>synchronized static</code>
methods.</p>
<p>This rule raises an issue each time a <code>static</code> field is updated from a non-static method.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {

  private static int count = 0;

  public void doSomething() {
    //...
    count++;  // Noncompliant
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Test assertions should include messages (java:S2698)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Adding messages to JUnit, FEST and AssertJ assertions is an investment in your future productivity. Spend a few seconds writing them now, and
you’ll save a lot of time on the other end when either the tests fail and you need to quickly diagnose the problem, or when you need to maintain the
tests and the assertion messages work as a sort of documentation.</p>
<h3>Noncompliant code example</h3>
<pre>
assertEquals(4, list.size());  // Noncompliant

try {
  fail();  // Noncompliant
} catch (Exception e) {
  assertThat(list.get(0)).isEqualTo("pear");  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
assertEquals("There should have been 4 Fruits in the list", 4, list.size());

try {
  fail("And exception is expected here");
} catch (Exception e) {
  assertThat(list.get(0)).as("check first element").overridingErrorMessage("The first element should be a pear, not a %s", list.get(0)).isEqualTo("pear");
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Tests should include assertions (java:S2699)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A test case without assertions ensures only that no exceptions are thrown. Beyond basic runnability, it ensures nothing about the behavior of the
code under test.</p>
<p>This rule raises an exception when no assertions from any of the following known frameworks are found in a test:</p>
<ul>
  <li> AssertJ </li>
  <li> Awaitility </li>
  <li> EasyMock </li>
  <li> Eclipse Vert.x </li>
  <li> Fest 1.x and 2.x </li>
  <li> Hamcrest </li>
  <li> JMock </li>
  <li> JMockit </li>
  <li> JUnit </li>
  <li> Mockito </li>
  <li> Rest-assured 2.x, 3.x and 4.x </li>
  <li> RxJava 1.x and 2.x </li>
  <li> Selenide </li>
  <li> Spring’s <code>org.springframework.test.web.servlet.ResultActions.andExpect()</code> and
  <code>org.springframework.test.web.servlet.ResultActions.andExpectAll()</code> </li>
  <li> Truth Framework </li>
  <li> WireMock </li>
</ul>
<p>Furthermore, as new or custom assertion frameworks may be used, the rule can be parametrized to define specific methods that will also be
considered as assertions. No issue will be raised when such methods are found in test cases. The parameter value should have the following format
<code>&lt;FullyQualifiedClassName&gt;#&lt;MethodName&gt;</code>, where <code>MethodName</code> can end with the wildcard character. For constructors,
the pattern should be <code>&lt;FullyQualifiedClassName&gt;#&lt;init&gt;</code>.</p>
<p>Example:&nbsp;<code>com.company.CompareToTester#compare*,com.company.CustomAssert#customAssertMethod,com.company.CheckVerifier#&lt;init&gt;</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
@Test
public void testDoSomething() {  // Noncompliant
  MyClass myClass = new MyClass();
  myClass.doSomething();
}
</pre>
<h3>Compliant solution</h3>
<p>Example when <code>com.company.CompareToTester#compare*</code> is used as parameter to the rule.</p>
<pre>
import com.company.CompareToTester;

@Test
public void testDoSomething() {
  MyClass myClass = new MyClass();
  assertNull(myClass.doSomething());  // JUnit assertion
  assertThat(myClass.doSomething()).isNull();  // Fest assertion
}

@Test
public void testDoSomethingElse() {
  MyClass myClass = new MyClass();
  new CompareToTester().compareWith(myClass);  // Compliant - custom assertion method defined as rule parameter
  CompareToTester.compareStatic(myClass);  // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Assertion arguments should be passed in the correct order (java:S3415)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The standard assertions library methods such as <code>org.junit.Assert.assertEquals</code>, and <code>org.junit.Assert.assertSame</code> expect the
first argument to be the expected value and the second argument to be the actual value. For AssertJ instead, the argument of
<code>org.assertj.core.api.Assertions.assertThat</code> is the actual value, and the subsequent calls contain the expected values.</p>
<h3>What is the potential impact?</h3>
<p>Having the expected value and the actual value in the wrong order will not alter the outcome of tests, (succeed/fail when it should) but the error
messages will contain misleading information.</p>
<p>This rule raises an issue when the actual argument to an assertions library method is a hard-coded value and the expected argument is not.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>You should provide the assertion methods with a hard-coded value as the expected value, while the actual value of the assertion should derive from
the portion of code that you want to test.</p>
<p>Supported frameworks:</p>
<ul>
  <li> <a href="https://junit.org/junit4/">JUnit4</a> </li>
  <li> <a href="https://junit.org/junit5/docs/current/user-guide/">JUnit5</a> </li>
  <li> <a href="https://assertj.github.io/doc/">AssertJ</a> </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
org.junit.Assert.assertEquals(runner.exitCode(), 0, "Unexpected exit code");  // Noncompliant; Yields error message like: Expected:&lt;-1&gt;. Actual:&lt;0&gt;.
org.assertj.core.api.Assertions.assertThat(0).isEqualTo(runner.exitCode()); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
org.junit.Assert.assertEquals(0, runner.exitCode(), "Unexpected exit code");
org.assertj.core.api.Assertions.assertThat(runner.exitCode()).isEqualTo(0);
</pre></p>
            </div>
        <div class="rule">
            <h3>Loggers should be named for their enclosing classes (java:S3416)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It is convention to name each class’s logger for the class itself. Doing so allows you to set up clear, communicative logger configuration. Naming
loggers by some other convention confuses configuration, and using the same class name for multiple class loggers prevents the granular configuration
of each class' logger. Some libraries, such as SLF4J warn about this, but not all do.</p>
<p>This rule raises an issue when a logger is not named for its enclosing class.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {
  private final static Logger LOG = LoggerFactory.getLogger(WrongClass.class);  // Noncompliant; multiple classes using same logger
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyClass {
  private final static Logger LOG = LoggerFactory.getLogger(MyClass.class);
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Custom resources should be closed (java:S3546)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Leaking resources in an application is never a good idea, as it can lead to memory issues, and even the crash of the application. This rule
template allows you to specify which constructions open a resource and how it is closed in order to raise issue within a method scope when custom
resources are leaked.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS2095'>S2095</a> - Resources should be closed </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Unit tests should throw exceptions (java:S3658)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the code under test in a unit test throws an exception, the test itself fails. Therefore, there is no need to surround the tested code with a
<code>try</code>-<code>catch</code> structure to detect failure. Instead, you can simply move the exception type to the method signature.</p>
<p>This rule raises an issue when there is a fail assertion inside a <code>catch</code> block.</p>
<p>Supported frameworks:</p>
<ul>
  <li> JUnit3 </li>
  <li> JUnit4 </li>
  <li> JUnit5 </li>
  <li> Fest assert </li>
  <li> AssertJ </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
@Test
public void testMethod() {
  try {
            // Some code
  } catch (MyException e) {
    Assert.fail(e.getMessage());  // Noncompliant
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Test
public void testMethod() throws MyException {
    // Some code
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Delivering code in production with debug features activated is security-sensitive (java:S4507)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Default:</p>
            <p><p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Sensitive Code Example</h2>
<p><code>Throwable.printStackTrace(...)</code> prints a Throwable and its stack trace to <code>System.Err</code> (by default) which is not easily
parseable and can expose sensitive information:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  e.printStackTrace(); // Sensitive
}
</pre>
<p><a
href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>true</code> enables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

@Configuration
@EnableWebSecurity(debug = true) // Sensitive
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(true)</a>
for Android enables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(true); // Sensitive
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Loggers should be used (instead of <code>printStackTrace</code>) to print throwables:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  LOGGER.log("context", e);
}
</pre>
<p><a
href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>false</code> disables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

@Configuration
@EnableWebSecurity(debug = false)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(false)</a>
for Android disables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(false);
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The code or configuration enabling the application debug features is deployed on production servers or distributed to end users. </li>
  <li> The application runs by default with debug features activated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p><code>Throwable.printStackTrace(...)</code> prints a Throwable and its stack trace to <code>System.Err</code> (by default) which is not easily
parseable and can expose sensitive information:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  e.printStackTrace(); // Sensitive
}
</pre>
<p><a
href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>true</code> enables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

@Configuration
@EnableWebSecurity(debug = true) // Sensitive
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(true)</a>
for Android enables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(true); // Sensitive
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(true); // Sensitive
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Development tools and frameworks usually have options to make debugging easier for developers. Although these features are useful during
development, they should never be enabled for applications deployed in production. Debug instructions or error messages can leak detailed information
about the system, like the application’s path or file names.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Do not enable debugging features on production servers or applications distributed to end users.</p>
<h2>Compliant Solution</h2>
<p>Loggers should be used (instead of <code>printStackTrace</code>) to print throwables:</p>
<pre>
try {
  /* ... */
} catch(Exception e) {
  LOGGER.log("context", e);
}
</pre>
<p><a
href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html">EnableWebSecurity</a>
annotation for SpringFramework with <code>debug</code> to <code>false</code> disables debugging support:</p>
<pre>
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;

@Configuration
@EnableWebSecurity(debug = false)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
  // ...
}
</pre>
<p><a
href="https://developer.android.com/reference/android/webkit/WebView#setWebContentsDebuggingEnabled(boolean)">WebView.setWebContentsDebuggingEnabled(false)</a>
for Android disables debugging support:</p>
<pre>
import android.webkit.WebView;

WebView.setWebContentsDebuggingEnabled(false);
WebView.getFactory().getStatics().setWebContentsDebuggingEnabled(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/489">CWE-489 - Active Debug Code</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/215">CWE-215 - Information Exposure Through Debug Information</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Setting JavaBean properties is security-sensitive (java:S4512)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Setting JavaBean properties is security sensitive. Doing it with untrusted values has led in the past to the following vulnerability:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0114">CVE-2014-0114</a> </li>
</ul>
<p>JavaBeans can have their properties or nested properties set by population functions. An attacker can leverage this feature to push into the
JavaBean malicious data that can compromise the software integrity. A typical attack will try to manipulate the ClassLoader and finally execute
malicious code.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> BeanUtils.populate(…​) or BeanUtilsBean.populate(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/">Apache Commons
  BeanUtils</a> are called </li>
  <li> BeanUtils.setProperty(…​) or BeanUtilsBean.setProperty(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/">Apache Commons
  BeanUtils</a> are called </li>
  <li> org.springframework.beans.BeanWrapper.setPropertyValue(…​) or org.springframework.beans.BeanWrapper.setPropertyValues(…​) from Spring is called
  </li>
</ul>
</p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> the new property values might have been tampered with or provided by an untrusted source. </li>
  <li> sensitive properties can be modified, for example: <code>class.classLoader</code> </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
Company bean = new Company();
HashMap map = new HashMap();
Enumeration names = request.getParameterNames();
while (names.hasMoreElements()) {
    String name = (String) names.nextElement();
    map.put(name, request.getParameterValues(name));
}
BeanUtils.populate(bean, map); // Sensitive: "map" is populated with data coming from user input, here "request.getParameterNames()"
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Setting JavaBean properties is security sensitive. Doing it with untrusted values has led in the past to the following vulnerability:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0114">CVE-2014-0114</a> </li>
</ul>
<p>JavaBeans can have their properties or nested properties set by population functions. An attacker can leverage this feature to push into the
JavaBean malicious data that can compromise the software integrity. A typical attack will try to manipulate the ClassLoader and finally execute
malicious code.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> BeanUtils.populate(…​) or BeanUtilsBean.populate(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/">Apache Commons
  BeanUtils</a> are called </li>
  <li> BeanUtils.setProperty(…​) or BeanUtilsBean.setProperty(…​) from <a href="http://commons.apache.org/proper/commons-beanutils/">Apache Commons
  BeanUtils</a> are called </li>
  <li> org.springframework.beans.BeanWrapper.setPropertyValue(…​) or org.springframework.beans.BeanWrapper.setPropertyValues(…​) from Spring is called
  </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the new property values might have been tampered with or provided by an untrusted source. </li>
  <li> sensitive properties can be modified, for example: <code>class.classLoader</code> </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Sanitize all values used as JavaBean properties.</p>
<p>Don’t set any sensitive properties. Keep full control over which properties are set. If the property names are provided by an unstrusted source,
filter them with a whitelist.</p>
<h2>Sensitive Code Example</h2>
<pre>
Company bean = new Company();
HashMap map = new HashMap();
Enumeration names = request.getParameterNames();
while (names.hasMoreElements()) {
    String name = (String) names.nextElement();
    map.put(name, request.getParameterValues(name));
}
BeanUtils.populate(bean, map); // Sensitive: "map" is populated with data coming from user input, here "request.getParameterNames()"
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/915">CWE-915 - Improperly Controlled Modification of Dynamically-Determined Object
  Attributes</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#BEAN_PROPERTY_INJECTION">BEAN_PROPERTY_INJECTION</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Sanitize all values used as JavaBean properties.</p>
<p>Don’t set any sensitive properties. Keep full control over which properties are set. If the property names are provided by an unstrusted source,
filter them with a whitelist.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/915">CWE-915 - Improperly Controlled Modification of Dynamically-Determined Object
  Attributes</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#BEAN_PROPERTY_INJECTION">BEAN_PROPERTY_INJECTION</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>String offset-based methods should be preferred for finding substrings from offsets (java:S4635)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Looking for a given substring starting from a specified offset can be achieved by such code: <code>str.substring(beginIndex).indexOf(char1)</code>.
This works well, but it creates a new <code>String</code> for each call to the <code>substring</code> method. When this is done in a loop, a lot of
<code>Strings</code> are created for nothing, which can lead to performance problems if <code>str</code> is large.</p>
<p>To avoid performance problems, <code>String.substring(beginIndex)</code> should not be chained with the following methods:</p>
<ul>
  <li> <code>indexOf(int ch)</code> </li>
  <li> <code>indexOf(String str)</code> </li>
  <li> <code>lastIndexOf(int ch)</code> </li>
  <li> <code>lastIndexOf(String str)</code> </li>
  <li> <code>startsWith(String prefix)</code> </li>
</ul>
<p>For each of these methods, another method with an additional parameter is available to specify an offset.</p>
<p>Using these methods will avoid the creation of additional <code>String</code> instances. For indexOf methods, adjust the returned value by
subtracting the substring index parameter to obtain the same result.</p>
<h3>Noncompliant code example</h3>
<pre>
str.substring(beginIndex).indexOf(char1); // Noncompliant; a new String is going to be created by "substring"
</pre>
<h3>Compliant solution</h3>
<pre>
str.indexOf(char1, beginIndex) - beginIndex; // index for char1 not found is (-1-beginIndex)
</pre></p>
            </div>
        <div class="rule">
            <h3>Chained AssertJ assertions should be simplified to the corresponding dedicated assertion (java:S5838)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>AssertJ contains many assertions methods specific to common types. Both versions will test the same things, but the dedicated one will provide a
better error message, simplifying the debugging process.</p>
<p>This rule reports an issue when an assertion can be simplified to a dedicated one.</p>
<p>The array below gives a non-exhaustive list of assertion reported by the rule. Code behaving similarly, or with a negation will also be
reported.</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Original</th>
      <th>Dedicated</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><strong>Related to Object</strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getObject()).isEqualTo(null)</code></p></td>
      <td><p><code>assertThat(getObject()).isNull()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getBoolean()).isEqualTo(true)</code></p></td>
      <td><p><code>assertThat(getBoolean()).isTrue()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getBoolean()).isEqualTo(false)</code></p></td>
      <td><p><code>assertThat(getBoolean()).isFalse()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x.equals(y)).isTrue()</code></p></td>
      <td><p><code>assertThat(x).isEqualTo(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x == y).isTrue()</code></p></td>
      <td><p><code>assertThat(x).isSameAs(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x == null).isTrue()</code></p></td>
      <td><p><code>assertThat(x).isNull()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x.toString()).isEqualTo(y)</code></p></td>
      <td><p><code>assertThat(x).hasToString(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x.hashCode()).isEqualTo(y.hashCode())</code></p></td>
      <td><p><code>assertThat(x).hasSameHashCodeAs(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getObject() instanceof MyClass).isTrue()</code></p></td>
      <td><p><code>assertThat(getObject()).isInstanceOf(MyClass.class)</code></p></td>
    </tr>
    <tr>
      <td><p><strong>Related to <code>Comparable</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x.compareTo(y)).isZero()</code></p></td>
      <td><p><code>assertThat(x).isEqualByComparingTo(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x &gt;= y).isTrue()</code></p></td>
      <td><p><code>assertThat(x).isGreaterThanOrEqualTo(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x &gt; y).isTrue()</code></p></td>
      <td><p><code>assertThat(x).isGreaterThan(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x &lt;= y).isTrue()</code></p></td>
      <td><p><code>assertThat(x).isLessThanOrEqualTo(y)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(x &lt; y).isTrue()</code></p></td>
      <td><p><code>assertThat(x).isLessThan(y)</code></p></td>
    </tr>
    <tr>
      <td><p><strong>Related to <code>String</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().isEmpty()).isTrue()</code></p></td>
      <td><p><code>assertThat(getString()).isEmpty()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString()).hasSize(0)</code></p></td>
      <td><p><code>assertThat(getString()).isEmpty()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().equals(expected)).isTrue()</code></p></td>
      <td><p><code>assertThat(getString()).isEqualTo(expected)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().equalsIgnoreCase(expected)).isTrue()</code></p></td>
      <td><p><code>assertThat(getString()).isEqualToIgnoringCase(expected)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().contains(expected)).isTrue()</code></p></td>
      <td><p><code>assertThat(getString()).contains(expected)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().startsWith(expected)).isTrue()</code></p></td>
      <td><p><code>assertThat(getString()).startsWith(expected)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().endsWith(expected)).isTrue()</code></p></td>
      <td><p><code>assertThat(getString()).endsWith(expected)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().matches(expected)).isTrue()</code></p></td>
      <td><p><code>assertThat(getString()).matches(expected)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().trim()).isEmpty()</code></p></td>
      <td><p><code>assertThat(getString()).isBlank()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().length()).isEqualTo(length)</code></p></td>
      <td><p><code>assertThat(getString()).hasSize(length)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getString().length()).hasSize(expected.length())</code></p></td>
      <td><p><code>assertThat(getString()).hasSameSizeAs(expected)</code></p></td>
    </tr>
    <tr>
      <td><p><strong>&nbsp;Related to <code>File</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile()).hasSize(0)</code></p></td>
      <td><p><code>assertThat(getFile()).isEmpty()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().length()).isZero()</code></p></td>
      <td><p><code>assertThat(getFile()).isEmpty()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().length()).isEqualTo(length)</code></p></td>
      <td><p><code>assertThat(getFile()).hasSize(length)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().canRead()).isTrue()</code></p></td>
      <td><p><code>assertThat(getFile()).canRead()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().canWrite()).isTrue()</code></p></td>
      <td><p><code>assertThat(getFile()).canWrite()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().exists()).isTrue()</code></p></td>
      <td><p><code>assertThat(getFile()).exists()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().getName()).isEqualTo(name)</code></p></td>
      <td><p><code>assertThat(getFile()).hasName(name)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().getParent()).isEqualTo(pathname)</code></p></td>
      <td><p><code>assertThat(getFile()).hasParent(pathname)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().getParentFile()).isNull()</code></p></td>
      <td><p><code>assertThat(getFile()).hasNoParent()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().isAbsolute()).isTrue()</code></p></td>
      <td><p><code>assertThat(getFile()).isAbsolute()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().isAbsolute()).isFalse()</code></p></td>
      <td><p><code>assertThat(getFile()).isRelative()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().isDirectory()).isTrue()</code></p></td>
      <td><p><code>assertThat(getFile()).isDirectory()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().isFile()).isTrue()</code></p></td>
      <td><p><code>assertThat(getFile()).isFile()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getFile().list()).isEmpty()</code></p></td>
      <td><p><code>assertThat(getFile()).isEmptyDirectory()</code></p></td>
    </tr>
    <tr>
      <td><p><strong>&nbsp;Related to <code>Path</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getPath().startsWith(path)).isTrue()</code></p></td>
      <td><p><code>assertThat(getPath()).startsWithRaw(path)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getPath().endsWith(path)).isTrue()</code></p></td>
      <td><p><code>assertThat(getPath()).endsWithRaw(path)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getPath().getParent()).isEqualTo(name)</code></p></td>
      <td><p><code>assertThat(getPath()).hasParentRaw(name)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getPath().getParent()).isNull()</code></p></td>
      <td><p><code>assertThat(getPath()).hasNoParentRaw()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getPath().isAbsolute()).isTrue()</code></p></td>
      <td><p><code>assertThat(getPath()).isAbsolute()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getPath().isAbsolute()).isFalse()</code></p></td>
      <td><p><code>assertThat(getPath()).isRelative()</code></p></td>
    </tr>
    <tr>
      <td><p><strong>&nbsp;Related to <code>Array</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getArray().length).isZero()</code></p></td>
      <td><p><code>assertThat(getArray()).isEmpty()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getArray().length).isEqualTo(length)</code></p></td>
      <td><p><code>assertThat(getArray()).hasSize(length)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getArray().length).isEqualTo(anotherArray.length)</code></p></td>
      <td><p><code>assertThat(getArray()).hasSameSizeAs(anotherArray)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getArray().length).isLessThanOrEqualTo(expression)</code></p></td>
      <td><p><code>assertThat(getArray()).hasSizeLessThanOrEqualTo(expression)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getArray().length).isLessThan(expression)</code></p></td>
      <td><p><code>assertThat(getArray()).hasSizeLessThan(expression)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getArray().length).isGreaterThan(expression)</code></p></td>
      <td><p><code>assertThat(getArray()).hasSizeGreaterThan(expression)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getArray().length).isGreaterThanOrEqualTo(expression)</code></p></td>
      <td><p><code>assertThat(getArray()).hasSizeGreaterThanOrEqualTo(expression)</code></p></td>
    </tr>
    <tr>
      <td><p><strong>Related to <code>Collection</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getCollection().isEmpty()).isTrue()</code></p></td>
      <td><p><code>assertThat(getCollection()).isEmpty()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getCollection().size()).isZero()</code></p></td>
      <td><p><code>assertThat(getCollection()).isEmpty()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getCollection().contains(something)).isTrue()</code></p></td>
      <td><p><code>assertThat(getCollection()).contains(something)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getCollection().containsAll(otherCollection)).isTrue()</code></p></td>
      <td><p><code>assertThat(getCollection()).containsAll(otherCollection)</code></p></td>
    </tr>
    <tr>
      <td><p><strong>Related to <code>Map</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getMap().size()).isEqualTo(otherMap().size()</code></p></td>
      <td><p><code>assertThat(getMap()).hasSameSizeAs(otherMap())</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getMap().containsKey(key)).isTrue()</code></p></td>
      <td><p><code>assertThat(getMap()).containsKey(key)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getMap().keySet()).contains(key)</code></p></td>
      <td><p><code>assertThat(getMap()).containsKey(key)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getMap().keySet()).containsOnlyKey(key)</code></p></td>
      <td><p><code>assertThat(getMap()).containsOnlyKey(key)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getMap().containsValue(value)).isTrue()</code></p></td>
      <td><p><code>assertThat(getMap()).containsValue(value)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getMap().values()).contains(value)</code></p></td>
      <td><p><code>assertThat(getMap()).containsValue(value)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getMap().get(key)).isEqualTo(value)</code></p></td>
      <td><p><code>assertThat(getMap()).containsEntry(key, value)</code></p></td>
    </tr>
    <tr>
      <td><p><strong>Related to <code>Optional</code></strong></p></td>
      <td></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getOptional().isPresent()).isTrue()</code></p></td>
      <td><p><code>assertThat(getOptional()).isPresent()</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getOptional().get()).isEqualTo(something)</code></p></td>
      <td><p><code>assertThat(getOptional()).contains(something)</code></p></td>
    </tr>
    <tr>
      <td><p><code>assertThat(getOptional().get()).isSameAs(something)</code></p></td>
      <td><p><code>assertThat(getOptional()).containsSame(something)</code></p></td>
    </tr>
  </tbody>
</table>
<h3>Noncompliant code example</h3>
<pre>
assertThat(getObject()).isEqualTo(null); // Noncompliant
assertThat(getObject()).isNotEqualTo(null); // Noncompliant - not listed above but also supported

assertThat(getString().trim()).isEmpty();
assertThat(getFile().canRead()).isTrue();
assertThat(getPath().getParent()).isNull();
</pre>
<h3>Compliant solution</h3>
<pre>
assertThat(getObject()).isNull();
assertThat(getObject()).isNotNull();

assertThat(getString()).isBlank();
assertThat(getFile()).canRead();
assertThat(getPath()).hasNoParentRaw();
</pre></p>
            </div>
        <div class="rule">
            <h3>Repeated patterns in regular expressions should not match the empty string (java:S5842)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A regex should never include a repetitive pattern whose body would match the empty string. This is usually a sign that a part of the regex is
redundant or does not do what the author intended.</p>
<h3>Noncompliant code example</h3>
<pre>
"(?:)*"      // same as the empty regex, the '*' accomplishes nothing
"(?:|x)*"    // same as the empty regex, the alternative has no effect
"(?:x|)*"    // same as 'x*', the empty alternative has no effect
"(?:x*|y*)*" // same as 'x*', the first alternative would always match, y* is never tried
"(?:x?)*"    // same as 'x*'
"(?:x?)+"    // same as 'x*'
</pre>
<h3>Compliant solution</h3>
<pre>
"x*"
</pre></p>
            </div>
        <div class="rule">
            <h3>Regular expressions should not be too complicated (java:S5843)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Overly complicated regular expressions are hard to read and to maintain and can easily cause hard-to-find bugs. If a regex is too complicated, you
should consider replacing it or parts of it with regular code or splitting it apart into multiple patterns at least.</p>
<p>The complexity of a regular expression is determined as follows:</p>
<p>Each of the following operators increases the complexity by an amount equal to the current nesting level and also increases the current nesting
level by one for its arguments:</p>
<ul>
  <li> <code>|</code> - when multiple <code>|</code> operators are used together, the subsequent ones only increase the complexity by 1 </li>
  <li> <code>&amp;&amp;</code> (inside character classes) - when multiple <code>&amp;&amp;</code> operators are used together, the subsequent ones
  only increase the complexity by 1 </li>
  <li> Quantifiers (<code>*</code>, <code>+</code>, <code>?</code>, <code>{n,m}</code>, <code>{n,}</code> or <code>{n}</code>) </li>
  <li> Non-capturing groups that set flags (such as <code>(?i:some_pattern)</code> or <code>(?i)some_pattern</code>) </li>
  <li> Lookahead and lookbehind assertions </li>
</ul>
<p>Additionally, each use of the following features increase the complexity by 1 regardless of nesting:</p>
<ul>
  <li> character classes </li>
  <li> back references </li>
</ul>
<p>If a regular expression is split among multiple variables, the complexity is calculated for each variable individually, not for the whole regular
expression. If a regular expression is split over multiple lines, each line is treated individually if it is accompanied by a comment (either a Java
comment or a comment within the regular expression), otherwise the regular expression is analyzed as a whole.</p>
<h3>Noncompliant code example</h3>
<pre>
if (dateString.matches("^(?:(?:31(\\/|-|\\.)(?:0?[13578]|1[02]))\\1|(?:(?:29|30)(\\/|-|\\.)(?:0?[13-9]|1[0-2])\\2))(?:(?:1[6-9]|[2-9]\\d)?\\d{2})$|^(?:29(\\/|-|\\.)0?2\\3(?:(?:(?:1[6-9]|[2-9]\\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00))))$|^(?:0?[1-9]|1\\d|2[0-8])(\\/|-|\\.)(?:(?:0?[1-9])|(?:1[0-2]))\\4(?:(?:1[6-9]|[2-9]\\d)?\\d{2})$")) {
    handleDate(dateString);
}
</pre>
<h3>Compliant solution</h3>
<pre>
if (dateString.matches("^\\d{1,2}([-/.])\\d{1,2}\\1\\d{1,4}$")) {
    String dateParts[] = dateString.split("[-/.]");
    int day = Integer.parseInt(dateParts[0]);
    int month = Integer.parseInt(dateParts[1]);
    int year = Integer.parseInt(dateParts[2]);
    // Put logic to validate and process the date based on its integer parts here
}
</pre>
<h3>Exceptions</h3>
<p>Regular expressions are only analyzed if all parts of the regular expression are either string literals, effectively final local variables or
<code>static final</code> fields, all of which can be combined using the '<code>+</code>' operator.</p>
<p>When a regular expression is split among multiple variables or commented lines, each part is only analyzed if it is syntactically valid by
itself.</p></p>
            </div>
        <div class="rule">
            <h3>AssertJ "assertThatThrownBy" should not be used alone (java:S5958)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Unlike similar AssertJ methods testing exceptions (<code>assertThatCode()</code>, <code>assertThatExceptionOfType()</code>, …​), the
<code>assertThatThrownBy()</code> method can be used alone, failing if the code did not raise any exception.</p>
<p>Still, only testing that an exception was raised is not enough to guarantee that it was the expected one, and you should test the exception type or
content further. In addition, it will make explicit what you are expecting, without relying on side-effects.</p>
<p>This rule raises an issue when <code>assertThatThrownBy</code> is used, without testing the exception further.</p>
<h3>Noncompliant code example</h3>
<pre>
assertThatThrownBy(() -&gt; shouldThrow()); // Noncompliant, is it really the exception you expected?
</pre>
<h3>Compliant solution</h3>
<pre>
assertThatThrownBy(() -&gt; shouldThrow()).isInstanceOf(IOException.class);
//or
assertThatThrownBy(() -&gt; shouldThrow()).hasMessage("My exception");
</pre></p>
            </div>
        <div class="rule">
            <h3>Model attributes should follow the Java identifier naming convention (java:S6806)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://www.oracle.com/java/technologies/javase/codeconventions-namingconventions.html">Java SE - naming conventions</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/expressions.html">Spring Expression Language (SpEL)</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/ui/Model.html">Spring IO Docs - Interface
  Model</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Spring Expression Language (SpEL) is an expression language used in the Spring Framework for evaluating and manipulating objects, properties, and
conditions within Spring-based applications.</p>
<p><code>org.springframework.ui.Model</code> is an interface in the Spring Framework that represents a container for data that can be passed between a
controller and a view in a Spring MVC web application, allowing for data sharing during the request-response cycle.</p>
<p>Attributes added to the <code>org.springframework.ui.Model</code> should follow the Java identifier naming convention, which means they must start
with a letter <code>a-z, A-Z</code>, underscore <code>_</code>, or a dollar sign <code>$</code> and may be followed by letters, digits, underscores,
or dollar signs.</p>
<p>Failure to do so may result in SpEL parsing errors when using these attributes in template engines.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Follow the Java identifier naming convention.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
model.addAttribute(" a", 100); // Noncompliant (starts with a space)
model.addAttribute("a-b", 7);  // Noncompliant (contains a hyphen)
model.addAttribute("1c", 42);  // Noncompliant (starts with a digit)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
model.addAttribute("a", 100);
model.addAttribute("b", 42);
model.addAttribute("_c", 7);
model.addAttribute("$d", 8);
</pre></p>
            </div>
        <div class="rule">
            <h3>Async methods should return void or Future (java:S6810)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring Framework Documentation - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Async.html">Annotation Interface
  Async</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The Spring framework provides the annotation <code>Async</code> to mark a method (or all methods of a type) as a candidate for asynchronous
execution.</p>
<p>Asynchronous methods do not necessarily, by their nature, return the result of their calculation immediately. Hence, it is unexpected and in clear
breach of the <code>Async</code> contract for such methods to have a return type that is neither <code>void</code> nor a <code>Future</code> type.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use <code>void</code> as the return type if the method is not expected to return a result. Otherwise, a <code>Future</code> should be returned,
allowing the caller to retrieve the result once it is ready. It is permitted to return more specific subtypes that inherit from
<code>Future</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Async
public String asyncMethod() {
  ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Async
public Future&lt;String&gt; asyncMethod() {
  ...
}
</pre>
<p>Alternatively, if the method does not need to return a result:</p>
<pre>
@Async
public void asyncMethod() {
  ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Bluetooth should be configured to use low power (java:S6926)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><ul>
  <li> Use <code>CONNECTION_PRIORITY_LOW_POWER</code> for <code>requestConnectionPriority</code> method. </li>
  <li> Use <code>ADVERTISE_MODE_LOW_POWER</code> for <code>setAdvertiseMode</code> method to promote low power consumption. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class BluetoothExample {
    private final BluetoothGattCallback gattCallback = new BluetoothGattCallback() {
        @Override
        public void onConnectionStateChange(BluetoothGatt gatt, int status, int newState) {
          // ...
        }

        @Override
        public void onServicesDiscovered(BluetoothGatt gatt, int status) {
            if (status == BluetoothGatt.GATT_SUCCESS) {
                gatt.requestConnectionPriority(BluetoothGatt.CONNECTION_PRIORITY_HIGH); // Noncompliant
            }
        }
    };
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class BluetoothExample {
   private final BluetoothGattCallback gattCallback = new BluetoothGattCallback() {
        @Override
        public void onConnectionStateChange(BluetoothGatt gatt, int status, int newState) {
          // ...
        }

        @Override
        public void onServicesDiscovered(BluetoothGatt gatt, int status) {
            if (status == BluetoothGatt.GATT_SUCCESS) {
                gatt.requestConnectionPriority(BluetoothGatt.CONNECTION_PRIORITY_LOW_POWER); // Compliant
            }
        }
    };
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
public class BluetoothExample {
    private void startAdvertising() {
        AdvertiseSettings.Builder settingsBuilder = new AdvertiseSettings.Builder();
        settingsBuilder.setAdvertiseMode(AdvertiseSettings.ADVERTISE_MODE_LOW_LATENCY); // Noncompliant
        // Other settings configuration...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
public class BluetoothExample {
    private void startAdvertising() {
        AdvertiseSettings.Builder settingsBuilder = new AdvertiseSettings.Builder();
        settingsBuilder.setAdvertiseMode(AdvertiseSettings.ADVERTISE_MODE_LOW_POWER); // Compliant
        // Other settings configuration...
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://developer.android.com/reference/android/bluetooth/BluetoothGattCallback">Android Developers - BluetoothGattCallback</a> </li>
  <li> <a href="https://developer.android.com/reference/android/bluetooth/BluetoothGatt">Android Developers - BluetoothGatt</a> </li>
  <li> <a href="https://developer.android.com/reference/android/bluetooth/BluetoothDevice">Android Developers - BluetoothDevice</a> </li>
  <li> <a href="https://developer.android.com/reference/android/bluetooth/le/AdvertiseSettings.Builder">Android Developers -
  AdvertiseSettings.Builder</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p><code>BluetoothGATT</code> is a class to provide a functionality to enable communication with Bluetooth Smart or Smart Ready devices.</p>
<p>To connect to a remote peripheral device, a <code>BluetoothGattCallback</code> is used and a method <code>BluetoothDevice#connectGatt</code> is
used to get an instance of this class. GATT-capable devices can be discovered using the Bluetooth device discovery or BLE scan process.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Using high power consumption modes for Bluetooth operations can drain the device battery faster and may not be suitable for scenarios where power
efficiency is crucial.</p>
<p>This rule identifies instances where high power consumption Bluetooth operations are used, specifically when <code>requestConnectionPriority</code>
or <code>setAdvertiseMode</code> methods are invoked with arguments other than those promoting low power consumption.</p></p>
            </div>
        <div class="rule">
            <h3>Source code should be indented consistently (java:S1120)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>External coding guidelines</h3>
<ul>
  <li> <a href="https://google.github.io/styleguide/javaguide.html">Google Java Style Guide</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Change the indentation so that the text starts at the expected column. The expected column should be the configured indent size multiplied by the
level at which the code block is nested.</p>

<h4>Noncompliant code example</h4>
<p>With an indent size of 2:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Foo {
  public int a;
   public int b;   // Noncompliant, expected to start at column 4

...

  public void doSomething() {
    if(something) {
          doSomethingElse();  // Noncompliant, expected to start at column 6
  }   // Noncompliant, expected to start at column 4
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class Foo {
  public int a;
  public int b;

...

  public void doSomething() {
    if(something) {
      doSomethingElse();
    }
  }
}
</pre>
<h3>Going the extra mile</h3>
<p>You can adopt a tool or configure your IDE to take care of code formatting automatically.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Indentation should be consistent to make the code easy to read, review and modify. To fix this issue, change the indentation so that the text
starts at the expected column.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Consistent indentation is a simple and effective way to improve the code’s readability. It reduces the differences that are committed to source
control systems, making code reviews easier.</p>
<p>This rule raises an issue when the indentation does not match the configured value. Only the first line of a badly indented section is
reported.</p>
<p>The rule behaves consistently when the indentation settings of the IDE use <em>spaces</em> instead of <em>tabs</em>. Using <em>tabs</em> can lead
to inconsistent indentation because the width of a <em>tab</em> can be configured differently in different environments.</p>
<h3>What is the potential impact?</h3>
<p>The readability is decreased. It becomes more tedious to review and modify the code.</p></p>
            </div>
        <div class="rule">
            <h3>Assignments should not be made from within sub-expressions (java:S1121)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Making assignments within sub-expressions can hinder the clarity of source code.</p>
<p>This practice essentially gives a side-effect to a larger expression, thus making it less readable. This often leads to confusion and potential
errors.</p>
<p>Extracting assignments into separate statements is encouraged to keep the code clear and straightforward.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
String str;
if (!(str = cont.substring(pos1, pos2)).isEmpty()) {  // Noncompliant
  // do something with "str"
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
String str = cont.substring(pos1, pos2);
if (!str.isEmpty()) {
  // do something with "str"
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A common code smell that can hinder the clarity of source code is making assignments within sub-expressions. This practice involves assigning a
value to a variable inside a larger expression, such as within a loop or a conditional statement.</p>
<p>This practice essentially gives a side-effect to a larger expression, thus making it less readable. This often leads to confusion and potential
errors.</p>
<h3>Exceptions</h3>
<p>This rule ignores assignments in conditions of <code>while</code> statements and assignments enclosed in relational expressions.</p>
<pre>
void processInput(BufferedReader br) {
  String line;
  while ((line = br.readLine()) != null) {
    processLine(line);
  }
}

Object foo;
if ((foo = bar()) != null) {
  // do something with "foo"
}
</pre>
<p>This rule also ignores chained assignments, including compound assignments.</p>
<pre>
int j, i = j = 0;
int k = (j += 1);
byte[] result, bresult;
result = (bresult = new byte[len]);
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/481">CWE-481 - Assigning instead of Comparing</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITZGBQ">CERT, EXP51-J.</a> - Do not perform assignments in conditional expressions </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Deprecated elements should have both the annotation and the Javadoc tag (java:S1123)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Deprecation should be marked with both the <code>@Deprecated</code> annotation and @deprecated Javadoc tag. The annotation enables tools such as
IDEs to warn about referencing deprecated elements, and the tag can be used to explain when it was deprecated, why, and how references should be
refactored.</p>
<h3>Noncompliant code example</h3>
<pre>
class MyClass {

  @Deprecated
  public void foo1() {    // Noncompliant: Add the missing @deprecated Javadoc tag.
  }

  /**
    * @deprecated
    */
  public void foo2() {    // Noncompliant: Add the missing @Deprecated annotation.
  }

}
</pre>
<h3>Compliant solution</h3>
<pre>
class MyClass {

  /**
    * @deprecated (when, why, refactoring advice...)
    */
  @Deprecated
  public void foo1() {
  }

}
</pre>
<h3>Exceptions</h3>
<p>The members and methods of a deprecated class or interface are ignored by this rule. The classes and interfaces themselves are still subject to
it.</p>
<pre>
/**
 * @deprecated (when, why, etc...)
 */
@Deprecated
class Qix  {

  public void foo() {} // Compliant; class is deprecated

}

/**
 * @deprecated (when, why, etc...)
 */
@Deprecated
interface Plop {

  void bar();

}
</pre></p>
            </div>
        <div class="rule">
            <h3>Modifiers should be declared in the correct order (java:S1124)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The Java Language Specification recommends listing modifiers in the following order:</p>
<ol>
  <li> Annotations </li>
  <li> public </li>
  <li> protected </li>
  <li> private </li>
  <li> abstract </li>
  <li> static </li>
  <li> final </li>
  <li> transient </li>
  <li> volatile </li>
  <li> synchronized </li>
  <li> native </li>
  <li> default </li>
  <li> strictfp </li>
</ol>
<p>Not following this convention has no technical impact, but will reduce the code’s readability because most developers are used to the standard
order.</p>
<h3>Noncompliant code example</h3>
<pre>
static public void main(String[] args) {   // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
public static void main(String[] args) {   // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Floating point numbers should not be tested for equality (java:S1244)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Floating point math is imprecise because of the challenges of storing such values in a binary representation. Even worse, floating point math is
not associative; push a <code>float</code> or a <code>double</code> through a series of simple mathematical operations and the answer will be
different based on the order of those operation because of the rounding that takes place at each step.</p>
<p>Even simple floating point assignments are not simple:</p>
<pre>
float f = 0.1; // 0.100000001490116119384765625
double d = 0.1; // 0.1000000000000000055511151231257827021181583404541015625
</pre>
<p>(Results will vary based on compiler and compiler settings);</p>
<p>Therefore, the use of the equality (<code>==</code>) and inequality (<code>!=</code>) operators on <code>float</code> or <code>double</code> values
is almost always an error. Instead the best course is to avoid floating point comparisons altogether. When that is not possible, you should consider
using one of Java’s float-handling <code>Numbers</code> such as <code>BigDecimal</code> which can properly handle floating point comparisons. A third
option is to look not for equality but for whether the value is close enough. I.e. compare the absolute value of the difference between the stored
value and the expected value against a margin of acceptable error. Note that this does not cover all cases (<code>NaN</code> and <code>Infinity</code>
for instance).</p>
<p>This rule checks for the use of direct and indirect equality/inequailty tests on floats and doubles.</p>
<h3>Noncompliant code example</h3>
<pre>
float myNumber = 3.146;
if ( myNumber == 3.146f ) { //Noncompliant. Because of floating point imprecision, this will be false
  // ...
}
if ( myNumber != 3.146f ) { //Noncompliant. Because of floating point imprecision, this will be true
  // ...
}

if (myNumber &lt; 4 || myNumber &gt; 4) { // Noncompliant; indirect inequality test
  // ...
}

float zeroFloat = 0.0f;
if (zeroFloat == 0) {  // Noncompliant. Computations may end up with a value close but not equal to zero.
}
</pre>
<h3>Exceptions</h3>
<p>Since <code>NaN</code> is not equal to itself, the specific case of testing a floating point value against itself is a valid test for
<code>NaN</code> and is therefore ignored. Though using <code>Double.isNaN</code> method should be preferred instead, as intent is more explicit.</p>
<pre>
float f;
double d;
if(f != f) { // Compliant; test for NaN value
  System.out.println("f is NaN");
} else if (f != d) { // Noncompliant
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Types should be used in lambdas (java:S2211)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared coding conventions allow teams to collaborate effectively. While types for lambda arguments are optional, specifying them anyway makes the
code clearer and easier to read.</p>
<h3>Noncompliant code example</h3>
<pre>
Arrays.sort(rosterAsArray,
    (a, b) -&gt; {  // Noncompliant
        return a.getBirthday().compareTo(b.getBirthday());
    }
);
</pre>
<h3>Compliant solution</h3>
<pre>
Arrays.sort(rosterAsArray,
    (Person a, Person b) -&gt; {
        return a.getBirthday().compareTo(b.getBirthday());
    }
);
</pre>
<h3>Exceptions</h3>
<p>When the lambda has one or two parameters and does not have a block this rule will not fire up an issue as things are considered more readable in
those cases.</p>
<pre>
stream.map((a, b) -&gt; a.length); // compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Redundant modifiers should not be used (java:S2333)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The methods declared in an <code>interface</code> are <code>public</code> and <code>abstract</code> by default. Any variables are automatically
<code>public static final</code>. Finally, <code>class</code> and <code>interface</code> are automatically <code>public static</code>. There is no
need to explicitly declare them so.</p>
<p>Since annotations are implicitly interfaces, the same holds true for them as well.</p>
<p>Similarly, the <code>final</code> modifier is redundant on any method of a <code>final</code> class, <code>private</code> is redundant on the
constructor of an <code>Enum</code>, and <code>static</code> is redundant for <code>interface</code> nested into a <code>class</code> or
<code>enum</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public interface Vehicle {

  public void go(int speed, Direction direction);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
public interface Vehicle {

  void go(int speed, Direction direction);
</pre></p>
            </div>
        <div class="rule">
            <h3>"indexOf" checks should not be for positive numbers (java:S2692)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Most checks against an <code>indexOf</code> value compare it with -1 because 0 is a valid index. Checking against <code>&gt; 0</code> ignores the
first element, which is likely a bug.</p>
<pre>
String name = "ishmael";

if (name.indexOf("ish") &gt; 0) { // Noncompliant
  // ...
}
</pre>
<p>Moreover, if the intent is merely to check the inclusion of a value in a <code>String</code> or a <code>List</code>, consider using the
<code>contains</code> method instead.</p>
<pre>
String name = "ishmael";

if (name.contains("ish") {
  // ...
}
</pre>
<p>If the intent is really to skip the first element, comparing it with <code>&gt;=1</code> will make it more straightforward.</p>
<pre>
String name = "ishmael";

if (name.indexOf("ish") &gt;= 1) {
  // ...
}
</pre>
<p>This rule raises an issue when an <code>indexOf</code> value retrieved from a <code>String</code> or a <code>List</code> is tested against
<code>&gt; 0</code>.</p></p>
            </div>
        <div class="rule">
            <h3>Threads should not be started in constructors (java:S2693)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The problem with invoking <code>Thread.start()</code> in a constructor is that you’ll have a confusing mess on your hands if the class is ever
extended because the superclass' constructor will start the thread before the child class has truly been initialized.</p>
<p>This rule raises an issue any time <code>start</code> is invoked in the constructor of a non-<code>final</code> class.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {

  Thread thread = null;

  public MyClass(Runnable runnable) {
    thread = new Thread(runnable);
    thread.start(); // Noncompliant
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/FDdGBQ">CERT, TSM02-J.</a> - Do not use background threads during class initialization </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Inner classes which do not reference their owning classes should be "static" (java:S2694)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A non-static inner class has a reference to its outer class, and access to the outer class' fields and methods. That class reference makes the
inner class larger and could cause the outer class instance to live in memory longer than necessary.</p>
<p>If the reference to the outer class isn’t used, it is more efficient to make the inner class <code>static</code> (also called nested). If the
reference is used only in the class constructor, then explicitly pass a class reference to the constructor. If the inner class is anonymous, it will
also be necessary to name it.</p>
<p>However, while a nested/<code>static</code> class would be more efficient, it’s worth noting that there are semantic differences between an inner
class and a nested one:</p>
<ul>
  <li> an inner class can only be instantiated within the context of an instance of the outer class. </li>
  <li> a nested (<code>static</code>) class can be instantiated independently of the outer class. </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/nested.html">Oracle Java SE - Nested Classes</a> </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/localclasses.html">Oracle Java SE - Local Classes</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.geeksforgeeks.org/difference-between-static-and-non-static-nested-class-in-java/">GeeksforGeeks - Difference between
  static and non-static nested class in Java</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>There are two scenarios in which this rule will raise an issue:</p>
<ol>
  <li> On an <em>inner class</em>: make it <code>static</code>. </li>
  <li> On a <em>local class</em>: extract it as a <code>static</code> <em>inner class</em>. </li>
</ol>

<h4>Noncompliant code example</h4>
<p>Inner classes that don’t use the outer class reference should be static.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Fruit {
  // ...

  public class Seed {  // Noncompliant; there's no use of the outer class reference so make it static
    int germinationDays = 0;
    public Seed(int germinationDays) {
      this.germinationDays = germinationDays;
    }
    public int getGerminationDays() {
      return germinationDays;
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Fruit {
  // ...

  public static class Seed {
    int germinationDays = 0;
    public Seed(int germinationDays) {
      this.germinationDays = germinationDays;
    }
    public int getGerminationDays() {
      return germinationDays;
    }
  }
}
</pre>
<p>Local classes that don’t use the outer class reference should be extracted as a static inner classes.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
public class Foo {
  public Foo() {
    class Bar { // Noncompliant
      void doSomething() {
        // ...
      }
    }
    new Bar().doSomething();
  }

  public void method() {
    class Baz { // Noncompliant
      void doSomething() {
        // ...
      }
    }
    new Baz().doSomething();
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
public class Foo {
  public Foo() {
    new Bar().doSomething();
  }

  public void method()  {
    new Baz().doSomething();
  }

  private static class Bar { // Compliant
    void doSomething() {
      // ...
    }
  }

  private static class Baz { // Compliant
    void doSomething() {
      // ...
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"PreparedStatement" and "ResultSet" methods should be called with valid indices (java:S2695)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>PreparedStatement</code> is an object that represents a precompiled SQL statement, that can be used to execute the statement multiple times
efficiently.</p>
<p><code>ResultSet</code> is the Java representation of the result set of a database query obtained from a <code>Statement</code> object. A default
<code>ResultSet</code> object is not updatable and has a cursor that moves forward only.</p>
<p>The parameters in <code>PreparedStatement</code> and <code>ResultSet</code> are indexed beginning at 1, not 0. When an invalid index is passed to
the <code>PreparedStatement</code> or <code>ResultSet</code> methods, an <code>IndexOutOfBoundsException</code> is thrown. This can cause the program
to crash or behave unexpectedly, leading to a poor user experience.</p>
<p>This rule raises an issue for the <code>get</code> methods in <code>PreparedStatement</code> and the <code>set</code> methods in
<code>ResultSet</code>.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ensure the index passed to the <code>PreparedStatement</code> and <code>ResultSet</code> methods is valid.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
PreparedStatement ps = con.prepareStatement("SELECT fname, lname FROM employees where hireDate &gt; ? and salary &lt; ?");
ps.setDate(0, date);  // Noncompliant
ps.setDouble(3, salary);  // Noncompliant

ResultSet rs = ps.executeQuery();
while (rs.next()) {
  String fname = rs.getString(0);  // Noncompliant
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
PreparedStatement ps = con.prepareStatement("SELECT fname, lname FROM employees where hireDate &gt; ? and salary &lt; ?");
ps.setDate(1, date);
ps.setDouble(2, salary);

ResultSet rs = ps.executeQuery();
while (rs.next()) {
  String fname = rs.getString(1);
  // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.sql/java/sql/PreparedStatement.html">Oracle SDK 20 - PreparedStatement</a>
  </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.sql/java/sql/ResultSet.html">Oracle SDK 20 - ResultSet</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.sql/java/sql/Connection.html#prepareStatement(java.lang.String)">Oracle SDK 20
  - Connection#prepareStatement</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>AssertJ assertions "allMatch" and "doesNotContains" should also test for emptiness (java:S5841)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>AssertJ assertions <code>allMatch</code> and <code>doesNotContains</code> on an empty list always&nbsp;returns true whatever the content of the
predicate. Despite being correct, you should make explicit if you expect an empty list or not, by adding
<code>isEmpty()</code>/<code>isNotEmpty()</code> in addition to calling the assertion, or by testing the list’s content further. It will justify the
useless predicate to improve clarity or increase the reliability of the test.</p>
<p>This rule raises an issue when any of the methods listed are used without asserting that the list is empty or not and without testing the
content.</p>
<p>Targetted methods:</p>
<ul>
  <li> <code>allMatch</code> </li>
  <li> <code>allSatisfy</code> </li>
  <li> <code>doesNotContain</code> </li>
  <li> <code>doesNotContainSequence</code> </li>
  <li> <code>doesNotContainSubsequence</code> </li>
  <li> <code>doesNotContainAnyElementsOf</code> </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
List&lt;String&gt; logs = getLogs();

assertThat(logs).allMatch(e -&gt; e.contains(“error”)); // Noncompliant, this test pass if logs are empty!
assertThat(logs).doesNotContain("error"); // Noncompliant, do you expect any log?
</pre>
<h3>Compliant solution</h3>
<pre>
List&lt;String&gt; logs = getLogs();

assertThat(logs).isNotEmpty().allMatch(e -&gt; e.contains(“error”));
// Or
assertThat(logs).hasSize(5).allMatch(e -&gt; e.contains(“error”));
// Or
assertThat(logs).isEmpty();

// Despite being redundant, this is also acceptable since it explains why you expect an empty list
assertThat(logs).doesNotContain("error").isEmpty();
// or test the content of the list further
assertThat(logs).contains("warning").doesNotContain("error");
</pre></p>
            </div>
        <div class="rule">
            <h3>Assertions comparing incompatible types should not be made (java:S5845)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href='/coding_rules#rule_key=java%3AS2159'>S2159</a> - Silly equality checks should not be made </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Assertions comparing incompatible types always fail, and negative assertions always pass. At best, negative assertions are useless. At worst, the
developer loses time trying to fix his code logic before noticing wrong assertions.</p>
<p>Dissimilar types are:</p>
<ul>
  <li> comparing a primitive with null </li>
  <li> comparing an object with an unrelated primitive (E.G. a string with an int) </li>
  <li> comparing unrelated classes </li>
  <li> comparing an array to a non-array </li>
  <li> comparing two arrays of dissimilar types </li>
</ul>
<p>This rule also raises issues for unrelated <code>class</code> and <code>interface</code> or unrelated <code>interface</code> types in negative
assertions. Because except in some corner cases, those types are more likely to be dissimilar. And inside a negative assertion, there is no test
failure to inform the developer about this unusual comparison.</p>
<p>Supported test frameworks:</p>
<ul>
  <li> JUnit4 </li>
  <li> JUnit5 </li>
  <li> AssertJ </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
interface KitchenTool {}
interface Plant {}
class Spatula implements KitchenTool {}
class Tree implements Plant {}

void assertValues(int size,
                  Spatula spatula, KitchenTool tool,  KitchenTool[] tools,
                  Tree    tree,    Plant       plant, Tree[]        trees) {

  // Whatever the given values, those negative assertions will always pass due to dissimilar types:
  assertThat(size).isNotNull();           // Noncompliant; primitives can not be null
  assertThat(spatula).isNotEqualTo(tree); // Noncompliant; unrelated classes
  assertThat(tool).isNotSameAs(tools);    // Noncompliant; array &amp; non-array
  assertThat(trees).isNotEqualTo(tools);  // Noncompliant; incompatible arrays

  // Those assertions will always fail
  assertThat(size).isNull();                       // Noncompliant
  assertThat(spatula).isEqualTo(tree);             // Noncompliant

  // Those negative assertions are more likely to always pass
  assertThat(spatula).isNotEqualTo(plant); // Noncompliant; unrelated class and interface
  assertThat(tool).isNotEqualTo(plant);    // Noncompliant; unrelated interfaces
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Assertions should not be used in production code (java:S5960)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Assertions are intended to be used in <strong>test</strong> code, but not in <strong>production</strong> code. It is confusing, and might lead to
<code>ClassNotFoundException</code> when the build tools only provide the required dependency in test scope.</p>
<p>In addition, assertions will throw a sub-class of <code>Error</code>: <code>AssertionError</code>, which should be avoided in production code.</p>
<p>This rule raises an issue when any assertion intended to be used in test is used in production code.</p>
<p>Supported frameworks:</p>
<ul>
  <li> JUnit </li>
  <li> FestAssert </li>
  <li> AssertJ </li>
</ul>
<p>Note: this does not apply for <code>assert</code> from Java itself or if the source code package name is related to tests (contains:
<code>test</code> or <code>assert</code> or <code>junit</code>).</p></p>
            </div>
        <div class="rule">
            <h3>Test methods should not contain too many assertions (java:S5961)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A common good practice is to write test methods targeting only one logical concept, that can only fail for one reason.</p>
<p>While it might make sense to have more than one assertion to test one concept, having too many is a sign that a test became too complex and should
be refactored to multiples ones.</p>
<p>This rule will report any test method containing more than a given number of assertion.</p>
<h3>Noncompliant code example</h3>
<p>With a parameter of 2.</p>
<pre>
@Test
void test() { // Refactor this method.
  assertEquals(1, f(1));
  assertEquals(2, f(2));
  assertEquals(3, g(1));
}
</pre>
<h3>Compliant solution</h3>
<pre>
void test_f() {
  assertEquals(1, f(1));
  assertEquals(2, f(2));
}
void test_g() {
  assertEquals(3, g(1));
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Tests method should not be annotated with competing annotations (java:S5967)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Annotating unit tests with more than one test-related annotation is not only useless but could also result in unexpected behavior like failing
tests or unwanted side-effects.</p>
<p>This rule reports an issue when a test method is annotated with more than one of the following competing annotation:</p>
<ul>
  <li> @Test </li>
  <li> @RepeatedTest </li>
  <li> @ParameterizedTest </li>
  <li> @TestFactory </li>
  <li> @TestTemplate </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
@Test
@RepeatedTest(2) // Noncompliant, this test will be repeated 3 times
void test() { }

@ParameterizedTest
@Test
@MethodSource("methodSource")
void test2(int argument) { } // Noncompliant, this test will fail with ParameterResolutionException
</pre>
<h3>Compliant solution</h3>
<pre>
@RepeatedTest(2)
void test() { }

@ParameterizedTest
@MethodSource("methodSource")
void test2(int argument) { }
</pre></p>
            </div>
        <div class="rule">
            <h3>Field dependency injection should be avoided (java:S6813)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Dependency injection frameworks such as Spring, Quarkus, and others support dependency injection by using annotations such as <code>@Inject</code>
and <code>@Autowired</code>. These annotations can be used to inject beans via constructor, setter, and field injection.</p>
<p>Generally speaking, field injection is discouraged. It allows the creation of objects in an invalid state and makes testing more difficult. The
dependencies are not explicit when instantiating a class that uses field injection.</p>
<p>In addition, field injection is not compatible with final fields. Keeping dependencies immutable where possible makes the code easier to
understand, easing development and maintenance.</p>
<p>Finally, because values are injected into fields after the object has been constructed, they cannot be used to initialize other non-injected fields
inline.</p>
<p>This rule raises an issue when the <code>@Autowired</code> or <code>@Inject</code> annotations are used on a field.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> Baeldung - <a href="https://www.baeldung.com/java-spring-field-injection-cons">Why Is Field Injection Not Recommended?</a> </li>
  <li> Baeldung - <a href="https://www.baeldung.com/constructor-injection-in-spring">Constructor Dependency Injection in Spring</a> </li>
  <li> Oliver Drotbohm - <a href="https://odrotbohm.de/2013/11/why-field-injection-is-evil/">Why field injection is evil</a> </li>
  <li> GitHub Discussions - <a href="https://github.com/quarkusio/quarkus/discussions/38474">Field injection in quarkus</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use constructor injection instead.</p>
<p>By using constructor injection, the dependencies are explicit and must be passed during an object’s construction. This avoids the possibility of
instantiating an object in an invalid state and makes types more testable. Fields can be declared final, which makes the code easier to understand, as
dependencies don’t change after instantiation.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class SomeService {
    @Autowired
    private SomeDependency someDependency; // Noncompliant

    private String name = someDependency.getName(); // Will throw a NullPointerException
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class SomeService {
    private final SomeDependency someDependency;
    private final String name;

    @Autowired
    public SomeService(SomeDependency someDependency) {
        this.someDependency = someDependency;
        name = someDependency.getName();
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Optional REST parameters should have an object type (java:S6814)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace primitive types, such as <code>boolean</code>, <code>char</code>, <code>int</code>, with the corresponding wrapper type, such as
<code>Boolean</code>, <code>Character</code>, <code>Integer</code>.</p>
<p>Alternatively, you might choose to remove <code>required = false</code> from the annotation and use an <code>Optional&lt;T&gt;</code> type for the
parameter, such as <code>Optional&lt;Boolean&gt;</code> or <code>Optional&lt;String&gt;</code>, which automatically makes the REST parameter optional.
This is the preferred approach because it enforces the proper handling of <code>null</code> in the method implementation.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@RequestMapping(value = {"/article", "/article/{id}"})
public Article getArticle(@PathVariable(required = false) int articleId) { // Noncompliant, null cannot be mapped to int
   //...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@RequestMapping(value = {"/article", "/article/{id}"})
public Article getArticle(@PathVariable(required = false) Integer articleId) { // Compliant
   //...
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
@RequestMapping(value = {"/article", "/article/{id}"})
public Article getArticle(@PathVariable(required = false) int articleId) { // Noncompliant, null cannot be mapped to int
   //...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
@RequestMapping(value = {"/article", "/article/{id}"})
public Article getArticle(@PathVariable Optional&lt;Integer&gt; articleId) { // Compliant and preferred approach
   //...
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Spring provides two options to mark a REST parameter as optional:</p>
<ol>
  <li> Use <code>required = false</code> in the <code>@PathVariable</code> or <code>@RequestParam</code> annotation of the respective method parameter
  or </li>
  <li> Use type <code>java.util.Optional&lt;T&gt;</code> for the method parameter </li>
</ol>
<p>When using 1., the absence of the parameter, when the REST function is called, is encoded by <code>null</code>, which can only be used for object
types. If <code>required = false</code> is used for a parameter with a primitive and the REST function is called without the parameter, a runtime
exception occurs because the Spring data mapper cannot map the <code>null</code> value to the parameter.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PathVariable.html">Spring
  Framework API - Annotation Interface PathVariable</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-optional-path-variables">Baeldung - Spring Optional Path Variables</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"@Autowired" should only be used on a single constructor (java:S6818)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/annotation-config/autowired.html">Spring Framework - Using @Autowired</a>
  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-autowire">Baeldung - Guide to Spring @Autowired</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>@Autowired</code> is an annotation in the Spring Framework for automatic dependency injection. It tells Spring to automatically provide the
required dependencies (such as other beans or components) to a class’s fields, methods, or constructors, allowing for easier and more flexible
management of dependencies in a Spring application. In other words, it’s a way to wire up and inject dependencies into Spring components
automatically, reducing the need for manual configuration and enhancing modularity and maintainability.</p>
<p>In any bean class, only one constructor is permitted to declare <code>@Autowired</code> with the <code>required</code> attribute set to true. This
signifies the constructor to be automatically wired when used as a Spring bean. Consequently, when the required attribute remains at its default value
(true), only a singular constructor can bear the <code>@Autowired</code> annotation. In cases where multiple constructors have this annotation, they
must all specify <code>required=false</code> to be eligible as candidates for auto-wiring.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>To maintain code clarity and ensure that the Spring context can create beans correctly, have only one constructor annotated with
<code>@Autowired</code> within a Spring component or set <code>required = false</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Component
public class MyComponent {
  private final MyService myService;

  @Autowired
  public MyComponent(MyService myService) {
    this.myService = myService;
    // ...
  }

  @Autowired  // Noncompliant
  public MyComponent(MyService myService, Integer i) {
    this.myService = myService;
    // ...
  }

  @Autowired  // Noncompliant
  public MyComponent(MyService myService, Integer i, String s) {
    this.myService = myService;
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Component
public class MyComponent {
  private final MyService myService;

  @Autowired
  public MyComponent(MyService myService) {
    this.myService = myService;
    // ...
  }

  public MyComponent(MyService myService, Integer i) {
    this.myService = myService;
    // ...
  }

  public MyComponent(MyService myService, Integer i, String s) {
    this.myService = myService;
    // ...
  }
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
@Component
public class MyComponent {
  private final MyService myService;

  @Autowired
  public MyComponent(MyService myService) {
    this.myService = myService;
    // ...
  }

  @Autowired  // Noncompliant
  public MyComponent(MyService myService, Integer i) {
    this.myService = myService;
    // ...
  }

  @Autowired  // Noncompliant
  public MyComponent(MyService myService, Integer i, String s) {
    this.myService = myService;
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
@Component
public class MyComponent {
  private final MyService myService;

  @Autowired
  public MyComponent(MyService myService) {
    this.myService = myService;
    // ...
  }

  @Autowired(required=false)  // Compliant
  public MyComponent(MyService myService, Integer i) {
    this.myService = myService;
    // ...
  }

  @Autowired(required=false)  // Compliant
  public MyComponent(MyService myService, Integer i, String s) {
    this.myService = myService;
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Unnecessary imports should be removed (java:S1128)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>While it’s not difficult to remove these unneeded lines manually, modern code editors support the removal of every unnecessary import with a single
click from every file of the project.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
package myapp.helpers;

import java.io.IOException;
import java.nio.file.*;
import java.nio.file.*;     // Noncompliant - package is imported twice
import java.lang.Runnable;  // Noncompliant - java.lang is imported by default

public class FileHelper {
    public static String readFirstLine(String filePath) throws IOException {
        return Files.readAllLines(Paths.get(filePath)).get(0);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
package myapp.helpers;

import java.io.IOException;
import java.nio.file.*;

public class FileHelper {
    public static String readFirstLine(String filePath) throws IOException {
        return Files.readAllLines(Paths.get(filePath)).get(0);
    }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Unnecessary imports refer to importing types that are not used or referenced anywhere in the code.</p>
<p>Although they don’t affect the runtime behavior of the application after compilation, removing them will:</p>
<ul>
  <li> Improve the readability and maintainability of the code. </li>
  <li> Help avoid potential naming conflicts. </li>
  <li> Improve the build time, as the compiler has fewer lines to read and fewer types to resolve. </li>
  <li> Reduce the number of items the code editor will show for auto-completion, thereby showing fewer irrelevant suggestions. </li>
</ul>
<h3>Exceptions</h3>
<p>Imports for types mentioned in Javadocs are ignored.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/package/usepkgs.html">Java packages</a> </li>
</ul>
<h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS1144'>S1144</a> - Unused "private" methods should be removed </li>
  <li> <a href='/coding_rules#rule_key=java%3AS1481'>S1481</a> - Unused local variables should be removed </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>The signature of "finalize()" should match that of "Object.finalize()" (java:S1175)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>Object.finalize()</code> is called by the Garbage Collector at some point after the object becomes unreferenced.</p>
<p>In general, overloading <code>Object.finalize()</code> is a bad idea because:</p>
<ul>
  <li> The overload may not be called by the Garbage Collector. </li>
  <li> Users are not expected to call <code>Object.finalize()</code> and will get confused. </li>
</ul>
<p>But beyond that it’s a terrible idea to name a method "finalize" if it doesn’t actually override <code>Object.finalize()</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public int finalize(int someParameter) {        // Noncompliant
  /* ... */
}
</pre>
<h3>Compliant solution</h3>
<pre>
public int someBetterName(int someParameter) {  // Compliant
  /* ... */
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Public types, methods and fields (API) should be documented with Javadoc (java:S1176)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Undocumented APIs pose significant challenges in software development for several reasons:</p>
<ul>
  <li> <strong>Lack of Clarity:</strong> developers struggling to understand how to use the API correctly. This can lead to misuse and unexpected
  results. </li>
  <li> <strong>Increased Development Time:</strong> developers spending extra time reading and understanding the source code, which slows down the
  development process. </li>
  <li> <strong>Error Prone:</strong> developers are more likely to make mistakes that lead to bugs or system crashes when the intent or the error
  handling of an API is not clear. </li>
  <li> <strong>Difficult Maintenance and Updates:</strong> developers may not understand the existing functionality well enough to add new features
  without breaking the existing ones. </li>
  <li> <strong>Poor Collaboration:</strong> collaboration, when there is lack of documentation, leads to confusion and inconsistencies. </li>
</ul>
<p>It is recommended to document the API using <strong>JavaDoc</strong> to clarify what is the contract of the API. This is especially important for
public APIs, as they are used by other developers.</p>
<h3>Exceptions</h3>
<p>The following public methods and constructors are not taken into account by this rule:</p>
<ul>
  <li> Getters and setters. </li>
  <li> Methods overriding another method (usually annotated with <code>@Override</code>). </li>
  <li> Empty constructors. </li>
  <li> Static constants. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>On top of a main description for each member of a public API, the following <strong>Javadoc</strong> elements are required to be described:</p>
<ul>
  <li> Parameters, using <code>@param parameterName</code>. </li>
  <li> Thrown exceptions, using <code>@throws exceptionName</code>. </li>
  <li> Method return values, using <code>@return</code>. </li>
  <li> Generic types, using <code>@param &lt;T&gt;</code>. </li>
</ul>
<p>Furthermore, the following guidelines should be followed:</p>
<ul>
  <li> At least 1 line of description. </li>
  <li> All parameters documented with <code>@param</code>, and names should match. </li>
  <li> All checked exceptions should be documented with <code>@throws</code> </li>
  <li> <code>@return</code> present and documented when method return type is not <code>void</code>. </li>
  <li> Placeholders like <code>"TODO"</code>, <code>"FIXME"</code>, <code>"…​"</code> should be avoided. </li>
</ul>
<p>For the parameters of the rule, the following rules are applied:</p>
<ul>
  <li> <code>?</code> matches a single character </li>
  <li> <code>*</code> matches zero or more characters </li>
  <li> <code>**</code> matches zero or more packages </li>
</ul>
<p>Examples:</p>
<ul>
  <li> <code>java.internal.InternalClass</code> will match only <code>InternalClass</code> class. </li>
  <li> <code>java.internal.*</code> will match any member of <code>java.internal</code> package. </li>
  <li> <code>java.internal.**</code> same as above, but including sub-packages. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
/**
  * This is a Javadoc comment
  */
public class MyClass&lt;T&gt; implements Runnable {   // Noncompliant - missing '@param &lt;T&gt;'

  public static final int DEFAULT_STATUS = 0;   // Compliant - static constant
  private int status;                           // Compliant - not public

  public String message;                        // Noncompliant

  public MyClass() {                            // Noncompliant - missing documentation
    this.status = DEFAULT_STATUS;
  }

  public void setStatus(int status) {           // Compliant - setter
    this.status = status;
  }

  @Override
  public void run() {                           // Compliant - has @Override annotation
  }

  protected void doSomething() {                // Compliant - not public
  }

  public void doSomething2(int value) {         // Noncompliant
  }

  public int doSomething3(int value) {          // Noncompliant
    return value;
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
/**
  * This is a Javadoc comment
  * @param &lt;T&gt; the parameter of the class
  */
public class MyClass&lt;T&gt; implements Runnable {

  public static final int DEFAULT_STATUS = 0;
  private int status;

  /**
    * This is a Javadoc comment
    */
  public String message;

  /**
   * Class comment...
   */
  public MyClass() {
    this.status = DEFAULT_STATUS;
  }

  public void setStatus(int status) {
    this.status = status;
  }

  @Override
  public void run() {
  }

  protected void doSomething() {
  }

  /**
    * Will do something.
    * @param value the value to be used
    */
  public void doSomething(int value) {
  }

  /**
    *  {@inheritDoc}
    */
  public int doSomething(int value) {
    return value;
  }
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>A good API documentation is a key factor in the usability and success of a software API. It ensures that developers can effectively use, maintain,
and collaborate on the API.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Oracle - <a href="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javadoc.html">JavaDoc</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Technical Writer HQ - <a href="https://technicalwriterhq.com/documentation/api-documentation/how-to-write-api-documentation/">How to write API
  documentation</a> </li>
  <li> FreeCodeCamp - <a href="https://www.freecodecamp.org/news/how-to-write-api-documentation-like-a-pro/">How to write API documentation like a
  pro</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Unused local variables should be removed (java:S1481)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>An unused local variable is a variable that has been declared but is not used anywhere in the block of code where it is defined. It is dead code,
contributing to unnecessary complexity and leading to confusion when reading the code. Therefore, it should be removed from your code to maintain
clarity and efficiency.</p>
<h3>What is the potential impact?</h3>
<p>Having unused local variables in your code can lead to several issues:</p>
<ul>
  <li> <strong>Decreased Readability</strong>: Unused variables can make your code more difficult to read. They add extra lines and complexity, which
  can distract from the main logic of the code. </li>
  <li> <strong>Misunderstanding</strong>: When other developers read your code, they may wonder why a variable is declared but not used. This can lead
  to confusion and misinterpretation of the code’s intent. </li>
  <li> <strong>Potential for Bugs</strong>: If a variable is declared but not used, it might indicate a bug or incomplete code. For example, if you
  declared a variable intending to use it in a calculation, but then forgot to do so, your program might not work as expected. </li>
  <li> <strong>Maintenance Issues</strong>: Unused variables can make code maintenance more difficult. If a programmer sees an unused variable, they
  might think it is a mistake and try to 'fix' the code, potentially introducing new bugs. </li>
  <li> <strong>Memory Usage</strong>: Although modern compilers are smart enough to ignore unused variables, not all compilers do this. In such cases,
  unused variables take up memory space, leading to inefficient use of resources. </li>
</ul>
<p>In summary, unused local variables can make your code less readable, more confusing, and harder to maintain, and they can potentially lead to bugs
or inefficient memory use. Therefore, it is best to remove them.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The fix for this issue is straightforward. Once you ensure the unused variable is not part of an incomplete implementation leading to bugs, you
just need to remove it.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public int numberOfMinutes(int hours) {
  int seconds = 0;   // Noncompliant - seconds is unused
  return hours * 60;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public int numberOfMinutes(int hours) {
  return hours * 60;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Catches should be combined (java:S2147)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Since Java 7 it has been possible to catch multiple exceptions at once. Therefore, when multiple <code>catch</code> blocks have the same code, they
should be combined for better readability.</p>
<p><strong>Note</strong> that this rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>7</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
catch (IOException e) {
  doCleanup();
  logger.log(e);
}
catch (SQLException e) {  // Noncompliant
  doCleanup();
  logger.log(e);
}
catch (TimeoutException e) {  // Compliant; block contents are different
  doCleanup();
  throw e;
}
</pre>
<h3>Compliant solution</h3>
<pre>
catch (IOException|SQLException e) {
  doCleanup();
  logger.log(e);
}
catch (TimeoutException e) {
  doCleanup();
  throw e;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Underscores should be used to make large numbers readable (java:S2148)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Beginning with Java 7, it is possible to add underscores ('_') to numeric literals to enhance readability. The addition of underscores in this
manner has no semantic meaning, but makes it easier for maintainers to understand the code.</p>
<p>The number of digits to the left of a decimal point needed to trigger this rule varies by base.</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Base</th>
      <th>Minimum digits</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>binary</p></td>
      <td><p>9</p></td>
    </tr>
    <tr>
      <td><p>octal</p></td>
      <td><p>9</p></td>
    </tr>
    <tr>
      <td><p>decimal</p></td>
      <td><p>6</p></td>
    </tr>
    <tr>
      <td><p>hexadecimal</p></td>
      <td><p>9</p></td>
    </tr>
  </tbody>
</table>
<p>It is only the presence of underscores, not their spacing that is scrutinized by this rule.</p>
<p><strong>Note</strong> that this rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>7</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
int i = 10000000;  // Noncompliant; is this 10 million or 100 million?
int  j = 0b01101001010011011110010101011110;  // Noncompliant
long l = 0x7fffffffffffffffL;  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
int i = 10_000_000;
int  j = 0b01101001_01001101_11100101_01011110;
long l = 0x7fff_ffff_ffff_ffffL;
</pre></p>
            </div>
        <div class="rule">
            <h3>Private mutable members should not be stored or returned directly (java:S2384)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/374">CWE-374 - Passing Mutable Objects to an Untrusted Method</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/375">CWE-375 - Returning a Mutable Object to an Untrusted Caller</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OTdGBQ">CERT, OBJ05-J.</a> - Do not return references to private mutable class members </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/HTdGBQ">CERT, OBJ06-J.</a> - Defensively copy mutable inputs and mutable internal components
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/VzZGBQ">CERT, OBJ13-J.</a> - Ensure that references to mutable objects are not exposed </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Mutable objects are those whose state can be changed. For instance, an array is mutable, but a String is not. Private mutable class members should
never be returned to a caller or accepted and stored directly. Doing so leaves you vulnerable to unexpected changes in your class state.</p>
<p>Instead use an unmodifiable <code>Collection</code> (via <code>Collections.unmodifiableCollection</code>,
<code>Collections.unmodifiableList</code>, …​) or make a copy of the mutable object, and store or return the copy instead.</p>
<p>This rule checks that private arrays, collections and Dates are not stored or returned directly.</p>
<h3>Noncompliant code example</h3>
<pre>
class A {
  private String [] strings;

  public A () {
    strings = new String[]{"first", "second"};
  }

  public String [] getStrings() {
    return strings; // Noncompliant
  }

  public void setStrings(String [] strings) {
    this.strings = strings;  // Noncompliant
  }
}

public class B {

  private A a = new A();  // At this point a.strings = {"first", "second"};

  public void wreakHavoc() {
    a.getStrings()[0] = "yellow";  // a.strings = {"yellow", "second"};
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class A {
  private String [] strings;

  public A () {
    strings = new String[]{"first", "second"};
  }

  public String [] getStrings() {
    return strings.clone();
  }

  public void setStrings(String [] strings) {
    this.strings = strings.clone();
  }
}

public class B {

  private A a = new A();  // At this point a.strings = {"first", "second"};

  public void wreakHavoc() {
    a.getStrings()[0] = "yellow";  // a.strings = {"first", "second"};
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Mutable fields should not be "public static" (java:S2386)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/582">CWE-582 - Array Declared Public, Final, and Static</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/607">CWE-607 - Public Static Final Field References Mutable Object</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/LjdGBQ">CERT, OBJ01-J.</a> - Limit accessibility of fields </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/VzZGBQ">CERT, OBJ13-J.</a> - Ensure that references to mutable objects are not exposed </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>There is no good reason to have a mutable object as the <code>public</code> (by default), <code>static</code> member of an <code>interface</code>.
Such variables should be moved into classes and their visibility lowered.</p>
<p>Similarly, mutable <code>static</code> members of classes and enumerations which are accessed directly, rather than through getters and setters,
should be protected to the degree possible. That can be done by reducing visibility or making the field <code>final</code> if appropriate.</p>
<p>Note that making a mutable field, such as an array, <code>final</code> will keep the variable from being reassigned, but doing so has no effect on
the mutability of the internal state of the array (i.e. it doesn’t accomplish the goal).</p>
<p>This rule raises issues for <code>public static</code> array, <code>Collection</code>, <code>Date</code>, and <code>awt.Point</code> members.</p>
<h3>Noncompliant code example</h3>
<pre>
public interface MyInterface {
  public static String [] strings; // Noncompliant
}

public class A {
  public static String [] strings1 = {"first","second"};  // Noncompliant
  public static String [] strings2 = {"first","second"};  // Noncompliant
  public static List&lt;String&gt; strings3 = new ArrayList&lt;&gt;();  // Noncompliant
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Child class fields should not shadow parent class fields (java:S2387)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Having a variable with the same name in two unrelated classes is fine, but do the same thing within a class hierarchy and you’ll get confusion at
best, chaos at worst.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Fruit {
  protected Season ripe;
  protected Color flesh;

  // ...
}

public class Raspberry extends Fruit {
  private boolean ripe;  // Noncompliant
  private static Color FLESH; // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Fruit {
  protected Season ripe;
  protected Color flesh;

  // ...
}

public class Raspberry extends Fruit {
  private boolean ripened;
  private static Color FLESH_COLOR;

}
</pre>
<h3>Exceptions</h3>
<p>This rule ignores same-name fields that are <code>static</code> in both the parent and child classes. This rule ignores <code>private</code> parent
class fields, but in all other such cases, the child class field should be renamed.</p>
<pre>
public class Fruit {
  private Season ripe;
  // ...
}

public class Raspberry extends Fruit {
  private Season ripe;  // Compliant as parent field 'ripe' is anyway not visible from Raspberry
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Inner class calls to super class methods should be unambiguous (java:S2388)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Explicitly call the super type’s method by prepending <code>super.</code> to the method call. If the intention was to call the outer class’s
implementation, prepend <code>Outer.this.</code> instead.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Parent {
  public void foo() { ... }
}

public class Outer {
  public void foo() { ... }

  public class Inner extends Parent {
    public void doSomething() {
      foo();  // Noncompliant, it is not explicit if Outer#foo or Parent#foo is the intended implementation to be called.
      // ...
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Parent {
  public void foo() { ... }
}

public class Outer {
  public void foo() { ... }

  public class Inner extends Parent {
    public void doSomething() {
      super.foo(); // Compliant, it is explicit that Parent#foo is the desired implementation to be called.
      // ...
    }
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>An inner class that extends another type can call methods from both the outer class and parent type directly, without prepending
<code>super.</code> or <code>Outer.this.</code>.</p>
<p>When both the outer and parent classes contain a method with the same name, the compiler will resolve an unqualified call to the parent type’s
implementation. The maintainer or a future reader may confuse the method call as calling the outer class’s implementation, even though it really calls
the super type’s.</p>
<p>To make matters worse, the maintainer sees the outer class’s implementation in the same file as the call in the inner class, while the parent type
is often declared in another file. The maintainer may not even be aware of the ambiguity present, as they do not see the parent’s implementation.</p></p>
            </div>
        <div class="rule">
            <h3>Factory method injection should be used in "@Configuration" classes (java:S3305)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When <code>@Autowired</code> is used, dependencies need to be resolved when the class is instantiated, which may cause early initialization of
beans or lead the context to look in places it shouldn’t to find the bean. To avoid this tricky issue and optimize the way the context loads,
dependencies should be requested as late as possible. That means using parameter injection instead of field injection for dependencies that are only
used in a single <code>@Bean</code> method.</p>
<h3>Noncompliant code example</h3>
<pre>
@Configuration
public class ​FooConfiguration {

  @Autowired private ​DataSource dataSource​;  // Noncompliant

  @Bean
  public ​MyService myService() {
    return new ​MyService(this​.dataSource​);
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Configuration
public class ​FooConfiguration {

 @Bean
  public ​MyService myService(DataSource dataSource) {
    return new ​MyService(dataSource);
  }
}
</pre>
<h3>Exceptions</h3>
<p>Fields used in methods that are called directly by other methods in the application (as opposed to being invoked automatically by the Spring
framework) are ignored by this rule so that direct callers don’t have to provide the dependencies themselves.</p></p>
            </div>
        <div class="rule">
            <h3>Constructor injection should be used instead of field injection (java:S3306)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Field injection seems like a tidy way to get your classes what they need to do their jobs, but it’s really a <code>NullPointerException</code>
waiting to happen unless all your class constructors are <code>private</code>. That’s because any class instances that are constructed by callers,
rather than instantiated by a Dependency Injection framework compliant with the JSR-330 (Spring, Guice, …​), won’t have the ability to perform the
field injection.</p>
<p>Instead <code>@Inject</code> should be moved to the constructor and the fields required as constructor parameters.</p>
<p>This rule raises an issue when classes with non-<code>private</code> constructors (including the default constructor) use field injection.</p>
<h3>Noncompliant code example</h3>
<pre>
class MyComponent {  // Anyone can call the default constructor

  @Inject MyCollaborator collaborator;  // Noncompliant

  public void myBusinessMethod() {
    collaborator.doSomething();  // this will fail in classes new-ed by a caller
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class MyComponent {

  private final MyCollaborator collaborator;

  @Inject
  public MyComponent(MyCollaborator collaborator) {
    Assert.notNull(collaborator, "MyCollaborator must not be null!");
    this.collaborator = collaborator;
  }

  public void myBusinessMethod() {
    collaborator.doSomething();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Ternary operators should not be nested (java:S3358)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Nested ternaries are hard to read and can make the order of operations complex to understand.</p>
<pre>
public String getReadableStatus(Job j) {
  return j.isRunning() ? "Running" : j.hasErrors() ? "Failed" : "Succeeded";  // Noncompliant
}
</pre>
<p>Instead, use another line to express the nested operation in a separate statement.</p>
<pre>
public String getReadableStatus(Job j) {
  if (j.isRunning()) {
    return "Running";
  }
  return j.hasErrors() ? "Failed" : "Succeeded";
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Double Brace Initialization should not be used (java:S3599)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Because Double Brace Initialization (DBI) creates an anonymous class with a reference to the instance of the owning object, its use can lead to
memory leaks if the anonymous inner class is returned and held by other objects. Even when there’s no leak, DBI is so obscure that it’s bound to
confuse most maintainers.</p>
<p>For collections, use <code>Arrays.asList</code> instead, or explicitly add each item directly to the collection.</p>
<h3>Noncompliant code example</h3>
<pre>
Map source = new HashMap(){{ // Noncompliant
    put("firstName", "John");
    put("lastName", "Smith");
}};
</pre>
<h3>Compliant solution</h3>
<pre>
Map source = new HashMap();
// ...
source.put("firstName", "John");
source.put("lastName", "Smith");
// ...
</pre></p>
            </div>
        <div class="rule">
            <h3>InputSteam.read() implementation should not return a signed byte (java:S4517)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>According to the Java documentation, any implementation of the <code>InputSteam.read()</code> method is supposed to read the next byte of data from
the input stream. The value byte must be an <code>int</code> in the range 0 to 255. If no byte is available because the end of the stream has been
reached, the value -1 is returned.</p>
<p>But in Java, the <code>byte</code> primitive data type is an 8-bit signed two’s complement integer. It has a minimum value of -128 and a maximum
value of 127. So by contract, the implementation of an <code>InputSteam.read()</code> method should never directly return a <code>byte</code>
primitive data type. A conversion into an unsigned byte must be done before by applying a bitmask.</p>
<h3>Noncompliant code example</h3>
<pre>
@Override
public int read() throws IOException {
  if (pos == buffer.length()) {
    return -1;
  }
  return buffer.getByte(pos++); // Noncompliant, a signed byte value is returned
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Override
public int read() throws IOException {
  if (pos == buffer.length()) {
    return -1;
  }
  return buffer.getByte(pos++) &amp; 0xFF; // The 0xFF bitmask is applied
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Persistent entities should not be used as arguments of "@RequestMapping" methods (java:S4684)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code is vulnerable to a mass assignment attack because it allows modifying the <code>User</code> persistent entities thanks to
maliciously forged <code>Wish</code> object properties.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.persistence.Entity;

@Entity
public class Wish {
  Long productId;
  Long quantity;
  Client client;
}

@Entity
public class Client {
  String clientId;
  String name;
  String password;
}

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class PurchaseOrderController {

  @RequestMapping(path = "/saveForLater", method = RequestMethod.POST)
  public String saveForLater(Wish wish) { // Noncompliant
    session.save(wish);
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class WishDTO {
  Long productId;
  Long quantity;
  Long clientId;
}

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
public class PurchaseOrderController {

  @RequestMapping(path = "/saveForLater", method = RequestMethod.POST)
  public String saveForLater(WishDTO wish) {
    Wish persistentWish = new Wish();
    persistentWish.productId = wish.productId
    persistentWish.quantity = wish.quantity
    persistentWish.client = getClientById(with.clientId)
    session.save(persistentWish);
  }
}
</pre>
<h3>How does this work?</h3>
<p>The compliant code implements a Data Transfer Object (DTO) layer. Instead of accepting a persistent <code>Wish</code> entity as a parameter, the
vulnerable method accepts a <code>WishDTO</code> object with a safe, minimal set of properties. It then instantiates a persistent entity and
initializes it based on the DTO properties' values. The resulting object can safely be persisted in the database.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>By accepting persistent entities as method arguments, the application allows clients to manipulate the object’s properties directly.</p>
<h3>What is the potential impact?</h3>
<p>Attackers could forge malicious HTTP requests that will alter unexpected properties of persistent objects. This can lead to unauthorized
modifications of the entity’s state. This is known as a <strong>mass assignment</strong> attack.</p>
<p>Depending on the affected objects and properties, the consequences can vary.</p>
<h4>Privilege escalation</h4>
<p>If the affected object is used to store the client’s identity or permissions, the attacker could alter it to change their entitlement on the
application. This can lead to horizontal or vertical privilege escalation.</p>
<h4>Security checks bypass</h4>
<p>Because persistent objects are modified directly without prior logic, attackers could exploit this issue to bypass security measures otherwise
enforced by the application. For example, an attacker might be able to change their e-mail address to an invalid one by directly setting it without
going through the application’s email validation process.</p>
<p>The same could also apply to passwords that attackers could change without complexity validation or knowledge of their current value.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html">Mass Assignment Cheat Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 - Category A8 - Software and Data
  Integrity Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 - Category A5 - Broken Access
  Control</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/915">CWE-915 - Improperly Controlled Modification of Dynamically-Determined Object
  Attributes</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<p>OWASP O2 Platform Blog - <a href="https://o2platform.files.wordpress.com/2011/07/ounce_springframework_vulnerabilities.pdf">Two Security
Vulnerabilities in the Spring Framework’s MVC</a></p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>With Spring, when a request mapping method is configured to accept bean objects as arguments, the framework will automatically bind HTTP parameters
to those objects' properties. If the targeted beans are also persistent entities, the framework will also store those properties in the storage
backend, usually the application’s database.</p></p>
            </div>
        <div class="rule">
            <h3>'List.remove()' should not be used in ascending 'for' loops (java:S5413)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html#remove(java.lang.Object)">Java SE 7 API Specification:
  Collection.remove</a> </li>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#removeIf-java.util.function.Predicate-">Java SE 8 API
  Specification: Collection.removeIf</a> </li>
  <li> <a href="https://sonarsource.github.io/rspec/#/rspec/<a href='/coding_rules#rule_key=java%3AS6068'>S6068</a>/java"><a href='/coding_rules#rule_key=java%3AS127'>S127</a> - "for" loop stop conditions should be
  invariant</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When <code>List.remove()</code> is called, the list shrinks, and the indices of all elements following the removed element are decremented by one.
If this operation is performed within a loop that iterates through the elements in ascending order, it will cause the loop to skip the element
immediately following the removed element.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>There are three ways how to fix this issue:</p>
<ol>
  <li> Replace the loop with a call to <code>Collection.removeIf()</code>. This is the preferred solution. </li>
  <li> Replace the ascending loop with a descending loop. Use this approach if the preferred solution is not possible due to side effects of the loop.
  </li>
  <li> Adjust the loop counter within the loop body after the call to <code>Collection.remove()</code>. <strong>This approach is not
  recommended</strong>, because it will raise an issue with rule <em><a href='/coding_rules#rule_key=java%3AS127'>S127</a> - "for" loop stop conditions should be invariant</em> </li>
</ol>

<h4>Noncompliant code example</h4>
<p>If the loop can be replaced with Java 8’s <code>Collection.removeIf</code> method, depending on the side effects of the loop and your Java target
version, then this is the preferred solution for this issue.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
void removeFrom(List&lt;String&gt; list) {
  // expected: iterate over all list elements
  for (int i = 0; i &lt; list.size(); i++) {
    if (list.get(i).isEmpty()) {
      list.remove(i); // Noncompliant, next element is skipped
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void removeFrom(List&lt;String&gt; list) {
  list.removeIf(String::isEmpty); // Compliant
}
</pre>
<h4>Noncompliant code example</h4>
<p>If this is not possible due to side effects of the loop, replace the ascending loop with a descending loop. Descending loops are not affected by
decrementing the element indices after the removed element, because they have already been iterated.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
void removeFrom(List&lt;String&gt; list) {
  // expected: iterate over all list elements
  for (int i = 0; i &lt; list.size(); i++) {
    if (list.get(i).isEmpty()) {
      list.remove(i); // Noncompliant, next element is skipped
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
void removeFrom(List&lt;String&gt; list) {
    // expected: iterate over all list elements
    for (int i = list.size() - 1; i &gt;= 0; i--) {
    if (list.get(i).isEmpty()) {
      list.remove(i); // Compliant, elements after removed one have already been iterated
    }
  }
}
</pre>
<h4>Noncompliant code example</h4>
<p>Another way to solve this issue is to adjust the loop counter after the call to <code>Collection.remove</code> to account for the index
decrement.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
void removeFrom(List&lt;String&gt; list) {
  // expected: iterate over all list elements
  for (int i = 0; i &lt; list.size(); i++) {
    if (list.get(i).isEmpty()) {
      list.remove(i); // Noncompliant, next element is skipped
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<p><strong>This is not recommanded</strong> because it raises an issue with rule <a href='/coding_rules#rule_key=java%3AS127'>S127</a>.</p>
<pre data-diff-id="3" data-diff-type="compliant">
void removeFrom(List&lt;String&gt; list) {
  // expected: iterate over all list elements
  for (int i = 0; i &lt; list.size(); i++) {
    if (list.get(i).isEmpty()) {
      list.remove(i); // Compliant due to counter adjust in next line
      i--; // Noncompliant with S127!
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Exception testing via JUnit ExpectedException rule should not be mixed with other assertions (java:S5776)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://github.com/junit-team/junit4/wiki/Exception-testing">JUnit exception testing documentation</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When testing exception via <code>org.junit.rules.ExpectedException</code> any code after the raised exception will not be executed, so adding
subsequent assertions is wrong and misleading. This rule raises an issue when an assertion is done after the "expect(…​)" invocation, only the code
throwing the expected exception should be after "expect(…​)".</p>
<p>You should consider using <a
href="https://github.com/junit-team/junit4/wiki/Exception-testing#using-assertthrows-method">org.junit.Assert.assertThrows</a> instead, it’s available
since JUnit 4.13 and it allows additional subsequent assertions.</p>
<p>Alternatively, you could use <a href="https://github.com/junit-team/junit4/wiki/Exception-testing#trycatch-idiom">try-catch idiom</a> for JUnit
version &lt; 4.13 or if your project does not support lambdas.</p>
<h3>Noncompliant code example</h3>
<pre>
@Rule
public ExpectedException thrown = ExpectedException.none();

@Test
public void test() throws IndexOutOfBoundsException {
  thrown.expect(IndexOutOfBoundsException.class); // Noncompliant
  Object o = get();
  // This test pass since execution will never get past this line.
  Assert.assertEquals(0, 1);
}

private Object get() {
  throw new IndexOutOfBoundsException();
}
</pre>
<h3>Compliant solution</h3>
<ul>
  <li> For JUnit &gt;= 4.13, use <a
  href="https://github.com/junit-team/junit4/wiki/Exception-testing#using-assertthrows-method">org.junit.Assert.assertThrows</a>: </li>
</ul>
<pre>
Assert.assertThrows(IndexOutOfBoundsException.class, () -&gt; get());
// This test correctly fails.
Assert.assertEquals(0, 1);
</pre>
<ul>
  <li> For JUnit &lt; 4.13, use the <a href="https://github.com/junit-team/junit4/wiki/Exception-testing#trycatch-idiom">try-catch idiom</a>: </li>
</ul>
<pre>
try {
  get();
  Assert.fail("Expected an IndexOutOfBoundsException to be thrown");
} catch (IndexOutOfBoundsException e) {}
Assert.assertEquals(0, 1); // Correctly fails.
</pre></p>
            </div>
        <div class="rule">
            <h3>Exception testing via JUnit @Test annotation should be avoided (java:S5777)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://github.com/junit-team/junit4/wiki/Exception-testing">JUnit exception testing documentation</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When testing exception via <code>@Test</code> annotation, having additional assertions inside that test method can be problematic because any code
after the raised exception will not be executed. It will prevent you to test the state of the program after the raised exception and, at worst, make
you&nbsp;misleadingly think that it is executed.</p>
<p>You should consider moving any assertions into a separate test method where possible, or using <a
href="https://github.com/junit-team/junit4/wiki/Exception-testing#using-assertthrows-method">org.junit.Assert.assertThrows</a> instead.</p>
<p>Alternatively, you could use <a href="https://github.com/junit-team/junit4/wiki/Exception-testing#trycatch-idiom">try-catch idiom</a> for JUnit
version &lt; 4.13 or if your project does not support lambdas.</p>
<h3>Noncompliant code example</h3>
<pre>
@Test(expected = IndexOutOfBoundsException.class)
public void testShouldFail() {
  get();
  // This test pass since execution will never get past this line.
  Assert.assertEquals(0, 1);
}

private Object get() {
  throw new IndexOutOfBoundsException();
}
</pre>
<h3>Compliant solution</h3>
<ul>
  <li> For JUnit &gt;= 4.13, use <a
  href="https://github.com/junit-team/junit4/wiki/Exception-testing#using-assertthrows-method">org.junit.Assert.assertThrows</a>: </li>
</ul>
<pre>
// This test correctly fails.
@Test
public void testToString() {
    Object obj = get();
    Assert.assertThrows(IndexOutOfBoundsException.class, () -&gt; obj.toString());
    Assert.assertEquals(0, 1);
}
</pre>
<ul>
  <li> For JUnit &lt; 4.13, use the <a href="https://github.com/junit-team/junit4/wiki/Exception-testing#trycatch-idiom">try-catch idiom</a>: </li>
</ul>
<pre>
@Test
public void testShouldFail() {
    Object obj = get();
    try {
        obj.toString();
        Assert.fail("Expected an IndexOutOfBoundsException to be thrown");
    } catch (IndexOutOfBoundsException e) {}
    Assert.assertEquals(0, 1); // Correctly fails.
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Only one method invocation is expected when testing runtime exceptions (java:S5778)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://github.com/junit-team/junit4/wiki/Exception-testing">JUnit exception testing documentation</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When verifying that code raises a runtime exception, a good practice is to avoid having multiple method calls inside the tested code, to be
explicit about which method call is expected to raise the exception.</p>
<p>It increases the clarity of the test, and avoid incorrect testing when another method is actually raising the exception.</p>
<h3>Noncompliant code example</h3>
<pre>
@Test
public void testToString() {
  // Do you expect get() or toString() throwing the exception?
  org.junit.Assert.assertThrows(IndexOutOfBoundsException.class, () -&gt; get().toString());
}

@Test
public void testToStringTryCatchIdiom() {
  try {
    // Do you expect get() or toString() throwing the exception?
    get().toString();
    Assert.fail("Expected an IndexOutOfBoundsException to be thrown");
  } catch (IndexOutOfBoundsException e) {
    // Test exception message...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Test
public void testToString() {
   Object obj = get();
   Assert.assertThrows(IndexOutOfBoundsException.class, () -&gt; obj.toString());
}

@Test
public void testToStringTryCatchIdiom() {
  Object obj = get();
  try {
    obj.toString();
    Assert.fail("Expected an IndexOutOfBoundsException to be thrown");
  } catch (IndexOutOfBoundsException e) {
    // Test exception message...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Assertion methods should not be used within the try block of a try-catch catching an Error (java:S5779)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Assertion methods&nbsp;are throwing a "<code>java.lang.AssertionError</code>". If this call is done within the try block of a try-catch cathing a
similar error, you should make sure to test some properties of the exception. Otherwise, the assertion will never fail.</p>
<h3>Noncompliant code example</h3>
<pre>
@Test
public void should_throw_assertion_error() {
  try {
    throwAssertionError();
    Assert.fail("Expected an AssertionError!"); // Noncompliant, the AssertionError will be caught and the test will never fail.
  } catch (AssertionError e) {}
}

private void throwAssertionError() {
  throw new AssertionError("My assertion error");
}
</pre>
<h3>Compliant solution</h3>
<pre>
assertThrows(AssertionError.class, () -&gt; throwAssertionError());
</pre>
<pre>
try {
   throwAssertionError();
   Assert.fail("Expected an AssertionError!"); // Compliant, we made sure to test that the correct error is raised
 } catch (AssertionError e) {
   Assert.assertThat(e.getMessage(), is("My assertion error"));
 }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://github.com/junit-team/junit4/wiki/Exception-testing">JUnit 4 exception testing documentation</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Empty lines should not be tested with regex MULTILINE flag (java:S5846)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>One way to test for empty lines is to use the regex <code>"^$"</code>, which can be extremely handy when filtering out empty lines from collections
of Strings, for instance. With regard to this, the Javadoc for <a
href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Pattern.html">Pattern (Line Terminators)</a> states the
following:</p>
<blockquote>
  <p>By default, the regular expressions ^ and <code>$</code> ignore line terminators and only match at the beginning and the end, respectively, of
  the entire input sequence. If <code>MULTILINE</code> mode is activated then ^ matches at the beginning of input and after any line terminator
  <strong>except at the end of input</strong>. When in <code>MULTILINE</code> mode <code>$</code> matches just before a line terminator or the end of
  the input sequence.</p>
</blockquote>
<p>As emphasized, ^ is not going to match at the end of an input, and the end of the input is necessarily included in the empty string, which might
lead to completely missing empty lines, while it would be the initial reason for using such regex.</p>
<p>Therefore, when searching for empty lines using a multi-line regular expression, you should also check whether the string is empty.</p>
<p>This rule is raising an issue every time a pattern that can match the empty string is used with <code>MULTILINE</code> flag and without calling
<code>isEmpty()</code> on the string.</p>
<h3>Noncompliant code example</h3>
<pre>
static final Pattern p = Pattern.compile("^$", Pattern.MULTILINE); // Noncompliant

// Alternatively
static final Pattern p = Pattern.compile("(?m)^$"); // Noncompliant


boolean containsEmptyLines(String str) {
    return p.matcher(str).find();
}

// ...
System.out.println(containsEmptyLines("a\n\nb")); // correctly prints 'true'
System.out.println(containsEmptyLines("")); // incorrectly prints 'false'
</pre>
<h3>Compliant solution</h3>
<pre>
static final Pattern p = Pattern.compile("^$", Pattern.MULTILINE);

boolean containsEmptyLines(String str) {
    return p.matcher(str).find() || str.isEmpty();
}

// ...
System.out.println(containsEmptyLines("a\n\nb")); // correctly prints 'true'
System.out.println(containsEmptyLines("")); // also correctly prints 'true'
</pre></p>
            </div>
        <div class="rule">
            <h3>Mocking all non-private methods of a class should be avoided (java:S5969)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>If you end up mocking every non-private method of a class in order to write tests, it is a strong sign that your test became too complex, or that
you misunderstood the way you are supposed to use the mocking mechanism.</p>
<p>You should either refactor the test code into multiple units, or consider using the class itself, by either directly instantiating it, or creating
a new one inheriting from it, with the expected behavior.</p>
<p>This rule reports an issue when every member of a given class are mocked.</p>
<h3>Noncompliant code example</h3>
<pre>
@Test
void test_requiring_MyClass() {
  MyClass myClassMock = mock(MyClass.class); // Noncompliant
  when(myClassMock.f()).thenReturn(1);
  when(myClassMock.g()).thenReturn(2);
  //...
}

abstract class MyClass {
  abstract int f();
  abstract int g();
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Test
void test_requiring_MyClass() {
  MyClass myClass = new MyClassForTest();
  //...
}

class MyClassForTest extends MyClass {

  @Override
  int f() {
    return 1;
  }

  @Override
  int g() {
    return 2;
  }
}
</pre>
<p>or</p>
<pre>
@Test
void test_requiring_f() {
  MyClass myClassMock = mock(MyClass.class);
  when(myClassMock.f()).thenReturn(1);
  //...
}

@Test
void test_requiring_g() {
  MyClass myClassMock = mock(MyClass.class);
  when(myClassMock.g()).thenReturn(2);
  //...
}

abstract class MyClass {
  abstract int f();
  abstract int g();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Nullable injected fields and parameters should provide a default value (java:S6816)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>@Value</code> annotation does not guarantee that the property is defined. Particularly if a field or parameter is annotated as nullable,
it indicates that the developer assumes that the property may be undefined.</p>
<p>An undefined property may lead to runtime exceptions when the Spring framework tries to inject the autowired dependency during bean creation.</p>
<p>This rule raises an issue when a nullable field or parameter is annotated with <code>@Value</code> and no default value is provided.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Add a default value to the <code>@Value</code> annotation. A default value can be supplied by using the colon (<code>:</code>) operator. As the
field is nullable, the default value should most likely be <code>#{null}</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Nullable
@Value("${my.property}") // Noncompliant, no default value is provided, even though the field is nullable
private String myProperty;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Nullable
@Value("${my.property:#{null}}") // Compliant, a default value is provided
private String myProperty;
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>SpEL, the Spring Expression Languages allows developers fine-grained control over the values injected into fields and parameters. Using the
<code>@Value</code> annotation, it is possible to inject values from sources such as system properties.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> Baeldung - <a href="https://www.baeldung.com/spring-value-defaults">Using Spring @Value With Defaults</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Use of the "@Async" annotation on methods declared within a "@Configuration" class in Spring Boot (java:S6817)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>@Configuration</code> is a class-level annotation indicating that an object is a source of bean definitions. <code>@Configuration</code>
classes declare beans through <code>@Bean</code>-annotated methods. Calls to <code>@Bean</code> methods on <code>@Configuration</code> classes can
also be used to define inter-bean dependencies. The <code>@Bean</code> annotation indicates that a method instantiates, configures, and initializes a
new object to be managed by the Spring IoC container.</p>
<p>Annotating a method of a bean with <code>@Async</code> will make it execute in a separate thread. In other words, the caller will not wait for the
completion of the called method.</p>
<p>The <code>@Async</code> annotation is not supported on methods declared within a <code>@Configuration</code> class. This is because
<code>@Async</code> methods are typically used for asynchronous processing, and they require certain infrastructure to be set up, which may not be
available or appropriate in a <code>@Configuration</code> class.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Don’t use <code>@Async</code> annotations on methods of <code>@Configuration</code> classes.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@EnableAsync
@Configuration
public class MyConfiguration {

  @Async // Noncompliant - This is not allowed
  public void asyncMethod() {
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@EnableAsync
@Configuration
public class MyConfiguration {

  public void method() {
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Async.html">Spring
  Framework - @Async</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/configuration-annotation.html">Spring Framework - Using the
  @Configuration annotation</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/basic-concepts.html">Spring Framework - Basic Concepts: @Bean and
  @Configuration</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-async">Baeldung - How To Do @Async in Spring</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Beans in "@Configuration" class should have different names (java:S6862)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>To address this issue, ensure each bean within a configuration has a distinct and meaningful name. Choose names that accurately represent the
purpose or functionality of the bean.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Configuration
class Config {
  @Bean
  public User user() {
    return currentUser();
  }
  @Bean
  public User user(AuthService auth) { // Noncompliant
    return auth.user();
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Configuration
class Config {
  @Bean
  public User user() {
    return currentUser();
  }
  @Bean
  public User userFromAuth(AuthService auth) {
    return auth.user();
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Naming conventions play a crucial role in maintaining code clarity and readability. The uniqueness of bean names in Spring configurations is vital
to the clarity and readability of the code. When two beans share the same name within a configuration, it is not obvious to the reader which bean is
being referred to. This leads to potential misunderstandings and errors.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/basic-concepts.html">Spring IO - Basic concepts: @Bean and
  @Configuration</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/configuration-annotation.html">Spring IO - Using the @Configuration
  annotation</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/beans/java/bean-annotation.html">Spring IO - Using the @Bean annotation</a>
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Set appropriate Status Codes on HTTP responses (java:S6863)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The request handler function in a <code>Controller</code> should set the appropriate HTTP status code based on the operation’s success or failure.
This is done by returning a <code>Response</code> object with the appropriate status code.</p>
<p>If an exception is thrown during the execution of the handler, the status code should be in the range of 4xx or 5xx. Examples of such codes are
<code>BAD_REQUEST</code>, <code>UNAUTHORIZED</code>, <code>FORBIDDEN</code>, <code>NOT_FOUND</code>, <code>INTERNAL_SERVER_ERROR</code>,
<code>BAD_GATEWAY</code>, <code>SERVICE_UNAVAILABLE</code>, etc.</p>
<p>The status code should be 1xx, 2xx, or 3xx if no exception is thrown and the operation is considered successful. Such codes include
<code>OK</code>, <code>CREATED</code>, <code>MOVED_PERMANENTLY</code>, <code>FOUND</code>, etc.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.html">Spring Java Documentation -
  HttpStatus</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/ResponseEntity.html">Spring Java
  Documentation - ResponseEntity</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-methods/responseentity.html">Spring Framework
  Documentation - ResponseEntity</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-ann-rest-exceptions.html">Spring Framework Documentation - Exception
  Handling</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> <a href="https://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml">IANA - Hypertext Transfer Protocol (HTTP) Status Code
  Registry</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Controller
public class UserController {
    public ResponseEntity&lt;User&gt; getUserById(Long userId) {
        try {
            User user = userService.getUserById(userId);
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(user); // Noncompliant: Setting 500 for a successful operation
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.OK).build(); // Noncompliant: Setting 200 for exception
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Controller
public class UserController {
    public ResponseEntity&lt;User&gt; getUserById(Long userId) {
        try {
            User user = userService.getUserById(userId);
            return ResponseEntity.ok(user); // Compliant: Setting 200 for a successful operation
        } catch (Exception e) {
            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build(); // Compliant: Setting 500 for exception
        }
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Public constants and fields initialized at declaration should be "static final" rather than merely "final" (java:S1170)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Making a <code>public</code> constant just <code>final</code> as opposed to <code>static final</code> leads to duplicating its value for every
instance of the class, uselessly increasing the amount of memory required to execute the application.</p>
<p>Further, when a non-<code>public</code>, <code>final</code> field isn’t also <code>static</code>, it implies that different instances can have
different values. However, initializing a non-<code>static final</code> field in its declaration forces every instance to have the same value. So such
fields should either be made <code>static</code> or initialized in the constructor.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Myclass {
  public final int THRESHOLD = 3;
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Myclass {
  public static final int THRESHOLD = 3;    // Compliant
}
</pre>
<h3>Exceptions</h3>
<p>No issues are reported on final fields of inner classes whose type is not a primitive or a String. Indeed according to the Java specification:</p>
<blockquote>
  <p>An inner class is a nested class that is not explicitly or implicitly declared static. Inner classes may not declare static initializers (§8.7)
  or member interfaces. Inner classes may not declare static members, unless they are compile-time constant fields (§15.28).</p>
</blockquote></p>
            </div>
        <div class="rule">
            <h3>Only static class initializers should be used (java:S1171)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Non-static initializers should be refactored into standard constructors or field initializers when possible.</p>
<p>In most cases, the use of constructors, overloaded constructors, or factory methods is preferable for initializing instance variables. These
approaches provide more explicit and controlled initialization, separate concerns, allow for better error handling, and make the code easier to
understand and maintain.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyClass {
  private static final Map&lt;String, String&gt; MY_MAP = new HashMap&lt;String, String&gt;() {
    {
      put("a", "b");
    }
  }; // Noncompliant - HashMap should be extended only to add behavior, not for initialization
}
</pre>
<h4>Compliant solution</h4>
<p>Using static initialization block:</p>
<pre data-diff-id="1" data-diff-type="compliant">
class MyClass {
  private static final Map&lt;String, String&gt; MY_MAP = new HashMap&lt;&gt;();

  static {
    MY_MAP.put("a", "b");  // Compliant
  }
}
</pre>
<p>or using constructor:</p>
<pre>
class MyClass {
  private static final Map&lt;String, String&gt; MY_MAP = new HashMap&lt;&gt;();

  public MyClass() {
    MY_MAP.put("a", "b");  // Compliant
  }
}
</pre>
<p>or using Java 9 <code>Map.of</code>:</p>
<pre>
class MyClass {
  private static final Map&lt;String, String&gt; MY_MAP = java.util.Map.of("a", "b");   // Compliant
}
</pre>
<p>or using Guava <code>ImmutableMap.of</code>:</p>
<pre>
class MyClass {
  private static final Map&lt;String, String&gt; MY_MAP = com.google.common.collect.ImmutableMap.of("a", "b");   // Compliant
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Non-static initializers, also known as instance initializers, are blocks of code within a class that are executed when an instance of the class is
created. They are executed when an object of the class is created just before the constructor is called. Non-static initializers are useful when you
want to perform some common initialization logic for all objects of a class. They allow you to initialize instance variables in a concise and
centralized manner, without having to repeat the same initialization code in each constructor.</p>
<p>While non-static initializers may have some limited use cases, they are rarely used and can be confusing for most developers because they only run
when new class instances are created.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-static-instance-initializer-blocks">Static vs. Instance Initializer Block in Java</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Unused method parameters should be removed (java:S1172)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Having unused function parameters in your code can lead to confusion and misunderstanding of a developer’s intention. They reduce code readability
and introduce the potential for errors. To avoid these problems, developers should remove unused parameters from function declarations.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void doSomething(int a, int b) { // Noncompliant, "b" is unused
  compute(a);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void doSomething(int a) {
  compute(a);
}
</pre>
<p>Examples of exceptions:</p>
<pre>
@Override
void doSomething(int a, int b) {     // no issue reported on b
  compute(a);
}

public void foo(String s) {
  // designed to be extended but noop in standard case
}

protected void bar(String s) {
  //open-closed principle
}

public void qix(String s) {
  throw new UnsupportedOperationException("This method should be implemented in subclasses");
}

/**
 * @param s This string may be used for further computation in overriding classes
 */
protected void foobar(int a, String s) { // no issue, method is overridable and unused parameter has proper javadoc
  compute(a);
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5dUxBQ">CERT, MSC12-C.</a> - Detect and remove code that has no effect or is never executed
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A typical code smell known as unused function parameters refers to parameters declared in a function but not used anywhere within the function’s
body. While this might seem harmless at first glance, it can lead to confusion and potential errors in your code. Disregarding the values passed to
such parameters, the function’s behavior will be the same, but the programmer’s intention won’t be clearly expressed anymore. Therefore, removing
function parameters that are not being utilized is considered best practice.</p>
<h3>Exceptions</h3>
<p>The rule will not raise issues for unused parameters:</p>
<ul>
  <li> that are annotated with <code>@javax.enterprise.event.Observes</code> </li>
  <li> in overrides and implementation methods </li>
  <li> in interface <code>default</code> methods </li>
  <li> in non-private methods that only <code>throw</code> or that have empty bodies </li>
  <li> in annotated methods, unless the annotation is <code>@SuppressWarning("unchecked")</code> or <code>@SuppressWarning("rawtypes")</code>, in
  which case the annotation will be ignored </li>
  <li> in overridable methods (non-final, or not member of a final class, non-static, non-private), if the parameter is documented with a proper
  javadoc. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"Object.finalize()" should remain protected (versus public) when overriding (java:S1174)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The contract of the <code>Object.finalize()</code> method is clear: only the Garbage Collector is supposed to call this method.</p>
<p>Making this method public is misleading, because it implies that any caller can use it.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {

  @Override
  public void finalize() {    // Noncompliant
    /* ... */
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/583">CWE-583 - finalize() Method Declared Public</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/4jZGBQ">CERT, MET12-J.</a> - Do not use finalizers </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Member variable visibility should be specified (java:S2039)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Failing to explicitly declare the visibility of a member variable could result it in having a visibility you don’t expect, and potentially leave it
open to unexpected modification by other classes.</p>
<p>The default access level modifier may be intentional; in that case, this rule can report false positives.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Ball {
  String color = "red";  // Noncompliant
}
enum A {
  B;
  int a;  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
class Ball {
  private String color = "red";  // Compliant
}
enum A {
  B;
  private int a;  // Compliant
}
</pre>
<h3>Exceptions</h3>
<ul>
  <li> Members with comments containing the word <code>modifier</code> are ignored, as it indicates the modifier is intentionally omitted. </li>
  <li> Members annotated with the <code>@VisibleForTesting</code> annotation are ignored, as it indicates that visibility has been purposely relaxed
  to make the code testable. </li>
</ul>
<pre>
class Cone {
  @VisibleForTesting
  Logger logger; // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Methods of "Random" that return floating point values should not be used in random integer generation (java:S2140)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Generating random floating point values to cast them into integers is inefficient. A random bounded integer value can be generated with a single
proper method call. Use <code>nextInt</code> to make the code more efficient and the intent clearer.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
Random r = new Random();
int rand = (int) (r.nextDouble() * 50);  // Noncompliant way to get a pseudo-random value between 0 and 50
int rand2 = (int) r.nextFloat(); // Noncompliant; will always be 0;
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
Random r = new Random();
int rand = r.nextInt(50);  // returns pseudo-random value between 0 and 50
int rand2 = 0;
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes that don't define "hashCode()" should not be used in hashes (java:S2141)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Because <code>Object</code> implements <code>hashCode</code>, any Java class can be put into a hash structure. However, classes that define
<code>equals(Object)</code> but not <code>hashCode()</code> aren’t truly hash-able because instances that are equivalent according to the
<code>equals</code> method can return different hashes.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Student {  // no hashCode() method; not hash-able
  // ...

  public boolean equals(Object o) {
    // ...
  }
}

public class School {
  private Map&lt;Student, Integer&gt; studentBody = // okay so far
          new HashTable&lt;Student, Integer&gt;(); // Noncompliant

  // ...
</pre>
<h3>Compliant solution</h3>
<pre>
public class Student {  // has hashCode() method; hash-able
  // ...

  public boolean equals(Object o) {
    // ...
  }
  public int hashCode() {
    // ...
  }
}

public class School {
  private Map&lt;Student, Integer&gt; studentBody = new HashTable&lt;Student, Integer&gt;();

  // ...
</pre></p>
            </div>
        <div class="rule">
            <h3>"InterruptedException" and "ThreadDeath" should not be ignored (java:S2142)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/391">CWE-391 - Unchecked Error Condition</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>If an <code>InterruptedException</code> or a <code>ThreadDeath</code> error is not handled properly, the information that the thread was
interrupted will be lost. Handling this exception means either to re-throw it or manually re-interrupt the current thread by calling
<code>Thread.interrupt()</code>. Simply logging the exception is not sufficient and counts as ignoring it. Between the moment the exception is caught
and handled, is the right time to perform cleanup operations on the method’s state, if needed.</p>
<h3>What is the potential impact?</h3>
<p>Failing to interrupt the thread (or to re-throw) risks delaying the thread shutdown and losing the information that the thread was interrupted -
probably without finishing its task.</p>
<h3>Noncompliant code example</h3>
<pre>
public void run () {
  try {
    /*...*/
  } catch (InterruptedException e) { // Noncompliant; logging is not enough
    LOGGER.log(Level.WARN, "Interrupted!", e);
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void run () {
  try {
    /* ... */
  } catch (InterruptedException e) { // Compliant; the interrupted state is restored
    LOGGER.log(Level.WARN, "Interrupted!", e);
    /* Clean up whatever needs to be handled before interrupting  */
    Thread.currentThread().interrupt();
  }
}

public void run () {
  try {
    /* ... */
  } catch (ThreadDeath e) { // Compliant; the error is being re-thrown
    LOGGER.log(Level.WARN, "Interrupted!", e);
    /* Clean up whatever needs to be handled before re-throwing  */
    throw e;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"java.time" classes should be used for dates and times (java:S2143)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The old, much-derided <code>Date</code> and <code>Calendar</code> classes have always been confusing and difficult to use properly, particularly in
a multi-threaded context. <code>JodaTime</code> has long been a popular alternative, but now an even better option is built-in. Java 8’s JSR 310
implementation offers specific classes for:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Class</th>
      <th>Use for</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>LocalDate</p></td>
      <td><p>a date, without time of day, offset, or zone</p></td>
    </tr>
    <tr>
      <td><p>LocalTime</p></td>
      <td><p>the time of day, without date, offset, or zone</p></td>
    </tr>
    <tr>
      <td><p>LocalDateTime</p></td>
      <td><p>the date and time, without offset, or zone</p></td>
    </tr>
    <tr>
      <td><p>OffsetDate</p></td>
      <td><p>a date with an offset such as +02:00, without time of day, or zone</p></td>
    </tr>
    <tr>
      <td><p>OffsetTime</p></td>
      <td><p>the time of day with an offset such as +02:00, without date, or zone</p></td>
    </tr>
    <tr>
      <td><p>OffsetDateTime</p></td>
      <td><p>the date and time with an offset such as +02:00, without a zone</p></td>
    </tr>
    <tr>
      <td><p>ZonedDateTime</p></td>
      <td><p>the date and time with a time zone and offset</p></td>
    </tr>
    <tr>
      <td><p>YearMonth</p></td>
      <td><p>a year and month</p></td>
    </tr>
    <tr>
      <td><p>MonthDay</p></td>
      <td><p>month and day</p></td>
    </tr>
    <tr>
      <td><p>Year/MonthOfDay/DayOfWeek/…​</p></td>
      <td><p>classes for the important fields</p></td>
    </tr>
    <tr>
      <td><p>DateTimeFields</p></td>
      <td><p>stores a map of field-value pairs which may be invalid</p></td>
    </tr>
    <tr>
      <td><p>Calendrical</p></td>
      <td><p>access to the low-level API</p></td>
    </tr>
    <tr>
      <td><p>Period</p></td>
      <td><p>a descriptive amount of time, such as "2 months and 3 days"</p></td>
    </tr>
  </tbody>
</table>
<h3>Noncompliant code example</h3>
<pre>
Date now = new Date();  // Noncompliant
DateFormat df = new SimpleDateFormat("dd.MM.yyyy");
Calendar christmas  = Calendar.getInstance();  // Noncompliant
christmas.setTime(df.parse("25.12.2020"));
</pre>
<h3>Compliant solution</h3>
<pre>
LocalDate now = LocalDate.now();  // gets calendar date. no time component
LocalTime now2 = LocalTime.now(); // gets current time. no date component
LocalDate christmas = LocalDate.of(2020,12,25);
</pre></p>
            </div>
        <div class="rule">
            <h3>Unnecessary equality checks should not be made (java:S2159)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Comparisons of dissimilar types will always return false. The comparison and all its dependent code can simply be removed. This includes:</p>
<ul>
  <li> comparing an object with null </li>
  <li> comparing an object with an unrelated primitive (E.G. a string with an int) </li>
  <li> comparing unrelated classes </li>
  <li> comparing an unrelated <code>class</code> and <code>interface</code> </li>
  <li> comparing unrelated <code>interface</code> types </li>
  <li> comparing an array to a non-array </li>
  <li> comparing two arrays </li>
</ul>
<p>Specifically in the case of arrays, since arrays don’t override <code>Object.equals()</code>, calling <code>equals</code> on two arrays is the same
as comparing their addresses. This means that <code>array1.equals(array2)</code> is equivalent to <code>array1==array2</code>.</p>
<p>However, some developers might expect <code>Array.equals(Object obj)</code> to do more than a simple memory address comparison, comparing for
instance the size and content of the two arrays. Instead, the <code>==</code> operator or <code>Arrays.equals(array1, array2)</code> should always be
used with arrays.</p>
<h3>Noncompliant code example</h3>
<pre>
interface KitchenTool { ... };
interface Plant {...}

public class Spatula implements KitchenTool { ... }
public class Tree implements Plant { ...}
//...

Spatula spatula = new Spatula();
KitchenTool tool = spatula;
KitchenTool [] tools = {tool};

Tree tree = new Tree();
Plant plant = tree;
Tree [] trees = {tree};


if (spatula.equals(tree)) { // Noncompliant; unrelated classes
  // ...
}
else if (spatula.equals(plant)) { // Noncompliant; unrelated class and interface
  // ...
}
else if (tool.equals(plant)) { // Noncompliant; unrelated interfaces
  // ...
}
else if (tool.equals(tools)) { // Noncompliant; array &amp; non-array
  // ...
}
else if (trees.equals(tools)) { // Noncompliant; incompatible arrays
  // ...
}
else if (tree.equals(null)) { // Noncompliant
  // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5zdGBQ">CERT, EXP02-J.</a> - Do not use the Object.equals() method to compare two arrays </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Java parser failure (java:S2260)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the Java parser fails, it is possible to record the failure as a violation on the file. This way, not only it is possible to track the number
of files that do not parse but also to easily find out why they do not parse.</p></p>
            </div>
        <div class="rule">
            <h3>Null checks should not be used with "instanceof" (java:S4201)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There’s no need to null test in conjunction with an <code>instanceof</code> test. <code>null</code> is not an <code>instanceof</code> anything, so
a null check is redundant.</p>
<h3>Noncompliant code example</h3>
<pre>
if (x != null &amp;&amp; x instanceof MyClass) { ... }  // Noncompliant

if (x == null || ! x instanceof MyClass) { ... } // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
if (x instanceof MyClass) { ... }

if (! x instanceof MyClass) { ... }
</pre></p>
            </div>
        <div class="rule">
            <h3>Nullness of parameters should be guaranteed (java:S4449)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When using null-related annotations at global scope level, for instance using <code>javax.annotation.ParametersAreNonnullByDefault</code> (from
JSR-305) at package level, it means that all the parameters to all the methods included in the package will, or should, be considered
Non-<code>null</code>. It is equivalent to annotating every parameter in every method with non-null annotations (such as <code>@Nonnull</code>).</p>
<p>The rule raises an issue every time a parameter could be <code>null</code> for a method invocation, where the method is annotated as forbidding
null parameters.</p>
<h3>Noncompliant code example</h3>
<pre>
@javax.annotation.ParametersAreNonnullByDefault
class A {

  void foo() {
    bar(getValue()); // Noncompliant - method 'bar' do not expect 'null' values as parameter
  }

  void bar(Object o) { // 'o' is by contract expected never to be null
    // ...
  }

  @javax.annotation.CheckForNull
  abstract Object getValue();
}
</pre>
<h3>Compliant solution</h3>
<p>Two solutions are possible:</p>
<ul>
  <li> The signature of the method is correct, and null check should be done prior to the call. </li>
  <li> The signature of the method is not coherent and should be annotated to allow null values being passed as parameter </li>
</ul>
<pre>
@javax.annotation.ParametersAreNonnullByDefault
abstract class A {

  void foo() {
      Object o = getValue();
      if (o != null) {
        bar(o); // Compliant - 'o' can not be null
      }
  }

  void bar(Object o) {
    // ...
  }

  @javax.annotation.CheckForNull
  abstract Object getValue();
}
</pre>
<p>or</p>
<pre>
@javax.annotation.ParametersAreNonnullByDefault
abstract class A {

  void foo() {
    bar(getValue());
  }

  void bar(@javax.annotation.Nullable Object o) { // annotation was missing
    // ...
  }

  @javax.annotation.CheckForNull
  abstract Object getValue();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"@CheckForNull" or "@Nullable" should not be used on primitive types (java:S4682)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>By definition, primitive types are not Objects and so they can’t be <code>null</code>. Adding <code>@CheckForNull</code> or <code>@Nullable</code>
on primitive types adds confusion and is useless.</p>
<p>This rule raises an issue when <code>@CheckForNull</code> or <code>@Nullable</code> is set on a method returning a primitive type: byte, short,
int, long, float, double, boolean, char.</p>
<h3>Noncompliant code example</h3>
<pre>
@CheckForNull
boolean isFoo() {
 ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
boolean isFoo() {
 ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Avoid using boxed "Boolean" types directly in boolean expressions (java:S5411)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When boxed type <code>java.lang.Boolean</code> is used as an expression to determine the control flow (as described in <a
href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-4.html#jls-4.2.5">Java Language Specification §4.2.5 The <code>boolean</code> Type and
boolean Values</a>) it will throw a <code>NullPointerException</code> if the value is <code>null</code> (as defined in <a
href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-5.html#jls-5.1.8">Java Language Specification §5.1.8 Unboxing Conversion</a>).</p>
<p>It is safer to avoid such conversion altogether and handle the <code>null</code> value explicitly.</p>
<p>Note, however, that no issues will be raised for Booleans that have already been null-checked or are marked <code>@NonNull/@NotNull</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
Boolean b = getBoolean();
if (b) {  // Noncompliant, it will throw NPE when b == null
  foo();
} else {
  bar();
}
</pre>
<h3>Compliant solution</h3>
<pre>
Boolean b = getBoolean();
if (Boolean.TRUE.equals(b)) {
  foo();
} else {
  bar();  // will be invoked for both b == false and b == null
}


Boolean b = getBoolean();
if(b != null){
  String test = b ? "test" : "";
}
</pre>
<h3>Exceptions</h3>
<p>The issue is not raised if the expression is annotated <code>@NonNull</code> / <code>@NotNull</code>. This is useful if a boxed type is an
instantiation of a generic type parameter and cannot be avoided.</p>
<pre>
List&lt;Boolean&gt; list = new ArrayList&lt;&gt;();
list.add(true);
list.add(false);
list.forEach((@NonNull Boolean value) -&gt; {
  // Compliant
  if(value) {
    System.out.println("yes");
  }
});

@NonNull Boolean someMethod() { /* ... */ }

// Compliant
if(someMethod()) { /* ... */ }

@NonNull Boolean boxedNonNull = Boolean.TRUE;

// Compliant
if(boxedNonNull) { /* ... */ }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-5.html#jls-5.1.8">Java Language Specification §5.1.8 Unboxing Conversion</a>
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>JWT should be signed and verified with strong cipher algorithms (java:S5659)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import com.auth0.jwt.JWT;

public void encode() {
    JWT.create()
        .withSubject(SUBJECT)
        .sign(Algorithm.none()); // Noncompliant
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
import com.auth0.jwt.JWT;

public void decode() {
    JWTVerifier verifier = JWT.require(Algorithm.none()) // Noncompliant
        .withSubject(LOGIN)
        .build();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import com.auth0.jwt.JWT;

public void encode() {
    JWT.create()
        .withSubject(SUBJECT)
        .sign(Algorithm.HMAC256(SECRET_KEY));
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import com.auth0.jwt.JWT;

public void decode() {
    JWTVerifier verifier = JWT.require(Algorithm.HMAC256(SECRET_KEY))
        .withSubject(LOGIN)
        .build();
}
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability allows forging of JSON Web Tokens to impersonate other users.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>JSON Web Tokens (JWTs), a popular method of securely transmitting information between parties as a JSON object, can become a significant security
risk when they are not properly signed with a robust cipher algorithm, left unsigned altogether, or if the signature is not verified. This
vulnerability class allows malicious actors to craft fraudulent tokens, effectively impersonating user identities. In essence, the integrity of a JWT
hinges on the strength and presence of its signature.</p>
<h3>What is the potential impact?</h3>
<p>When a JSON Web Token is not appropriately signed with a strong cipher algorithm or if the signature is not verified, it becomes a significant
threat to data security and the privacy of user identities.</p>
<h4>Impersonation of users</h4>
<p>JWTs are commonly used to represent user authorization claims. They contain information about the user’s identity, user roles, and access rights.
When these tokens are not securely signed, it allows an attacker to forge them. In essence, a weak or missing signature gives an attacker the power to
craft a token that could impersonate any user. For instance, they could create a token for an administrator account, gaining access to high-level
permissions and sensitive data.</p>
<h4>Unauthorized data access</h4>
<p>When a JWT is not securely signed, it can be tampered with by an attacker, and the integrity of the data it carries cannot be trusted. An attacker
can manipulate the content of the token and grant themselves permissions they should not have, leading to unauthorized data access.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of JWT encoding and decoding without a strong cipher algorithm.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
import io.jsonwebtoken.Jwts;

public void encode() {
    Jwts.builder()
        .setSubject(USER_LOGIN)
        .compact(); // Noncompliant
}
</pre>
<pre data-diff-id="12" data-diff-type="noncompliant">
import io.jsonwebtoken.Jwts;

public void decode() {
    Jwts.parser()
        .setSigningKey(SECRET_KEY)
        .parse(token)
        .getBody(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
import io.jsonwebtoken.Jwts;

public void encode() {
    Jwts.builder()
        .setSubject(USER_LOGIN)
        .signWith(SignatureAlgorithm.HS256, SECRET_KEY)
        .compact();
}
</pre>
<p>When using <code>Jwts.parser()</code>, make sure to call <code>parseClaimsJws</code> instead of <code>parse</code> as it throws exceptions for
invalid or missing signatures.</p>
<pre data-diff-id="12" data-diff-type="compliant">
import io.jsonwebtoken.Jwts;

public void decode() {
    Jwts.parser()
        .setSigningKey(SECRET_KEY)
        .parseClaimsJws(token)
        .getBody();
}
</pre>
<h3>How does this work?</h3>
<h4>Always sign your tokens</h4>
<p>The foremost measure to enhance JWT security is to ensure that every JWT you issue is signed. Unsigned tokens are like open books that anyone can
tamper with. Signing your JWTs ensures that any alterations to the tokens after they have been issued can be detected. Most JWT libraries support a
signing function, and using it is usually as simple as providing a secret key when the token is created.</p>
<h4>Choose a strong cipher algorithm</h4>
<p>It is not enough to merely sign your tokens. You need to sign them with a strong cipher algorithm. Algorithms like HS256 (HMAC using SHA-256) are
considered secure for most purposes. But for an additional layer of security, you could use an algorithm like RS256 (RSA Signature with SHA-256),
which uses a private key for signing and a public key for verification. This way, even if someone gains access to the public key, they will not be
able to forge tokens.</p>
<h4>Verify the signature of your tokens</h4>
<p>Resolving a vulnerability concerning the validation of JWT token signatures is mainly about incorporating a critical step into your process:
validating the signature every time a token is decoded. Just having a signed token using a secure algorithm is not enough. If you are not validating
signatures, they are not serving their purpose.</p>
<p>Every time your application receives a JWT, it needs to decode the token to extract the information contained within. It is during this decoding
process that the signature of the JWT should also be checked.</p>
<p>To resolve the issue, follow these instructions:</p>
<ol>
  <li> Use framework-specific functions for signature verification: Most programming frameworks that support JWTs provide specific functions to not
  only decode a token but also validate its signature simultaneously. Make sure to use these functions when handling incoming tokens. </li>
  <li> Handle invalid signatures appropriately: If a JWT’s signature does not validate correctly, it means the token is not trustworthy, indicating
  potential tampering. The action to take when encountering an invalid token should be denying the request carrying it and logging the event for
  further investigation. </li>
  <li> Incorporate signature validation in your tests: When you are writing tests for your application, include tests that check the signature
  validation functionality. This can help you catch any instances where signature verification might be unintentionally skipped or bypassed. </li>
</ol>
<p>By following these practices, you can ensure the security of your application’s JWT handling process, making it resistant to attacks that rely on
tampering with tokens. Validation of the signature needs to be an integral and non-negotiable part of your token handling process.</p>
<h3>Going the extra mile</h3>
<h4>Securely store your secret keys</h4>
<p>Ensure that your secret keys are stored securely. They should not be hard-coded into your application code or checked into your version control
system. Instead, consider using environment variables, secure key management systems, or vault services.</p>
<h4>Rotate your secret keys</h4>
<p>Even with the strongest cipher algorithms, there is a risk that your secret keys may be compromised. Therefore, it is a good practice to
periodically rotate your secret keys. By doing so, you limit the amount of time that an attacker can misuse a stolen key. When you rotate keys, be
sure to allow a grace period where tokens signed with the old key are still accepted to prevent service disruptions.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Reverse iteration should utilize reversed view (java:S6876)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/SequencedCollection.html">Interface
  SequencedCollection</a> </li>
  <li> OpenJDK - <a href="https://openjdk.org/jeps/431">JEP 431: Sequenced Collections</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/core/creating-sequenced-collections-sets-and-maps.html#GUID-DCFE1D88-A0F5-47DE-A816-AEDA50B97523">Creating Sequenced Collections, Sets, and Maps</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java 21 introduces the new Sequenced Collections API, which is applicable to all collections with a defined sequence on their elements, such as
<code>LinkedList</code>, <code>TreeSet</code>, and others (see <a href="https://openjdk.org/jeps/431">JEP 431</a>). For projects using Java 21 and
onwards, this API should be utilized instead of workaround implementations that were necessary before Java 21.</p>
<p>This rule reports when a collection is iterated in reverse through explicit implementation or workarounds, instead of using the reversed view of
the collection.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace the reported statement with a forward-iteration over the reversed view of the collection.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void printLastToFirst(List&lt;String&gt; list) {
  for (var it = list.listIterator(list.size()); it.hasPrevious();) {
    var element = it.previous();
    System.out.println(element);
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void printLastToFirst(List&lt;String&gt; list) {
  for (var element: list.reversed()) {
    System.out.println(element);
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Reverse view should be used instead of reverse copy in read-only cases (java:S6877)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Remove <code>Collections.reverse(list);</code> and replace <code>list</code> with <code>list.reversed()</code> after.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void foo() {
  var list = new ArrayList&lt;String&gt;();
  list.add("A");
  list.add("B");
  Collections.reverse(list); // Noncompliant
  for (var e : list) {
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void foo() {
  var list = new ArrayList&lt;String&gt;();
  list.add("A");
  list.add("B");
  for (var e : list.reversed()) {  // Compliant
    // ...
  }
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
void foo(List&lt;String&gt; list) {
  var copy = new ArrayList&lt;String&gt;(list);
  Collections.reverse(copy); // Noncompliant
  for (var e : copy) {
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
void foo(List&lt;String&gt; list) {
  for (var e : list.reversed()) {  // Compliant
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/SequencedCollection.html">Interface
  SequencedCollection</a> </li>
  <li> OpenJDK - <a href="https://openjdk.org/jeps/431">JEP 431: Sequenced Collections</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/core/creating-sequenced-collections-sets-and-maps.html#GUID-DCFE1D88-A0F5-47DE-A816-AEDA50B97523">Creating Sequenced Collections, Sets, and Maps</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java 21 introduces the new Sequenced Collections API, which applies to all collections with a defined sequence on their elements, such as
<code>LinkedList</code>, <code>TreeSet</code>, and others (see <a href="https://openjdk.org/jeps/431">JEP 431</a>). For projects using Java 21 and
onwards, use this API instead of workaround implementations that were necessary before Java 21. One of the features of the new Sequenced Collections
API is <code>SequencedCollection.reversed()</code> which returns a lightweight view of the original collection, in the reverse order.</p>
<p>This rule reports when reverse view would have been sufficient instead of a reverse copy of a sequenced collection created using a list constructor
plus a <code>Collections.reverse(collection);</code> call.</p>
<p>If feasible, a view should be preferred over a copy because a view is a lightweight iterator without modification of the list itself.</p></p>
            </div>
        <div class="rule">
            <h3>Use record pattern instead of explicit field access (java:S6878)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.org/jeps/440">JEP 440: Record Patterns</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java 21 enhances Pattern Matching, introduced in Java 16, with a <em>record pattern</em> that decomposes records into local variables. This form
should be used when all fields of a record are accessed within a block for improved readability. Nested record patterns are also allowed and should be
used when a record field is another record, and all its fields are accessed.</p>
<h2>Exceptions</h2>
<p>This rule does not apply when not all record fields are accessed. This prevents the creation of unused local variables in the decomposed record
structure.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace the instance check or simple pattern matching with a record pattern.</p>

<h4>Noncompliant code example</h4>
<p>This example uses pattern matching but not a record pattern, even though all fields of the record are accessed in the block.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
record Point(Float x, Float y, Float z) {}

void print(Object obj) {
    if (obj instanceof Point p) { // Noncompliant, because all three fields x, y, z are accessed
        Float x = p.x;
        Float y = p.y();
        System.out.println(x + y + p.z);
    }
}
</pre>
<h4>Compliant solution</h4>
<p>The compliant example uses a record pattern to decompose the record structure.</p>
<pre data-diff-id="1" data-diff-type="compliant">
record Point(Float x, Float y, Float z) {}

void print(Object obj) {
    if (obj instanceof Point(Float x, Float y, Float z)) { // Compliant
        System.out.println(x + y + z);
    }
}
</pre>
<h4>Noncompliant code example</h4>
<p>This example does not use pattern matching or a record pattern. Rule <em><a
href="https://sonarsource.github.io/rspec/#/rspec/<a href='/coding_rules#rule_key=java%3AS6201'>S6201</a>"><a href='/coding_rules#rule_key=java%3AS6201'>S6201</a> - Pattern matching or "instanceOf" operator should be
used</a></em> would report first. When fixed using simple pattern matching instead of a record pattern, this rule (<a href='/coding_rules#rule_key=java%3AS6878'>S6878</a>) will report.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
void print(Object obj) {
    if (obj instanceof Point) { // Noncompliant
        Point p = (Point) obj;
        Float x = p.x;
        Float y = p.y();
        System.out.println(x + y + p.z);
    }
}
</pre>
<h4>Compliant solution</h4>
<p>The solution compliant with both rules, <a href='/coding_rules#rule_key=java%3AS6201'>S6201</a> and <a href='/coding_rules#rule_key=java%3AS6878'>S6878</a>, uses pattern matching and decomposes the record structure using a
record pattern.</p>
<pre data-diff-id="2" data-diff-type="compliant">
void print(Object obj) {
    if (obj instanceof Point(Float x, Float y, Float z)) { // Compliant
        System.out.println(x + y + z);
    }
}
</pre>
<h4>Noncompliant code example</h4>
<p>This example is noncompliant because a nested record pattern could have been used.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
record Plane(Point normal, Float d) {}

void print(Object obj) {
    // Noncompliant, because all field of "normal" are accessed
    if (obj instanceof Plane(Point normal, Float d)) {
        System.out.println(normal.x + normal.y + normal.z);
        System.out.println(d);
    }
}
</pre>
<h4>Compliant solution</h4>
<p>This is the same example using a nested record pattern.</p>
<pre data-diff-id="3" data-diff-type="compliant">
void print(Object obj) {
    if (obj instanceof Plane(Point(Float x, Float y, Float z), Float d)) { // Compliant
        System.out.println(x + y + z);
        System.out.println(d);
    }
}
</pre>
<h4>Compliant solution</h4>
<p>This example uses <code>var</code> instead of replicating the field types in the record pattern, which is less verbose and keeps the code more
readable, especially in the case of longer type names. Also, it uses variable names that do not match the original field names. The reason for this
can be to avoid name collisions with fields or other local variables.</p>
<pre>
void print(Object obj) {
    if (obj instanceof Point(var px, var py, var pz)) { // Compliant
        System.out.println(px + py + pz);
    }
}
</pre>
<h4>Compliant solution</h4>
<p>This example is compliant without using a record pattern, as it does not access all fields.</p>
<pre>
void print(Object obj) {
    if (obj instanceof Point p) { // Compliant, because z is never accessed
        Float x = p.x;
        Float y = p.y();
        System.out.println(x + y);
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Unused labels should be removed (java:S1065)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5dUxBQ">CERT, MSC12-C.</a> - Detect and remove code that has no effect or is never executed
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>If a label is declared but not used in the program, it can be considered as dead code and should therefore be removed.</p>
<p>This will improve maintainability as developers will not wonder what this label is used for.</p>
<h3>Noncompliant code example</h3>
<pre>
void foo() {
  outer: //label is not used.
  for(int i = 0; i&lt;10; i++) {
    break;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
void foo() {
  for(int i = 0; i&lt;10; i++) {
    break;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Mergeable "if" statements should be combined (java:S1066)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>If merging the conditions seems to result in a more complex code, extracting the condition or part of it in a named function or variable is a
better approach to fix readability.</p>

<h4>Noncompliant code example</h4>
<pre>
if (file != null) {
  if (file.isFile() || file.isDirectory()) {  // Noncompliant
    /* ... */
  }
}
</pre>
<h4>Compliant solution</h4>
<pre>
if (file != null &amp;&amp; isFileOrDirectory(file)) { // Compliant
  /* ... */
}

private static boolean isFileOrDirectory(File file) {
  return file.isFile() || file.isDirectory();
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Nested code - blocks of code inside blocks of code - is eventually necessary, but increases complexity. This is why keeping the code as flat as
possible, by avoiding unnecessary nesting, is considered a good practice.</p>
<p>Merging <code>if</code> statements when possible will decrease the nesting of the code and improve its readability.</p>
<p>Code like</p>
<pre>
if (condition1) {
  if (condition2) {             // Noncompliant
    /* ... */
  }
}
</pre>
<p>Will be more readable as</p>
<pre>
if (condition1 &amp;&amp; condition2) { // Compliant
  /* ... */
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Expressions should not be too complex (java:S1067)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The complexity of an expression is defined by the number of <code>&amp;&amp;</code>, <code>||</code> and <code>condition ? ifTrue : ifFalse</code>
operators it contains.</p>
<p>A single expression’s complexity should not become too high to keep the code readable.</p>
<h3>Noncompliant code example</h3>
<p>With the default threshold value of 3:</p>
<pre>
if (((condition1 &amp;&amp; condition2) || (condition3 &amp;&amp; condition4)) &amp;&amp; condition5) { ... }
</pre>
<h3>Compliant solution</h3>
<pre>
if ( (myFirstCondition() || mySecondCondition()) &amp;&amp; myLastCondition()) { ... }
</pre>
<h3>Exceptions</h3>
<p>No issue is reported inside <code>equals</code> methods, because it is common to compare all the fields of a class for equality inside this kind of
method.</p></p>
            </div>
        <div class="rule">
            <h3>Unused "private" fields should be removed (java:S1068)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>If a <code>private</code> field is declared but not used locally, its limited visibility makes it dead code.</p>
<p>This is either a sign that some logic is missing or that the code should be cleaned.</p>
<p>Cleaning out dead code decreases the size of the maintained codebase, making it easier to understand and preventing bugs from being introduced.</p>
<pre>
public class MyClass {
  private int foo = 42; // Noncompliant: foo is unused and should be removed

  public int compute(int a) {
    return a * 42;
  }

}
</pre>
<p>Note that this rule does not take reflection into account, which means that issues will be raised on <code>private</code> fields that are only
accessed using the reflection API.</p>
<h3>Exceptions</h3>
<p>The rule admits 3 exceptions:</p>
<ul>
  <li> Serialization ID fields </li>
</ul>
<p>The Java serialization runtime associates with each serializable class a version number called <code>serialVersionUID</code>, which is used during
deserialization to verify that the sender and receiver of a serialized object have loaded classes for that object that are compatible for
serialization.</p>
<p>A serializable class can declare its own <code>serialVersionUID</code> explicitly by declaring a field named <code>serialVersionUID</code> that
must be static, final, and of type long. By definition, those <code>serialVersionUID</code> fields should not be reported by this rule:</p>
<pre>
public class MyClass implements java.io.Serializable {
  private static final long serialVersionUID = 42L;  // Compliant by exception
}
</pre>
<ul>
  <li> Annotated fields and classes annotated with Lombok annotations </li>
</ul>
<p>The unused field in this class will not be reported by the rule as it is annotated, except if annotation class <code>SomeAnnotation</code> is
listed in the <code>ignoreAnnotations</code> parameter (see Parameters).</p>
<pre>
public class MyClass {
  @SomeAnnotation
  private int unused;  // Compliant by exception
}
</pre>
<ul>
  <li> Fields from classes with native methods </li>
</ul>
<p>The unused field in this class will not be reported by the rule as it might be used by native code.</p>
<pre>
public class MyClass {
  private int unused = 42;  // Compliant by exception
  private native static void doSomethingNative();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Overriding methods should do more than simply call the same method in the super class (java:S1185)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Overriding a method just to call the same method from the super class without performing any other actions is useless and misleading. The only time
this is justified is in <code>final</code> overriding methods, where the effect is to lock in the parent class behavior. This rule ignores such
overrides of <code>equals</code>, <code>hashCode</code> and <code>toString</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public void doSomething() {
  super.doSomething();
}

@Override
public boolean isLegal(Action action) {
  return super.isLegal(action);
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Override
public boolean isLegal(Action action) {         // Compliant - not simply forwarding the call
  return super.isLegal(new Action(/* ... */));
}

@Id
@Override
public int getId() {                            // Compliant - there is annotation different from @Override
  return super.getId();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Methods should not be empty (java:S1186)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void shouldNotBeEmpty() {  // Noncompliant - method is empty
}

public void notImplemented() {  // Noncompliant - method is empty
}

@Override
public void emptyOnPurpose() {  // Noncompliant - method is empty
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void doSomething() {
  doSomething();
}

public void notImplemented() {
  throw new UnsupportedOperationException("notImplemented() cannot be performed because ...");
}

@Override
public void emptyOnPurpose() {
  // comment explaining why the method is empty
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>An empty method is generally considered bad practice and can lead to confusion, readability, and maintenance issues. Empty methods bring no
functionality and are misleading to others as they might think the method implementation fulfills a specific and identified requirement.</p>
<p>There are several reasons for a method not to have a body:</p>
<ul>
  <li> It is an unintentional omission, and should be fixed to prevent an unexpected behavior in production. </li>
  <li> It is not yet, or never will be, supported. In this case an exception should be thrown. </li>
  <li> The method is an intentionally-blank override. In this case a nested comment should explain the reason for the blank override. </li>
</ul>
<h3>Exceptions</h3>
<p>This does not raise an issue in the following cases:</p>
<ul>
  <li> Non-public default (no-argument) constructors </li>
  <li> Public default (no-argument) constructors when there are other constructors in the class </li>
  <li> Empty methods in abstract classes </li>
  <li> Methods annotated with <code>@org.aspectj.lang.annotation.Pointcut()</code> </li>
</ul>
<pre>
public abstract class Animal {
  void speak() {  // default implementation ignored
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Anonymous classes should not have too many lines (java:S1188)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Anonymous classes are a very convenient and compact way to inject a behavior without having to create a dedicated class. But those anonymous inner
classes should be used only if the behavior to be injected can be defined in a few lines of code, otherwise the source code can quickly become
unreadable.</p></p>
            </div>
        <div class="rule">
            <h3>Unnecessary boxing and unboxing should be avoided (java:S2153)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Boxing is the process of putting a primitive value into a wrapper object, such as creating an <code>Integer</code> to hold an <code>int</code>
value. Unboxing is the process of retrieving the primitive value from such an object. Since the original value is unchanged during boxing and
unboxing, there is no point in doing either when not needed.</p>
<p>Instead, you should rely on Java’s implicit boxing/unboxing to convert from the primitive type to the wrapper type and vice versa, for better
readability.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void examinePrimitiveInt(int a) {
  //...
}

public void examineBoxedInteger(Integer a) {
  // ...
}

public void func() {
  int primitiveInt = 0;
  Integer boxedInt = Integer.valueOf(0);
  double d = 1.0;

  int dIntValue = Double.valueOf(d).intValue(); // Noncompliant; should be replaced with a simple cast

  examinePrimitiveInt(boxedInt.intValue()); // Noncompliant; unnecessary unboxing
  examinePrimitiveInt(Integer.valueOf(primitiveInt));  // Noncompliant; boxed int will be auto-unboxed

  examineBoxedInteger(Integer.valueOf(primitiveInt)); // Noncompliant; unnecessary boxing
  examineBoxedInteger(boxedInt.intValue()); // Noncompliant; unboxed int will be autoboxed
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public void examinePrimitiveInt(int a) {
  //...
}

public void examineBoxedInteger(Integer a) {
  // ...
}

public void func() {
  int primitiveInt = 0;
  Integer boxedInt = Integer.valueOf(0);
  double d = 1.0;

  int dIntValue = (int) d;

  examinePrimitiveInt(primitiveInt);
  examinePrimitiveInt(boxedInt);

  examineBoxedInteger(primitiveInt);
  examineBoxedInteger(boxedInt);
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Dissimilar primitive wrappers should not be used with the ternary operator without explicit casting (java:S2154)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>Cast one of both operands to a common supertype (e.g., <code>Number</code>) to prevent auto-unboxing and, thus, type coercion.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
Integer i = 123456789;
Float f = 1.0f;
Number n1 = condition ? i : f;  // Noncompliant, unexpected precision loss, n1 = 1.23456792E8
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Integer i = 123456789;
Float f = 1.0f;
Number n1 = condition ? (Number) i : f; // Compliant, cast to Number prevents unboxing
Number n2 = condition ? i : (Number) f; // Compliant, cast to Number prevents unboxing
</pre>
<h4>Noncompliant code example</h4>
<p>If type coercion was your intention, clarify this by casting the operand that would be coerced to the corresponding type explicitly.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
Integer i = 123456789;
Float f = 1.0f;
Number n1 = condition ? i : f;  // Noncompliant, unexpected precision loss, n1 = 1.23456792E8
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
Integer i = 123456789;
Float f = 1.0f;
Number n = condition ? (float) i : f; // Compliant, intentional type coercion with precision loss
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Using boxed values in a ternary operator does not simply return one operand or the other based on the condition. Instead, the values are unboxed
and coerced to a common type, which can result in a loss of precision when converting one operand from <code>int</code> to <code>float</code> or from
<code>long</code> to <code>double</code>.</p>
<p>While this behavior is expected for arithmetic operations, it may be unexpected for the ternary operator. To avoid confusion or unexpected
behavior, cast to a compatible type explicitly.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/op2.html">The Java Tutorials: Equality, Relational, and Conditional
  Operators</a> </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/data/autoboxing.html">The Java Tutorials: Autoboxing and Unboxing</a> </li>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-5.html">The Java® Language Specification Java SE 7 Edition: Chapter 5.
  Conversions and Promotions</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.geeksforgeeks.org/coercion-in-java/">GeeksforGeeks: Coercion in Java</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"final" classes should not have "protected" members (java:S2156)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The difference between <code>private</code> and <code>protected</code> visibility is that child classes can see and use <code>protected</code>
members, but they cannot see <code>private</code> ones. Since a <code>final</code> class will have no children, marking the members of a
<code>final</code> class <code>protected</code> is confusingly pointless.</p>
<p>Note that the <code>protected</code> members of a class can also be seen and used by other classes that are placed within the same package, this
could lead to accidental, unintended access to otherwise private members.</p>
<h3>Noncompliant code example</h3>
<pre>
public final class MyFinalClass {

  protected String name = "Fred";  // Noncompliant
  protected void setName(String name) {  // Noncompliant
    // ...
  }
</pre>
<h3>Compliant solution</h3>
<pre>
public final class MyFinalClass {

  private String name = "Fred";
  public void setName(String name) {
    // ...
  }
</pre>
<h3>Exceptions</h3>
<p>Members annotated with&nbsp;<code>@VisibleForTesting</code> annotation are ignored, as it indicates that visibility has been purposely relaxed to
make the code testable.</p>
<pre>
public final class MyFinalClass {
  @VisibleForTesting
  protected Logger logger; // Compliant

  @VisibleForTesting
  protected int calculateSomethingComplex(String input) { // Compliant
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Cloneables" should implement "clone" (java:S2157)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Consider the following example:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Foo implements Cloneable { // Noncompliant, override `clone` method
  public int value;
}
</pre>
<p>Override the <code>clone</code> method in class <code>Foo</code>. By convention, it must call <code>super.clone()</code>. At this point, we know
that:</p>
<ul>
  <li> By behavioral contract, <code>Object.clone</code> will not throw a <code>CloneNotSupportedException</code>, because <code>Foo</code> implements
  <code>Cloneable</code>. </li>
  <li> The returned object is an instance of class <code>Foo</code> </li>
</ul>
<p>We can narrow down the return type of <code>clone</code> to <code>Foo</code> and handle the <code>CloneNotSupportedException</code> inside the
function instead of throwing it:</p>
<pre data-diff-id="1" data-diff-type="compliant">
class Foo implements Cloneable { // Compliant

  public int value;

  @Override
  public Foo clone() {
    try {
      return (Foo) super.clone();
    } catch (CloneNotSupportedException e) {
      throw new AssertionError();
    }
  }
}
</pre>
<p>Be aware that <code>super.clone()</code> returns a one-by-one copy of the fields of the original instance. This means that in our example, the
<code>Foo.value</code> field is not required to be explicitly copied in the overridden function.</p>
<p>If you require another copy behavior for some or all of the fields, for example, deep copy or certain invariants that need to be true for a field,
these fields must be patched after <code>super.clone()</code>:</p>
<pre>
class Entity implements Cloneable {

  public int id; // unique per instance
  public List&lt;Entity&gt; children; // deep copy wanted

  @Override
  public Entity clone() {
    try {
      Entity copy = (Entity) super.clone();
      copy.id = System.identityHashCode(this);
      copy.children = children.stream().map(Entity::clone).toList();
      return copy;
    } catch (CloneNotSupportedException e) {
      throw new AssertionError();
    }
  }
}
</pre>
<p>Be aware that the <code>Cloneable</code> / <code>Object.clone</code> approach has several drawbacks. You might, therefore, also consider resorting
to other solutions, such as a custom <code>copy</code> method or a copy constructor:</p>
<pre>
class Entity implements Cloneable {

  public int id; // unique per instance
  public List&lt;Entity&gt; children; // deep copy wanted

  Entity(Entity template) {
    id = System.identityHashCode(this);
    children = template.children.stream().map(Entity::new).toList();
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>Cloneable</code> is a <em>marker interface</em> that defines the contract of the <code>Object.clone</code> method, which is to create a
consistent copy of the instance. The <code>clone</code> method is not defined by the interface though, but by class <code>Objects</code>.</p>
<p>The general problem with marker interfaces is that their definitions cannot be enforced by the compiler because they have no own API. When a class
implements <code>Cloneable</code> but does not override <code>Object.clone</code>, it is highly likely that it violates the contract for
<code>Cloneable</code>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Cloneable.html">Interface Cloneable - Java™ Platform, Standard Edition 8 API
  Specification</a> </li>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#clone--">Object.clone - Java™ Platform, Standard Edition 8 API
  Specification</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a class implements the interface <code>java.lang.Cloneable</code>, but does not override the
<code>Object.clone()</code> method.</p></p>
            </div>
        <div class="rule">
            <h3>"Object.wait(...)" and "Condition.await(...)" should be called inside a "while" loop (java:S2274)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In a multithreaded environment, the <code>Object.wait(…​)</code>, as well as <code>Condition.await(…​)</code> and similar methods are used to pause
the execution of a thread until the thread is awakened. A thread is typically awakened when it is notified, signaled, or interrupted, usually because
of an event in another thread requiring some subsequent action by the waiting thread.</p>
<p>However, a thread may be awakened despite the desired condition not being met or the desired event not having happened. This is referred to as
"spurious wakeups" and may be caused by underlying platform semantics. In other words, a thread may be awakened due to reasons that have nothing to do
with the business logic. Hence, the assumption that the desired condition is met or the desired event occurred after a thread is awakened does not
always hold.</p>
<p>According to the documentation of the Java <code>Condition</code> interface [1]:</p>
<blockquote>
  <p>When waiting upon a <code>Condition</code>, a "spurious wakeup" is permitted to occur, in general, as a concession to the underlying platform
  semantics. This has little practical impact on most application programs as a Condition should always be waited upon in a loop, testing the state
  predicate that is being waited for. An implementation is free to remove the possibility of spurious wakeups but it is recommended that applications
  programmers always assume that they can occur and so always wait in a loop.</p>
</blockquote>
<p>The same advice is also found for the <code>Object.wait(…​)</code> method [2]:</p>
<blockquote>
  <p>[…​] waits should always occur in loops, like this one:</p>
  <pre>
synchronized (obj) {
  while (&lt;condition does not hold&gt;){
    obj.wait(timeout);
  }
   ... // Perform action appropriate to condition
}
</pre>
</blockquote></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Make sure that the desired condition is actually true after being awakened. This can be accomplished by calling the <code>wait</code> or
<code>await</code> methods inside a loop that checks said condition.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
synchronized (obj) {
  if (!suitableCondition()){
    obj.wait(timeout); // Noncompliant, the thread can be awakened even though the condition is still false
  }
   ... // Perform some logic that is appropriate for when the condition is true
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
synchronized (obj) {
  while (!suitableCondition()){
    obj.wait(timeout); // Compliant, the condition is checked in a loop, so the action below will only occur if the condition is true
  }
   ... // Perform some logic that is appropriate for when the condition is true
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ol>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/concurrent/locks/Condition.html">Java SE 17 &amp; JDK 17</a> -
  Condition </li>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#wait--">Java Platform SE 8</a> - Object#wait </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/EzdGBQ">CERT THI03-J.</a> - Always invoke wait() and await() methods inside a loop </li>
</ol></p>
            </div>
        <div class="rule">
            <h3>Printf-style format strings should not lead to unexpected behavior at runtime (java:S2275)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Because <code>printf</code>-style format strings are interpreted at runtime, rather than validated by the Java compiler, they can contain errors
that lead to unexpected behavior or runtime errors. This rule statically validates the good behavior of <code>printf</code>-style formats when calling
the <code>format(...)</code> methods of <code>java.util.Formatter</code>, <code>java.lang.String</code>, <code>java.io.PrintStream</code>,
<code>MessageFormat</code>, and <code>java.io.PrintWriter</code> classes and the <code>printf(...)</code> methods of <code>java.io.PrintStream</code>
or <code>java.io.PrintWriter</code> classes.</p>
<h3>Noncompliant code example</h3>
<pre>
String.format("The value of my integer is %d", "Hello World");  // Noncompliant; an 'int' is expected rather than a String
String.format("Duke's Birthday year is %tX", c);  //Noncompliant; X is not a supported time conversion character
String.format("Display %0$d and then %d", 1);   //Noncompliant; arguments are numbered starting from 1
String.format("Not enough arguments %d and %d", 1);  //Noncompliant; the second argument is missing
String.format("%&lt; is equals to %d", 2);   //Noncompliant; the argument index '&lt;' refers to the previous format specifier but there isn't one

MessageFormat.format("Result {1}.", value); // Noncompliant; Not enough arguments. (first element is {0})
MessageFormat.format("Result {{0}.", value); // Noncompliant; Unbalanced number of curly brace (single curly braces should be escaped)
MessageFormat.format("Result ' {0}", value); // Noncompliant; Unbalanced number of quotes (single quote must be escaped)

java.util.logging.Logger logger;
logger.log(java.util.logging.Level.SEVERE, "Result {1}!", 14); // Noncompliant - Not enough arguments.

org.slf4j.Logger slf4jLog;
org.slf4j.Marker marker;

slf4jLog.debug(marker, "message {}"); // Noncompliant - Not enough arguments.

org.apache.logging.log4j.Logger log4jLog;
log4jLog.debug("message {}"); // Noncompliant - Not enough arguments.
</pre>
<h3>Compliant solution</h3>
<pre>
String.format("The value of my integer is %d", 3);
String.format("Duke's Birthday year is %tY", c);
String.format("Display %1$d and then %d", 1);
String.format("Not enough arguments %d and %d", 1, 2);
String.format("%d is equals to %&lt;", 2);

MessageFormat.format("Result {0}.", value);
MessageFormat.format("Result {0} &amp; {1}.", value, value);
MessageFormat.format("Result {0}.", myObject);

java.util.logging.Logger logger;
logger.log(java.util.logging.Level.SEVERE, "Result {1},{2}!", 14, 2);

org.slf4j.Logger slf4jLog;
org.slf4j.Marker marker;

slf4jLog.debug(marker, "message {}", 1);

org.apache.logging.log4j.Logger log4jLog;
log4jLog.debug("message {}", 1);
</pre></p>
            </div>
        <div class="rule">
            <h3>"wait(...)" should be used instead of "Thread.sleep(...)" when a lock is held (java:S2276)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Call <code>wait(…​)</code> on the monitor object instead of using <code>Thread.sleep(…​)</code>. While <code>wait(…​)</code> is executed, the lock
is temporarily released and hence other threads can run in the meantime.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doSomething(){
  synchronized(monitor) {
    while(notReady()){
      Thread.sleep(200); // Noncompliant, any other thread synchronizing on monitor is blocked from running while the first thread sleeps.
    }
    process();
  }
  ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void doSomething(){
  synchronized(monitor) {
    while(notReady()){
      monitor.wait(200); // Compliant, the current monitor is released.
    }
    process();
  }
  ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/YTdGBQ">CERT, LCK09-J.</a> - Do not perform operations that can block while holding a lock </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In a multithreaded environment, a thread may need to wait for a particular condition to become true. One way of pausing execution in Java is
<code>Thread.sleep(…​)</code>.</p>
<p>If a thread that holds a lock calls <code>Thread.sleep(…​)</code>, no other thread can acquire said lock. This can lead to performance and
scalability issues, in the worst case leading to deadlocks.</p></p>
            </div>
        <div class="rule">
            <h3>Method parameters should be declared with base types (java:S3242)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>For maximum reusability, methods should accept parameters with as little specialization as possible. So unless specific features from a child class
are required by a method, a type higher up the class hierarchy should be used instead.</p>
<h3>Noncompliant code example</h3>
<pre>
public void printSize(ArrayList&lt;Object&gt; list) {  // Collection can be used instead
    System.out.println(list.size());
}

public static void loop(List&lt;Object&gt; list) { // java.lang.Iterable can be used instead
   for (Object o : list) {
     o.toString();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void printSize(Collection&lt;?&gt; list) {  // Collection can be used instead
    System.out.println(list.size());
}

public static void loop(Iterable&lt;?&gt; list) { // java.lang.Iterable can be used instead
   for (Object o : list) {
     o.toString();
  }
}
</pre>
<h3>Exceptions</h3>
<p>Parameters in non-public methods are not checked, because such methods are not intended to be generally reusable. <code>java.lang.String</code>
parameters are excluded, because String is immutable and can not be always substituted for more generic type. Parameters used in any other context
than method invocation or enhanced for loop are also excluded.</p></p>
            </div>
        <div class="rule">
            <h3>"this" should not be exposed from constructors (java:S3366)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/iDdGBQ">CERT, TSM01-J.</a> - Do not let the this reference escape during object construction
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/vzdGBQ">CERT, TSM03-J.</a> - Do not publish partially initialized objects </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In single-threaded environments, the use of <code>this</code> in constructors is normal, and expected. But in multi-threaded environments, it could
expose partially-constructed objects to other threads, and should be used with caution.</p>
<p>The classic example is a class with a <code>static</code> list of its instances. If the constructor stores <code>this</code> in the list, another
thread could access the object before it’s fully-formed. Even when the storage of <code>this</code> is the last instruction in the constructor,
there’s still a danger if the class is not <code>final</code>. In that case, the initialization of subclasses won’t be complete before
<code>this</code> is exposed.</p>
<p>This rule raises an issue when <code>this</code> is assigned to any globally-visible object in a constructor, and when it is passed to the method
of another object in a constructor</p>
<h3>Noncompliant code example</h3>
<pre>
public class Monument {

  public static final List&lt;Monument&gt; ALL_MONUMENTS = new ArrayList()&lt;&gt;;
  // ...

  public Monument(String location, ...) {
    ALL_MONUMENTS.add(this);  // Noncompliant; passed to a method of another object

    this.location = location;
    // ...
  }
}
</pre>
<h3>Exceptions</h3>
<p>This rule ignores instances of assigning <code>this</code> directly to a <code>static</code> field of the same class because that case is covered
by <a href='/coding_rules#rule_key=java%3AS3010'>S3010</a> .</p></p>
            </div>
        <div class="rule">
            <h3>"ActiveMQConnectionFactory" should not be vulnerable to malicious code deserialization (java:S5301)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the application does not implement controls over the JMS object types, its clients could be able to force the deserialization of arbitrary
objects. This may lead to deserialization injection attacks.</p>
<h3>What is the potential impact?</h3>
<p>Attackers will be able to force the deserialization of arbitrary objects. This process will trigger the execution of magic unmarshalling methods on
the object and its properties. With a specially crafted serialized object, the attackers can exploit those magic methods to achieve malicious
purposes.</p>
<p>While the exact impact depends on the types available in the execution context at the time of deserialization, such an attack can generally lead to
the execution of arbitrary code on the application server.</p>
<h4>Application-specific attacks</h4>
<p>By exploiting the behavior of some of the application-defined types and objects, the attacker could manage to affect the application’s business
logic. The exact consequences will depend on the application’s nature:</p>
<ul>
  <li> Payment bypass in an e-commerce application. </li>
  <li> Privilege escalation. </li>
  <li> Unauthorized users' data access. </li>
</ul>
<h4>Publicly-known exploitation</h4>
<p>In some cases, depending on the library the application uses and their versions, there may exist publicly known deserialization attack payloads
known as <strong>gadget chains</strong>. In general, they are designed to have severe consequences, such as:</p>
<ul>
  <li> Arbitrary code execution </li>
  <li> Arbitrary file read or write </li>
  <li> Server-side request forgery </li>
</ul>
<p>Those attacks are independent of the application’s own logic and from the types it specifies.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code example is vulnerable to a deserialization injection attack because it allows the deserialization of arbitrary types from JMS
messages.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
factory.setTrustAllPackages(true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
factory.setTrustedPackages(Arrays.asList("org.mypackage1", "org.mypackage2"));
</pre>
<h3>How does this work?</h3>
<p>The noncompliant code example calls the <code>setTrustAllPackages</code> method that explicitly allows the deserialization of arbitrary types. On
the contrary, the compliant code example, thanks to the <code>setTrustedPackages</code> method, defines a short list of classes allowed for the
deserialization.</p>
<p>While defining a short list of trusted types is generally the state-of-the-art solution to avoid deserialization injection attacks, it is important
to ensure that the allowed classes and packages can not be used to exploit the issue. In that case, a vulnerability would still be present.</p>
<p>Note that ActiveMQ, starting with version 5.12.2, forces developers to explicitly list packages that JMS messages can contain. This limits the risk
of successful exploitation. In versions before that one, calling the <code>ActiveMQConnectionFactory</code> constructor without further configuration
would leave the application at risk.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Apache ActiveMQ Documentation - <a href="https://activemq.apache.org/objectmessage.html">ObjectMessage</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5254">CVE-2015-5254</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 - Category A8 - Software and Data
  Integrity Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 - Category A8 - Insecure
  Deserialization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>ActiveMQ can send/receive JMS Object messages (ObjectMessage in ActiveMQ context) to comply with JMS specifications. Internally, ActiveMQ relies on
Java’s serialization mechanism for the marshaling and unmarshalling of the messages' payload.</p>
<p>Applications should restrict the types that can be unserialized from JMS messages.</p></p>
            </div>
        <div class="rule">
            <h3>Encryption algorithms should be used with secure mode and padding scheme (java:S5542)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>For AES, the weakest mode is ECB (Electronic Codebook). Repeated blocks of data are encrypted to the same value, making them easy to identify and
reducing the difficulty of recovering the original cleartext.</p>
<p>Unauthenticated modes such as CBC (Cipher Block Chaining) may be used but are prone to attacks that manipulate the ciphertext. They must be used
with caution.</p>
<p>For RSA, the weakest algorithms are either using it without padding or using the PKCS1v1.5 padding scheme.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate possible impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>Example with a symmetric cipher, AES:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("AES/CBC/PKCS5Padding"); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<p>Example with an asymmetric cipher, RSA:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("RSA/None/NoPadding"); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<p>For the AES symmetric cipher, use the GCM mode:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("AES/GCM/NoPadding");
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<p>For the RSA asymmetric cipher, use the Optimal Asymmetric Encryption Padding (OAEP):</p>
<pre data-diff-id="2" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher.getInstance("RSA/ECB/OAEPWITHSHA-256ANDMGF1PADDING");
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic community.</p>
<p>Appropriate choices are currently the following.</p>
<h4>For AES: use authenticated encryption modes</h4>
<p>The best-known authenticated encryption mode for AES is Galois/Counter mode (GCM).</p>
<p>GCM mode combines encryption with authentication and integrity checks using a cryptographic hash function and provides both confidentiality and
authenticity of data.</p>
<p>Other similar modes are:</p>
<ul>
  <li> CCM: <code>Counter with CBC-MAC</code> </li>
  <li> CWC: <code>Cipher Block Chaining with Message Authentication Code</code> </li>
  <li> EAX: <code>Encrypt-and-Authenticate</code> </li>
  <li> IAPM: <code>Integer Authenticated Parallelizable Mode</code> </li>
  <li> OCB: <code>Offset Codebook Mode</code> </li>
</ul>
<p>It is also possible to use AES-CBC with HMAC for integrity checks. However, it is considered more straightforward to use AES-GCM directly
instead.</p>
<h4>For RSA: use the OAEP scheme</h4>
<p>The Optimal Asymmetric Encryption Padding scheme (OAEP) adds randomness and a secure hash function that strengthens the regular inner workings of
RSA.</p></p>
            </div>
        <div class="rule">
            <h3>Cipher algorithms should be robust (java:S5547)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communication in various domains. They are used for
several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<h3>What is the potential impact?</h3>
<p>The cleartext of an encrypted message might be recoverable. Additionally, it might be possible to modify the cleartext of an encrypted message.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By using a weak algorithm the likelihood that an attacker might be able to recover the cleartext drastically increases.</p>
<h4>Additional attack surface</h4>
<p>By modifying the cleartext of the encrypted message it might be possible for an attacker to trigger other vulnerabilities in the code. Encrypted
values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of algorithms that are not considered highly resistant to cryptanalysis and thus should be avoided.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher des = Cipher.getInstance("DES"); // Noncompliant
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.crypto.Cipher;
import java.security.NoSuchAlgorithmException;
import javax.crypto.NoSuchPaddingException;

public static void main(String[] args) {
    try {
        Cipher aes = Cipher.getInstance("AES/GCM/NoPadding");
    } catch(NoSuchAlgorithmException|NoSuchPaddingException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<h4>Use a secure algorithm</h4>
<p>It is highly recommended to use an algorithm that is currently considered secure by the cryptographic community. A common choice for such an
algorithm is the Advanced Encryption Standard (AES).</p>
<p>For block ciphers, it is not recommended to use algorithms with a block size that is smaller than 128 bits.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222396">Application Security and
  Development: V-222396</a> - The application must implement DoD-approved encryption to protect the confidentiality of remote access sessions. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability makes it possible that the cleartext of the encrypted message might be recoverable without prior knowledge of the key.</p></p>
            </div>
        <div class="rule">
            <h3>Simple string literal should be used for single line strings (java:S5663)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/378">JEP 378: Text Blocks</a> </li>
  <li> <a href="https://openjdk.org/projects/amber/guides/text-blocks-guide">Programmer’s Guide To Text Blocks</a>, by Jim Laskey and Stuart Marks
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>If a string fits on a single line, without concatenation and escaped newlines, you should probably continue to use a string literal.</p>
<h3>Noncompliant code example</h3>
<pre>
String question = """
              What's the point, really?""";
</pre>
<h3>Compliant solution</h3>
<pre>
String question = "What's the point, really?";
</pre></p>
            </div>
        <div class="rule">
            <h3>Whitespace for text block indent should be consistent (java:S5664)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/378">JEP 378: Text Blocks</a> </li>
  <li> <a href="https://openjdk.org/projects/amber/guides/text-blocks-guide">Programmer’s Guide To Text Blocks</a>, by Jim Laskey and Stuart Marks
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Either use only spaces or only tabs for the indentation of a text block. Mixing white space will lead to a result with irregular indentation.</p>
<h3>Noncompliant code example</h3>
<pre>
String textBlock = """
        this is
&lt;tab&gt;text block!
        !!!!
      """;
</pre>
<h3>Compliant solution</h3>
<pre>
String textBlock = """
        this is
        text block!
        !!!!
      """;
</pre></p>
            </div>
        <div class="rule">
            <h3>Escape sequences should not be used in text blocks (java:S5665)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/378">JEP 378: Text Blocks</a> </li>
  <li> <a href="https://openjdk.org/projects/amber/guides/text-blocks-guide">Programmer’s Guide To Text Blocks</a>, by Jim Laskey and Stuart Marks
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The use of escape sequences is mostly unnecessary in text blocks.</p>
<h3>Noncompliant code example</h3>
<p><code>\n</code> can be replaced by simply introducing the newline, <code>\"\"\"</code> it is sufficient to escape only the first qoute.</p>
<pre>
String textBlock = """
        \"\"\" this \nis
        text  block!
        !!!!
      """;
</pre>
<h3>Compliant solution</h3>
<pre>
String textBlock = """
        \""" this
        is
        text  block!
        !!!!
      """;
</pre></p>
            </div>
        <div class="rule">
            <h3>Vararg method arguments should not be confusing (java:S5669)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Passing single <code>null</code> or primitive array argument to the variable arity method may not work as expected. In the case of
<code>null</code>, it is not passed as array with single element, but the argument itself is <code>null</code>. In the case of a primitive array, if
the formal parameter is <code>Object...</code>, it is passed as a single element array. This may not be obvious to someone not familiar with such
corner cases, and it is probably better to avoid such ambiguities by explicitly casting the argument to the desired type.</p>
<h3>Noncompliant code example</h3>
<pre>
class A {
  public static void main(String[] args) {
    vararg(null);  // Noncompliant, prints "null"
    int[] arr = {1,2,3};
    vararg(arr);  // Noncompliant, prints "length: 1"
  }

  static void vararg(Object... s) {
    if (s == null) {
      System.out.println("null");
    } else {
      System.out.println("length: " + s.length);
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class A {
  public static void main(String[] args) {
    vararg((Object) null); // prints 1
    Object[] arr = {1,2,3};
    vararg(arr); // prints 3
  }

  static void vararg(Object... s) {
    if (s == null) {
      System.out.println("null"); // not reached
    } else {
      System.out.println("length: " + s.length);
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Only one method invocation is expected when testing checked exceptions (java:S5783)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When verifying that code raises an exception, a good practice is to avoid having multiple method calls inside the tested code, to be explicit about
what is exactly tested.</p>
<p>When two of the methods can raise the same <strong>checked</strong> exception, not respecting this good practice is a bug, since it is not possible
to know what is really tested.</p>
<p>You should make sure that only one method can raise the expected checked exception in the tested code.</p>
<h3>Noncompliant code example</h3>
<pre>
@Test
public void testG() {
  // Do you expect g() or f() throwing the exception?
  assertThrows(IOException.class, () -&gt; g(f(1)) ); // Noncompliant
}

@Test
public void testGTryCatchIdiom() {
  try { // Noncompliant
    g(f(1));
    Assert.fail("Expected an IOException to be thrown");
  } catch (IOException e) {
    // Test exception message...
  }
}

int f(int x) throws IOException {
  // ...
}

int g(int x) throws IOException {
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Test
public void testG() {
  int y = f(1);
  // It is explicit that we expect an exception from g() and not f()
  assertThrows(IOException.class, () -&gt; g(y) );
}

@Test
public void testGTryCatchIdiom() {
  int y = f(1);
  try {
    g(y);
    Assert.fail("Expected an IOException to be thrown");
  } catch (IOException e) {
    // Test exception message...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>JUnit5 test classes and methods should have default package visibility (java:S5786)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>You can simply change the visibility by removing the <code>public</code> or <code>protected</code> keywords.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.junit.jupiter.api.Test;

public class MyClassTest { // Noncompliant - modifier can be removed
  @Test
  protected void test() { // Noncompliant - modifier can be removed
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.junit.jupiter.api.Test;

class MyClassTest {
  @Test
  void test() {
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-classes-and-methods">JUnit5 User Guide: Test Classes and Methods</a>
  </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>JUnit5 test classes and methods should generally have package visibility. To fix this issue, change their visibility to the default package
visibility.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>JUnit5 is more tolerant regarding the visibility of test classes and methods than JUnit4, which required everything to be <code>public</code>. Test
classes and methods can have any visibility except <code>private</code>. It is however recommended to use the default package visibility to improve
readability.</p>
<blockquote>
  <p>Test classes, test methods, and lifecycle methods are not required to be <code>public</code>, but they must not be <code>private</code>.</p>
  <p>It is generally recommended to omit the public modifier for test classes, test methods, and lifecycle methods unless there is a technical reason
  for doing so – for example, when a test class is extended by a test class in another package. Another technical reason for making classes and
  methods public is to simplify testing on the module path when using the Java Module System.</p>
</blockquote>  — JUnit5 User Guide
<h3>What is the potential impact?</h3>
<p>The code will be non-conventional and readability can be slightly affected.</p>
<h3>Exceptions</h3>
<p>This rule does not raise an issue when the visibility is set to <code>private</code>, because <code>private</code> test methods and classes are
systematically ignored by JUnit5, without a proper warning. In this case, there is also an impact on reliability and so it is handled by the rule
<a href='/coding_rules#rule_key=java%3AS5810'>S5810</a>.</p></p>
            </div>
        <div class="rule">
            <h3>Case insensitive string comparisons should be made without intermediate upper or lower casing (java:S1157)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using <code>toLowerCase()</code> or <code>toUpperCase()</code> to make case insensitive comparisons is inefficient because it requires the creation
of temporary, intermediate <code>String</code> objects.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
private void compareStrings(String foo, String bar){
    boolean result1 = foo.toUpperCase().equals(bar);               // Noncompliant
    boolean result2 = foo.equals(bar.toUpperCase());               // Noncompliant
    boolean result3 = foo.toLowerCase().equals(bar.toLowerCase()); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
private void compareStrings(String foo, String bar){
    boolean result1 = foo.equalsIgnoreCase(bar);                    // Compliant
}
</pre>
<h3>Exceptions</h3>
<p>No issue will be raised when a locale is specified because the result could be different from <code>equalsIgnoreCase()</code>. (e.g.: using the
Turkish locale)</p>
<pre>
private void compareStrings(String foo, String bar, java.util.Locale locale){
    boolean result1 = foo.toUpperCase(locale).equals(bar);         // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Primitive wrappers should not be instantiated only for "toString" or "compareTo" calls (java:S1158)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Creating temporary primitive wrapper objects only for <code>String</code> conversion or the use of the <code>compareTo()</code> method is
inefficient.</p>
<p>Instead, the static <code>toString()</code> or <code>compare()</code> method of the primitive wrapper class should be used.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
private int isZero(int value){
    return Integer.valueOf(value).compareTo(0); // Noncompliant
}
private String convert(int value){
    return Integer.valueOf(value).toString(); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
private int isZero(int value){
    return Integer.compare(value, 0); // Compliant
}
private String convert(int value){
    return Integer.toString(value); // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Throwable and Error should not be caught (java:S1181)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/396">CWE-396 - Declaration of Catch for Generic Exception</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/ERR08-J.+Do+not+catch+NullPointerException+or+any+of+its+ancestors">CERT,
  ERR08-J.</a> - Do not catch NullPointerException or any of its ancestors </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>Throwable</code> is the superclass of all errors and exceptions in Java. <code>Error</code> is the superclass of all errors, which are not
meant to be caught by applications.</p>
<p>Catching either <code>Throwable</code> or <code>Error</code> will also catch <code>OutOfMemoryError</code> and <code>InternalError</code>, from
which an application should not attempt to recover.</p>
<h3>Noncompliant code example</h3>
<pre>
try { /* ... */ } catch (Throwable t) { /* ... */ }
try { /* ... */ } catch (Error e) { /* ... */ }
</pre>
<h3>Compliant solution</h3>
<pre>
try { /* ... */ } catch (RuntimeException e) { /* ... */ }
try { /* ... */ } catch (MyException e) { /* ... */ }
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes that override "clone" should be "Cloneable" and call "super.clone()" (java:S1182)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/580">CWE-580 - clone() Method Without super.clone()</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/FjZGBQ">CERT, MET53-J.</a> - Ensure that the clone() method calls super.clone() </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>Cloneable</code> is the marker <code>Interface</code> that indicates that <code>clone()</code> may be called on an object. Overriding
<code>clone()</code> without implementing <code>Cloneable</code> can be helpful if you want to control how subclasses clone themselves, but otherwise,
it’s probably a mistake.</p>
<p>The usual convention for <code>Object.clone()</code> according to Oracle’s Javadoc is:</p>
<ol>
  <li> <code>x.clone() != x</code> </li>
  <li> <code>x.clone().getClass() == x.getClass()</code> </li>
  <li> <code>x.clone().equals(x)</code> </li>
</ol>
<p>Obtaining the object that will be returned by calling <code>super.clone()</code> helps to satisfy those invariants:</p>
<ol>
  <li> <code>super.clone()</code> returns a new object instance </li>
  <li> <code>super.clone()</code> returns an object of the same type as the one <code>clone()</code> was called on </li>
  <li> <code>Object.clone()</code> performs a shallow copy of the object’s state. </li>
</ol></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ensure that the <code>clone()</code> method calls <code>super.clone()</code> and implement <code>Cloneable</code> in the class or remove the clone
method.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class BaseClass {  // Noncompliant - should implement Cloneable
  @Override
  public Object clone() throws CloneNotSupportedException {    // Noncompliant - should return the super.clone() instance
    return new BaseClass();
  }
}

class DerivedClass extends BaseClass implements Cloneable {
  /* Does not override clone() */

  public void sayHello() {
    System.out.println("Hello, world!");
  }
}

class Application {
  public static void main(String[] args) throws Exception {
    DerivedClass instance = new DerivedClass();
    ((DerivedClass) instance.clone()).sayHello();              // Throws a ClassCastException because invariant #2 is violated
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class BaseClass implements Cloneable {
  @Override
  public Object clone() throws CloneNotSupportedException {    // Compliant
    return super.clone();
  }
}

class DerivedClass extends BaseClass implements Cloneable {
  /* Does not override clone() */

  public void sayHello() {
    System.out.println("Hello, world!");
  }
}

class Application {
  public static void main(String[] args) throws Exception {
    DerivedClass instance = new DerivedClass();
    ((DerivedClass) instance.clone()).sayHello();              // Displays "Hello, world!" as expected. Invariant #2 is satisfied
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Double.longBitsToDouble" should take "long" as argument (java:S2127)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>Double.longBitsToDouble</code> converts the bit pattern into its corresponding floating-point representation. The method expects a 64-bit
long argument to interpret the bits as a double value correctly.</p>
<p>When the argument is a smaller data type, the cast to <code>long</code> may lead to a different value than expected due to the interpretation of
the most significant bit, which, in turn, results in <code>Double.longBitsToDouble</code> returning an incorrect value.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
int i = 0x80003800;
Double.longBitsToDouble(i);   // Noncompliant - NaN
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
long i = 0x80003800L;
Double.longBitsToDouble(i);   // Compliant - 1.0610049784E-314
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Double.html#doubleToLongBits(double)">Oracle Java SE -
  Double.doubleToLongBits</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">Wikipedia - Double Precision floating point format</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Single-precision_floating-point_format">Wikipedia - Single Precision floating point format</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"runFinalizersOnExit" should not be called (java:S2151)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/4jZGBQ">CERT, MET12-J.</a> - Do not use finalizers </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Enabling <code>runFinalizersOnExit</code> is unsafe as it might result in erratic behavior and deadlocks on application exit.</p>
<p>Indeed, finalizers might be force-called on live objects while other threads are concurrently manipulating them.</p>
<p>Instead, if you want to execute something when the virtual machine begins its shutdown sequence, you should attach a shutdown hook.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public static void main(String [] args) {
  System.runFinalizersOnExit(true);  // Noncompliant
}

protected void finalize(){
  doShutdownOperations();
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public static void main(String [] args) {
  Thread myThread = new Thread( () -&gt; { doShutdownOperations(); });
  Runtime.getRuntime().addShutdownHook(myThread);
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Using pseudorandom number generators (PRNGs) is security-sensitive (java:S2245)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a cryptographically secure pseudo random number generator (CSPRNG) like "java.security.SecureRandom" in place of a non-cryptographic PRNG.
  </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
SecureRandom random = new SecureRandom();
byte bytes[] = new byte[20];
random.nextBytes(bytes);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation">Secure
  Random Number Generation Cheat Sheet</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/oTdGBQ">CERT, MSC02-J.</a> - Generate strong random numbers </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>PRNGs are algorithms that produce sequences of numbers that only approximate true randomness. While they are suitable for applications like
simulations or modeling, they are not appropriate for security-sensitive contexts because their outputs can be predictable if the internal state is
known.</p>
<p>In contrast, cryptographically secure pseudorandom number generators (CSPRNGs) are designed to be secure against prediction attacks. CSPRNGs use
cryptographic algorithms to ensure that the generated sequences are not only random but also unpredictable, even if part of the sequence or the
internal state becomes known. This unpredictability is crucial for security-related tasks such as generating encryption keys, tokens, or any other
values that must remain confidential and resistant to guessing attacks.</p>
<p>For example, the use of non-cryptographic PRNGs has led to vulnerabilities such as:</p>
<ul>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information. Therefore, it is critical to use CSPRNGs in any
security-sensitive application to ensure the robustness and security of the system.</p>
<p>As the <code>java.util.Random</code> class relies on a non-cryptographic pseudorandom number generator, this class and relating
<code>java.lang.Math.random()</code> method should not be used for security-critical applications or for protecting sensitive data. In such context,
the <code>java.security.SecureRandom</code> class which relies on a CSPRNG should be used in place.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>PRNGs are algorithms that produce sequences of numbers that only approximate true randomness. While they are suitable for applications like
simulations or modeling, they are not appropriate for security-sensitive contexts because their outputs can be predictable if the internal state is
known.</p>
<p>In contrast, cryptographically secure pseudorandom number generators (CSPRNGs) are designed to be secure against prediction attacks. CSPRNGs use
cryptographic algorithms to ensure that the generated sequences are not only random but also unpredictable, even if part of the sequence or the
internal state becomes known. This unpredictability is crucial for security-related tasks such as generating encryption keys, tokens, or any other
values that must remain confidential and resistant to guessing attacks.</p>
<p>For example, the use of non-cryptographic PRNGs has led to vulnerabilities such as:</p>
<ul>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-6386">CVE-2013-6386</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-3419">CVE-2006-3419</a> </li>
  <li> <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4102">CVE-2008-4102</a> </li>
</ul>
<p>When software generates predictable values in a context requiring unpredictability, it may be possible for an attacker to guess the next value that
will be generated, and use this guess to impersonate another user or access sensitive information. Therefore, it is critical to use CSPRNGs in any
security-sensitive application to ensure the robustness and security of the system.</p>
<p>As the <code>java.util.Random</code> class relies on a non-cryptographic pseudorandom number generator, this class and relating
<code>java.lang.Math.random()</code> method should not be used for security-critical applications or for protecting sensitive data. In such context,
the <code>java.security.SecureRandom</code> class which relies on a CSPRNG should be used in place.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use is a non-cryptographic PRNG. </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a cryptographically secure pseudo random number generator (CSPRNG) like "java.security.SecureRandom" in place of a non-cryptographic PRNG.
  </li>
  <li> Use the generated random values only once. </li>
  <li> You should not expose the generated random value. If you have to store it, make sure that the database or file is secure. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
Random random = new Random(); // Sensitive use of Random
byte bytes[] = new byte[20];
random.nextBytes(bytes); // Check if bytes is used for hashing, encryption, etc...
</pre>
<h2>Compliant Solution</h2>
<pre>
SecureRandom random = new SecureRandom();
byte bytes[] = new byte[20];
random.nextBytes(bytes);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#secure-random-number-generation">Secure
  Random Number Generation Cheat Sheet</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/338">CWE-338 - Use of Cryptographically Weak Pseudo-Random Number Generator (PRNG)</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1241">CWE-1241 - Use of Predictable Algorithm in Random Number Generator</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/oTdGBQ">CERT, MSC02-J.</a> - Generate strong random numbers </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#PREDICTABLE_RANDOM">Predictable Pseudo Random Number
  Generator</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> the code using the generated value requires it to be unpredictable. It is the case for all encryption mechanisms or when a secret value, such
  as a password, is hashed. </li>
  <li> the function you use is a non-cryptographic PRNG. </li>
  <li> the generated value is used multiple times. </li>
  <li> an attacker can access the generated value. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
Random random = new Random(); // Sensitive use of Random
byte bytes[] = new byte[20];
random.nextBytes(bytes); // Check if bytes is used for hashing, encryption, etc...
</pre>
</p>
            </div>
        <div class="rule">
            <h3>"Iterator.next()" methods should throw "NoSuchElementException" (java:S2272)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>java.util.Iterator.next()</code> method must throw a <code>NoSuchElementException</code> when there are no more elements in the
iteration. Any other behavior is non-compliant with the API contract and may cause unexpected behavior for users.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyIterator implements Iterator&lt;String&gt; {
  public String next() {
    if (!hasNext()) {
      return null;
    }
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyIterator implements Iterator&lt;String&gt; {
  public String next() {
    if (!hasNext()) {
      throw new NoSuchElementException();
    }
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Iterator.html#next--">Java SE 7 API Specification: Iterator</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"Object.wait()", "Object.notify()" and "Object.notifyAll()" should only be called from synchronized code (java:S2273)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>To become the owner of an object’s monitor Java provides the <code>synchronized</code> keyword. In other words, calling
<code>Object.wait(…​)</code>, <code>Object.notify()</code> and <code>Object.notifyAll()</code> on a given object should only be done from code
synchronized on the same object.</p>
<p>For example, the call to <code>someObject.wait(…​)</code> should be wrapped in a <code>synchronized(someObject){ …​ }</code> block. If
<code>wait</code> or <code>notify</code> are invoked on <code>this</code>, then the entire method can be marked as <code>synchronized</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
private void performSomeAction(Object syncValue) {
  while (!suitableCondition()){
    syncValue.wait(); // Noncompliant, not being inside a `synchronized` block, this will raise an IllegalMonitorStateException
  }
  ... // Perform some action
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
private void performSomeAction(Object syncValue) {
  synchronized(syncValue) {
    while (!suitableCondition()){
      syncValue.wait(); // Compliant, the `synchronized` block guarantees ownership of syncValue's monitor
    }
    ... // Perform some action
  }
}
</pre>
<h2>References</h2>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html">Java Documentation</a> - Synchronized methods </li>
  <li> <a href="https://docs.oracle.com/javase%2F7%2Fdocs%2Fapi%2F%2F/java/lang/Object.html#wait()">Java Documentation</a> - java.lang.Object class
  and its methods </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Object.wait(…​)</code>, <code>Object.notify()</code> and <code>Object.notifyAll()</code> methods are used in multithreaded environments
to coordinate interdependent tasks that are performed by different threads. These methods are not thread-safe and by contract, they require the
invoking <code>Thread</code> to own the object’s monitor. If a thread invokes one of these methods without owning the object’s monitor an
<code>IllegalMonitorStateException</code> is thrown.</p></p>
            </div>
        <div class="rule">
            <h3>Classes should not access their own subclasses during class initialization (java:S2390)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Referencing a static member of a subclass from its parent during class initialization, makes the code more fragile and prone to future bugs. The
execution of the program will rely heavily on the order of initialization of classes and their static members.</p>
<h3>What is the potential impact?</h3>
<p>This could create what is known as an "initialization cycle", or even a deadlock in some extreme cases. Additionally, if the order of the static
class members is changed, the behavior of the program might change. These issues can be very hard to diagnose so it is highly recommended to avoid
creating this kind of dependencies.</p>
<h3>Noncompliant code example</h3>
<pre>
class Parent {
  static int field1 = Child.method(); // Noncompliant
  static int field2 = 42;

  public static void main(String[] args) {
    System.out.println(Parent.field1); // will display "0" instead of "42"
  }
}

class Child extends Parent {
  static int method() {
    return Parent.field2;
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/display/java/DCL00-J.+Prevent+class+initialization+cycles">DCL00-J. Prevent class
  initialization cycles</a> </li>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-12.html#jls-12.4">Section 12.4: Initialization of Classes and Interfaces</a> -
  Java Language Specification </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Static non-final field names should comply with a naming convention (java:S3008)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://www.oreilly.com/library/view/java-8-pocket/9781491901083/ch01.html">O’Reilly - Java 8 in pocket - Naming Conventions</a> </li>
  <li> <a href="https://www.educative.io/answers/what-are-the-naming-conventions-in-java">Educative - Naming conventions in Java</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The Java Language Specification defines a set of rules called naming conventions that apply to Java programs. These conventions provide
recommendations for naming packages, classes, methods, and variables.</p>
<p>By following shared naming conventions, teams can collaborate more efficiently.</p>
<p>This rule checks that static non-final field names match a provided regular expression.</p>
<h3>Noncompliant code example</h3>
<p>The default regular expression applied by the rule is <code>^[a-z][a-zA-Z0-9]*$</code>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
   private static String foo_bar; // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
   private static String fooBar;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Format strings should be used correctly (java:S3457)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>printf-</code>-style format string is a string that contains placeholders, usually represented by special characters such as "%s" or "{}",
depending on the technology in use. These placeholders are replaced by values when the string is printed or logged.</p>
<p>Because <code>printf</code>-style format strings are interpreted at runtime, rather than validated by the compiler, they can contain errors that
result in the wrong strings being created.</p>
<p>This rule checks whether every format string specifier can be correctly matched with one of the additional arguments when calling the following
methods:</p>
<ul>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#format-java.lang.String-java.lang.Object…​-"><code>java.lang.String#format</code></a> </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html#format-java.lang.String-java.lang.Object…​-"><code>java.util.Formatter#format</code></a> </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/io/PrintStream.html#format-java.lang.String-java.lang.Object…​-"><code>java.io.PrintStream#format</code></a> </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/text/MessageFormat.html#format-java.lang.String-java.lang.Object…​-"><code>java.text.MessageFormat#format</code></a> </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/io/PrintWriter.html#format-java.lang.String-java.lang.Object…​-"><code>java.io.PrintWriter#format</code></a> </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/io/PrintStream.html#printf-java.lang.String-java.lang.Object…​-"><code>java.io.PrintStream#printf</code></a> </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/io/PrintWriter.html#printf-java.lang.String-java.lang.Object…​-"><code>java.io.PrintWriter#printf</code></a> </li>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/String.html#formatted(java.lang.Object…​)"><code>java.lang.String#formatted</code></a> (since Java 15) </li>
  <li> logging methods of <a href="https://www.slf4j.org/api/org/slf4j/Logger.html"><code>org.slf4j.Logger</code></a>, <a
  href="https://docs.oracle.com/javase/8/docs/api/java/util/logging/Logger.html"><code>java.util.logging.Logger</code></a>, <a
  href="https://logging.apache.org/log4j/2.x/javadoc/log4j-api/org/apache/logging/log4j/Logger.html"><code>org.apache.logging.log4j.Logger</code></a>.
  </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/J9YxBQ">CERT, FIO47-C.</a> - Use valid format strings </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/text/MessageFormat.html">java.text.MessageFormat</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>A <code>printf-</code>-style format string is a string that contains placeholders, which are replaced by values when the string is printed or
logged. Mismatch in the format specifiers and the arguments provided can lead to incorrect strings being created.</p>
<p>To avoid issues, a developer should ensure that the provided arguments match format specifiers.</p>
<p>Note that <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/text/MessageFormat.html">MessageFormat</a> is used by most
logging mechanisms, for example <code>java.util.logging.Logger</code>, thus the <em>single quote</em> must be escaped by a <em>double single
quote</em>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void logging(org.slf4j.Logger slf4jLog, java.util.logging.Logger logger) {
    String.format("Too many arguments %d and %d", 1, 2, 3); // Noncompliant - the third argument '3' is unused
    String.format("First {0} and then {1}", "foo", "bar");  //Noncompliant - it appears there is confusion with the use of "java.text.MessageFormat" - parameters "foo" and "bar" will be ignored here


    slf4jLog.debug("The number: ", 1); // Noncompliant - String contains no format specifiers.

    logger.log(level, "Can't load library \"{0}\"!", "foo"); // Noncompliant - the single quote ' must be escaped
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void logging(org.slf4j.Logger slf4jLog, java.util.logging.Logger logger) {
    String.format("Too many arguments %d and %d", 1, 2);
    String.format("First %s and then %s", "foo", "bar");

    slf4jLog.debug("The number: {}", 1);

    logger.log(level, "Can''t load library \"{0}\"!", "foo");
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Test methods should comply with a naming convention (java:S3578)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared naming conventions allow teams to collaborate efficiently. This rule raises an issue when a test method name does not match the provided
regular expression.</p>
<h3>Noncompliant code example</h3>
<p>With the default value: <code>^test[A-Z][a-zA-Z0-9]*$</code></p>
<pre>
@Test
public void foo() {  // Noncompliant
  //...
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Test
public void testFoo() {
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Weak SSL/TLS protocols should not be used (java:S4423)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability exposes encrypted data to a number of attacks whose goal is to recover the plaintext.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        SSLContext.getInstance("TLSv1.1"); // Noncompliant
    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.net.ssl.SSLContext;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        SSLContext.getInstance("TLSv1.2");
    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>For these reasons, as soon as cryptography is included in a project, it is important to choose encryption algorithms that are considered strong and
secure by the cryptography community.</p>
<p>To provide communication security over a network, SSL and TLS are generally used. However, it is important to note that the following protocols are
all considered weak by the cryptographic community, and are officially deprecated:</p>
<ul>
  <li> SSL versions 1.0, 2.0 and 3.0 </li>
  <li> TLS versions 1.0 and 1.1 </li>
</ul>
<p>When these unsecured protocols are used, it is best practice to expect a breach: that a user or organization with malicious intent will perform
mathematical attacks on this data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
import okhttp3.ConnectionSpec;
import okhttp3.TlsVersion;

public static void main(String[] args) {
    new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
          .tlsVersions(TlsVersion.TLS_1_1) // Noncompliant
          .build();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
import okhttp3.ConnectionSpec;
import okhttp3.TlsVersion;

public static void main(String[] args) {
    new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
          .tlsVersions(TlsVersion.TLS_1_2)
          .build();
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, by default you should use the cryptographic algorithms and mechanisms that are considered strong by the cryptographic
community.</p>
<p>The best choices at the moment are the following.</p>
<h4>Use TLS v1.2 or TLS v1.3</h4>
<p>Even though TLS V1.3 is available, using TLS v1.2 is still considered good and secure practice by the cryptography community.<br></p>
<p>The use of TLS v1.2 ensures compatibility with a wide range of platforms and enables seamless communication between different systems that do not
yet have TLS v1.3 support.</p>
<p>The only drawback depends on whether the framework used is outdated: its TLS v1.2 settings may enable older and insecure cipher suites that are
deprecated as insecure.</p>
<p>On the other hand, TLS v1.3 removes support for older and weaker cryptographic algorithms, eliminates known vulnerabilities from previous TLS
versions, and improves performance.</p></p>
            </div>
        <div class="rule">
            <h3>Cryptographic keys should be robust (java:S4426)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Encryption algorithms are essential for protecting sensitive information and ensuring secure communications in a variety of domains. They are used
for several important reasons:</p>
<ul>
  <li> Confidentiality, privacy, and intellectual property protection </li>
  <li> Security during transmission or on storage devices </li>
  <li> Data integrity, general trust, and authentication </li>
</ul>
<p>When selecting encryption algorithms, tools, or combinations, you should also consider two things:</p>
<ol>
  <li> No encryption is unbreakable. </li>
  <li> The strength of an encryption algorithm is usually measured by the effort required to crack it within a reasonable time frame. </li>
</ol>
<p>In today’s cryptography, the length of the <strong>key</strong> directly affects the security level of cryptographic algorithms.</p>
<p>Note that depending on the algorithm, the term <strong>key</strong> refers to a different mathematical property. For example:</p>
<ul>
  <li> For RSA, the key is the product of two large prime numbers, also called the <strong>modulus</strong>. </li>
  <li> For AES and Elliptic Curve Cryptography (ECC), the key is only a sequence of randomly generated bytes.
    <ul>
      <li> In some cases, AES keys are derived from a master key or a passphrase using a Key Derivation Function (KDF) like PBKDF2 (Password-Based Key
      Derivation Function 2) </li>
    </ul>  </li>
</ul>
<p>If an application uses a key that is considered short and <strong>insecure</strong>, the encrypted data is exposed to attacks aimed at getting at
the plaintext.</p>
<p>In general, it is best practice to expect a breach: that a user or organization with malicious intent will perform cryptographic attacks on this
data after obtaining it by other means.</p>
<h3>What is the potential impact?</h3>
<p>After retrieving encrypted data and performing cryptographic attacks on it on a given timeframe, attackers can recover the plaintext that
encryption was supposed to protect.</p>
<p>Depending on the recovered data, the impact may vary.</p>
<p>Below are some real-world scenarios that illustrate the potential impact of an attacker exploiting the vulnerability.</p>
<h4>Additional attack surface</h4>
<p>By modifying the plaintext of the encrypted message, an attacker may be able to trigger additional vulnerabilities in the code. An attacker can
further exploit a system to obtain more information.<br> Encrypted values are often considered trustworthy because it would not be possible for a
third party to modify them under normal circumstances.</p>
<h4>Breach of confidentiality and privacy</h4>
<p>When encrypted data contains personal or sensitive information, its retrieval by an attacker can lead to privacy violations, identity theft,
financial loss, reputational damage, or unauthorized access to confidential systems.</p>
<p>In this scenario, the company, its employees, users, and partners could be seriously affected.</p>
<p>The impact is twofold, as data breaches and exposure of encrypted data can undermine trust in the organization, as customers, clients and
stakeholders may lose confidence in the organization’s ability to protect their sensitive data.</p>
<h4>Legal and compliance issues</h4>
<p>In many industries and locations, there are legal and compliance requirements to protect sensitive data. If encrypted data is compromised and the
plaintext can be recovered, companies face legal consequences, penalties, or violations of privacy laws.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability exposes encrypted data to attacks whose goal is to recover the plaintext.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> Documentation
    <ul>
      <li> NIST Documentation - <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-186.pdf">NIST SP 800-186: Recommendations
      for Discrete Logarithm-based Cryptography: Elliptic Curve Domain Parameters</a> </li>
      <li> IETF - <a href="https://datatracker.ietf.org/doc/html/rfc5639">rfc5639: Elliptic Curve Cryptography (ECC) Brainpool Standard Curves and
      Curve Generation</a> </li>
    </ul>  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://learn.microsoft.com/en-us/dotnet/standard/security/vulnerabilities-cbc-mode">Microsoft, Timing vulnerabilities with CBC-mode
  symmetric decryption using padding</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Padding_oracle_attack">Wikipedia, Padding Oracle Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-ciphertext_attack">Wikipedia, Chosen-Ciphertext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Chosen-plaintext_attack">Wikipedia, Chosen-Plaintext Attack</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Semantic_security">Wikipedia, Semantically Secure Cryptosystems</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Optimal_asymmetric_encryption_padding">Wikipedia, OAEP</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Galois/Counter_Mode">Wikipedia, Galois/Counter Mode</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-131Ar1.pdf">NIST 800-131A</a> - Recommendation for Transitioning the
  Use of Cryptographic Algorithms and Key Lengths </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/326">CWE-326 - Inadequate Encryption Strength</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/hDdGBQ">CERT, MSC61-J.</a> - Do not use insecure or weak cryptographic algorithms </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code examples either explicitly or implicitly generate keys. Note that there are differences in the size of the keys depending on the
algorithm.</p>
<p>Due to the mathematical properties of the algorithms, the security requirements for the key size vary depending on the algorithm.<br> For example,
a 256-bit ECC key provides about the same level of security as a 3072-bit RSA key and a 128-bit symmetric key.</p>
<h4>Noncompliant code example</h4>
<p>Here is an example of a private key generation with RSA:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(1024); // Noncompliant

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<p>Here is an example of a private key generation with AES:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
import java.security.KeyGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyGenerator keyGenerator = KeyGenerator.getInstance("AES");
        keyGenerator.initialize(64); // Noncompliant

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<p>Here is an example of an Elliptic Curve (EC) initialization. It implicitly generates a private key whose size is indicated in the elliptic curve
name:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator    = KeyPairGenerator.getInstance("EC");
        ECGenParameterSpec ellipticCurveName = new ECGenParameterSpec("secp112r1"); // Noncompliant
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (NoSuchAlgorithmException | InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");
        keyPairGenerator.initialize(2048);

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("AES");
        keyPairGenerator.initialize(128);

    } catch (NoSuchAlgorithmException e) {
        // ...
    }
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
import java.security.KeyPairGenerator;
import java.security.NoSuchAlgorithmException;
import java.security.InvalidAlgorithmParameterException;
import java.security.spec.ECGenParameterSpec;

public static void main(String[] args) {
    try {
        KeyPairGenerator keyPairGenerator    = KeyPairGenerator.getInstance("EC");
        ECGenParameterSpec ellipticCurveName = new ECGenParameterSpec("secp256r1");
        keyPairGenerator.initialize(ellipticCurveName);

    } catch (NoSuchAlgorithmException | InvalidAlgorithmParameterException e) {
        // ...
    }
}
</pre>
<h3>How does this work?</h3>
<p>As a rule of thumb, use the cryptographic algorithms and mechanisms that are considered strong by the cryptography community.</p>
<p>The appropriate choices are the following.</p>
<h4>RSA (Rivest-Shamir-Adleman) and DSA (Digital Signature Algorithm)</h4>
<p>The security of these algorithms depends on the difficulty of attacks attempting to solve their underlying mathematical problem.</p>
<p>In general, a minimum key size of <strong>2048</strong> bits is recommended for both. It provides 112 bits of security. A key length of
<strong>3072</strong> or <strong>4096</strong> should be preferred when possible.</p>
<h4>AES (Advanced Encryption Standard)</h4>
<p>AES supports three key sizes: 128 bits, 192 bits and 256 bits. The security of the AES algorithm is based on the computational complexity of trying
all possible keys.<br> A larger key size increases the number of possible keys and makes exhaustive search attacks computationally infeasible.
Therefore, a 256-bit key provides a higher level of security than a 128-bit or 192-bit key.</p>
<p>Currently, a minimum key size of <strong>128 bits</strong> is recommended for AES.</p>
<h4>Elliptic Curve Cryptography (ECC)</h4>
<p>Elliptic curve cryptography is also used in various algorithms, such as ECDSA, ECDH, or ECMQV. The length of keys generated with elliptic curve
algorithms is mentioned directly in their names. For example, <code>secp256k1</code> generates a 256-bits long private key.</p>
<p>Currently, a minimum key size of <strong>224 bits</strong> is recommended for EC-based algorithms.</p>
<p>Additionally, some curves that theoretically provide sufficiently long keys are still discouraged. This can be because of a flaw in the curve
parameters, a bad overall design, or poor performance. It is generally advised to use a NIST-approved elliptic curve wherever possible. Such curves
currently include:</p>
<ul>
  <li> NIST P curves with a size of at least 224 bits, e.g. secp256r1. </li>
  <li> Curve25519, generally known as ed25519 or x25519 depending on its application. </li>
  <li> Curve448. </li>
  <li> Brainpool curves with a size of at least 224 bits, e.g. brainpoolP224r1 </li>
</ul>
<h3>Going the extra mile</h3>
<h4>Pre-Quantum Cryptography</h4>
<p>Encrypted data and communications recorded today could be decrypted in the future by an attack from a quantum computer.<br> It is important to keep
in mind that NIST-approved digital signature schemes, key agreement, and key transport may need to be replaced with secure quantum-resistant (or
"post-quantum") counterpart.</p>
<p>Thus, if data is to remain secure beyond 2030, proactive measures should be taken now to ensure its safety.</p>
<p><a href="https://www.enisa.europa.eu/publications/post-quantum-cryptography-current-state-and-quantum-mitigation">Learn more here</a>.</p></p>
            </div>
        <div class="rule">
            <h3>"equals" method parameters should not be marked "@Nonnull" (java:S4454)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>By contract, the <code>equals(Object)</code> method, from <code>java.lang.Object</code>, should accept a <code>null</code> argument. Among all the
other cases, the <code>null</code> case is even explicitly detailed in the <code>Object.equals(...)</code> Javadoc, stating <em>"For any non-null
reference value x, x.equals(null) should return false."</em></p>
<p>Assuming that the argument to <code>equals</code> is always non-null, and enforcing that assumption with an annotation is not only a fundamental
violation of the contract of <code>equals</code>, but it is also likely to cause problems in the future as the use of the class evolves over time.</p>
<p>The rule raises an issue when the <code>equals</code> method is overridden and its parameter annotated with any kind of <code>@Nonnull</code>
annotation.</p>
<h3>Noncompliant code example</h3>
<pre>
public boolean equals(@javax.annotation.Nonnull Object obj) { // Noncompliant
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public boolean equals(Object obj) {
  if (obj == null) {
    return false;
  }
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Using unsafe Jackson deserialization configuration is security-sensitive (java:S4544)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Default:</p>
            <p><p>Using unsafe Jackson deserialization configuration is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-4995">CVE-2017-4995</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19362">CVE-2018-19362</a> </li>
</ul>
<p>When Jackson is configured to allow Polymorphic Type Handling (aka PTH), formerly known as Polymorphic Deserialization, "deserialization gadgets"
may allow an attacker to perform remote code execution.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> <code>enableDefaultTyping()</code> is called on an instance of <code>com.fasterxml.jackson.databind.ObjectMapper</code> or
  <code>org.codehaus.jackson.map.ObjectMapper</code>. </li>
  <li> or when the annotation <code>@JsonTypeInfo</code> is set at class, interface or field levels and configured with <code>use =
  JsonTypeInfo.Id.CLASS</code> or <code>use = Id.MINIMAL_CLASS</code>. </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You configured the Jackson deserializer as mentioned above. </li>
  <li> The serialized data might come from an untrusted source. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use the latest patch versions of <code>jackson-databind</code> blocking the already discovered "deserialization gadgets". </li>
  <li> Avoid using the default typing configuration: <code>ObjectMapper.enableDefaultTyping()</code>. </li>
  <li> If possible, use <code>@JsonTypeInfo(use = Id.NAME)</code> instead of <code>@JsonTypeInfo(use = Id.CLASS)</code> or <code>@JsonTypeInfo(use =
  Id. MINIMAL_CLASS)</code> and so rely on <code>@JsonTypeName</code> and <code>@JsonSubTypes</code>. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
ObjectMapper mapper = new ObjectMapper();
mapper.enableDefaultTyping(); // Sensitive
</pre>
<pre>
@JsonTypeInfo(use = Id.CLASS) // Sensitive
abstract class PhoneNumber {
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data">Deserialization of untrusted data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
  <li> <a href="https://medium.com/@cowtowncoder/on-jackson-cves-dont-panic-here-is-what-you-need-to-know-54cd0d6e8062">On Jackson CVEs: Don’t
  Panic</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-15095">CVE-2017-1509</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-7525">CVE-2017-7525</a> </li>
  <li> Derived from FindSecBugs rule <a
  href="https://find-sec-bugs.github.io/bugs.htm#JACKSON_UNSAFE_DESERIALIZATION">JACKSON_UNSAFE_DESERIALIZATION</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> You configured the Jackson deserializer as mentioned above. </li>
  <li> The serialized data might come from an untrusted source. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
ObjectMapper mapper = new ObjectMapper();
mapper.enableDefaultTyping(); // Sensitive
</pre>
<pre>
@JsonTypeInfo(use = Id.CLASS) // Sensitive
abstract class PhoneNumber {
}
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use the latest patch versions of <code>jackson-databind</code> blocking the already discovered "deserialization gadgets". </li>
  <li> Avoid using the default typing configuration: <code>ObjectMapper.enableDefaultTyping()</code>. </li>
  <li> If possible, use <code>@JsonTypeInfo(use = Id.NAME)</code> instead of <code>@JsonTypeInfo(use = Id.CLASS)</code> or <code>@JsonTypeInfo(use =
  Id. MINIMAL_CLASS)</code> and so rely on <code>@JsonTypeName</code> and <code>@JsonSubTypes</code>. </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-community/vulnerabilities/Deserialization_of_untrusted_data">Deserialization of untrusted data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
  <li> <a href="https://medium.com/@cowtowncoder/on-jackson-cves-dont-panic-here-is-what-you-need-to-know-54cd0d6e8062">On Jackson CVEs: Don’t
  Panic</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-15095">CVE-2017-1509</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2017-7525">CVE-2017-7525</a> </li>
  <li> Derived from FindSecBugs rule <a
  href="https://find-sec-bugs.github.io/bugs.htm#JACKSON_UNSAFE_DESERIALIZATION">JACKSON_UNSAFE_DESERIALIZATION</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Using unsafe Jackson deserialization configuration is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-4995">CVE-2017-4995</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19362">CVE-2018-19362</a> </li>
</ul>
<p>When Jackson is configured to allow Polymorphic Type Handling (aka PTH), formerly known as Polymorphic Deserialization, "deserialization gadgets"
may allow an attacker to perform remote code execution.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> <code>enableDefaultTyping()</code> is called on an instance of <code>com.fasterxml.jackson.databind.ObjectMapper</code> or
  <code>org.codehaus.jackson.map.ObjectMapper</code>. </li>
  <li> or when the annotation <code>@JsonTypeInfo</code> is set at class, interface or field levels and configured with <code>use =
  JsonTypeInfo.Id.CLASS</code> or <code>use = Id.MINIMAL_CLASS</code>. </li>
</ul>
</p>
            </div>
        <div class="rule">
            <h3>JUnit assertTrue/assertFalse should be simplified to the corresponding dedicated assertion (java:S5785)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Testing equality or nullness with JUnit’s <code>assertTrue()</code> or <code>assertFalse()</code> should be simplified to the corresponding
dedicated assertion.</p>
<h3>Noncompliant code example</h3>
<pre>
Assert.assertTrue(a.equals(b));
Assert.assertTrue(a == b);
Assert.assertTrue(a == null);
Assert.assertTrue(a != null);
Assert.assertFalse(a.equals(b));
</pre>
<h3>Compliant solution</h3>
<pre>
Assert.assertEquals(a, b);
Assert.assertSame(a, b);
Assert.assertNull(a);
Assert.assertNotNull(a);
Assert.assertNotEquals(a, b);
</pre></p>
            </div>
        <div class="rule">
            <h3>A new session should be created during user authentication (java:S5876)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>An attacker may trick a user into using a predetermined session identifier. Consequently, this attacker can gain unauthorized access and
impersonate the user’s session. This kind of attack is called session fixation, and protections against it should not be disabled.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Session fixation attacks take advantage of the way web applications manage session identifiers. Here’s how a session fixation attack typically
works:</p>
<ul>
  <li> When a user visits a website or logs in, a session is created for them. </li>
  <li> This session is assigned a unique session identifier, stored in a cookie, in local storage, or through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. For example,
  the attacker sends the victim an email containing a link with this predetermined session identifier. </li>
  <li> When the victim clicks on the link, the web application does not create a new session identifier but uses this identifier known to the
  attacker. </li>
  <li> At this point, the attacker can hijack and impersonate the victim’s session. </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Session fixation attacks pose a significant security risk to web applications and their users. By exploiting this vulnerability, attackers can gain
unauthorized access to user sessions, potentially leading to various malicious activities. Some of the most relevant scenarios are the following:</p>
<h4>Impersonation</h4>
<p>Once an attacker successfully fixes a session identifier, they can impersonate the victim and gain access to their account without providing valid
credentials. This can result in unauthorized actions, such as modifying personal information, making unauthorized transactions, or even performing
malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing actions they wouldn’t normally do, such as
revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p>
<h4>Data Breach</h4>
<p>If an attacker gains access to a user’s session, they may also gain access to sensitive data associated with that session. This can include
personal information, financial details, or any other confidential data that the user has access to within the application. The compromised data can
be used for identity theft, financial fraud, or other malicious purposes.</p>
<h4>Privilege Escalation</h4>
<p>In some cases, session fixation attacks can be used to escalate privileges within a web application. By fixing a session identifier with higher
privileges, an attacker can bypass access controls and gain administrative or privileged access to the application. This can lead to unauthorized
modifications, data manipulation, or even complete compromise of the application and its underlying systems.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<p><a href="https://docs.spring.io/spring-security/reference/servlet/authentication/session-management.html">Session Fixation Attack
Protection</a></p>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> <a href="https://owasp.org/www-community/attacks/Session_fixation">OWASP Sesssion Fixation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/384">CWE-384 - Session Fixation</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222579">Application Security and
  Development: V-222579</a> - Applications must use system-generated session identifiers that protect against session fixation. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222582">Application Security and
  Development: V-222582</a> - The application must not re-use or recycle session IDs. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>In a Spring Security’s context, session fixation protection is enabled by default but can be disabled with <code>sessionFixation().none()</code>
method. Session fixation protection can also be enabled explicitly with <code>migrateSession()</code> but is superfluous in most cases.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Override
protected void configure(HttpSecurity http) throws Exception {
   http.sessionManagement()
     .sessionFixation().none(); // Noncompliant: the existing session will continue
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Override
protected void configure(HttpSecurity http) throws Exception {
  http.sessionManagement()
     .sessionFixation().migrateSession();
}
</pre>
<h3>How does this work?</h3>
<p>The protection works by ensuring that the session identifier, which is used to identify and track a user’s session, is changed or regenerated
during the authentication process.</p>
<p>Here’s how session fixation protection typically works:</p>
<ol>
  <li> When a user visits a website or logs in, a session is created for them. This session is assigned a unique session identifier, which is stored
  in a cookie or passed through URL parameters. </li>
  <li> In a session fixation attack, an attacker tricks a user into using a predetermined session identifier controlled by the attacker. This allows
  the attacker to potentially gain unauthorized access to the user’s session. </li>
  <li> To protect against session fixation attacks, session fixation protection mechanisms come into play during the authentication process. When a
  user successfully authenticates, this mechanism generates a new session identifier for the user’s session. </li>
  <li> The old session identifier, which may have been manipulated by the attacker, is invalidated and no longer associated with the user’s session.
  This ensures that any attempts by the attacker to use the fixed session identifier are rendered ineffective. </li>
  <li> The user is then assigned the new session identifier, which is used for subsequent requests and session tracking. This new session identifier
  is typically stored in a new session cookie or passed through URL parameters. </li>
</ol>
<p>By regenerating the session identifier upon authentication, session fixation protection helps ensure that the user’s session is tied to a new,
secure identifier that the attacker cannot predict or control. This mitigates the risk of an attacker gaining unauthorized access to the user’s
session and helps maintain the integrity and security of the application’s session management process.</p>
<p>In Spring, calling <code>migrateSession()</code> explicitly is not necessary in most cases, as it automatically migrates session attributes to a
new session upon successful authentication. The <code>migrateSession()</code> method is typically explicitly used when you want to manually trigger
the migration of session attributes to a new session outside of the authentication process.</p></p>
            </div>
        <div class="rule">
            <h3>Regex boundaries should not be used in a way that can never be matched (java:S5996)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In regular expressions the boundaries <code>^</code> and <code>\A</code> can only match at the beginning of the input (or, in case of
<code>^</code> in combination with the <code>MULTILINE</code> flag, the beginning of the line) and <code>$</code>, <code>\Z</code> and <code>\z</code>
only at the end.</p>
<p>These patterns can be misused, by accidentally switching <code>^</code> and <code>$</code> for example, to create a pattern that can never
match.</p>
<h3>Noncompliant code example</h3>
<pre>
// This can never match because $ and ^ have been switched around
Pattern.compile("$[a-z]+^"); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("^[a-z]+$");
</pre></p>
            </div>
        <div class="rule">
            <h3>Regular expressions should not overflow the stack (java:S5998)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The Java regex engine uses recursive method calls to implement backtracking. Therefore when a repetition inside a regular expression contains
multiple paths (i.e. the body of the repetition contains an alternation (<code>|</code>), an optional element or another repetition), trying to match
the regular expression can cause a stack overflow on large inputs. This does not happen when using a possessive quantifier (such as <code>*+</code>
instead of <code>*</code>) or when using a character class inside a repetition (e.g. <code>[ab]*</code> instead of <code>(a|b)*</code>).</p>
<p>The size of the input required to overflow the stack depends on various factors, including of course the stack size of the JVM. One thing that
significantly increases the size of the input that can be processed is if each iteration of the repetition goes through a chain of multiple constant
characters because such consecutive characters will be matched by the regex engine without invoking any recursion.</p>
<p>For example, on a JVM with a stack size of 1MB, the regex <code>(?:a|b)*</code> will overflow the stack after matching around 6000 characters
(actual numbers may differ between JVM versions and even across multiple runs on the same JVM) whereas <code>(?:abc|def)*</code> can handle around
15000 characters.</p>
<p>Since often times stack growth can’t easily be avoided, this rule will only report issues on regular expressions if they can cause a stack overflow
on realistically sized inputs. You can adjust the <code>maxStackConsumptionFactor</code> parameter to adjust this.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("(a|b)*"); // Noncompliant
Pattern.compile("(.|\n)*"); // Noncompliant
Pattern.compile("(ab?)*"); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("[ab]*"); // Character classes don't cause recursion the way that '|' does
Pattern.compile("(?s).*"); // Enabling the (?s) flag makes '.' match line breaks, so '|\n' isn't necessary
Pattern.compile("(ab?)*+"); // Possessive quantifiers don't cause recursion because they disable backtracking
</pre></p>
            </div>
        <div class="rule">
            <h3>"Enumeration" should not be implemented (java:S1150)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>As documented in <code>Enumeration</code> 's Javadoc, you should favor the <code>Iterator</code> interface over <code>Enumeration</code>.
<code>Iterator</code> offers a similar contract to <code>Enumeration</code> with the addition of a method for removal and shorter method names.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass implements Enumeration {  // Noncompliant
  /* ... */
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass implements Iterator {     // Compliant
  /* ... */
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Enumeration.html">docs.oracle.com</a> - Enumeration </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"switch case" clauses should not have too many lines of code (java:S1151)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>switch</code> statement should be used only to clearly define some new branches in the control flow. As soon as a <code>case</code>
clause contains too many statements this highly decreases the readability of the overall control flow statement. In such case, the content of the
<code>case</code> clause should be extracted into a dedicated method.</p>
<h3>Noncompliant code example</h3>
<p>With the default threshold of 5:</p>
<pre>
switch (myVariable) {
  case 0: // Noncompliant: 6 lines till next case
    methodCall1("");
    methodCall2("");
    methodCall3("");
    methodCall4("");
    break;
  case 1:
  ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
switch (myVariable) {
  case 0:
    doSomething()
    break;
  case 1:
  ...
}
...
private void doSomething(){
    methodCall1("");
    methodCall2("");
    methodCall3("");
    methodCall4("");
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"String.valueOf()" should not be appended to a "String" (java:S1153)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Appending <code>String.valueOf()</code> to a <code>String</code> decreases the code readability.</p>
<p>The argument passed to <code>String.valueOf()</code> should be directly appended instead.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
String message = "Output is " + String.valueOf(12);
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
String message = "Output is " + 12;
</pre></p>
            </div>
        <div class="rule">
            <h3>"Collection.isEmpty()" should be used to test for emptiness (java:S1155)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When you call <code>isEmpty()</code>, it clearly communicates the code’s intention, which is to check if the collection is empty. Using
<code>size() == 0</code> for this purpose is less direct and makes the code slightly more complex.</p>
<p>Moreover, depending on the implementation, the <code>size()</code> method can have a time complexity of <code>O(n)</code> where <code>n</code> is
the number of elements in the collection. On the other hand, <code>isEmpty()</code> simply checks if there is at least one element in the collection,
which is a constant time operation, <code>O(1)</code>.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
  public void doSomething(Collection&lt;String&gt; myCollection) {
    if (myCollection.size() == 0) { // Noncompliant
      doSomethingElse();
    }
  }
}
</pre>
<p>Prefer using <code>isEmpty()</code> to test for emptiness over <code>size()</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
  public void doSomething(Collection&lt;String&gt; myCollection) {
    if (myCollection.isEmpty()) {
      doSomethingElse();
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Empty arrays and collections should be returned instead of null (java:S1168)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/aNYxBQ">CERT, MSC19-C.</a> - For functions that return an array, prefer returning an empty array
  over a null value </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/JzZGBQ">CERT, MET55-J.</a> - Return an empty array or collection instead of a null value for
  methods that return an array or collection </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Returning <code>null</code> instead of an actual array, collection or map forces callers of the method to explicitly test for nullity, making them
more complex and less readable.</p>
<p>Moreover, in many cases, <code>null</code> is used as a synonym for empty.</p>
<h3>Noncompliant code example</h3>
<pre>
public static List&lt;Result&gt; getAllResults() {
  return null;                             // Noncompliant
}

public static Result[] getResults() {
  return null;                             // Noncompliant
}

public static Map&lt;String, Object&gt; getValues() {
  return null;                             // Noncompliant
}

public static void main(String[] args) {
  Result[] results = getResults();
  if (results != null) {                   // Nullity test required to prevent NPE
    for (Result result: results) {
      /* ... */
    }
  }

  List&lt;Result&gt; allResults = getAllResults();
  if (allResults != null) {                // Nullity test required to prevent NPE
    for (Result result: allResults) {
      /* ... */
    }
  }

  Map&lt;String, Object&gt; values = getValues();
  if (values != null) {                   // Nullity test required to prevent NPE
    values.forEach((k, v) -&gt; doSomething(k, v));
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public static List&lt;Result&gt; getAllResults() {
  return Collections.emptyList();          // Compliant
}

public static Result[] getResults() {
  return new Result[0];                    // Compliant
}

public static Map&lt;String, Object&gt; getValues() {
  return Collections.emptyMap();           // Compliant
}

public static void main(String[] args) {
  for (Result result: getAllResults()) {
    /* ... */
  }

  for (Result result: getResults()) {
    /* ... */
  }

  getValues().forEach((k, v) -&gt; doSomething(k, v));
}
</pre></p>
            </div>
        <div class="rule">
            <h3>String operations with predictable outcomes should be avoided (java:S2121)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/String.html">Oracle Java SE - String</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Operations performed on a string with predictable outcomes should be avoided. For example:</p>
<ul>
  <li> checking if a string contains itself </li>
  <li> comparing a string with itself </li>
  <li> matching a string against itself </li>
  <li> creating a substring from 0 to the end of the string </li>
  <li> creating a substring from the end of the string </li>
  <li> replacing a string with itself </li>
  <li> replacing a substring with the exact substring </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Avoid performing the operation that has a predictable outcome.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
String speech = "SonarQube is the best static code analysis tool."

String s1 = speech.substring(0); // Noncompliant - yields the whole string
String s2 = speech.substring(speech.length()); // Noncompliant - yields "";
String s3 = speech.substring(5, speech.length()); // Noncompliant - use the 1-arg version instead

if (speech.contains(speech)) { // Noncompliant - always true
    // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
String speech = "SonarQube is the best static code analysis tool."

String s1 = speech;
String s2 = "";
String s3 = speech.substring(5);

// ...
</pre></p>
            </div>
        <div class="rule">
            <h3>"ScheduledThreadPoolExecutor" should not have 0 core threads (java:S2122)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/concurrent/ScheduledThreadPoolExecutor.html">Oracle Java SE -
  ScheduledThreadPoolExecutor</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://engineering.zalando.com/posts/2019/04/how-to-set-an-ideal-thread-pool-size.html">Zalando - How to set an ideal thread pool
  size</a> </li>
  <li> <a href="https://www.baeldung.com/java-threadpooltaskexecutor-core-vs-max-poolsize">Baeldung - ThreadPoolTaskExecutor corePoolSize vs.
  maxPoolSize</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>ThreadPoolExecutor</code> is an object that efficiently manages and controls the execution of multiple tasks in a thread pool. A thread pool
is a collection of pre-initialized threads ready to execute tasks. Instead of creating a new thread for each task, which can be costly in terms of
system resources, a thread pool reuses existing threads.</p>
<p><code>java.util.concurrent.ScheduledThreadPoolExecutor</code> is an extension of <code>ThreadPoolExecutor</code> that can additionally schedule
commands to run after a given delay or to execute periodically.</p>
<p><code>ScheduledThreadPoolExecutor</code> 's pool is sized with <code>corePoolSize</code>, so setting <code>corePoolSize</code> to zero means the
executor will have no threads and run nothing. <code>corePoolSize</code> should have a value greater than zero and valid for your tasks.</p>
<p>This rule detects instances where <code>corePoolSize</code> is set to zero via its setter or the object constructor.</p>
<h3>Noncompliant code example</h3>
<pre>
public void do(){

  int poolSize = 5; // value greater than 0

  ScheduledThreadPoolExecutor threadPool1 = new ScheduledThreadPoolExecutor(0); // Noncompliant

  ScheduledThreadPoolExecutor threadPool2 = new ScheduledThreadPoolExecutor(poolSize);
  threadPool2.setCorePoolSize(0);  // Noncompliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Values should not be uselessly incremented (java:S2123)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A value that is incremented or decremented and then not stored is at best wasted code and at worst a bug.</p>
<h3>Noncompliant code example</h3>
<pre>
public int pickNumber() {
  int i = 0;
  int j = 0;

  i = i++; // Noncompliant; i is still zero

  return j++; // Noncompliant; 0 returned
}
</pre>
<h3>Compliant solution</h3>
<pre>
public int pickNumber() {
  int i = 0;
  int j = 0;

  i++;
  return ++j;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Constructors should not be used to instantiate "String", "BigInteger", "BigDecimal" and primitive-wrapper classes (java:S2129)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Calling constructors for <code>String</code>, <code>BigInteger</code>, <code>BigDecimal</code> and the objects used to wrap primitives is less
efficient and less clear than relying on autoboxing or <code>valueOf</code>.</p>
<p>Consider simplifying when possible for more efficient and cleaner code.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
String empty = new String(); // Noncompliant; yields essentially "", so just use that.
String nonempty = new String("Hello world"); // Noncompliant
Double myDouble = new Double(1.1); // Noncompliant; use valueOf
Integer integer = new Integer(1); // Noncompliant
Boolean bool = new Boolean(true); // Noncompliant
BigInteger bigInteger1 = new BigInteger("3"); // Noncompliant
BigInteger bigInteger2 = new BigInteger("9223372036854775807"); // Noncompliant
BigInteger bigInteger3 = new BigInteger("111222333444555666777888999"); // Compliant, greater than Long.MAX_VALUE
BigDecimal bigDecimal = new BigDecimal("42.0"); // Compliant (see Exceptions section)
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
String empty = "";
String nonempty = "Hello world";
Double myDouble = 1.1;
Integer integer = 1;
Boolean bool = true;
BigInteger bigInteger1 = BigInteger.valueOf(3);
BigInteger bigInteger2 = BigInteger.valueOf(9223372036854775807L);
BigInteger bigInteger3 = new BigInteger("111222333444555666777888999");
BigDecimal bigDecimal = new BigDecimal("42.0");
</pre>
<h3>Exceptions</h3>
<p><code>BigDecimal</code> constructor with a <code>double</code> argument is ignored as using <code>valueOf</code> instead might change the resulting
value. See <a href='/coding_rules#rule_key=java%3AS2111'>S2111</a>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/data/autoboxing.html">Oracle - Learning the Java Language</a> - Autoboxing and Unboxing
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Objects should not be created only to invoke "getClass" (java:S2133)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Creating an object for the sole purpose of calling <code>getClass</code> on it is a waste of memory and cycles. Instead, simply use the class’s
<code>.class</code> property.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
MyObject myOb = new MyObject();  // Noncompliant
Class c = myOb.getClass();
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
Class c = MyObject.class;
</pre></p>
            </div>
        <div class="rule">
            <h3>"HttpServletRequest.getRequestedSessionId()" should not be used (java:S2254)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Jakarta EE Documentation - <a
  href="https://jakarta.ee/specifications/platform/10/apidocs/jakarta/servlet/http/httpservletrequest#getRequestedSessionId--"><code>HttpServletRequest</code> - <code>getRequestedSessionId</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/807">CWE-807 - Reliance on Untrusted Inputs in a Security Decision</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222582">Application Security and
  Development: V-222582</a> - The application must not re-use or recycle session IDs. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This function uses a session ID that is supplied by the client. Because of this, the ID may not be valid or might even be spoofed.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>According to the API documentation of the <code>HttpServletRequest.getRequestedSessionId()</code> method:</p>
<blockquote>
  <p>Returns the session ID specified by the client. This may not be the same as the ID of the current valid session for this request. If the client
  did not specify a session ID, this method returns null.</p>
</blockquote>
<p>The session ID it returns is either transmitted through a cookie or a URL parameter. This allows an end user to manually update the value of this
session ID in an HTTP request.</p>
<p>Due to the ability of the end-user to manually change the value, the session ID in the request should only be used by a servlet container (e.g.
Tomcat or Jetty) to see if the value matches the ID of an existing session. If it does not, the user should be considered unauthenticated.</p>
<h3>What is the potential impact?</h3>
<p>Using a client-supplied session ID to manage sessions on the server side can potentially have an impact on the security of the application.</p>
<h4>Impersonation (through session fixation)</h4>
<p>If an attacker succeeds in fixing a user’s session to a session identifier that they know, then they can impersonate this victim and gain access to
their account without providing valid credentials. This can result in unauthorized actions, such as modifying personal information, making
unauthorized transactions, or even performing malicious activities on behalf of the victim. An attacker can also manipulate the victim into performing
actions they wouldn’t normally do, such as revealing sensitive information or conducting financial transactions on the attacker’s behalf.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>In both examples, a session ID is used to check whether a user’s session is still active. In the noncompliant example, the session ID supplied by
the user is used. In the compliant example, the session ID defined by the server is used instead.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
if (isActiveSession(request.getRequestedSessionId())) { // Noncompliant
    // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
if (isActiveSession(request.getSession().getId())) {
    // ...
}
</pre>
<h3>How does this work?</h3>
<p>The noncompliant example uses <code>HttpServletRequest.getRequestedSessionId()</code> to retrieve a session ID. This ID is then used to verify if
the given session is still active. As this value is given by a user, this value is not guaranteed to be a valid ID.</p>
<p>The compliant example instead uses the server’s session ID to verify if the session is active. Additionally, <code>getSession()</code> will create
a new session if the user’s request does not contain a valid ID.</p></p>
            </div>
        <div class="rule">
            <h3>Using non-standard cryptographic algorithms is security-sensitive (java:S2257)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>SHA-256</code>, <code>SHA-384</code>, <code>SHA-512</code>, …​ should be used instead.</p>
<p>This rule tracks creation of <code>java.security.MessageDigest</code> subclasses.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>The use of a non-standard algorithm is dangerous because a determined attacker may be able to break the algorithm and compromise whatever data has
been protected. Standard algorithms like <code>SHA-256</code>, <code>SHA-384</code>, <code>SHA-512</code>, …​ should be used instead.</p>
<p>This rule tracks creation of <code>java.security.MessageDigest</code> subclasses.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a standard algorithm instead of creating a custom one. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public class MyCryptographicAlgorithm extends MessageDigest {
  ...
}
</pre>
<h2>Compliant Solution</h2>
<pre>
MessageDigest digest = MessageDigest.getInstance("SHA-256");
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST">MessageDigest is Custom</a>
  </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Sensitive Code Example</h2>
<pre>
public class MyCryptographicAlgorithm extends MessageDigest {
  ...
}
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a standard algorithm instead of creating a custom one. </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
MessageDigest digest = MessageDigest.getInstance("SHA-256");
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/327">CWE-327 - Use of a Broken or Risky Cryptographic Algorithm</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#CUSTOM_MESSAGE_DIGEST">MessageDigest is Custom</a>
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Null pointers should not be dereferenced (java:S2259)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>The variable <code>myObject</code> is equal to <code>null</code>, meaning it has no value:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void method() {
  Object myObject = null;
  System.out.println(myObject.toString()); // Noncompliant: myObject is null
}
</pre>
<p>The parameter <code>input</code> might be <code>null</code> as suggested by the <code>if</code> condition:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
public void method(Object input)
{
  if (input == null)
  {
    // ...
  }
  System.out.println(input.toString()); // Noncompliant
}
</pre>
<p>The unboxing triggered in the return statement will throw a <code>NullPointerException</code>:</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
public boolean method() {
  Boolean boxed = null;
  return boxed; // Noncompliant
}
</pre>
<p>Both <code>conn</code> and <code>stmt</code> might be <code>null</code> in case an exception was thrown in the try{} block:</p>
<pre data-diff-id="4" data-diff-type="noncompliant">
Connection conn = null;
Statement stmt = null;
try {
  conn = DriverManager.getConnection(DB_URL,USER,PASS);
  stmt = conn.createStatement();
  // ...
} catch(Exception e) {
  e.printStackTrace();
} finally {
  stmt.close();  // Noncompliant
  conn.close();  // Noncompliant
}
</pre>
<p>As <code>getName()</code> is annotated with <code>@CheckForNull</code>, there is a risk of <code>NullPointerException</code> here:</p>
<pre data-diff-id="5" data-diff-type="noncompliant">
@CheckForNull
String getName() {...}

public boolean isNameEmpty() {
  return getName().length() == 0; // Noncompliant
}
</pre>
<p>As <code>merge(…​)</code> parameter is annotated with <code>@Nonnull</code>, passing an identified potential null value (thanks to @CheckForNull)
is not safe:</p>
<pre data-diff-id="6" data-diff-type="noncompliant">
private void merge(@Nonnull Color firstColor, @Nonnull Color secondColor) {...}

public void append(@CheckForNull Color color) {
  merge(currentColor, color);  // Noncompliant: color should be null-checked because merge(...) doesn't accept nullable parameters
}
</pre>
<h4>Compliant solution</h4>
<p>Ensuring the variable <code>myObject</code> has a value resolves the issue:</p>
<pre data-diff-id="1" data-diff-type="compliant">
public void method() {
  Object myObject = new Object();
  System.out.println(myObject.toString()); // Compliant: myObject is not null
}
</pre>
<p>Preventing the non-compliant code to be executed by returning early:</p>
<pre data-diff-id="2" data-diff-type="compliant">
public void method(Object input)
{
  if (input == null)
  {
    return;
  }
  System.out.println(input.toString()); // Compliant: if 'input' is null, this is unreachable
}
</pre>
<p>Ensuring that no unboxing of <code>null</code> value can happen resolves the issue</p>
<pre data-diff-id="3" data-diff-type="compliant">
public boolean method() {
  Boolean boxed = true;
  return boxed; // Compliant
}
</pre>
<p>Ensuring that both <code>conn</code> and <code>stmt</code> are not <code>null</code> resolves the issue:</p>
<pre data-diff-id="4" data-diff-type="compliant">
Connection conn = null;
Statement stmt = null;
try {
  conn = DriverManager.getConnection(DB_URL,USER,PASS);
  stmt = conn.createStatement();
  // ...
} catch(Exception e) {
  e.printStackTrace();
} finally {
  if (stmt != null) {
    stmt.close();  // Compliant
  }
  if (conn != null) {
    conn.close();  // Compliant
  }
}
</pre>
<p>Checking the returned value of <code>getName()</code> resolves the issue:</p>
<pre data-diff-id="5" data-diff-type="compliant">
@CheckForNull
String getName() {...}

public boolean isNameEmpty() {
  String name = getName();
  if (name != null) {
    return name.length() == 0; // Compliant
  } else {
    // ...
  }
}
</pre>
<p>Ensuring that the provided <code>color</code> is not <code>null</code> resolves the issue:</p>
<pre data-diff-id="6" data-diff-type="compliant">
private void merge(@Nonnull Color firstColor, @Nonnull Color secondColor) {...}

public void append(@CheckForNull Color color) {
  if (color != null) {
    merge(currentColor, color);  // Compliant
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/476">CWE-476 - NULL Pointer Dereference</a> </li>
  <li> CERT, EXP34-C. - <a href="https://wiki.sei.cmu.edu/confluence/x/QdcxBQ">Do not dereference null pointers</a> </li>
  <li> CERT, EXP01-J. - <a href="https://wiki.sei.cmu.edu/confluence/x/aDdGBQ">Do not use a null in a case where an object is required</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A reference to <code>null</code> should never be dereferenced/accessed. Doing so will cause a <code>NullPointerException</code> to be thrown. At
best, such an exception will cause abrupt program termination. At worst, it could expose debugging information that would be useful to an attacker, or
it could allow an attacker to bypass security measures.</p>
<p>Note that when they are present, this rule takes advantage of nullability annotations, like <code>@CheckForNull</code> or <code>@Nonnull</code>,
defined in <a href="https://jcp.org/en/jsr/detail?id=305">JSR-305</a> to understand which values can be null or not. <code>@Nonnull</code> will be
ignored if used on the parameter of the <code>equals</code> method, which by contract should always work with null.</p></p>
            </div>
        <div class="rule">
            <h3>Creating cookies without the "HttpOnly" flag is security-sensitive (java:S3330)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(false);  // Sensitive: this sensitive cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setHttpOnly(boolean)"><code>HttpOnly</code></a> flag is
set to <em>false:</em></p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);  // Sensitive: this sensitive cookie is created with the httponly flag not defined (by default set to false) and so it can be stolen easily in case of XSS vulnerability
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(true); // Compliant: this sensitive cookie is protected against theft (HttpOnly=true)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222575">Application Security and
  Development: V-222575</a> - The application must set the HTTPOnly flag on session cookies. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>When a cookie is configured with the <code>HttpOnly</code> attribute set to <em>true</em>, the browser guaranties that no client-side script will
be able to read it. In most cases, when a cookie is created, the default value of <code>HttpOnly</code> is <em>false</em> and it’s up to the developer
to decide whether or not the content of the cookie can be read by the client-side script. As a majority of Cross-Site Scripting (XSS) attacks target
the theft of session-cookies, the <code>HttpOnly</code> attribute can help to reduce their impact as it won’t be possible to exploit the XSS
vulnerability to steal session-cookies.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is sensitive, used to authenticate the user, for instance a <em>session-cookie</em> </li>
  <li> the <code>HttpOnly</code> attribute offer an additional protection (not the case for an <em>XSRF-TOKEN cookie</em> / CSRF token for example)
  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> By default the <code>HttpOnly</code> flag should be set to <em>true</em> for most of the cookies and it’s mandatory for session /
  sensitive-security cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(false);  // Sensitive: this sensitive cookie is created with the httponly flag set to false and so it can be stolen easily in case of XSS vulnerability
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setHttpOnly(boolean)"><code>HttpOnly</code></a> flag is
set to <em>false:</em></p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);  // Sensitive: this sensitive cookie is created with the httponly flag not defined (by default set to false) and so it can be stolen easily in case of XSS vulnerability
</pre>
<h2>Compliant Solution</h2>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setHttpOnly(true); // Compliant: this sensitive cookie is protected against theft (HttpOnly=true)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://owasp.org/www-community/HttpOnly">OWASP HttpOnly</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1004">CWE-1004 - Sensitive Cookie Without 'HttpOnly' Flag</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#HTTPONLY_COOKIE">HTTPONLY_COOKIE</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222575">Application Security and
  Development: V-222575</a> - The application must set the HTTPOnly flag on session cookies. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Expressions used in "assert" should not produce side effects (java:S3346)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/mjdGBQ">CERT, EXP06-J.</a> - Expressions used in assertions must not produce side effects </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Since <code>assert</code> statements aren’t executed by default (they must be enabled with JVM flags) developers should never rely on their
execution the evaluation of any logic required for correct program function.</p>
<h3>Noncompliant code example</h3>
<pre>
assert myList.remove(myList.get(0));  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
boolean removed = myList.remove(myList.get(0));
assert removed;
</pre></p>
            </div>
        <div class="rule">
            <h3>Test classes should comply with a naming convention (java:S3577)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared naming conventions allow teams to collaborate efficiently. This rule raises an issue when a test class name does not match the provided
regular expression.</p>
<h3>Noncompliant code example</h3>
<p>With the default value: <code>^((Test|IT)[a-zA-Z0-9_]+|[A-Z][a-zA-Z0-9_]*(Test|Tests|TestCase|IT|ITCase))$</code></p>
<pre>
class Foo {  // Noncompliant
  @Test
  void check() {  }
}

class Bar {  // Noncompliant
  @Nested
  class PositiveCase {
    @Test
    void check() {  }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class FooTest {
  @Test
  void check() {  }
}

class BarIT {
  @Nested
  class PositiveCase {
    @Test
    void check() {  }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Integer.toHexString" should not be used to build hexadecimal strings (java:S4425)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using <code>Integer.toHexString</code> is a common mistake when converting sequences of bytes into hexadecimal string representations. The problem
is that the method trims leading zeroes, which can lead to wrong conversions. For instance a two bytes value of <code>0x4508</code> would be converted
into <code>45</code> and <code>8</code> which once concatenated would give <code>0x458</code>.</p>
<p>This is particularly damaging when converting hash-codes and could lead to a security vulnerability.</p>
<p>This rule raises an issue when <code>Integer.toHexString</code> is used in any kind of string concatenations.</p>
<h3>Noncompliant code example</h3>
<pre>
MessageDigest md = MessageDigest.getInstance("SHA-256");
byte[] bytes = md.digest(password.getBytes("UTF-8"));

StringBuilder sb = new StringBuilder();
for (byte b : bytes) {
    sb.append(Integer.toHexString( b &amp; 0xFF )); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
MessageDigest md = MessageDigest.getInstance("SHA-256");
byte[] bytes = md.digest(password.getBytes("UTF-8"));

StringBuilder sb = new StringBuilder();
for (byte b : bytes) {
    sb.append(String.format("%02X", b));
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/704">CWE-704 - Incorrect Type Conversion or Cast</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#BAD_HEXA_CONVERSION">BAD_HEXA_CONVERSION</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Allowing deserialization of LDAP objects is security-sensitive (java:S4434)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The application connects to an untrusted LDAP directory. </li>
  <li> User-controlled objects can be stored in the LDAP directory. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
DirContext ctx = new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            true, // Noncompliant; allows deserialization
            deref));
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>JNDI supports the deserialization of objects from LDAP directories, which can lead to remote code execution.</p>
<p>This rule raises an issue when an LDAP search query is executed with <code>SearchControls</code> configured to allow deserialization.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application connects to an untrusted LDAP directory. </li>
  <li> User-controlled objects can be stored in the LDAP directory. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable deserialization of LDAP objects.</p>
<h2>Sensitive Code Example</h2>
<pre>
DirContext ctx = new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            true, // Noncompliant; allows deserialization
            deref));
</pre>
<h2>Compliant Solution</h2>
<pre>
DirContext ctx = new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            false, // Compliant
            deref));
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> <a href="https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE-wp.pdf">BlackHat
  presentation</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#LDAP_ENTRY_POISONING">LDAP_ENTRY_POISONING</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable deserialization of LDAP objects.</p>
<h2>Compliant Solution</h2>
<pre>
DirContext ctx = new InitialDirContext();
// ...
ctx.search(query, filter,
        new SearchControls(scope, countLimit, timeLimit, attributes,
            false, // Compliant
            deref));
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/502">CWE-502 - Deserialization of Untrusted Data</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A8_2017-Insecure_Deserialization">Top 10 2017 Category A8 - Insecure
  Deserialization</a> </li>
  <li> <a href="https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE-wp.pdf">BlackHat
  presentation</a> </li>
  <li> Derived from FindSecBugs rule <a href="https://find-sec-bugs.github.io/bugs.htm#LDAP_ENTRY_POISONING">LDAP_ENTRY_POISONING</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>JNDI supports the deserialization of objects from LDAP directories, which can lead to remote code execution.</p>
<p>This rule raises an issue when an LDAP search query is executed with <code>SearchControls</code> configured to allow deserialization.</p>
</p>
            </div>
        <div class="rule">
            <h3>Constructors of an "abstract" class should not be declared "public" (java:S5993)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Abstract classes should not have public constructors. Constructors of abstract classes can only be called in constructors of their subclasses. So
there is no point in making them public. The <code>protected</code> modifier should be enough.</p>
<h3>Noncompliant code example</h3>
<pre>
public abstract class AbstractClass1 {
    public AbstractClass1 () { // Noncompliant, has public modifier
        // do something here
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public abstract class AbstractClass2 {
    protected AbstractClass2 () {
        // do something here
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Regex patterns following a possessive quantifier should not always fail (java:S5994)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Possessive quantifiers in Regex patterns like below improve performance by eliminating needless backtracking:</p>
<pre>
?+ , *+ , ++ , {n}+ , {n,}+ , {n,m}+
</pre>
<p>But because possessive quantifiers do not keep backtracking positions and never give back, the following sub-patterns should not match only similar
characters. Otherwise, possessive quantifiers consume all characters that could have matched the following sub-patterns and nothing remains for the
following sub-patterns.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern pattern1 = Pattern.compile("a++abc");       // Noncompliant, the second 'a' never matches
Pattern pattern2 = Pattern.compile("\\d*+[02468]"); // Noncompliant, the sub-pattern "[02468]" never matches
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern pattern1 = Pattern.compile("aa++bc");            // Compliant, for example it can match "aaaabc"
Pattern pattern2 = Pattern.compile("\\d*+(?&lt;=[02468])"); // Compliant, for example it can match an even number like "1234"
</pre></p>
            </div>
        <div class="rule">
            <h3>"@PathVariable" annotation should be present if a path variable is used (java:S6856)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>@PathVariable</code> annotation in Spring extracts values from the URI path and binds them to method parameters in a Spring MVC
controller. It is commonly used with <code>@GetMapping</code>, <code>@PostMapping</code>, <code>@PutMapping</code>, and <code>@DeleteMapping</code> to
capture path variables from the URI. These annotations map HTTP requests to specific handler methods in a controller. They are part of the Spring Web
module and are commonly used to define the routes for different HTTP operations in a RESTful API.</p>
<p>If a method has a path template containing a placeholder, like "/api/resource/{id}", and there’s no <code>@PathVariable</code> annotation on a
method parameter to capture the id path variable, Spring will disregard the id variable.</p>
<p>This rule will raise an issue if a method has a path template with a placeholder, but no corresponding <code>@PathVariable</code>, or
vice-versa.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@GetMapping("/api/resource/{id}")
public ResponseEntity&lt;String&gt; getResourceById(Long id) { // Noncompliant - The 'id' parameter will not be automatically populated with the path variable value
  return ResponseEntity.ok("Fetching resource with ID: " + id);
}

@GetMapping("/api/asset/")
public ResponseEntity&lt;String&gt; getAssetById(@PathVariable Long id) { // Noncompliant - The 'id' parameter does not have a corresponding placeholder
  return ResponseEntity.ok("Fetching asset with ID: " + id);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@GetMapping("/api/resource/{id}")
public ResponseEntity&lt;String&gt; getResourceById(@PathVariable Long id) { // Compliant
  return ResponseEntity.ok("Fetching resource with ID: " + id);
}

@GetMapping("/api/asset/{id}")
public ResponseEntity&lt;String&gt; getAssetById(@PathVariable Long id) {
  return ResponseEntity.ok("Fetching asset with ID: " + id);
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://spring.io/guides/tutorials/rest/">Spring IO - Building REST services with Spring</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PathVariable.html">Spring
  Framework API - PathVariable</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/GetMapping.html">Spring
  Framework API - GetMapping</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PostMapping.html">Spring
  Framework API - PostMapping</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/PutMapping.html">Spring
  Framework API - PutMapping</a> </li>
  <li> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/DeleteMapping.html">Spring
  Framework API - DeleteMapping</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/spring-pathvariable">Baeldung - Spring @PathVariable</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>SpEL expression should have a valid syntax (java:S6857)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.spring.io/spring-framework/reference/core/expressions.html">Spring Framework - Spring Expression Language (SpEL)</a>
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>SpEL is used in Spring annotations and is parsed by the Spring framework, not by the Java compiler. This means that invalid SpEL expressions are
not detected during Java compile time. They will cause exceptions during runtime instead, or even fail silently with the expression string interpreted
as a simple string literal by Spring.</p>
<h3>Exceptions</h3>
<p>This rule does report syntactical errors in SpEL expressions but does not consider semantic errors, such as unknown identifiers or incompatible
operand data types.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Correct the syntax error in the SpEL expression.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Value("#{systemProperties['user.region'}") // Noncompliant, unclosed "["
private String region;
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
@Value("#{'${listOfValues}' split(',')}") // Noncompliant, missing operator
private List&lt;String&gt; valuesList;
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
@Value("#{T(java.lang.Math).random() * 64h}") // Noncompliant, invalid number
private Double randPercent;
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
@Query("SELECT u FROM User u WHERE u.status = :#{#status+}") // Noncompliant, missing operand for "+"
List&lt;User&gt; findUsersByStatus(@Param("status") String status);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Value("#{systemProperties['user.region']}") // Compliant
private String region;
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
@Value("#{'${listOfValues}'.split(',')}") // Compliant
private List&lt;String&gt; valuesList;
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
@Value("#{T(java.lang.Math).random() * 100.0}") // Compliant
private Double randPercent;
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
@Query("SELECT u FROM User u WHERE u.status = :#{#status+42}") // Compliant
List&lt;User&gt; findUsersByStatus(@Param("status") String status);
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule reports syntax errors in Spring Expression Language (SpEL) expressions.</p></p>
            </div>
        <div class="rule">
            <h3>Functions should not be defined with a variable number of arguments (java:S923)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>As stated per effective java :</p>
<blockquote>
  <p>Varargs methods are a convenient way to define methods that require a variable number of arguments, but they should not be overused. They can
  produce confusing results if used inappropriately.</p>
</blockquote>
<h3>Noncompliant code example</h3>
<pre>
void fun ( String... strings )	// Noncompliant
{
  // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/DCL57-J.+Avoid+ambiguous+overloading+of+variable+arity+methods">CERT, DCL57J</a> -
  Avoid ambiguous overloading of variable arity methods </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Public methods should throw at most one checked exception (java:S1160)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using checked exceptions forces method callers to deal with errors, either by propagating them or by handling them. Throwing exceptions makes them
fully part of the API of the method.</p>
<p>But to keep the complexity for callers reasonable, methods should not throw more than one kind of checked exception.</p>
<h3>Noncompliant code example</h3>
<pre>
public void delete() throws IOException, SQLException {      // Noncompliant
  /* ... */
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void delete() throws SomeApplicationLevelException {
  /* ... */
}
</pre>
<h3>Exceptions</h3>
<p>Overriding methods are not checked by this rule and are allowed to throw several checked exceptions.</p></p>
            </div>
        <div class="rule">
            <h3>"@Override" should be used on overriding and implementing methods (java:S1161)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>While not mandatory, using the <code>@Override</code> annotation on compliant methods improves readability by making it explicit that methods are
overridden.</p>
<p>A compliant method either overrides a parent method or implements an interface or abstract method.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
class ParentClass {
  public boolean doSomething(){/*...*/}
}
class FirstChildClass extends ParentClass {
  public boolean doSomething(){/*...*/}  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
class ParentClass {
  public boolean doSomething(){/*...*/}
}
class FirstChildClass extends ParentClass {
  @Override
  public boolean doSomething(){/*...*/}  // Compliant
}
</pre>
<h3>Exceptions</h3>
<p>This rule does not raise issues when overriding methods from <code>Object</code> (eg: <code>equals()</code>, <code>hashCode()</code>,
<code>toString()</code>, …​).</p></p>
            </div>
        <div class="rule">
            <h3>Checked exceptions should not be thrown (java:S1162)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The purpose of checked exceptions is to ensure that errors will be dealt with, either by propagating them or by handling them, but some believe
that checked exceptions negatively impact the readability of source code, by spreading this error handling/propagation logic everywhere.</p>
<p>This rule verifies that no method throws a new checked exception.</p>
<h3>Noncompliant code example</h3>
<pre>
public void myMethod1() throws CheckedException {
  ...
  throw new CheckedException(message);   // Noncompliant
  ...
  throw new IllegalArgumentException(message); // Compliant; IllegalArgumentException is unchecked
}

public void myMethod2() throws CheckedException {  // Compliant; propagation allowed
  myMethod1();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Exceptions should not be thrown in finally blocks (java:S1163)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/FTZGBQ">CERT, ERR05-J.</a> - Do not let checked exceptions escape from a finally block </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>If an exception is already being thrown within the <code>try</code> block or caught in a <code>catch</code> block, throwing another exception in
the <code>finally</code> block will override the original exception. This means that the original exception’s message and stack trace will be lost,
potentially making it challenging to diagnose and troubleshoot the root cause of the problem.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
try {
  /* some work which end up throwing an exception */
  throw new IllegalArgumentException();
} finally {
  /* clean up */
  throw new RuntimeException();       // Noncompliant; masks the IllegalArgumentException
}
</pre>
<pre data-diff-id="1" data-diff-type="compliant">
try {
  /* some work which end up throwing an exception */
  throw new IllegalArgumentException();
} finally {
  /* clean up */
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Exception classes should have final fields (java:S1165)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a class has all <code>final</code> fields, the compiler ensures that the object’s state remains constant. It also enforces a clear design
intent of immutability, making the class easier to reason about and use correctly.</p>
<p>Exceptions are meant to represent the application’s state at the point at which an error occurred. Making all fields in an <code>Exception</code>
class <code>final</code> ensures that these class fields do not change after initialization.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyException extends Exception {

  private int status;                        // Noncompliant

  public MyException(String message) {
    super(message);
  }

  public int getStatus() {
    return status;
  }

  public void setStatus(int status) {
    this.status = status;
  }

}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyException extends Exception {

  private final int status;                  // Compliant

  public MyException(String message, int status) {
    super(message);
    this.status = status;
  }

  public int getStatus() {
    return status;
  }

}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> Effective Java 3rd Edition, Joshua Bloch - Exceptions - Item 76 : Strive for failure atomicity </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Exception handlers should preserve the original exceptions (java:S1166)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When handling a caught exception, the original exception’s message and stack trace should be logged or passed forward.</p>
<h3>Noncompliant code example</h3>
<pre>
try {
  /* ... */
} catch (Exception e) {   // Noncompliant - exception is lost
  LOGGER.info("context");
}

try {
  /* ... */
} catch (Exception e) {  // Noncompliant - exception is lost (only message is preserved)
  LOGGER.info(e.getMessage());
}

try {
  /* ... */
} catch (Exception e) {  // Noncompliant - original exception is lost
  throw new RuntimeException("context");
}
</pre>
<h3>Compliant solution</h3>
<pre>
try {
  /* ... */
} catch (Exception e) {
  LOGGER.info(e);  // exception is logged
}

try {
  /* ... */
} catch (Exception e) {
  throw new RuntimeException(e);   // exception stack trace is propagated
}

try {
  /* ... */
} catch (RuntimeException e) {
  doSomething();
  throw e;  // original exception passed forward
} catch (Exception e) {
  throw new RuntimeException(e);  // Conversion into unchecked exception is also allowed
}
</pre>
<h3>Exceptions</h3>
<p><code>InterruptedException</code>, <code>NumberFormatException</code>, <code>DateTimeParseException</code>, <code>ParseException</code> and
<code>MalformedURLException</code> exceptions are arguably used to indicate nonexceptional outcomes. Similarly, handling
<code>NoSuchMethodException</code> is often required when dealing with the Java reflection API.</p>
<p>Because they are part of Java, developers have no choice but to deal with them. This rule does not verify that those particular exceptions are
correctly handled.</p>
<pre>
int myInteger;
try {
  myInteger = Integer.parseInt(myString);
} catch (NumberFormatException e) {
  // It is perfectly acceptable to not handle "e" here
  myInteger = 0;
}
</pre>
<p>Furthermore, no issue will be raised if the exception message is logged with additional information, as it shows that the developer added some
context to the error message.</p>
<pre>
try {
  /* ... */
} catch (Exception e) {
  String message = "Exception raised while authenticating user: " + e.getMessage();
  LOGGER.warn(message); // Compliant - exception message logged with some contextual information
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A10_2017-Insufficient_Logging%2526Monitoring">Top 10 2017 Category A10 -
  Insufficient Logging &amp; Monitoring</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/xDdGBQ">CERT, ERR00-J.</a> - Do not suppress or ignore checked exceptions </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/778">CWE-778 - Insufficient Logging</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Parsing should be used to convert "Strings" to primitives (java:S2130)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Rather than creating a boxed primitive from a <code>String</code> to extract the primitive value, use the relevant <code>parse</code> method
instead. Using <code>parse</code> makes the code more efficient and the intent of the developer clearer.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
String myNum = "42.0";
float myFloat = new Float(myNum);  // Noncompliant
float myFloatValue = (new Float(myNum)).floatValue();  // Noncompliant
int myInteger = Integer.valueOf(myNum); // Noncompliant
int myIntegerValue = Integer.valueOf(myNum).intValue(); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
String myNum = "42.0";
float f = Float.parseFloat(myNum);
int myInteger = Integer.parseInt(myNum);
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes extending java.lang.Thread should provide a specific "run" behavior (java:S2134)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>To fix this issue, you have 2 options:</p>
<ul>
  <li> override the <code>run</code> method </li>
</ul>
<pre>
public class MyThread extends Thread {
  @Override
  public void run() {
    System.out.println("Hello, World!");
  }
}
</pre>
<ul>
  <li> provide a <code>Runnable</code> at construction time </li>
</ul>
<pre>
public class MyRunnable implements Runnable {
  @Override
  public void run() {
    System.out.println("Hello, World!");
  }
}
public class MyThread extends Thread {
  public MyThread(Runnable runnable) {
    super(runnable);
  }
}

public class Main() {
  public static void main(String [] args) {
    Runnable runnable = new MyRunnable();
    Thread customThread = new MyThread(runnable);
    Thread regularThread = new Thread(runnable);
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The default implementation of <code>java.lang.Thread</code> 's <code>run</code> will only perform a task passed as a <code>Runnable</code>. If no
<code>Runnable</code> has been provided at construction time, then the thread will not perform any action.</p>
<p>When extending <code>java.lang.Thread</code>, you should override the <code>run</code> method or pass a <code>Runnable</code> target to the
constructor of <code>java.lang.Thread</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyThread extends Thread { // Noncompliant
  public void doSomething() {
    System.out.println("Hello, World!");
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Exceptions should be either logged or rethrown but not both (java:S2139)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In applications where the accepted practice is to log an <code>Exception</code> and then rethrow it, you end up with miles-long logs that contain
multiple instances of the same exception. In multi-threaded applications debugging this type of log can be particularly hellish because messages from
other threads will be interwoven with the repetitions of the logged-and-thrown <code>Exception</code>. Instead, exceptions should be either logged or
rethrown, not both.</p>
<h3>Noncompliant code example</h3>
<pre>
catch (SQLException e) {
  ...
  LOGGER.log(Level.ERROR,  contextInfo, e);
  throw new MySQLException(contextInfo, e);
}
</pre>
<h3>Compliant solution</h3>
<pre>
catch (SQLException e) {
  ...
  throw new MySQLException(contextInfo, e);
}
</pre>
<p>or</p>
<pre>
catch (SQLException e) {
  ...
  LOGGER.log(Level.ERROR,  contextInfo, e);
  // handle exception...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Collection methods with O(n) performance should be used carefully (java:S2250)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The time complexity of method calls on collections is not always obvious. For instance, for most collections the <code>size()</code> method takes
constant time, but the time required to execute <code>ConcurrentLinkedQueue.size()</code> is O(n), i.e. directly proportional to the number of
elements in the collection. When the collection is large, this could therefore be an expensive operation.</p>
<p>This rule raises an issue when the following O(n) methods are called outside of constructors on class fields:</p>
<ul>
  <li> <code>ArrayList</code>
    <ul>
      <li> <code>contains</code> </li>
      <li> <code>remove</code> </li>
    </ul>  </li>
  <li> <code>LinkedList</code>
    <ul>
      <li> <code>get</code> </li>
      <li> <code>contains</code> </li>
    </ul>  </li>
  <li> <code>ConcurrentLinkedQueue</code>
    <ul>
      <li> <code>size</code> </li>
      <li> <code>contains</code> </li>
    </ul>  </li>
  <li> <code>ConcurrentLinkedDeque</code>
    <ul>
      <li> <code>size</code> </li>
      <li> <code>contains</code> </li>
    </ul>  </li>
  <li> <code>CopyOnWriteArrayList</code>
    <ul>
      <li> <code>add</code> </li>
      <li> <code>contains</code> </li>
      <li> <code>remove</code> </li>
    </ul>  </li>
  <li> <code>CopyOnWriteArraySet</code>
    <ul>
      <li> <code>add</code> </li>
      <li> <code>contains</code> </li>
      <li> <code>remove</code> </li>
    </ul>  </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
ConcurrentLinkedQueue queue = new ConcurrentLinkedQueue();
//...
log.info("Queue contains " + queue.size() + " elements");  // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>A "for" loop update clause should move the counter in the right direction (java:S2251)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>for</code> loop with a counter moving away from the end of the specified range is likely a programming mistake.</p>
<p>If the intention is to iterate over the specified range, this differs from what the loop does because the counter moves in the wrong direction.</p>
<p>If the intention is to have an infinite loop or a loop terminated only by a break statement, there are two problems:</p>
<ol>
  <li> The loop condition is not infinite because the counter variable will eventually overflow and fulfill the condition. This can take a long time,
  depending on the data type of the counter. </li>
  <li> An infinite loop terminated by a <code>break</code> statement should be implemented using a <code>while</code> or <code>do</code>
  <code>while</code> loop to make the developer’s intention clear to the reader. </li>
</ol></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>Change the direction of the counter.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
for (int i = 10; i &gt; 0; i++) { // Noncompliant, wrong direction
  System.out.println("Hello, world!") // executed ca. 2 billion times
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
public void doSomething(String [] strings) {
  for (int i = 0; i &lt; strings.length; i--) { // Noncompliant, wrong direction
    String string = strings[i];  // ArrayIndexOutOfBoundsException when i reaches -1
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
for (int i = 10; i &gt; 0; i--) { // Compliant
  System.out.println("Hello, world!") // executed 10 times
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
public void doSomething(String [] strings) {
  for (int i = 0; i &lt; strings.length; i++) { // Compliant
    String string = strings[i];
    // ...
  }
}
</pre>
<h4>Noncompliant code example</h4>
<p>If the intention is to have an infinite loop or a loop terminated only by a break statement, use a <code>while</code> or a <code>do</code>
<code>while</code> statement instead.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
for (int i = 0; i &lt; 0; i++) { // Noncompliant, loop is not infinite
  String event = waitForNextEvent();
  if (event == "terminate") break;
  processEvent(event);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
while (true) { // Compliant
  String event = waitForNextEvent();
  if (event == "terminate") break;
  processEvent(event);
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/aTdGBQ">CERT, MSC54-J.</a> - Avoid inadvertent wrapping of loop counters </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Integer_overflow">Wikipedia - Integer overflow</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Loop conditions should be true at least once (java:S2252)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/for.html">The <code>for</code> statement</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/for.html"><code>for</code></a> loop is a fundamental programming construct
used to execute a block of code repeatedly. However, if the loop’s condition is false before the first iteration, the loop will never execute.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
for (int i = 0; i &lt; 0; i++) {  // Noncompliant: the condition is always false, and the loop will never execute
    // ...
}
</pre>
<p>Rewrite the loop to ensure the condition evaluates to <code>true</code> at least once.</p>
<pre data-diff-id="1" data-diff-type="compliant">
for (int i = 0; i &lt; 10; i++) {  // Compliant: the condition is true at least once, the loop will execute
    // ...
}
</pre>
<p>This bug has the potential to cause unexpected outcomes as the loop might contain critical code that needs to be executed.</p></p>
            </div>
        <div class="rule">
            <h3>Track uses of disallowed methods (java:S2253)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule allows banning certain methods.</p>
<h3>Noncompliant code example</h3>
<p>Given parameters:</p>
<ul>
  <li> className:java.lang.String </li>
  <li> methodName: replace </li>
  <li> argumentTypes: java.lang.CharSequence, java.lang.CharSequence </li>
</ul>
<pre>
String name;
name.replace("A","a");  // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>LDAP connections should be authenticated (java:S4433)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>Lightweight Directory Access Protocol (LDAP) servers provide two main authentication methods: the <em>SASL</em> and <em>Simple</em> ones. The
<em>Simple Authentication</em> method also breaks down into three different mechanisms:</p>
<ul>
  <li> <em>Anonymous</em> Authentication </li>
  <li> <em>Unauthenticated</em> Authentication </li>
  <li> <em>Name/Password</em> Authentication </li>
</ul>
<p>A server that accepts either the <em>Anonymous</em> or <em>Unauthenticated</em> mechanisms will accept connections from clients not providing
credentials.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://datatracker.ietf.org/doc/html/rfc4513#section-5">RFC 4513 - Lightweight Directory Access Protocol (LDAP): Authentication
  Methods and Security Mechanisms</a> - Bind operations </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/521">CWE-521 - Weak Password Requirements</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code indicates an anonymous LDAP authentication vulnerability because it binds to a remote server using an Anonymous Simple
authentication mechanism.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
// Set up the environment for creating the initial context
Hashtable&lt;String, Object&gt; env = new Hashtable&lt;String, Object&gt;();
env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
env.put(Context.PROVIDER_URL, "ldap://localhost:389/o=JNDITutorial");

// Use anonymous authentication
env.put(Context.SECURITY_AUTHENTICATION, "none"); // Noncompliant

// Create the initial context
DirContext ctx = new InitialDirContext(env);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
// Set up the environment for creating the initial context
Hashtable&lt;String, Object&gt; env = new Hashtable&lt;String, Object&gt;();
env.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.ldap.LdapCtxFactory");
env.put(Context.PROVIDER_URL, "ldap://localhost:389/o=Example");

// Use simple authentication
env.put(Context.SECURITY_AUTHENTICATION, "simple");
env.put(Context.SECURITY_PRINCIPAL, "cn=local, ou=Unit, o=Example");
env.put(Context.SECURITY_CREDENTIALS, getLDAPPassword());

// Create the initial context
DirContext ctx = new InitialDirContext(env);
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When configured to accept the Anonymous or Unauthenticated authentication mechanism, an LDAP server will accept connections from clients that do
not provide a password or other authentication credentials. Such users will be able to read or modify part or all of the data contained in the hosted
directory.</p>
<h3>What is the potential impact?</h3>
<p>An attacker exploiting unauthenticated access to an LDAP server can access the data that is stored in the corresponding directory. The impact
varies depending on the permission obtained on the directory and the type of data it stores.</p>
<h4>Authentication bypass</h4>
<p>If attackers get write access to the directory, they will be able to alter most of the data it stores. This might include sensitive technical data
such as user passwords or asset configurations. Such an attack can typically lead to an authentication bypass on applications and systems that use the
affected directory as an identity provider.</p>
<p>In such a case, all users configured in the directory might see their identity and privileges taken over.</p>
<h4>Sensitive information leak</h4>
<p>If attackers get read-only access to the directory, they will be able to read the data it stores. That data might include security-sensitive pieces
of information.</p>
<p>Typically, attackers might get access to user account lists that they can use in further intrusion steps. For example, they could use such lists to
perform password spraying, or related attacks, on all systems that rely on the affected directory as an identity provider.</p>
<p>If the directory contains some Personally Identifiable Information, an attacker accessing it might represent a violation of regulatory requirements
in some countries. For example, this kind of security event would go against the European GDPR law.</p></p>
            </div>
        <div class="rule">
            <h3>Enum values should be compared with "==" (java:S4551)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://www.infoworld.com/article/2074292/use-----or-----to-compare-java-enums.html">Use == (or !=) to Compare Java Enums</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Testing equality of an enum value with <code>equals</code> is perfectly valid because an enum is an Object and every Java developer knows "=="
should not be used to compare the content of an Object. At the same time, using "==" on enums:</p>
<ul>
  <li> provides the same expected comparison (content) as <code>equals</code> </li>
  <li> is more null-safe than equals() </li>
  <li> provides compile-time (static) checking rather than runtime checking </li>
</ul>
<p>For these reasons, use of "==" should be preferred to <code>equals</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public enum Fruit {
   APPLE, BANANA, GRAPE
}

public enum Cake {
  LEMON_TART, CHEESE_CAKE
}

public boolean isFruitGrape(Fruit candidateFruit) {
  return candidateFruit.equals(Fruit.GRAPE); // Noncompliant; this will raise an NPE if candidateFruit is NULL
}

public boolean isFruitGrape(Cake candidateFruit) {
  return candidateFruit.equals(Fruit.GRAPE); // Noncompliant; always returns false
}
</pre>
<h3>Compliant solution</h3>
<pre>
public boolean isFruitGrape(Fruit candidateFruit) {
  return candidateFruit == Fruit.GRAPE; // Compliant; there is only one instance of Fruit.GRAPE - if candidateFruit is a GRAPE it will have the same reference as Fruit.GRAPE
}

public boolean isFruitGrape(Cake candidateFruit) {
  return candidateFruit == Fruit.GRAPE; // Compliant; compilation time failure
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Using weak hashing algorithms is security-sensitive (java:S4790)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Compliant Solution</h2>
<pre>
MessageDigest md1 = MessageDigest.getInstance("SHA-512"); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>Cryptographic hash algorithms such as <code>MD2</code>, <code>MD4</code>, <code>MD5</code>, <code>MD6</code>, <code>HAVAL-128</code>,
<code>HMAC-MD5</code>, <code>DSA</code> (which uses <code>SHA-1</code>), <code>RIPEMD</code>, <code>RIPEMD-128</code>, <code>RIPEMD-160</code>,
<code>HMACRIPEMD160</code> and <code>SHA-1</code> are no longer considered secure, because it is possible to have <code>collisions</code> (little
computational effort is enough to find two or more different inputs that produce the same hash).</p>
<h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Safer alternatives, such as <code>SHA-256</code>, <code>SHA-512</code>, <code>SHA-3</code> are recommended, and for password hashing, it’s even
better to use algorithms that do not compute too "quickly", like <code>bcrypt</code>, <code>scrypt</code>, <code>argon2</code> or <code>pbkdf2</code>
because it slows down <code>brute force attacks</code>.</p>
<h2>Sensitive Code Example</h2>
<pre>
MessageDigest md1 = MessageDigest.getInstance("SHA");  // Sensitive:  SHA is not a standard name, for most security providers it's an alias of SHA-1
MessageDigest md2 = MessageDigest.getInstance("SHA1");  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
MessageDigest md1 = MessageDigest.getInstance("SHA-512"); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/1240">CWE-1240 - Use of a Risky Cryptographic Primitive</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<p>The hashed value is used in a security context like:</p>
<ul>
  <li> User-password storage. </li>
  <li> Security token generation (used to confirm e-mail when registering on a website, reset password, etc …​). </li>
  <li> To compute some message integrity. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
MessageDigest md1 = MessageDigest.getInstance("SHA");  // Sensitive:  SHA is not a standard name, for most security providers it's an alias of SHA-1
MessageDigest md2 = MessageDigest.getInstance("SHA1");  // Sensitive
</pre>
</p>
            </div>
        <div class="rule">
            <h3>Server hostnames should be verified during SSL/TLS connections (java:S5527)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled because <code>mail.smtp.ssl.checkserveridentity</code> is omitted. To enable validation, set it to
<code>true</code>.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
import java.util.Properties;

public Properties prepareEmailConnection() {
    Properties props = new Properties();

    props.put("mail.smtp.host", "smtp.gmail.com");
    props.put("mail.smtp.socketFactory.port", "465");
    props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory"); // Noncompliant
    props.put("mail.smtp.auth", "true");
    props.put("mail.smtp.port", "465");

    return props;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
import java.util.Properties;

public Properties prepareEmailConnection() {
    Properties props = new Properties();

    props.put("mail.smtp.host", "smtp.gmail.com");
    props.put("mail.smtp.socketFactory.port", "465");
    props.put("mail.smtp.ssl.checkserveridentity", true);
    props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
    props.put("mail.smtp.auth", "true");
    props.put("mail.smtp.port", "465");

    return props;
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled because <code>setSSLCheckServerIdentity</code> is omitted. To enable validation, set it to
<code>true</code>.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.apache.commons.mail.DefaultAuthenticator;
import org.apache.commons.mail.Email;
import org.apache.commons.mail.SimpleEmail;

public void sendMail(String message) {
    Email email = new SimpleEmail();

    email.setMsg(message);
    email.setSmtpPort(465);
    email.setAuthenticator(new DefaultAuthenticator(username, password));
    email.setSSLOnConnect(true); // Noncompliant

    email.send();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.apache.commons.mail.DefaultAuthenticator;
import org.apache.commons.mail.Email;
import org.apache.commons.mail.SimpleEmail;

public void sendMail(String message) {
    Email email = new SimpleEmail();

    email.setMsg(message);
    email.setSmtpPort(465);
    email.setAuthenticator(new DefaultAuthenticator(username, password));
    email.setSSLCheckServerIdentity(true);
    email.setSSLOnConnect(true);

    email.send();
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-NETWORK/">Mobile AppSec Verification Standard - Network Communication Requirements</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/297">CWE-297 - Improper Validation of Certificate with Host Mismatch</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222550">Application Security and
  Development: V-222550</a> - The application must validate certificates by constructing a certification path to an accepted trust anchor. </li>
  <li> <a
  href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them. In this
process, the role of hostname validation, combined with certificate validation, is to ensure that a system is indeed the one it claims to be, adding
an extra layer of trust and security.</p>
<p>When hostname validation is disabled, the client skips this critical check. This creates an opportunity for attackers to pose as a trusted entity
and intercept, manipulate, or steal the data being transmitted.</p>
<p>To do so, an attacker would obtain a valid certificate authenticating <code>example.com</code>, serve it using a different hostname, and the
application code would still accept it.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable hostname validation, you are removing a key mechanism designed to build
this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate hostnames, it cannot confirm the identity of the other party involved in the communication. An attacker can exploit
this by creating a fake server and masquerading it as a legitimate one. For example, they might set up a server that looks like your bank’s server,
tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect any data
your system sends to them, potentially leading to significant data breaches.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability allows attackers to impersonate a trusted host.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of disabled hostname validation.</p>
<p>The hostname validation gets disabled by overriding <code>javax.net.ssl.HostnameVerifier.verify()</code> with an empty implementation. It is highly
recommended to use the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="21" data-diff-type="noncompliant">
import java.io.InputStream;
import java.net.URL;
import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLSession;
import javax.net.ssl.HostnameVerifier;

public InputStream doRequest() {
    URL url                          = new URL("https://example.org/");
    HttpsURLConnection urlConnection = (HttpsURLConnection)url.openConnection();

    urlConnection.setHostnameVerifier(new HostnameVerifier() {
      @Override
      public boolean verify(String requestedHost, SSLSession remoteServerSession) {
        return true;  // Noncompliant
      }
    });

    return urlConnection.getInputStream();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="21" data-diff-type="compliant">
import java.io.InputStream;
import java.net.URL;
import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLSession;

public InputStream doRequest() {
    URL url                          = new URL("https://example.org/");
    HttpsURLConnection urlConnection = (HttpsURLConnection)url.openConnection();

    return urlConnection.getInputStream();
}
</pre>
<h3>How does this work?</h3>
<p>To fix the vulnerability of disabled hostname validation, it is strongly recommended to first re-enable the default validation and fix the root
cause: the validity of the certificate.</p>
<h4>Use valid certificates</h4>
<p>If a hostname validation failure prevents connecting to the target server, keep in mind that <strong>one system’s code should not work around
another system’s problems</strong>, as this creates unnecessary dependencies and can lead to reliability issues.</p>
<p>Therefore, the first solution is to change the remote host’s certificate to match its identity. If the remote host is not under your control,
consider replicating its service to a server whose certificate you can change yourself.</p>
<p>In case the contacted host is located on a development machine, and if there is no other choice, try following this solution:</p>
<ul>
  <li> Create a self-signed certificate for that machine. </li>
  <li> Add this self-signed certificate to the system’s trust store. </li>
  <li> If the hostname is not <code>localhost</code>, add the hostname in the <code>/etc/hosts</code> file. </li>
</ul>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre></p>
            </div>
        <div class="rule">
            <h3>Literal suffixes should be upper case (java:S818)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using upper case literal suffixes removes the potential ambiguity between "1" (digit 1) and "l" (letter el) for declaring literals.</p>
<h3>Noncompliant code example</h3>
<pre>
long long1 = 1l; // Noncompliant
float float1 = 1.0f; // Noncompliant
double double1 = 1.0d; // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
long long1 = 1L;
float float1 = 1.0F;
double double1 = 1.0D;
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/cdYxBQ">CERT DCL16-C.</a> - Use "L," not "l," to indicate a long value </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/7DZGBQ">CERT, DCL50-J.</a> - Use visually distinct identifiers </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"switch" statements should have at least 3 "case" clauses (java:S1301)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>switch</code> statements are useful when there are many different cases depending on the value of the same expression.</p>
<p>For just one or two cases, however, the code will be more readable with <code>if</code> statements.</p>
<h3>Noncompliant code example</h3>
<pre>
switch (variable) {
  case 0:
    doSomething();
    break;
  default:
    doSomethingElse();
    break;
}
</pre>
<h3>Compliant solution</h3>
<pre>
if (variable == 0) {
  doSomething();
} else {
  doSomethingElse();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Track uses of "@SuppressWarnings" annotations (java:S1309)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule allows you to track the usage of the <code>@SuppressWarnings</code> mechanism.</p>
<h3>Noncompliant code example</h3>
<p>With a parameter value of "unused" :</p>
<pre>
@SuppressWarnings("unused")
@SuppressWarnings("unchecked")  // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Methods should not be too complex (java:S1541)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The cyclomatic complexity of methods should not exceed a defined threshold.</p>
<p>Complex code can perform poorly and will in any case be difficult to understand and therefore to maintain.</p>
<h3>Exceptions</h3>
<p>While having a large number of fields in a class may indicate that it should be split, this rule nonetheless ignores high complexity in
<code>equals</code> and <code>hashCode</code> methods.</p></p>
            </div>
        <div class="rule">
            <h3>Variables should not be self-assigned (java:S1656)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5dUxBQ">CERT, MSC12-C.</a> - Detect and remove code that has no effect or is never executed
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>There is no reason to re-assign a variable to itself. Either this statement is redundant and should be removed, or the re-assignment is a mistake
and some other value or variable was intended for the assignment instead.</p>
<h3>Noncompliant code example</h3>
<pre>
public void setName(String name) {
  name = name;
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void setName(String name) {
  this.name = name;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Multiple variables should not be declared on the same line (java:S1659)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/YTZGBQ">CERT, DCL52-J.</a> - Do not declare more than one variable per declaration </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/EtcxBQ">CERT, DCL04-C.</a> - Do not declare more than one variable per declaration </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Declaring multiple variables on one line is difficult to read.</p>
<h3>Noncompliant code example</h3>
<pre>
class MyClass {

  private int a, b;

  public void method(){
    int c; int d;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class MyClass {

  private int a;
  private int b;

  public void method(){
    int c;
    int d;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Loops with at most one iteration should be refactored (java:S1751)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/for.html">Oracle - The for Statement</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A loop with at most one iteration is equivalent to an <code>if</code> statement. This can confuse developers and make the code less readable since
loops are not meant to replace <code>if</code> statements.</p>
<p>If the intention was to conditionally execute the block only once, an <code>if</code> statement should be used instead. Otherwise, the loop should
be fixed so the loop block can be executed multiple times.</p>
<p>A loop statement with at most one iteration can happen when a statement that unconditionally transfers control, such as a jump or throw statement,
is misplaced inside the loop block.</p>
<p>This rule arises when the following statements are misplaced:</p>
<ul>
  <li> <code>break</code> </li>
  <li> <code>return</code> </li>
  <li> <code>throw</code> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
int i = 0;
while(i &lt; 10) { // Noncompliant; loop only executes once
  System.out.println("i is " + i);
  i++;
  break;
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
for (int i = 0; i &lt; 10; i++) { // Noncompliant; loop only executes once
  if (i == x) {
    break;
  } else {
    System.out.println("i is " + i);
    return;
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
int i = 0;
while (i &lt; 10) {
  System.out.println("i is " + i);
  i++;
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
for (int i = 0; i &lt; 10; i++) {
  if (i == x) {
    break;
  } else {
    System.out.println("i is " + i);
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>The ternary operator should not be used (java:S1774)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Ternary expressions, while concise, can often lead to code that is difficult to read and understand, especially when they are nested or complex.
Prioritizing readability fosters maintainability and reduces the likelihood of bugs. Therefore, they should be removed in favor of more explicit
control structures, such as <code>if</code>/<code>else</code> statements, to improve the clarity and readability of the code.</p>

<h4>Noncompliant code example</h4>
<pre>
System.out.println(i&gt;10?"yes":"no");  // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre>
if (i &gt; 10) {
  System.out.println("yes");
} else {
  System.out.println("no");
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Two branches in a conditional structure should not have exactly the same implementation (java:S1871)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS3923'>S3923</a> - All branches in a conditional structure should not have exactly the same implementation </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When the same code is duplicated in two or more separate branches of a conditional, it can make the code harder to understand, maintain, and can
potentially introduce bugs if one instance of the code is changed but others are not.</p>
<p>Having two <code>cases</code> in a <code>switch</code> statement or two branches in an <code>if</code> chain with the same implementation is at
best duplicate code, and at worst a coding error.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
if (a &gt;= 0 &amp;&amp; a &lt; 10) {
  doFirstThing();
  doTheThing();
}
else if (a &gt;= 10 &amp;&amp; a &lt; 20) {
  doTheOtherThing();
}
else if (a &gt;= 20 &amp;&amp; a &lt; 50) {
  doFirstThing();
  doTheThing();  // Noncompliant; duplicates first condition
}
else {
  doTheRest();
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
switch (i) {
  case 1:
    doFirstThing();
    doSomething();
    break;
  case 2:
    doSomethingDifferent();
    break;
  case 3:  // Noncompliant; duplicates case 1's implementation
    doFirstThing();
    doSomething();
    break;
  default:
    doTheRest();
}
</pre>
<p>If the same logic is truly needed for both instances, then:</p>
<ul>
  <li> in an <code>if</code> chain they should be combined </li>
</ul>
<pre data-diff-id="1" data-diff-type="compliant">
if ((a &gt;= 0 &amp;&amp; a &lt; 10) || (a &gt;= 20 &amp;&amp; a &lt; 50)) { // Compliant
  doFirstThing();
  doTheThing();
}
else if (a &gt;= 10 &amp;&amp; a &lt; 20) {
  doTheOtherThing();
}
else {
  doTheRest();
}
</pre>
<ul>
  <li> for a <code>switch</code>, one should fall through to the other </li>
</ul>
<pre data-diff-id="2" data-diff-type="compliant">
switch (i) {
  case 1:
  case 3: // Compliant
    doFirstThing();
    doSomething();
    break;
  case 2:
    doSomethingDifferent();
    break;
  default:
    doTheRest();
}
</pre>
<p>When all blocks are identical, either this rule will trigger if there is no default clause or rule <a href='/coding_rules#rule_key=java%3AS3923'>S3923</a> will raise if there is a
default clause.</p>
<h3>Exceptions</h3>
<p>Unless all blocks are identical, blocks in an <code>if</code> chain that contain a single line of code are ignored. The same applies to blocks in a
<code>switch</code> statement that contains a single line of code with or without a following <code>break</code>.</p>
<pre>
if (a == 1) {
  doSomething();  // Compliant, usually this is done on purpose to increase the readability
} else if (a == 2) {
  doSomethingElse();
} else {
  doSomething();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes should not be compared by name (java:S1872)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There is no requirement that class names be unique, only that they be unique within a package. Therefore trying to determine an object’s type based
on its class name is an exercise fraught with danger. One of those dangers is that a malicious user will send objects of the same name as the trusted
class and thereby gain trusted access.</p>
<p>Instead, the <code>instanceof</code> operator or the <code>Class.isAssignableFrom()</code> method should be used to check the object’s underlying
type.</p>
<h3>Noncompliant code example</h3>
<pre>
package computer;
class Pear extends Laptop { ... }

package food;
class Pear extends Fruit { ... }

class Store {

  public boolean hasSellByDate(Object item) {
    if ("Pear".equals(item.getClass().getSimpleName())) {  // Noncompliant
      return true;  // Results in throwing away week-old computers
    }
    return false;
  }

  public boolean isList(Class&lt;T&gt; valueClass) {
    if (List.class.getName().equals(valueClass.getName())) {  // Noncompliant
      return true;
    }
    return false;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class Store {

  public boolean hasSellByDate(Object item) {
    if (item instanceof food.Pear) {
      return true;
    }
    return false;
  }

  public boolean isList(Class&lt;T&gt; valueClass) {
    if (valueClass.isAssignableFrom(List.class)) {
      return true;
    }
    return false;
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/486">CWE-486 - Comparison of Classes by Name</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/eDdGBQ">CERT, OBJ09-J.</a> - Compare classes and not class names </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"@Deprecated" code should not be used (java:S1874)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Code is sometimes annotated as deprecated by developers maintaining libraries or APIs to indicate that the method, class, or other programming
element is no longer recommended for use. This is typically due to the introduction of a newer or more effective alternative. For example, when a
better solution has been identified, or when the existing code presents potential errors or security risks.</p>
<p>Deprecation is a good practice because it helps to phase out obsolete code in a controlled manner, without breaking existing software that may
still depend on it. It is a way to warn other developers not to use the deprecated element in new code, and to replace it in existing code when
possible.</p>
<p>Deprecated classes, interfaces, and their members should not be used, inherited or extended because they will eventually be removed. The
deprecation period allows you to make a smooth transition away from the aging, soon-to-be-retired technology.</p>
<p>Check the documentation or the deprecation message to understand why the code was deprecated and what the recommended alternative is.</p>
<pre>
/**
 * @deprecated  As of release 1.3, replaced by {@link #Foo}
 */
@Deprecated
public class Fum { ... }

public class Foo {
  /**
   * @deprecated  As of release 1.7, replaced by {@link #newMethod()}
   */
  @Deprecated
  public void oldMethod() { ... }

  public void newMethod() { ... }
}

public class Bar extends Foo {
  public void oldMethod() { ... } // Noncompliant; don't override a deprecated method
}

public class Baz extends Fum {  // Noncompliant; Fum is deprecated
  public void myMethod() {
    Foo foo = new Foo();
    foo.oldMethod();  // Noncompliant; oldMethod method is deprecated
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/477">CWE-477 - Use of Obsolete Functions</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"for" loop increment clauses should modify the loops' counters (java:S1994)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The counter of a <code>for</code> loop should be updated in the loop’s increment clause. The purpose of a <code>for</code> loop is to iterate over
a range using a counter variable. It should not be used for other purposes, and alternative loops should be used in those cases.</p>
<p>If the counter is not updated, the loop will be infinite with a constant counter variable. If this is intentional, use a <code>while</code> or
<code>do</code> <code>while</code> loop instead of a <code>for</code> loop.</p>
<p>If the counter variable is updated within the loop’s body, try to move it to the increment clause. If this is impossible due to certain conditions,
replace the <code>for</code> loop with a <code>while</code> or <code>do</code> <code>while</code> loop.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>Move the counter variable update to the loop’s increment clause.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
for (int i = 0; i &lt; 10; ) { // Noncompliant, i not updated in increment clause
  // ...
  i++;
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
int sum = 0
for (int i = 0; i &lt; 10; sum++) { // Noncompliant, i not updated in increment clause
  // ...
  i++;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
for (i = 0; i &lt; 10; i++) { // Compliant
  // ...
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
int sum = 0
for (int i = 0; i &lt; 10; i++) { // Compliant
  // ...
  sum++;
}
</pre>
<h4>Noncompliant code example</h4>
<p>If this is impossible and the counter variable must be updated in the loop’s body, use a <code>while</code> or <code>do</code> <code>while</code>
loop instead.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
for (int sum = 0; sum &lt; 10) { // Noncompliant, sum not updated in increment clause
  // ...
  if (condition) sum++;
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
int sum = 0;
while (sum &lt; 10) { // Compliant
  // ...
  if (condition) sum++;
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Files should contain only one top-level class or interface each (java:S1996)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A file that grows too much tends to aggregate too many responsibilities and inevitably becomes harder to understand and therefore to maintain. This
is doubly true for a file with multiple top-level classes and interfaces. It is strongly advised to divide the file into one top-level class or
interface per file.</p></p>
            </div>
        <div class="rule">
            <h3>"Preconditions" and logging arguments should not require evaluation (java:S2629)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Some method calls can effectively be "no-ops", meaning that the invoked method does nothing, based on the application’s configuration (eg: debug
logs in production). However, even if the method effectively does nothing, its arguments may still need to evaluated before the method is called.</p>
<p>Passing message arguments that require further evaluation into a Guava <code>com.google.common.base.Preconditions</code> check can result in a
performance penalty. That is because whether or not they’re needed, each argument must be resolved before the method is actually called.</p>
<p>Similarly, passing concatenated strings into a logging method can also incur a needless performance hit because the concatenation will be performed
every time the method is called, whether or not the log level is low enough to show the message.</p>
<p>Instead, you should structure your code to pass static or pre-computed values into <code>Preconditions</code> conditions check and logging
calls.</p>
<p>Specifically, the built-in string formatting should be used instead of string concatenation, and if the message is the result of a method call,
then <code>Preconditions</code> should be skipped altogether, and the relevant exception should be conditionally thrown instead.</p>
<h3>Noncompliant code example</h3>
<pre>
logger.log(Level.DEBUG, "Something went wrong: " + message);  // Noncompliant; string concatenation performed even when log level too high to show DEBUG messages

logger.fine("An exception occurred with message: " + message); // Noncompliant

LOG.error("Unable to open file " + csvPath, e);  // Noncompliant

Preconditions.checkState(a &gt; 0, "Arg must be positive, but got " + a);  // Noncompliant. String concatenation performed even when a &gt; 0

Preconditions.checkState(condition, formatMessage());  // Noncompliant. formatMessage() invoked regardless of condition

Preconditions.checkState(condition, "message: %s", formatMessage());  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
logger.log(Level.DEBUG, "Something went wrong: {0} ", message);  // String formatting only applied if needed
logger.log(Level.SEVERE, () -&gt; "Something went wrong: " + message); // since Java 8, we can use Supplier , which will be evaluated lazily

logger.fine("An exception occurred with message: {}", message);  // SLF4J, Log4j

LOG.error("Unable to open file {0}", csvPath, e);

if (LOG.isDebugEnabled()) {
  LOG.debug("Unable to open file " + csvPath, e);  // this is compliant, because it will not evaluate if log level is above debug.
}

Preconditions.checkState(arg &gt; 0, "Arg must be positive, but got %d", a);  // String formatting only applied if needed

if (!condition) {
  throw new IllegalStateException(formatMessage());  // formatMessage() only invoked conditionally
}

if (!condition) {
  throw new IllegalStateException("message: " + formatMessage());
}
</pre>
<h3>Exceptions</h3>
<p><code>catch</code> blocks are ignored, because the performance penalty is unimportant on exceptional paths (catch block should not be a part of
standard program flow). Getters are ignored as well as methods called on annotations which can be considered as getters. This rule accounts for
explicit test-level testing with SLF4J methods <code>isXXXEnabled</code> and ignores the bodies of such <code>if</code> statements.</p></p>
            </div>
        <div class="rule">
            <h3>"@NonNull" values should not be set to null (java:S2637)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Fields, parameters and return values marked <code>@NotNull</code>, <code>@NonNull</code>, or <code>@Nonnull</code> are assumed to have non-null
values and are not typically null-checked before use. Therefore setting one of these values to <code>null</code>, or failing to set such a class field
in a constructor, could cause <code>NullPointerException</code>s at runtime.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MainClass {

  @Nonnull
  private String primary;
  private String secondary;

  public MainClass(String color) {
    if (color != null) {
      secondary = null;
    }
    primary = color;  // Noncompliant; "primary" is Nonnull but could be set to null here
  }

  public MainClass() { // Noncompliant; "primary" is Nonnull but is not initialized
  }

  @Nonnull
  public String indirectMix() {
    String mix = null;
    return mix;  // Noncompliant; return value is Nonnull, but null is returned.
  }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/QdcxBQ">EXP34-C. Do not dereference null pointers</a> </li>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/display/java/EXP01-J.+Do+not+use+a+null+in+a+case+where+an+object+is+required">EXP01-J. Do
  not use a null in a case where an object is required</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/476">CWE-476 NULL Pointer Dereference</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Method overrides should not change contracts (java:S2638)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when an overriding method changes a contract defined in a superclass.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> SOLID - <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Wikipedia - Liskov substitution principle</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Because a subclass instance may be cast to and treated as an instance of the superclass, overriding methods should uphold the aspects of the
superclass contract that relate to the Liskov Substitution Principle. Specifically, if the parameters or return type of the superclass method are
marked with any of the following: <code>@Nullable</code>, <code>@CheckForNull</code>, <code>@NotNull</code>, <code>@NonNull</code>, and
<code>@Nonnull</code>, then subclass parameters are not allowed to tighten the contract, and return values are not allowed to loosen it.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Fruit {

  private Season ripe;
  private String color;

  public void setRipe(@Nullable Season ripe) {
    this.ripe = ripe;
  }

  public @NotNull Integer getProtein() {
    return 12;
  }
}

public class Raspberry extends Fruit {

  public void setRipe(@NotNull Season ripe) {  // Noncompliant: the ripe argument annotated as @Nullable in parent class
    this.ripe = ripe;
  }

  public @Nullable Integer getProtein() {  // Noncompliant: the return type annotated as @NotNull in parent class
    return null;
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Fruit {

  private Season ripe;
  private String color;

  public void setRipe(@Nullable Season ripe) {
    this.ripe = ripe;
  }

  public @NotNull Integer getProtein() {
    return 12;
  }
}

public class Raspberry extends Fruit {

  public void setRipe(@Nullable Season ripe) {
    this.ripe = ripe;
  }

  public @NotNull Integer getProtein() {
    return 12;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Inappropriate regular expressions should not be used (java:S2639)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Regular expressions are powerful but tricky, and even those long used to using them can make mistakes.</p>
<p>The following should not be used as regular expressions:</p>
<ul>
  <li> <code>.</code> - matches any single character. Used in <code>replaceAll</code>, it matches <em>everything</em> </li>
  <li> <code>|</code> - normally used as an option delimiter. Used stand-alone, it matches the space between characters </li>
  <li> <code>File.separator</code> - matches the platform-specific file path delimiter. On Windows, this will be taken as an escape character </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
String str = "/File|Name.txt";

String clean = str.replaceAll(".",""); // Noncompliant; probably meant to remove only dot chars, but returns an empty string
String clean2 = str.replaceAll("|","_"); // Noncompliant; yields _/_F_i_l_e_|_N_a_m_e_._t_x_t_
String clean3 = str.replaceAll(File.separator,""); // Noncompliant; exception on Windows

String clean4 = str.replaceFirst(".",""); // Noncompliant;
String clean5 = str.replaceFirst("|","_"); // Noncompliant;
String clean6 = str.replaceFirst(File.separator,""); // Noncompliant;
</pre></p>
            </div>
        <div class="rule">
            <h3>XML parsers should not be vulnerable to XXE attacks (java:S2755)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="31" data-diff-type="noncompliant">
import org.xml.sax.XMLReader;
import org.xml.sax.helpers.XMLReaderFactory;

public void decode() {
    XMLReader reader = XMLReaderFactory.createXMLReader(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>Set <code>disallow-doctype-decl</code> to <code>true</code>.</p>
<pre data-diff-id="31" data-diff-type="compliant">
import org.xml.sax.XMLReader;
import org.xml.sax.helpers.XMLReaderFactory;

public void decode() {
    XMLReader reader = XMLReaderFactory.createXMLReader();
    reader.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.xml.XMLConstants;
import javax.xml.parsers.DocumentBuilderFactory;

public void decode() {
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance(); // Noncompliant
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
import javax.xml.stream.XMLInputFactory;

public void decode() {
    XMLInputFactory factory = XMLInputFactory.newInstance(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<p>For <code>DocumentBuilderFactory</code>, <code>SAXParserFactory</code>, <code>TransformerFactory</code>, and <code>SchemaFactory</code> set
<code>XMLConstants.FEATURE_SECURE_PROCESSING</code> to <code>true</code>.</p>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.xml.XMLConstants;
import javax.xml.parsers.DocumentBuilderFactory;

public void decode() {
    DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
    factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
}
</pre>
<p>For <code>XMLInputFactory</code> set <code>SUPPORT_DTD</code> to <code>false</code>.</p>
<pre data-diff-id="2" data-diff-type="compliant">
import javax.xml.stream.XMLInputFactory;

public void decode() {
    XMLInputFactory factory = XMLInputFactory.newInstance();
    factory.setProperty(XMLInputFactory.SUPPORT_DTD, false);
}
</pre>
<p>Other combinations of settings are secure, but in general, it is recommendable to use the approaches shown here, as they are the most clear.</p>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p>
<h3>Going the extra mile</h3>
<h4>Disable entity expansion</h4>
<p>Specifically for <code>DocumentBuilderFactory</code>, it is possible to disable the entity expansion. Note, however, that this does not prevent the
retrieval of external entities.</p>
<pre>
factory.setExpandEntityReferences(false);
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Information Exposure Through XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222608">Application Security and
  Development: V-222608</a> - The application must not be vulnerable to XML-oriented attacks. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability allows the usage of external entities in XML.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>External Entity Processing allows for XML parsing with the involvement of external entities. However, when this functionality is enabled without
proper precautions, it can lead to a vulnerability known as XML External Entity (XXE) attack.</p>
<h3>What is the potential impact?</h3>
<h4>Exposing sensitive data</h4>
<p>One significant danger of XXE vulnerabilities is the potential for sensitive data exposure. By crafting malicious XML payloads, attackers can
reference external entities that contain sensitive information, such as system files, database credentials, or configuration files. When these
entities are processed during XML parsing, the attacker can extract the contents and gain unauthorized access to sensitive data. This poses a severe
threat to the confidentiality of critical information.</p>
<h4>Exhausting system resources</h4>
<p>Another consequence of XXE vulnerabilities is the potential for denial-of-service attacks. By exploiting the ability to include external entities,
attackers can construct XML payloads that cause resource exhaustion. This can overwhelm the system’s memory, CPU, or other critical resources, leading
to system unresponsiveness or crashes. A successful DoS attack can disrupt the availability of services and negatively impact the user experience.</p>
<h4>Forging requests</h4>
<p>XXE vulnerabilities can also enable Server-Side Request Forgery (SSRF) attacks. By leveraging the ability to include external entities, an attacker
can make the vulnerable application send arbitrary requests to other internal or external systems. This can result in unintended actions, such as
retrieving data from internal resources, scanning internal networks, or attacking other systems. SSRF attacks can lead to severe consequences,
including unauthorized data access, system compromise, or even further exploitation within the network infrastructure.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="11" data-diff-type="noncompliant">
import org.jdom2.input.SAXBuilder;

public void decode() {
    SAXBuilder builder = new SAXBuilder(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="11" data-diff-type="compliant">
import org.jdom2.input.SAXBuilder;

public void decode() {
    SAXBuilder builder = new SAXBuilder();
    builder.setProperty(XMLConstants.ACCESS_EXTERNAL_DTD, "");
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of XML parsers that have external entity processing enabled. As a result, the parsers are vulnerable to XXE
attacks if an attacker can control the XML file that is processed.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="21" data-diff-type="noncompliant">
import org.dom4j.io.SAXReader;

public void decode() {
    SAXReader xmlReader = new SAXReader(); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="21" data-diff-type="compliant">
import org.dom4j.io.SAXReader;

public void decode() {
    SAXReader xmlReader = new SAXReader();
    xmlReader.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
}
</pre>
<h3>How does this work?</h3>
<h4>Disable external entities</h4>
<p>The most effective approach to prevent XXE vulnerabilities is to disable external entity processing entirely, unless it is explicitly required for
specific use cases. By default, XML parsers should be configured to reject the processing of external entities. This can be achieved by setting the
appropriate properties or options in your XML parser library or framework.</p>
<p>If external entity processing is necessary for certain scenarios, adopt a whitelisting approach to restrict the entities that can be resolved
during XML parsing. Create a list of trusted external entities and disallow all others. This approach ensures that only known and safe entities are
processed.<br> You should rely on features provided by your XML parser to restrict the external entities.</p></p>
            </div>
        <div class="rule">
            <h3>Non-existent operators like "=+" should not be used (java:S2757)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using operator pairs (<code>=+</code>, <code>=-</code>, or <code>=!</code>) that look like reversed single operators (<code>+=</code>,
<code>-=</code> or <code>!=</code>) is confusing. They compile and run but do not produce the same result as their mirrored counterpart.</p>
<pre>
int target = -5;
int num = 3;

target =- num;  // Noncompliant: target = -3. Is that the intended behavior?
target =+ num; // Noncompliant: target = 3
</pre>
<p>This rule raises an issue when <code>=+</code>, <code>=-</code>, or <code>=!</code> are used without any space between the operators and when there
is at least one whitespace after.</p>
<p>Replace the operators with a single one if that is the intention</p>
<pre>
int target = -5;
int num = 3;

target -= num;  // target = -8
</pre>
<p>Or fix the spacing to avoid confusion</p>
<pre>
int target = -5;
int num = 3;

target = -num;  // target = -3
</pre></p>
            </div>
        <div class="rule">
            <h3>"entrySet()" should be iterated when both the key and value are needed (java:S2864)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>Map</code> is an object that maps keys to values. A map cannot contain duplicate keys, which means each key can map to at most one value.</p>
<p>When both the key and the value are needed, it is more efficient to iterate the <code>entrySet()</code>, which will give access to both instead of
iterating over the <code>keySet()</code> and then getting the value.</p>
<p>If the <code>entrySet()</code> method is not iterated when both the key and value are needed, it can lead to unnecessary lookups. This is because
each lookup requires two operations: one to retrieve the key and another to retrieve the value. By iterating the <code>entrySet()</code> method, the
key-value pair can be retrieved in a single operation, which can improve performance.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doSomethingWithMap(Map&lt;String,Object&gt; map) {
  for (String key : map.keySet()) {  // Noncompliant; for each key the value is retrieved
    Object value = map.get(key);
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public void doSomethingWithMap(Map&lt;String,Object&gt; map) {
  for (Map.Entry&lt;String,Object&gt; entry : map.entrySet()) {
    String key = entry.getKey();
    Object value = entry.getValue();
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Map.html">Oracle SE 20 - Map</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-map-entries-methods">Baeldung - Java Map methods</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Java 8's "Files.exists" should not be used (java:S3725)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Files.exists</code> method has noticeably poor performance in JDK 8, and can slow an application significantly when used to check files
that don’t actually exist.</p>
<p>The same goes for <code>Files.notExists</code>, <code>Files.isDirectory</code> and <code>Files.isRegularFile</code> from <code>java.nio.file</code>
package.</p>
<p><strong>Note</strong> that this rule is automatically disabled when the project’s <code>sonar.java.source</code> is not 8.</p>
<h3>Noncompliant code example</h3>
<pre>
Path myPath;
if(java.nio.file.Files.exists(myPath)) {  // Noncompliant
 // do something
}
</pre>
<h3>Compliant solution</h3>
<pre>
Path myPath;
if(myPath.toFile().exists())) {
 // do something
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://bugs.openjdk.java.net/browse/JDK-8153414">https://bugs.openjdk.java.net/browse/JDK-8153414</a> </li>
  <li> <a href="https://bugs.openjdk.java.net/browse/JDK-8154077">https://bugs.openjdk.java.net/browse/JDK-8154077</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Number patterns should be regular (java:S3937)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The use of punctuation characters to separate subgroups in a number can make the number more readable. For instance consider 1,000,000,000 versus
1000000000. But when the grouping is irregular, such as 1,000,00,000; it indicates an error.</p>
<p>This rule raises an issue when underscores (<code>_</code>) are used to break a number into irregular subgroups.</p>
<h3>Noncompliant code example</h3>
<pre>
int thousand = 100_0;
int tenThousand = 100_00;
int million = 1_000_00_000;
</pre>
<h3>Compliant solution</h3>
<pre>
int thousand = 1000;
int tenThousand = 10_000;
int tenThousandWithout = 10000;
int duos = 1_00_00;
int million = 100_000_000;
</pre>
<h3>Exceptions</h3>
<p>No issue will be raised on binary numbers (starting with <code>0b</code> or <code>0B</code>). Binary number bits are often grouped corresponding to
certain meanings, resulting in irregular bit group sizes.</p>
<pre>
int configValue1 = 0b00_000_10_1; // Compliant
int configValue2 = 0B00_000_10_1; // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Intermediate Stream methods should not be left unused (java:S3958)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#StreamOps">Stream Operations</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>There are two types of stream operations: intermediate operations, which return another stream, and terminal operations, which return something
other than a stream. Intermediate operations are lazy, meaning they aren’t actually executed until and unless a terminal stream operation is performed
on their results. Consequently, if the result of an intermediate stream operation is not fed to a terminal operation, it serves no purpose, which is
almost certainly an error.</p>
<h3>Noncompliant code example</h3>
<pre>
widgets.stream().filter(b -&gt; b.getColor() == RED); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
int sum = widgets.stream()
                      .filter(b -&gt; b.getColor() == RED)
                      .mapToInt(b -&gt; b.getWeight())
                      .sum();
Stream&lt;Widget&gt; pipeline = widgets.stream()
                                 .filter(b -&gt; b.getColor() == GREEN)
                                 .mapToInt(b -&gt; b.getWeight());
sum = pipeline.sum();
</pre></p>
            </div>
        <div class="rule">
            <h3>Consumed Stream pipelines should not be reused (java:S3959)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Stream operations are divided into intermediate and terminal operations, and are combined to form stream pipelines. After the terminal operation is
performed, the stream pipeline is considered consumed, and cannot be used again. Such a reuse will yield unexpected results.</p>
<h3>Noncompliant code example</h3>
<pre>
Stream&lt;Widget&gt; pipeline = widgets.stream().filter(b -&gt; b.getColor() == RED);
int sum1 = pipeline.sum();
int sum2 = pipeline.mapToInt(b -&gt; b.getWeight()).sum(); // Noncompliant
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/package-summary.html#StreamOps">Stream Operations</a></p></p>
            </div>
        <div class="rule">
            <h3>"Class.forName()" should not load JDBC 4.0+ drivers (java:S4925)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In the past, it was required to load a JDBC driver before creating a <code>java.sql.Connection</code>. Nowadays, when using JDBC 4.0 drivers, this
is no longer required and <code>Class.forName()</code> can be safely removed because JDBC 4.0 (JDK 6) drivers available in the classpath are
automatically loaded.</p>
<p>This rule raises an issue when <code>Class.forName()</code> is used with one of the following values:</p>
<ul>
  <li> <code>com.mysql.jdbc.Driver</code> </li>
  <li> <code>oracle.jdbc.driver.OracleDriver</code> </li>
  <li> <code>com.ibm.db2.jdbc.app.DB2Driver</code> </li>
  <li> <code>com.ibm.db2.jdbc.net.DB2Driver</code> </li>
  <li> <code>com.sybase.jdbc.SybDriver</code> </li>
  <li> <code>com.sybase.jdbc2.jdbc.SybDriver</code> </li>
  <li> <code>com.teradata.jdbc.TeraDriver</code> </li>
  <li> <code>com.microsoft.sqlserver.jdbc.SQLServerDriver</code> </li>
  <li> <code>org.postgresql.Driver</code> </li>
  <li> <code>sun.jdbc.odbc.JdbcOdbcDriver</code> </li>
  <li> <code>org.hsqldb.jdbc.JDBCDriver</code> </li>
  <li> <code>org.h2.Driver</code> </li>
  <li> <code>org.firebirdsql.jdbc.FBDriver</code> </li>
  <li> <code>net.sourceforge.jtds.jdbc.Driver</code> </li>
  <li> <code>com.ibm.db2.jcc.DB2Driver</code> </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class Demo {
  private static final String DRIVER_CLASS_NAME = "org.postgresql.Driver";
  private final Connection connection;

  public Demo(String serverURI) throws SQLException, ClassNotFoundException {
    Class.forName(DRIVER_CLASS_NAME); // Noncompliant; no longer required to load the JDBC Driver using Class.forName()
    connection = DriverManager.getConnection(serverURI);
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class Demo {
    private final Connection connection;

    public Demo(String serverURI) throws SQLException {
        connection = DriverManager.getConnection(serverURI);
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"serialVersionUID" should not be declared blindly (java:S4926)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> Vojtech Ruzicka’s Programming Blog: <a href="https://www.vojtechruzicka.com/explicitly-declare-serialversionuid/">Should I explicitly declare
  serialVersionUID?</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Providing a <code>serialVersionUID</code> field on <code>Serializable</code> classes is strongly recommended by the <code>Serializable</code>
documentation but blindly following that recommendation can be harmful.</p>
<p><code>serialVersionUID</code> value is stored with the serialized data and this field is verified when deserializing the data to ensure that the
code reading the data is compatible with the serialized data. In case of failure, it means the serialized data and the code are not in sync and this
fine because you know what’s wrong.</p>
<p>When the <code>serialVersionUID</code> is generated by an IDE or blindly hard-coded, there is a high probability that one will forget to update the
<code>serialVersionUID</code> value when the <code>Serializable</code> class is later enriched with additional fields. As a consequence, old
serialized data will incorrectly be considered compatible with the newer version of the code creating situations which are hard to debug.</p>
<p>Therefore, defining <code>serialVersionUID</code> should be done with care. This rule raises an issue on each <code>serialVersionUID</code> field
declared on classes implementing <code>Serializable</code> to be sure the presence and the value of the <code>serialVersionUID</code> field is
challenged and validated by the team.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Foo implements Serializable {
  private static final long serialVersionUID = 1;
}

public class BarException extends RuntimeException {
  private static final long serialVersionUID = 8582433437601788991L;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"read(byte[],int,int)" should be overridden (java:S4929)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When directly subclassing <code>java.io.InputStream</code> or <code>java.io.FilterInputStream</code>, the only requirement is that you implement
the method <code>read()</code>. However most uses for such streams don’t read a single byte at a time and the default implementation for
<code>read(byte[],int,int)</code> will call <code>read(int)</code> for every single byte in the array which can create a lot of overhead and is
utterly inefficient. It is therefore strongly recommended that subclasses provide an efficient implementation of
<code>read(byte[],int,int)</code>.</p>
<p>This rule raises an issue when a direct subclass of <code>java.io.InputStream</code> or <code>java.io.FilterInputStream</code> doesn’t provide an
override of <code>read(byte[],int,int)</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyInputStream extends java.io.InputStream {
  private FileInputStream fin;

  public MyInputStream(File file) throws IOException {
    fin = new FileInputStream(file);
  }

  @Override
  public int read() throws IOException {
    return fin.read();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyInputStream extends java.io.InputStream {
  private FileInputStream fin;

  public MyInputStream(File file) throws IOException {
    fin = new FileInputStream(file);
  }

  @Override
  public int read() throws IOException {
    return fin.read();
  }

  @Override
  public int read(byte[] b, int off, int len) throws IOException {
    return fin.read(b, off, len);
  }
}
</pre>
<h3>Exceptions</h3>
<p>This rule doesn’t raise an issue when the class is declared <code>abstract</code>.</p></p>
            </div>
        <div class="rule">
            <h3>Methods annotated with "@BeforeTransaction" or "@AfterTransaction" must respect the contract (java:S7190)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In tests configured with Spring’s <code>@Transactional</code> annotation, methods annotated with <code>@BeforeTransaction</code> or
<code>@AfterTransaction</code> must be void and have no arguments. These methods are executed before or after a transaction, respectively. Deviating
from this contract by having a non-void return type or accepting arguments will cause Spring to throw a runtime error.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/context/transaction/BeforeTransaction.html">BeforeTransaction</a> </li>
  <li> Spring - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/context/transaction/AfterTransaction.html">AfterTransaction</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ensure that methods annotated with <code>@BeforeTransaction</code> or <code>@AfterTransaction</code> have a void return type and do not accept any
arguments.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class TransactionalTest {

    @BeforeTransaction
    public String setupTransaction(int x) { // non-compliant, method should be void and have no argument
        // Setup logic
    }

    @AfterTransaction
    public int cleanupTransaction(int x) { // non-compliant, method should be void and have no argument
        // Cleanup logic
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class TransactionalTest {

    @BeforeTransaction
    public void setupTransaction() {
        // Setup logic
    }

    @AfterTransaction
    public void cleanupTransaction() {
        // Cleanup logic
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>The members of an interface or class declaration should appear in a pre-defined order (java:S1213)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>According to the Java Code Conventions as defined by Oracle, the members of a class or interface declaration should appear in the following order
in the source files:</p>
<ul>
  <li> Class variables </li>
  <li> Instance variables </li>
  <li> Constructors </li>
  <li> Methods </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
public class Foo{
   private int field = 0;
   public boolean isTrue() {...}
   public Foo() {...}                         // Noncompliant, constructor defined after methods
   public static final int OPEN = 4;  //Noncompliant, variable defined after constructors and methods
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Foo{
   public static final int OPEN = 4;
   private int field = 0;
   public Foo() {...}
   public boolean isTrue() {...}
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Interfaces should not solely consist of constants (java:S1214)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>An interface that consists solely of constant definitions is a bad practice. The purpose of interfaces is to provide an API, not implementation
details. That is, they should provide functions in the first place and constants only to assist these functions, for example, as possible
arguments.</p>
<p>If an interface contains constants only, move them either to somewhere else, or replace the interface with an <em>Enum</em> or a final class with a
private constructor.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://dzone.com/articles/reasons-why-the-constant-interface-pattern-is-disc">Mohammad Nadeem - Why the Constant Interface Pattern
  Should Be Discouraged</a> </li>
  <li> Joshua Bloch - Effective Java, ISBN 9780134686097 </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>If the concrete value of the constants is not essential, and they serve as mere identifiers, replace the interface with an <code>enum</code> like
in the following example:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public interface Status { // Noncompliant, enum should be used
  int OPEN = 1;
  int CLOSED = 2;
}
</pre>
<pre data-diff-id="1" data-diff-type="compliant">
public enum Status {      // Compliant
  OPEN,
  CLOSED
}
</pre>
<p>In some cases, enums are not a suitable option because the concrete constant value is important. Then you should check whether it is appropriate to
move them to a specific existing class, for example, if that class is the primary user of the constants:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
interface AuxiliaryConstants { // Noncompliant, implementation detail of WordPacker
  int BITS_PER_WORD = 16;
  int WORD_MASK = (1 &lt;&lt; BITS_PER_WORD) - 1;
  int HI_WORD_BK_MASK = ~(WORD_MASK &lt;&lt; BITS_PER_WORD);
}

class WordPacker {
  public static int getHiWord(int value) {
    return (value &gt;&gt;&gt; AuxiliaryConstants.BITS_PER_WORD);
  }

  public static int setHiWord(int value, int wordValue) {
    return (value &amp; AuxiliaryConstants.HI_WORD_BK_MASK) |
      (wordValue &lt;&lt; AuxiliaryConstants.BITS_PER_WORD);
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
class WordPacker { // Compliant
  private static final int BITS_PER_WORD = 16;
  private static final int WORD_MASK = (1 &lt;&lt; BITS_PER_WORD) - 1;
  private static final int HI_WORD_BK_MASK = ~(WORD_MASK &lt;&lt; BITS_PER_WORD);

  public static int getHiWord(int value) {
      return (value &gt;&gt;&gt; BITS_PER_WORD);
  }

  public static int setHiWord(int value, int wordValue) {
    return (value &amp; HI_WORD_BK_MASK) | (wordValue &lt;&lt; BITS_PER_WORD);
  }
}
</pre>
<p>If this is not the case and several classes are using the constants equally, you should use a final class with a private constructor. Unlike
interfaces, they can neither be inherited from nor instantiated.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
public interface ColorTheme { // Noncomplient, final class should be used
  int COLOR_ERROR = 0xff0000;   // red
  int COLOR_WARNING = 0xffff00; // yellow
  int COLOR_OK = 0x00cf00;      // green
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
public final class ColorTheme { // Compliant
  public static final int COLOR_ERROR = 0xff0000;   // red
  public static final int COLOR_WARNING = 0xffff00; // yellow
  public static final int COLOR_OK = 0x00cf00;      // green

  private ColorTheme() {}
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when an interface consists only of constant definitions without other members.</p></p>
            </div>
        <div class="rule">
            <h3>Maps with keys that are enum values should use the EnumMap implementation (java:S1640)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>If all the keys in a <code>Map</code> are values from a single enum, it is recommended to use an <code>EnumMap</code> as the specific
implementation. An <code>EnumMap</code>, which has the advantage of knowing all possible keys in advance, is more efficient compared to other
implementations, as it can use a simple array as its underlying data structure.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public enum Color {
  RED, GREEN, BLUE, ORANGE;
}

Map&lt;Color, String&gt; colorMap = new HashMap&lt;&gt;(); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public enum Color {
  RED, GREEN, BLUE, ORANGE;
}

Map&lt;Color, String&gt; colorMap = new EnumMap&lt;&gt;(Color.class); // Compliant
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://www.baeldung.com/java-enum-map">A Guide to EnumMap - Baeldung</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Sets with elements that are enum values should be replaced with EnumSet (java:S1641)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When all the elements in a Set are values from the same enum, the Set can be replaced with an EnumSet, which can be much more efficient than other
sets because the underlying data structure is a simple bitmap.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {

  public enum COLOR {
    RED, GREEN, BLUE, ORANGE;
  }

  public void doSomething() {
    Set&lt;COLOR&gt; warm = new HashSet&lt;COLOR&gt;();
    warm.add(COLOR.RED);
    warm.add(COLOR.ORANGE);
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyClass {

  public enum COLOR {
    RED, GREEN, BLUE, ORANGE;
  }

  public void doSomething() {
    Set&lt;COLOR&gt; warm = EnumSet.of(COLOR.RED, COLOR.ORANGE);
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Strings should not be concatenated using '+' in a loop (java:S1643)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Strings are immutable objects, so concatenation doesn’t simply add the new String to the end of the existing string. Instead, in each loop
iteration, the first String is converted to an intermediate object type, the second string is appended, and then the intermediate object is converted
back to a String. Further, performance of these intermediate operations degrades as the String gets longer. Therefore, the use of StringBuilder is
preferred.</p>
<h3>Noncompliant code example</h3>
<pre>
String str = "";
for (int i = 0; i &lt; arrayOfStrings.length ; ++i) {
  str = str + arrayOfStrings[i];
}
</pre>
<h3>Compliant solution</h3>
<pre>
StringBuilder bld = new StringBuilder();
  for (int i = 0; i &lt; arrayOfStrings.length; ++i) {
    bld.append(arrayOfStrings[i]);
  }
  String str = bld.toString();
</pre></p>
            </div>
        <div class="rule">
            <h3>"==" and "!=" should not be used when "equals" is overridden (java:S1698)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It is equivalent to use the equality <code>==</code> operator and the <code>equals</code> method to compare two objects if the <code>equals</code>
method inherited from <code>Object</code> has not been overridden. In this case both checks compare the object references.</p>
<p>But as soon as <code>equals</code> is overridden, two objects not having the same reference but having the same value can be equal. This rule spots
suspicious uses of <code>==</code> and <code>!=</code> operators on objects whose <code>equals</code> methods are overridden.</p>
<h3>Noncompliant code example</h3>
<pre>
String firstName = getFirstName(); // String overrides equals
String lastName = getLastName();

if (firstName == lastName) { ... }; // Non-compliant; false even if the strings have the same value
</pre>
<h3>Compliant solution</h3>
<pre>
String firstName = getFirstName();
String lastName = getLastName();

if (firstName != null &amp;&amp; firstName.equals(lastName)) { ... };
</pre>
<h3>Exceptions</h3>
<p>Comparing two instances of the <code>Class</code> object will not raise an issue:</p>
<pre>
Class c;
if(c == Integer.class) { // No issue raised
}
</pre>
<p>Comparing <code>Enum</code> will not raise an issue:</p>
<pre>
public enum Fruit {
   APPLE, BANANA, GRAPE
}
public boolean isFruitGrape(Fruit candidateFruit) {
  return candidateFruit == Fruit.GRAPE; // it's recommended to activate S4551 to enforce comparison of Enums using ==
}
</pre>
<p>Comparing with <code>final</code> reference will not raise an issue:</p>
<pre>
private static final Type DEFAULT = new Type();

void foo(Type other) {
  if (other == DEFAULT) { // Compliant
  //...
  }
}
</pre>
<p>Comparing with <code>this</code> will not raise an issue:</p>
<pre>
  public boolean equals(Object other) {
    if (this == other) {  // Compliant
      return false;
    }
 }
</pre>
<p>Comparing with <code>java.lang.String</code> and boxed types <code>java.lang.Integer</code>, …​ will not raise an issue.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href='/coding_rules#rule_key=java%3AS4973'>S4973</a> - Strings and Boxed types should be compared using "equals()" </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/595">CWE-595 - Comparison of Object References Instead of Object Contents</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/597">CWE-597 - Use of Wrong Operator in String Comparison</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/UjdGBQ">CERT, EXP03-J.</a> - Do not use the equality operators when comparing values of boxed
  primitives </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/yDdGBQ">CERT, EXP50-J.</a> - Do not confuse abstract object equality with reference equality
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Identical expressions should not be used on both sides of a binary operator (java:S1764)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using the same value on both sides of a binary operator is a code defect. In the case of logical operators, it is either a copy/paste error and,
therefore, a bug, or it is simply duplicated code and should be simplified. In the case of bitwise operators and most binary mathematical operators,
having the same value on both sides of an operator yields predictable results and should be simplified as well.</p>
<h3>Noncompliant code example</h3>
<pre>
if ( a == a ) { // always true
  doZ();
}
if ( a != a ) { // always false
  doY();
}
if ( a == b &amp;&amp; a == b ) { // if the first one is true, the second one is too
  doX();
}
if ( a == b || a == b ) { // if the first one is true, the second one is too
  doW();
}

int j = 5 / 5; //always 1
int k = 5 - 5; //always 0

c.equals(c); //always true
</pre>
<h3>Exceptions</h3>
<ul>
  <li> This rule ignores <code>*</code>, <code>+</code>, and <code>=</code>. </li>
  <li> The specific case of testing a floating point value against itself is a valid test for <code>NaN</code> and is therefore ignored. </li>
  <li> Similarly, left-shifting 1 onto 1 is common in the construction of bit masks, and is ignored. </li>
</ul>
<pre>
float f;
if(f != f) { //test for NaN value
  System.out.println("f is NaN");
}

int i = 1 &lt;&lt; 1; // Compliant
int j = a &lt;&lt; a; // Noncompliant
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5dUxBQ">CERT, MSC12-C.</a> - Detect and remove code that has no effect or is never executed
  </li>
  <li> <a href='/coding_rules#rule_key=java%3AS1656'>S1656</a> - Implements a check on <code>=</code>. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Setting loose POSIX file permissions is security-sensitive (java:S2612)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Compliant Solution</h2>
<p>On operating systems that implement POSIX standard. This will throw a <code>UnsupportedOperationException</code> on Windows.</p>
<pre>
    public void setPermissionsSafe(String filePath) throws IOException {
        Set&lt;PosixFilePermission&gt; perms = new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions removed
        perms.remove(PosixFilePermission.OTHERS_READ); // Compliant
        perms.remove(PosixFilePermission.OTHERS_WRITE); // Compliant
        perms.remove(PosixFilePermission.OTHERS_EXECUTE); // Compliant

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/FIO01-J.+Create+files+with+appropriate+access+permissions">CERT, FIO01-J.</a> -
  Create files with appropriate access permissions </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.+Create+files+with+appropriate+access+permissions">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222430">Application Security and
  Development: V-222430</a> - The application must execute without excessive account permissions. </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>The most restrictive possible permissions should be assigned to files and directories.</p>
<h2>Sensitive Code Example</h2>
<pre>
    public void setPermissions(String filePath) {
        Set&lt;PosixFilePermission&gt; perms = new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions
        perms.add(PosixFilePermission.OTHERS_READ); // Sensitive
        perms.add(PosixFilePermission.OTHERS_WRITE); // Sensitive
        perms.add(PosixFilePermission.OTHERS_EXECUTE); // Sensitive

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<pre>
    public void setPermissionsUsingRuntimeExec(String filePath) {
        Runtime.getRuntime().exec("chmod 777 file.json"); // Sensitive
    }
</pre>
<pre>
    public void setOthersPermissionsHardCoded(String filePath ) {
        Files.setPosixFilePermissions(Paths.get(filePath), PosixFilePermissions.fromString("rwxrwxrwx")); // Sensitive
    }
</pre>
<h2>Compliant Solution</h2>
<p>On operating systems that implement POSIX standard. This will throw a <code>UnsupportedOperationException</code> on Windows.</p>
<pre>
    public void setPermissionsSafe(String filePath) throws IOException {
        Set&lt;PosixFilePermission&gt; perms = new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions removed
        perms.remove(PosixFilePermission.OTHERS_READ); // Compliant
        perms.remove(PosixFilePermission.OTHERS_WRITE); // Compliant
        perms.remove(PosixFilePermission.OTHERS_EXECUTE); // Compliant

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/09-Test_File_Permission">OWASP File Permission</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/732">CWE-732 - Incorrect Permission Assignment for Critical Resource</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/266">CWE-266 - Incorrect Privilege Assignment</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/FIO01-J.+Create+files+with+appropriate+access+permissions">CERT, FIO01-J.</a> -
  Create files with appropriate access permissions </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/c/FIO06-C.+Create+files+with+appropriate+access+permissions">CERT, FIO06-C.</a> - Create
  files with appropriate access permissions </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222430">Application Security and
  Development: V-222430</a> - The application must execute without excessive account permissions. </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The application is designed to be run on a multi-user environment. </li>
  <li> Corresponding files and directories may contain confidential information. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
    public void setPermissions(String filePath) {
        Set&lt;PosixFilePermission&gt; perms = new HashSet&lt;PosixFilePermission&gt;();
        // user permission
        perms.add(PosixFilePermission.OWNER_READ);
        perms.add(PosixFilePermission.OWNER_WRITE);
        perms.add(PosixFilePermission.OWNER_EXECUTE);
        // group permissions
        perms.add(PosixFilePermission.GROUP_READ);
        perms.add(PosixFilePermission.GROUP_EXECUTE);
        // others permissions
        perms.add(PosixFilePermission.OTHERS_READ); // Sensitive
        perms.add(PosixFilePermission.OTHERS_WRITE); // Sensitive
        perms.add(PosixFilePermission.OTHERS_EXECUTE); // Sensitive

        Files.setPosixFilePermissions(Paths.get(filePath), perms);
    }
</pre>
<pre>
    public void setPermissionsUsingRuntimeExec(String filePath) {
        Runtime.getRuntime().exec("chmod 777 file.json"); // Sensitive
    }
</pre>
<pre>
    public void setOthersPermissionsHardCoded(String filePath ) {
        Files.setPosixFilePermissions(Paths.get(filePath), PosixFilePermissions.fromString("rwxrwxrwx")); // Sensitive
    }
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Unix file system permissions, the "<code>others</code>" category refers to all users except the owner of the file system resource and the
members of the group assigned to this resource.</p>
<p>Granting permissions to this category can lead to unintended access to files or directories that could allow attackers to obtain sensitive
information, disrupt services or elevate privileges.</p>
</p>
            </div>
        <div class="rule">
            <h3>"catch" clauses should do more than rethrow (java:S2737)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>catch</code> clause that only rethrows the caught exception has the same effect as omitting the <code>catch</code> altogether and letting
it bubble up automatically.</p>
<pre>
public String readFile(File f) throws IOException {
  String content;
  try {
    content = readFromDisk(f);
  } catch (IOException e) {
    throw e;
  }
  return content;
}
</pre>
<p>Such clauses should either be removed or populated with the appropriate logic.</p>
<pre>
public String readFile(File f) throws IOException {
  return readFromDisk(f);
}
</pre>
<p>or</p>
<pre>
public String readFile(File f) throws IOException {
  String content;
  try {
    content = readFromDisk(f);
  } catch (IOException e) {
    logger.LogError(e);
    throw e;
  }
  return content;
}
</pre>
<p>In the case of try-with-resources, the try should remain even without a catch clause, to keep the resource management</p>
<pre>
String readFirstLine(FileReader fileReader) throws IOException {
  try (BufferedReader br = new BufferedReader(fileReader)) {
     return br.readLine();
  } catch (IOException e) { // Noncompliant
  throw e;
}
</pre>
<p>becomes</p>
<pre>
String readFirstLine(FileReader fileReader) throws IOException {
  try (BufferedReader br = new BufferedReader(fileReader)) {
     return br.readLine();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Nested "enum"s should not be declared static (java:S2786)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Java, an enum is a special data type that allows you to define a set of constants. Nested enum types, also known as inner enum types, are enum
types that are defined within another class or interface.</p>
<p>Nested enum types are implicitly static, so there is no need to declare them <code>static</code> explicitly.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Flower {
  static enum Color { // Noncompliant; static is redundant here
    RED, YELLOW, BLUE, ORANGE
  }
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class Flower {
  enum Color { // Compliant
    RED, YELLOW, BLUE, ORANGE
  }
  // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se20/html/jls-8.html#jls-8.9">Java Language Specification-8.9</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Assertions should be complete (java:S2970)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It is very easy to write incomplete assertions when using some test frameworks. This rule enforces complete assertions in the following cases:</p>
<ul>
  <li> Fest: <code>assertThat</code> is not followed by an assertion invocation </li>
  <li> AssertJ: <code>assertThat</code> is not followed by an assertion invocation </li>
  <li> Mockito: <code>verify</code> is not followed by a method invocation </li>
  <li> Truth: <code>assertXXX</code> is not followed by an assertion invocation </li>
</ul>
<p>In such cases, what is intended to be a test doesn’t actually verify anything</p>
<h3>Noncompliant code example</h3>
<pre>
// Fest
boolean result = performAction();
// let's now check that result value is true
assertThat(result); // Noncompliant; nothing is actually checked, the test passes whether "result" is true or false

// Mockito
List mockedList = Mockito.mock(List.class);
mockedList.add("one");
mockedList.clear();
// let's check that "add" and "clear" methods are actually called
Mockito.verify(mockedList); // Noncompliant; nothing is checked here, oups no call is chained to verify()
</pre>
<h3>Compliant solution</h3>
<pre>
// Fest
boolean result = performAction();
// let's now check that result value is true
assertThat(result).isTrue();

// Mockito
List mockedList = Mockito.mock(List.class);
mockedList.add("one");
mockedList.clear();
// let's check that "add" and "clear" methods are actually called
Mockito.verify(mockedList).add("one");
Mockito.verify(mockedList).clear();
</pre>
<h3>Exceptions</h3>
<p>Variable assignments and return statements are skipped to allow helper methods.</p>
<pre>
private BooleanAssert check(String filename, String key) {
  String fileContent = readFileContent(filename);
  performReplacements(fileContent);
  return assertThat(fileContent.contains(key)); // No issue is raised here
}

@Test
public void test() {
  check("foo.txt", "key1").isTrue();
  check("bar.txt", "key2").isTrue();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Inner classes should not have too many lines of code (java:S2972)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Inner classes should be short and sweet, to manage complexity in the overall file. An inner class that has grown longer than a certain threshold
should probably be externalized to its own file.</p></p>
            </div>
        <div class="rule">
            <h3>Escaped Unicode characters should not be used (java:S2973)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The use of Unicode escape sequences should be reserved for characters that would otherwise be ambiguous, such as unprintable characters.</p>
<p>This rule ignores sequences composed entirely of Unicode characters, but otherwise raises an issue for each Unicode character that represents a
printable character.</p>
<h3>Noncompliant code example</h3>
<pre>
String prefix = "n\u00E9e"; // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
String prefix = "née";
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes without "public" constructors should be "final" (java:S2974)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Classes with only <code>private</code> constructors should be marked <code>final</code> to prevent any mistaken extension attempts.</p>
<h3>Noncompliant code example</h3>
<pre>
public class PrivateConstructorClass {  // Noncompliant
  private PrivateConstructorClass() {
    // ...
  }

  public static int magic(){
    return 42;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public final class PrivateConstructorClass {  // Compliant
  private PrivateConstructorClass() {
    // ...
  }

  public static int magic(){
    return 42;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"clone" should not be overridden (java:S2975)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Object.clone</code> / <code>java.lang.Cloneable</code> mechanism in Java should be considered broken for the following reasons and
should, consequently, not be used:</p>
<ul>
  <li> <code>Cloneable</code> is a <em>marker interface</em> without API but with a contract about class behavior that the compiler cannot enforce.
  This is a bad practice. </li>
  <li> Classes are instantiated without calling their constructor, so possible preconditions cannot be enforced. </li>
  <li> There are implementation flaws by design when overriding <code>Object.clone</code>, like type casts or the handling of
  <code>CloneNotSupportedException</code> exceptions. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a class overrides the <code>Object.clone</code> method instead of resorting to a copy constructor or other copy
mechanisms.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>A copy constructor, copy factory or a custom copy function are suitable alternatives to the <code>Object.clone</code> /
<code>java.lang.Cloneable</code> mechanism.</p>
<p>Consider the following example:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Entity implements Cloneable { // Noncompliant, using `Cloneable`

  public int value;
  public List&lt;Entity&gt; children; // deep copy wanted

  Entity() {
    EntityManager.register(this); // invariant
  }

  @Override
  public Entity clone() {
    try {
      Entity copy = (Entity) super.clone(); // invariant not enforced, because no constructor is caled
      copy.children = children.stream().map(Entity::clone).toList();
      return copy;
    } catch (CloneNotSupportedException e) { // this will not happen due to behavioral contract
      throw new AssertionError();
    }
  }
}
</pre>
<p>The <code>Cloneable</code> / <code>Object.clone</code> mechanism could easily be replaced by copy constructor:</p>
<pre data-diff-id="1" data-diff-type="compliant">
class Entity { // Compliant

  public int value;
  public List&lt;Entity&gt; children; // deep copy wanted

  Entity() {
    EntityManager.register(this); // invariant
  }

  Entity(Entity template) {
    value = template.value;
    children = template.children.stream().map(Entity::new).toList();
  }
}
</pre>
<p>Or by a factory method:</p>
<pre>
class Entity { // Compliant

  public int value;
  public List&lt;Entity&gt; children; // deep copy wanted

  Entity() {
    EntityManager.register(this); // invariant
  }

  public static Entity create(Entity template) {
    Entity entity = new Entity();
    entity.value = template.value;
    entity.children = template.children.stream().map(Entity::new).toList();
    return Entity;
  }
}
</pre>
<p>Or by a custom <code>copy</code> function:</p>
<pre>
class Entity { // Compliant

  public int value;
  public List&lt;Entity&gt; children; // deep copy wanted

  Entity() {
    EntityManager.register(this); // invariant
  }

  public Entity copy() {
    Entity entity = new Entity();
    entity.value = value;
    entity.children = children.stream().map(Entity::new).toList();
    return Entity;
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://www.artima.com/intv/bloch13.html">Joshua Bloch - Copy Constructor versus Cloning</a> </li>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Cloneable.html">Interface Cloneable - Java™ Platform, Standard Edition 8 API
  Specification</a> </li>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#clone--">Object.clone - Java™ Platform, Standard Edition 8 API
  Specification</a> </li>
</ul>
<h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS2157'>S2157</a> - "Cloneables" should implement "clone" </li>
  <li> <a href='/coding_rules#rule_key=java%3AS1182'>S1182</a> - Classes that override "clone" should be "Cloneable" and call "super.clone()" </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"Map.get" and value test should be replaced with single method call (java:S3824)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It’s a common pattern to test the result of a <code>java.util.Map.get()</code> against <code>null</code> or calling
<code>java.util.Map.containsKey()</code> before proceeding with adding or changing the value in the map. However the <code>java.util.Map</code> API
offers a significantly better alternative in the form of the <code>computeIfPresent()</code> and <code>computeIfAbsent()</code> methods. Using these
instead leads to cleaner and more readable code.</p>
<p><strong>Note</strong> that this rule is automatically disabled when the project’s <code>sonar.java.source</code> is not 8.</p>
<h3>Noncompliant code example</h3>
<pre>
V value = map.get(key);
if (value == null) {  // Noncompliant
  value = V.createFor(key);
  if (value != null) {
    map.put(key, value);
  }
}
if (!map.containsKey(key)) {  // Noncompliant
  value = V.createFor(key);
  if (value != null) {
    map.put(key, value);
  }
}
return value;
</pre>
<h3>Compliant solution</h3>
<pre>
return map.computeIfAbsent(key, k -&gt; V.createFor(k));
</pre>
<h3>Exceptions</h3>
<p>This rule will not raise an issue when trying to add <code>null</code> to a map, because <code>computeIfAbsent</code> will not add the entry if the
value returned by the function is <code>null</code>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS6104'>S6104</a> - Map "computeIfAbsent()" and "computeIfPresent()" should not be used to add "null" values. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"@SpringBootApplication" and "@ComponentScan" should not be used in the default package (java:S4602)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>@ComponentScan</code> is used to determine which Spring Beans are available in the application context. The packages to scan can be
configured thanks to the <code>basePackageClasses</code> or <code>basePackages</code> (or its alias <code>value</code>) parameters. If neither
parameter is configured, <code>@ComponentScan</code> will consider only the package of the class annotated with it. When <code>@ComponentScan</code>
is used on a class belonging to the default package, the entire classpath will be scanned.</p>
<p>This will slow-down the start-up of the application and it is likely the application will fail to start with an
<code>BeanDefinitionStoreException</code> because you ended up scanning the Spring Framework package itself.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> <code>@ComponentScan</code>, <code>@SpringBootApplication</code> and <code>@ServletComponentScan</code> are used on a class belonging to the
  default package </li>
  <li> <code>@ComponentScan</code> is explicitly configured with the default package </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
import org.springframework.boot.SpringApplication;

@SpringBootApplication // Noncompliant; RootBootApp is declared in the default package
public class RootBootApp {
...
}
</pre>
<pre>
@ComponentScan("")
public class Application {
...
}
</pre>
<h3>Compliant solution</h3>
<pre>
package hello;

import org.springframework.boot.SpringApplication;

@SpringBootApplication // Compliant; RootBootApp belongs to the "hello" package
public class RootBootApp {
...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>JUnit5 test classes and methods should not be silently ignored (java:S5810)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>JUnit5 is more tolerant regarding the visibilities of Test classes and methods than JUnit4, which required everything to be public. JUnit5 supports
default package, public and protected visibility, even if it is recommended to use the default package visibility, which improves the readability of
code.</p>
<p>But JUnit5 ignores without any warning:</p>
<ul>
  <li> private classes and private methods </li>
  <li> static methods </li>
  <li> methods returning a value without being a TestFactory </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
import org.junit.jupiter.api.Test;

class MyClassTest {
  @Test
  private void test1() { // Noncompliant - ignored by JUnit5
    // ...
  }
  @Test
  static void test2() { // Noncompliant - ignored by JUnit5
    // ...
  }
  @Test
  boolean test3() { // Noncompliant - ignored by JUnit5
    // ...
  }
  @Nested
  private class MyNestedClass { // Noncompliant - ignored by JUnit5
    @Test
    void test() {
      // ...
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
import org.junit.jupiter.api.Test;

class MyClassTest {
  @Test
  void test1() {
    // ...
  }
  @Test
  void test2() {
    // ...
  }
  @Test
  void test3() {
    // ...
  }
  @Nested
  class MyNestedClass {
    @Test
    void test() {
      // ...
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Use appropriate @DirtiesContext modes (java:S7177)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In a Spring application, the <code>@DirtiesContext</code> annotation marks the ApplicationContext as dirty and indicates that it should be cleared
and recreated. This is important in tests that modify the context, such as altering the state of singleton beans or databases.</p>
<p>Misconfiguring <code>@DirtiesContext</code> by setting the <code>methodMode</code> at the class level or the <code>classMode</code> at the method
level will make the annotation have no effect.</p>
<p>This rule will raise an issue when the incorrect mode is configured on a @DirtiesContext annotation targeting a different scope.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring documentation - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/annotation/DirtiesContext.html">@DirtiesContext</a>
  </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@ContextConfiguration
@DirtiesContext(methodMode = MethodMode.AFTER_METHOD) // Noncompliant, for class-level control, use classMode instead.
public class TestClass {
  @DirtiesContext(classMode = DirtiesContext.ClassMode.AFTER_CLASS) // Non compliant, for method-level control use methodMode instead
  public void test() {...}
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@ContextConfiguration
@DirtiesContext(classMode = DirtiesContext.ClassMode.AFTER_CLASS)
public class TestClass {
  @DirtiesContext(methodMode = MethodMode.AFTER_METHOD)
  public void test() {...}
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Injecting data into static fields is not supported by Spring (java:S7178)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Spring dependency injection framework does not support injecting data into static fields. When @Value, @Inject, or @Autowired are applied to static
fields, they are ignored.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <strong>Null Values</strong>: Uninitialized static fields annotated with @Value, @Inject, or @Autowired will not be initialized by Spring,
  potentially causing NullPointerException at runtime. </li>
  <li> <strong>Confusing Code</strong>: The presence of injection annotations on static fields can mislead developers into believing that the fields
  will be populated by Spring. </li>
</ul>
<p>This rule raises an issue when a static field is annotated with @Value, @Inject, or @Autowired.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> Java Guides - <a href="https://www.baeldung.com/spring-inject-static-field">Injecting a Value in a Static Field in Spring</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Either use an instance field instead of a static field or remove the @Value, @Inject, or @Autowired annotation and initialize the field.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Component
public class MyComponent {

    @Value("${my.app.prop}")
    private static SomeDependency dependency; // non compliant, @Value will be ignored and no value will be injected
    // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Component
public class MyComponent {

    @Value("${my.app.prop}")
    private final SomeDependency dependency;
    // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>@Cacheable and @CachePut should not be combined (java:S7179)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring Documentation - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/cache/annotation/CachePut.html">@CachePut</a> </li>
  <li> Spring Documentation - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/cache/annotation/Cacheable.html">@Cacheable</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>@Cacheable</code> annotation is used to store the result of a method and avoid executing it for the same inputs. <code>@CachePut</code>
instead is used to force the execution of a method and store the result in the cache. Annotating a method with both will produce unreliable behavior,
except for specific corner-cases when their <code>condition()</code> or <code>unless()</code> expressions are mutually exclusive. Hence this pattern
is strongly discouraged and an issue will be raised on such cases.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Cacheable
@CachePut
void getBook(String isbn){ // Non compliant, methods annotated with both @Cacheable and @CachePut will not behave as intended
    ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Cacheable
void getBook(String isbn){
    ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"@Cache*" annotations should only be applied on concrete classes (java:S7180)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Annotating interfaces or interface methods with <code>@Cache*</code> annotations is not recommended by the official Spring documentation. If you
use the weaving-based aspect (mode="aspectj"), the <code>@Cache*</code> annotations will be ignored, and no caching proxy will be created.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <strong>Confusing Code</strong>: Developers may mistakenly believe that caching is in effect, leading to confusion and incorrect assumptions
  about application performance. </li>
</ul>
<p>This rule raises an issue when an interface or an interface method is annotated with a <code>@Cache*</code> annotation.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring - <a href="https://docs.spring.io/spring-framework/reference/integration/cache/annotations.html#cache-annotation-enable">Declarative
  Annotation-based Caching</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Move <code>@Cache*</code> annotation from interface or interface method to the concrete class.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public interface ExampleService {

    @Cacheable("exampleCache") //non compliant, interface method is annotated with @Cacheable
    String getData(String id);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Service
public class ExampleServiceImpl implements ExampleService {

    @Cacheable("exampleCache")
    @Override
    public String getData(String id) {
        // Implementation here
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>@InitBinder methods should have void return type (java:S7183)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Spring provides the <code>@InitBinder</code> annotation to initialize a <code>WebDataBinder</code> instance for controllers. This is useful to bind
request parameters to a model object, and to plug converters and formatters into this process.</p>
<p>Methods annotated with <code>@InitBinder</code> must not have a return value, otherwise the controller containing them will throw an exception when
invoked.</p>
<p>This rule raises an issue when a method annotated with <code>@InitBinder</code> does not have a <code>void</code> return type</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Controller
public class MyController {

	@InitBinder
	public String initBinder(WebDataBinder binder) { // Non compliant, make the @InitBinder method return void
		SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
		dateFormat.setLenient(false);
		binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
        return "OK";
	}

	// ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Controller
public class MyController {

	@InitBinder
	public void initBinder(WebDataBinder binder) {
		SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
		dateFormat.setLenient(false);
		binder.registerCustomEditor(Date.class, new CustomDateEditor(dateFormat, false));
	}

	// ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring api - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/InitBinder.html">@InitBinder api</a>
  </li>
  <li> String documentation - <a href="https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-initbinder.html">@InitBinder
  docs</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"@Scheduled" annotation should only be applied to no-arg methods (java:S7184)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>According to Spring documentation, the <code>@Scheduled</code> annotation can only be applied to methods without arguments. Applying @Scheduled to
a method with arguments will result in a runtime error.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Transform method annotated with <code>@Scheduled</code> into a no-arg method.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ExampleService {

    @Scheduled(fixedRate = 5000)
    public void scheduledTask(String param) { // non compliant, method has an argument. It will raise a runtime error.
        // Task implementation
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ExampleService {

    @Scheduled(fixedRate = 5000)
    public void scheduledTask() { // compliant, no-arg method
        // Task implementation
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring - <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/scheduling/annotation/Scheduled.html">scheduled</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>@EventListener methods should have one parameter at most (java:S7185)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<p>Spring API - <a
href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/context/event/EventListener.html">@EventListener</a></p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Spring provides the <code>@EventListener</code> annotation as a simpler alternative to implementing the <code>ApplicationListener</code> interface
for handling events. The <code>@EventListener</code> annotation registers a method as an event handler. This allows to skip the implementation of the
<code>ApplicationListener</code> interface, making it easier to handle events.</p>
<p>The <code>@EventListener</code> annotation can only be used on methods that have at most one parameter, which should be the specific event that we
want to handle. To listen to several types of events, use the <code>classes</code> argument of the <code>@EventListener</code> annotation.</p>
<p>This rule raises an issue on all methods annotated with <code>@EventListener</code> that have more than one parameter.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@EventListener
void handleEvent(CustomerEvent customerEvent, ExceptionalEvent exceptionalEvent) { // Non compliant, this will cause a runtime error
    //... some event handling
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@EventListener(classes = {CustomerEvent.class, ExceptionalEvent.class})
void handleEvent(ApplicationEvent event) { // Only one parameter, of the super type `ApplicationEvent`
    //... some event handling
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Methods returning "Page" or "Slice" must take "Pageable" as an input parameter (java:S7186)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring - <a href="https://docs.spring.io/spring-data/jpa/reference/jpa/query-methods.html">JPA Query Methods</a> </li>
  <li> Spring - <a
  href="https://docs.spring.io/spring-data/jpa/reference/repositories/query-methods-details.html#repositories.paging-and-sorting">Defining Query
  Methods</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Spring Guides - <a href="https://reflectoring.io/spring-boot-paging/">Paging with Spring Boot</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Spring Data Repository supports paging for queries, allowing you to return results in small, manageable chunks rather than retrieving an entire
large result set.</p>
<p>The conventional approach to paginating data in Spring is to use the <code>Pageable</code> interface to control pagination and to store the query
results into a <code>Page</code> or <code>Slice</code>. If a query method in a <code>Repository</code> returns a <code>Page</code> or
<code>Slice</code> without taking a <code>Pageable</code> as an input, it raises a runtime exception.</p>
<p>This rule raises an issue on queries in a <code>Repository</code> that return a <code>Page</code> or <code>Slice</code> without taking a
<code>Pageable</code> as an input.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ensure that query methods returning a <code>Page</code> or <code>Slice</code> include a <code>Pageable</code> parameter in their method
signature.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public Page&lt;Item&gt; findItems() { //non compliant, no Pageable parameter
    // query
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public Page&lt;Item&gt; findItems(Pageable pageable) {
    // query
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"equals(Object obj)" should be overridden along with the "compareTo(T obj)" method (java:S1210)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>According to the Java <code>Comparable.compareTo(T o)</code> documentation:</p>
<blockquote>
  <p>It is strongly recommended, but not strictly required that <code>(x.compareTo(y)==0) == (x.equals(y))</code>.</p>
  <p>Generally speaking, any class that implements the Comparable interface and violates this condition should clearly indicate this fact.</p>
  <p>The recommended language is "Note: this class has a natural ordering that is inconsistent with equals."</p>
</blockquote>
<p>If this rule is violated, weird and unpredictable failures can occur.</p>
<p>For example, in Java 5 the <code>PriorityQueue.remove()</code> method relied on <code>compareTo()</code>, but since Java 6 it has relied on
<code>equals()</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Foo implements Comparable&lt;Foo&gt; {
  @Override
  public int compareTo(Foo foo) { /* ... */ }      // Noncompliant as the equals(Object obj) method is not overridden
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Foo implements Comparable&lt;Foo&gt; {
  @Override
  public int compareTo(Foo foo) { /* ... */ }      // Compliant

  @Override
  public boolean equals(Object obj) { /* ... */ }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Thread.run()" should not be called directly (java:S1217)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The likely intention of a user calling <code>Thread.run()</code> is to start the execution of code within a new thread. This, however, is not what
happens when this method is called.</p>
<p>The purpose of <code>Thread.run()</code> is to provide a method that users can overwrite to specify the code to be executed. The actual thread is
then started by calling <code>Thread.start()</code>. When <code>Thread.run()</code> is called directly, it will be executed as a regular method within
the current thread.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when <code>Thread.run()</code> is called instead of <code>Thread.start()</code>.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>If you intend to execute the contents of the <code>Thread.run()</code> method within a new thread, call <code>Thread.start()</code> instead.</p>
<p>If your intention is only to have a container for a method but execute this method within the current thread, do not use <code>Thread</code> but
<code>Runnable</code> or another functional interface.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Thread myThread = new Thread(runnable);
myThread.run(); // Noncompliant, does not start a thread
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Thread myThread = new Thread(runnable);
myThread.start(); // Compliant
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
class ComputePrimesThread extends Thread {
    @Override
    public void run() {
        // ...
    }
}
new ComputePrimesThread().run(); // Noncompliant, does not start a thread
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
class ComputePrimesThread extends Thread {
    @Override
    public void run() {
        // ...
    }
}
new ComputePrimesThread().start(); // Compliant
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="3" data-diff-type="noncompliant">
class Button {

    private Thread onClick;

    Button(Thread onClick) {
        this.onClick = onClick;
    }

    private void clicked() {
        if (onClick != null) onClick.run(); // Noncompliant, use functional interface
    }
}

new Button(new Thread() {
    @Override public void run() {
        System.out.println("clicked!");
    }
});
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
class Button {

    private Runnable onClick;

    Button(Runnable onClick) {
        this.onClick = onClick;
    }

    private void clicked() {
        if (onClick != null) onClick.run(); // compliant
    }
}

new Button(() -&gt; System.out.println("clicked!"));
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#start--">Java™ Platform, Standard Edition 8 API Specification -
  Thread.start()</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.javatpoint.com/what-if-we-call-java-run-method-directly">JavaTPoint - What if we call Java run() method directly instead
  start() method?</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"switch" statements should not contain non-case labels (java:S1219)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Even if it is legal, mixing case and non-case labels in the body of a switch statement is very confusing and can even be the result of a typing
error.</p>
<h3>Noncompliant code example</h3>
<pre>
switch (day) {
  case MONDAY:
  case TUESDAY:
  WEDNESDAY:   // Noncompliant; syntactically correct, but behavior is not what's expected
    doSomething();
    break;
  ...
}

switch (day) {
  case MONDAY:
    break;
  case TUESDAY:
    foo:for(int i = 0 ; i &lt; X ; i++) {  // Noncompliant; the code is correct and behaves as expected but is barely readable
         /* ... */
        break foo;  // this break statement doesn't relate to the nesting case TUESDAY
         /* ... */
    }
    break;
    /* ... */
}
</pre>
<h3>Compliant solution</h3>
<pre>
switch (day) {
  case MONDAY:
  case TUESDAY:
  case WEDNESDAY:
    doSomething();
    break;
  ...
}

switch (day) {
  case MONDAY:
    break;
  case TUESDAY:
    compute(args); // put the content of the labelled "for" statement in a dedicated method
    break;

    /* ... */
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Private fields only used as local variables in methods should become local variables (java:S1450)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the value of a private field is always assigned to in a class' methods before being read, then it is not being used to store class
information. Therefore, it should become a local variable in the relevant methods to prevent any misunderstanding.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Foo {
  private int a;
  private int b;

  public void doSomething(int y) {
    a = y + 5;
    ...
    if(a == 0) {
      ...
    }
    ...
  }

  public void doSomethingElse(int y) {
    b = y + 3;
    ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Foo {

  public void doSomething(int y) {
    int a = y + 5;
    ...
    if(a == 0) {
      ...
    }
  }

  public void doSomethingElse(int y) {
    int b = y + 3;
    ...
  }
}
</pre>
<h3>Exceptions</h3>
<p>This rule doesn’t raise any issue on annotated field.</p></p>
            </div>
        <div class="rule">
            <h3>Track lack of copyright and license headers (java:S1451)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Each source file should start with a header stating file ownership and the license which must be used to distribute the application.</p>
<p>This rule must be fed with the header text that is expected at the beginning of every file.</p>
<h3>Compliant solution</h3>
<pre>
/*
 * SonarQube, open source software quality management tool.
 * Copyright (C) 2008-2013 SonarSource
 * mailto:contact AT sonarsource DOT com
 *
 * SonarQube is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 3 of the License, or (at your option) any later version.
 *
 * SonarQube is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public License
 * along with this program; if not, write to the Free Software Foundation,
 * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 */
</pre></p>
            </div>
        <div class="rule">
            <h3>Generic wildcard types should not be used in return types (java:S1452)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A return type containing wildcards cannot be narrowed down in any context. This indicates that the developer’s intention was likely something
else.</p>
<p>The core problem lies in type variance. Expressions at an input position, such as arguments passed to a method, can have a more specific type than
the type expected by the method, which is called <em>covariance</em>. Expressions at an output position, such as a variable that receives the return
result from a method, can have a more general type than the method’s return type, which is called <em>contravariance</em>. This can be traced back to
the Liskov substitution principle.</p>
<p>In Java, type parameters of a generic type are invariant by default due to their potential occurrence in both input and output positions at the
same time. A classic example of this is the methods <code>T get()</code> (output position) and <code>add(T element)</code> (input position) in
interface <code>java.util.List</code>. We could construct cases with invalid typing in <code>List</code> if <code>T</code> were not invariant.</p>
<p>Wildcards can be employed to achieve covariance or contravariance in situations where the type parameter appears in one position only:</p>
<ul>
  <li> <code>&lt;? extends Foo&gt;</code> for covariance (input positions) </li>
  <li> <code>&lt;? super Foo&gt;</code> for contravariance (output positions) </li>
</ul>
<p>However, covariance is ineffective for the return type of a method since it is not an input position. Making it contravariant also has no effect
since it is the receiver of the return value which must be contravariant (use-site variance in Java). Consequently, a return type containing wildcards
is generally a mistake.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The solution to this problem depends on the original intention of the developer. Given the examples:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
List&lt;? extends Animal&gt; getAnimals() { ... } // Noncompliant, wildcard with no use
List&lt;? super Plant&gt; getLifeforms() { ... }  // Noncompliant, wildcard with no use
</pre>
<p>You can remove the wildcards to make the types invariant:</p>
<pre data-diff-id="1" data-diff-type="compliant">
List&lt;Animal&gt; getAnimals() { ... }           // Compliant, using invariant type instead
List&lt;Plant&gt; getLifeforms() { ... }          // Compliant, using invariant type instead
</pre>
<p>Or replace them with a super- or subtypes (still invariant):</p>
<pre>
List&lt;Dog&gt; getAnimals() { ... }              // Compliant, using subtype instead
List&lt;Lifeform&gt; getLifeforms() { ... }       // Compliant, using supertype instead
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/extra/generics/wildcards.html">The Java™ Tutorials - Wildcards</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://medium.com/javarevisited/variance-in-java-and-scala-63af925d21dc">Sinisa Louc - A Complete Guide to Variance in Java and
  Scala</a> </li>
  <li> <a href="https://web.archive.org/web/20240206045705/https://kotlinexpertise.com/kotlin-generics-and-variance-vs-java/">Kotlin Expertise Blog -
  Kotlin Generics and Variance (Compared to Java)</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)">Wikipedia - Covariance and contravariance (computer
  science)</a> </li>
  <li> <a href="https://schneide.blog/2015/05/11/declaration-site-and-use-site-variance-explained/">Schneide Blog - Declaration-site and use-site
  variance explained</a> </li>
  <li> <a href="https://en.wikipedia.org/wiki/Liskov_substitution_principle">Wikipedia - Liskov substitution principle</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>An abstract class should have both abstract and concrete methods (java:S1694)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The purpose of an abstract class is to provide some heritable behaviors while also defining methods which must be implemented by sub-classes.</p>
<p>A class with no abstract methods that was made abstract purely to prevent instantiation should be converted to a concrete class (i.e. remove the
<code>abstract</code> keyword) with a private constructor.</p>
<p>A class with only abstract methods and no inheritable behavior should be converted to an interface.</p>
<h3>Noncompliant code example</h3>
<pre>
public abstract class Animal {  // Noncompliant; should be an interface
  abstract void move();
  abstract void feed();
}

public abstract class Color {  // Noncompliant; should be concrete with a private constructor
  private int red = 0;
  private int green = 0;
  private int blue = 0;

  public int getRed() {
    return red;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public interface Animal {
  void move();
  void feed();
}

public class Color {
  private int red = 0;
  private int green = 0;
  private int blue = 0;

  private Color () {}

  public int getRed() {
    return red;
  }
}

public abstract class Lamp {

  private boolean switchLamp=false;

  public abstract void glow();

  public void flipSwitch() {
    switchLamp = !switchLamp;
    if (switchLamp) {
      glow();
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"NullPointerException" should not be explicitly thrown (java:S1695)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>NullPointerException</code> should indicate that a <code>null</code> value was unexpectedly encountered. Good programming practice dictates
that code is structured to avoid NPE’s.</p>
<p>Explicitly throwing <code>NullPointerException</code> forces a method’s callers to explicitly catch it, rather than coding to avoid it. Further, it
makes it difficult to distinguish between the unexpectedly-encountered <code>null</code> value and the condition which causes the method to purposely
throw an NPE.</p>
<p>If an NPE is being thrown to indicate that a parameter to the method should not have been null, use the <code>@NotNull</code> annotation
instead.</p>
<h3>Noncompliant code example</h3>
<pre>
public void doSomething (String aString) throws NullPointerException {
     throw new NullPointerException();
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void doSomething (@NotNull String aString) {
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"NullPointerException" should not be caught (java:S1696)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/395">CWE-395 - Use of NullPointerException Catch to Detect NULL Pointer Dereference</a>
  </li>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/display/java/ERR08-J.+Do+not+catch+NullPointerException+or+any+of+its+ancestors">ERR08-J.
  Do not catch NullPointerException or any of its ancestors</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>NullPointerException</code> should be avoided, not caught. Any situation in which <code>NullPointerException</code> is explicitly caught can
easily be converted to a <code>null</code> test, and any behavior being carried out in the catch block can easily be moved to the "is null" branch of
the conditional.</p>
<h3>Noncompliant code example</h3>
<pre>
public int lengthPlus(String str) {
  int len = 2;
  try {
    len += str.length();
  }
  catch (NullPointerException e) {
    log.info("argument was null");
  }
  return len;
}
</pre>
<h3>Compliant solution</h3>
<pre>
public int lengthPlus(String str) {
  int len = 2;

  if (str != null) {
    len += str.length();
  }
  else {
    log.info("argument was null");
  }
  return len;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Public methods should not contain selector arguments (java:S2301)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A selector argument is a <code>boolean</code> argument that’s used to determine which of two paths to take through a method. Specifying such a
parameter may seem innocuous, particularly if it’s well named.</p>
<p>Unfortunately, the maintainers of the code calling the method won’t see the parameter name, only its value. They’ll be forced either to guess at
the meaning or to take extra time to look the method up.</p>
<p>Instead, separate methods should be written.</p>
<p>This rule finds methods with a <code>boolean</code> that’s used to determine which path to take through the method.</p>
<h3>Noncompliant code example</h3>
<pre>
public String tempt(String name, boolean ofAge) {
  if (ofAge) {
    offerLiquor(name);
  } else {
    offerCandy(name);
  }
}

// ...
public void corrupt() {
  tempt("Joe", false); // does this mean not to temp Joe?
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void temptAdult(String name) {
  offerLiquor(name);
}

public void temptChild(String name) {
    offerCandy(name);
}

// ...
public void corrupt() {
  age &lt; legalAge ? temptChild("Joe") : temptAdult("Joe");
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"deleteOnExit" should not be used (java:S2308)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Use of <code>File.deleteOnExit()</code> is not recommended for the following reasons:</p>
<ul>
  <li> The deletion occurs only in the case of a normal JVM shutdown but not when the JVM crashes or is killed. </li>
  <li> For each file handler, the memory associated with the handler is released only at the end of the process. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
File file = new File("file.txt");
file.deleteOnExit();  // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Files should not be empty (java:S2309)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Files with no lines of code clutter a project and should be removed.</p>
<h3>Noncompliant code example</h3>
<pre>
//package org.foo;
//
//public class Bar {}
</pre></p>
            </div>
        <div class="rule">
            <h3>Methods returns should not be invariant (java:S3516)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a method is designed to return an invariant value, it may be poor design, but it shouldn’t adversely affect the outcome of your program.
However, when it happens on all paths through the logic, it is surely a bug.</p>
<p>This rule raises an issue when a method contains several <code>return</code> statements that all return the same value.</p>
<h3>Noncompliant code example</h3>
<pre>
int foo(int a) {
  int b = 12;
  if (a == 1) {
    return b;
  }
  return b;  // Noncompliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Zero should not be a possible denominator (java:S3518)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>If the denominator to an integer division or remainder operation is zero, a <code>ArithmeticException</code> is thrown.</p>
<p>This error will crash your program in most cases. To fix it, you need to ensure that the denominator value in all division operations is always
non-zero, or check the value against zero before performing the division.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/ArithmeticException.html">ArithmeticException</a> </li>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-15.html#jls-15.17.2">The Division Operator in the JLS</a> </li>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-15.html#jls-15.17.3">The Remainder Operator in the JLS</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/369">CWE-369 - Divide by zero</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/CTZGBQ">CERT, NUM02-J.</a> - Ensure that division and remainder operations do not result in
  divide-by-zero errors </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222612">Application Security and
  Development: V-222612</a> - The application must not be vulnerable to overflow attacks. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A division (<code>/</code>) or remainder operation (<code>%</code>) by zero indicates a bug or logical error. This is because in Java, a division
or remainder operation where the denominator is zero and not a floating point value always results in an <code>ArithmeticException</code> being
thrown.</p>
<p>When working with <code>double</code> or <code>float</code> values, no exception will be thrown, but the operation will result in special floating
point values representing either positive infinity, negative infinity, or <code>NaN</code>. Unless these special values are explicitly handled by a
program, zero denominators should be avoided in floating point operations, too. Otherwise, the application might produce unexpected results.</p>
<h3>What is the potential impact?</h3>
<p>Issues of this type interrupt the normal execution of a program, causing it to crash or putting it into an inconsistent state. Therefore, this
issue might impact the availability and reliability of your application, or even result in data loss.</p>
<p>If the computation of the denominator is tied to user input data, this issue can potentially even be exploited by attackers to disrupt your
application.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
void test_divide() {
  int z = 0;
  if (unknown()) {
    // ..
    z = 3;
  } else {
    // ..
  }
  z = 1 / z; // Noncompliant, possible division by zero
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
void test_divide() {
  int z = 0;
  if (unknown()) {
    // ..
    z = 3;
  } else {
    // ..
    z = 1;
  }
  z = 1 / z;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Arrays.stream" should be used for primitive arrays (java:S3631)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>For arrays of objects, <code>Arrays.asList(T ... a).stream()</code> and <code>Arrays.stream(array)</code> are basically equivalent in terms of
performance. However, for arrays of primitives, using <code>Arrays.asList</code> will force the construction of a list of boxed types, and then use
<em>that</em> list as a stream. On the other hand, <code>Arrays.stream</code> uses the appropriate primitive stream type (<code>IntStream</code>,
<code>LongStream</code>, <code>DoubleStream</code>) when applicable, with much better performance.</p>
<h3>Noncompliant code example</h3>
<pre>
Arrays.asList("a1", "a2", "b1", "c2", "c1").stream()
    .filter(...)
    .forEach(...);

Arrays.asList(1, 2, 3, 4).stream() // Noncompliant
    .filter(...)
    .forEach(...);
</pre>
<h3>Compliant solution</h3>
<pre>
Arrays.asList("a1", "a2", "b1", "c2", "c1").stream()
    .filter(...)
    .forEach(...);

int[] intArray = new int[]{1, 2, 3, 4};
Arrays.stream(intArray)
    .filter(...)
    .forEach(...);
</pre></p>
            </div>
        <div class="rule">
            <h3>Spring "@Controller" classes should not use "@Scope" (java:S3750)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Spring <code>@Controller</code>s, <code>@Service</code>s, and <code>@Repository</code>s have <code>singleton</code> scope by default, meaning only
one instance of the class is ever instantiated in the application. Defining any other scope for one of these class types will result in needless churn
as new instances are created and destroyed. In a busy web application, this could cause a significant amount of needless additional load on the
server.</p>
<p>This rule raises an issue when the <code>@Scope</code> annotation is applied to a <code>@Controller</code>, <code>@Service</code>, or
<code>@Repository</code> with any value but "singleton". <code>@Scope("singleton")</code> is redundant, but ignored.</p>
<h3>Noncompliant code example</h3>
<pre>
@Scope("prototype")  // Noncompliant
@Controller
public class HelloWorld {
</pre>
<h3>Compliant solution</h3>
<pre>
@Controller
public class HelloWorld {
</pre></p>
            </div>
        <div class="rule">
            <h3>"@RequestMapping" methods should not be "private" (java:S3751)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A method with a <code>@RequestMapping</code> annotation part of a class annotated with <code>@Controller</code> (directly or indirectly through a
meta annotation - <code>@RestController</code> from Spring Boot is a good example) will be called to handle matching web requests. That will happen
even if the method is <code>private</code>, because Spring invokes such methods via reflection, without checking visibility.</p>
<p>So marking a sensitive method <code>private</code> may seem like a good way to control how such code is called. Unfortunately, not all Spring
frameworks ignore visibility in this way. For instance, if you’ve tried to control web access to your sensitive, <code>private</code>,
<code>@RequestMapping</code> method by marking it <code>@Secured</code> …​ it will still be called, whether or not the user is authorized to access
it. That’s because AOP proxies are not applied to private methods.</p>
<p>In addition to <code>@RequestMapping</code>, this rule also considers the annotations introduced in Spring Framework 4.3: <code>@GetMapping</code>,
<code>@PostMapping</code>, <code>@PutMapping</code>, <code>@DeleteMapping</code>, <code>@PatchMapping</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
@RequestMapping("/greet", method = GET)
private String greet(String greetee) {  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
@RequestMapping("/greet", method = GET)
public String greet(String greetee) {
</pre></p>
            </div>
        <div class="rule">
            <h3>Allowing both safe and unsafe HTTP methods is security-sensitive (java:S3752)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>For all the routes/controllers of an application, the authorized HTTP methods should be explicitly defined and safe HTTP methods should only be
used to perform read-only operations.</p>
<h2>Compliant Solution</h2>
<pre>
@RequestMapping("/delete_user", method = RequestMethod.POST)  // Compliant
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = RequestMethod.POST) // Compliant
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
  <li> <a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-use-proper-verbs">Spring Security Official
  Documentation: Use proper HTTP verbs (CSRF protection)</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> HTTP methods are not defined at all for a route/controller of the application. </li>
  <li> Safe HTTP methods are defined and used for a route/controller that can change the state of an application. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
@RequestMapping("/delete_user")  // Sensitive: by default all HTTP methods are allowed
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = {RequestMethod.GET, RequestMethod.POST}) // Sensitive: both safe and unsafe methods are allowed
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>An HTTP method is safe when used to perform a read-only operation, such as retrieving information. In contrast, an unsafe HTTP method is used to
change the state of an application, for instance to update a user’s profile on a web application.</p>
<p>Common safe HTTP methods are GET, HEAD, or OPTIONS.</p>
<p>Common unsafe HTTP methods are POST, PUT and DELETE.</p>
<p>Allowing both safe and unsafe HTTP methods to perform a specific operation on a web application could impact its security, for example CSRF
protections are most of the time only protecting operations performed by unsafe HTTP methods.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>An HTTP method is safe when used to perform a read-only operation, such as retrieving information. In contrast, an unsafe HTTP method is used to
change the state of an application, for instance to update a user’s profile on a web application.</p>
<p>Common safe HTTP methods are GET, HEAD, or OPTIONS.</p>
<p>Common unsafe HTTP methods are POST, PUT and DELETE.</p>
<p>Allowing both safe and unsafe HTTP methods to perform a specific operation on a web application could impact its security, for example CSRF
protections are most of the time only protecting operations performed by unsafe HTTP methods.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> HTTP methods are not defined at all for a route/controller of the application. </li>
  <li> Safe HTTP methods are defined and used for a route/controller that can change the state of an application. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>For all the routes/controllers of an application, the authorized HTTP methods should be explicitly defined and safe HTTP methods should only be
used to perform read-only operations.</p>
<h2>Sensitive Code Example</h2>
<pre>
@RequestMapping("/delete_user")  // Sensitive: by default all HTTP methods are allowed
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = {RequestMethod.GET, RequestMethod.POST}) // Sensitive: both safe and unsafe methods are allowed
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}
</pre>
<h2>Compliant Solution</h2>
<pre>
@RequestMapping("/delete_user", method = RequestMethod.POST)  // Compliant
public String delete1(String username) {
// state of the application will be changed here
}

@RequestMapping(path = "/delete_user", method = RequestMethod.POST) // Compliant
String delete2(@RequestParam("id") String id) {
// state of the application will be changed here
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/352">CWE-352 - Cross-Site Request Forgery (CSRF)</a> </li>
  <li> <a href="https://owasp.org/www-community/attacks/csrf">OWASP: Cross-Site Request Forgery</a> </li>
  <li> <a href="https://docs.spring.io/spring-security/site/docs/5.0.x/reference/html/csrf.html#csrf-use-proper-verbs">Spring Security Official
  Documentation: Use proper HTTP verbs (CSRF protection)</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"@Controller" classes that use "@SessionAttributes" must call "setComplete" on their "SessionStatus" objects (java:S3753)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A Spring <code>@Controller</code> that uses <code>@SessionAttributes</code> is designed to handle a stateful / multi-post form. Such
<code>@Controller</code>s use the specified <code>@SessionAttributes</code> to store data on the server between requests. That data should be cleaned
up when the session is over, but unless <code>setComplete()</code> is called on the <code>SessionStatus</code> object from a
<code>@RequestMapping</code> method, neither Spring nor the JVM will know it’s time to do that. Note that the <code>SessionStatus</code> object must
be passed to that method as a parameter.</p>
<h3>Noncompliant code example</h3>
<pre>
@Controller
@SessionAttributes("hello")  // Noncompliant; this doesn't get cleaned up
public class HelloWorld {

  @RequestMapping("/greet", method = GET)
  public String greet(String greetee) {

    return "Hello " + greetee;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Controller
@SessionAttributes("hello")
public class HelloWorld {

  @RequestMapping("/greet", method = GET)
  public String greet(String greetee) {

    return "Hello " + greetee;
  }

  @RequestMapping("/goodbye", method = POST)
  public String goodbye(SessionStatus status) {
    //...
    status.setComplete();
  }

}
</pre></p>
            </div>
        <div class="rule">
            <h3>"HttpSecurity" URL patterns should be correctly ordered (java:S4601)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code is vulnerable because it defines access control configuration in the wrong order.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
      .antMatchers("/resources/**", "/signup", "/about").permitAll()
      .antMatchers("/admin/**").hasRole("ADMIN")
      .antMatchers("/admin/login").permitAll() // Noncompliant
      .antMatchers("/**", "/home").permitAll()
      .antMatchers("/db/**").access("hasRole('ADMIN') and hasRole('DBA')") // Noncompliant
      .and().formLogin().loginPage("/login").permitAll().and().logout().permitAll();
  }
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
  protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
      .antMatchers("/resources/**", "/signup", "/about").permitAll()
      .antMatchers("/admin/login").permitAll()
      .antMatchers("/admin/**").hasRole("ADMIN")
      .antMatchers("/db/**").access("hasRole('ADMIN') and hasRole('DBA')")
      .antMatchers("/**", "/home").permitAll()
      .and().formLogin().loginPage("/login").permitAll().and().logout().permitAll();
  }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring Documentation - <a href="https://docs.spring.io/spring-security/reference/servlet/authorization/authorize-http-requests.html">Authorize
  HttpServletRequests</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 - Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 - Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/285">CWE-285 - Improper Authorization</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/287">CWE-287 - Improper Authentication</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Spring Framework, and, more precisely, the Spring Security component, allows setting up access control checks at the URI level. This is done by
adding request matchers to the security configuration, each authorizing access to some resources depending on the incoming request entitlement.</p>
<p>Similarly to firewall filtering rules, the order in which those matchers are defined is security relevant.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Configured URL matchers are considered in the order they are declared. Especially, for a given resource, if a looser filter is defined before a
stricter one, only the less secure configuration will apply. No request will ever reach the stricter rule.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> A URL pattern ending with <code>**</code> precedes another one having the same prefix. E.g. <code>/admin/**</code> is defined before
  <code>/admin/example/**</code> </li>
  <li> A pattern without wildcard characters is preceded by another one that matches it. E.g.: <code>/page-index/db</code> is defined after
  <code>/page*/**</code> </li>
</ul>
<h3>What is the potential impact?</h3>
<p>Access control rules that have been defined but cannot be applied generally indicate an error in the filtering process. In most cases, this will
have consequences on the application’s authorization and authentication mechanisms.</p>
<h4>Authentication bypass</h4>
<p>When the ignored access control rule is supposed to enforce the authentication on a resource, the consequence is a bypass of the authentication for
that resource. Depending on the scope of the ignored rule, a single feature or whole sections of the application can be left unprotected.</p>
<p>Attackers could take advantage of such an issue to access the affected features without prior authentication, which may impact the confidentiality
or integrity of sensitive, business, or personal data.</p>
<h4>Privilege escalation</h4>
<p>When the ignored access control rule is supposed to verify the role of an authenticated user, the consequence is a privilege escalation or
authorization bypass. An authenticated user with low privileges on the application will be able to access more critical features or sections of the
application.</p>
<p>This could have financial consequences if the accessed features are normally accessed by paying users. It could also impact the confidentiality or
integrity of sensitive, business, or personal data, depending on the features.</p></p>
            </div>
        <div class="rule">
            <h3>"setDaemon", "setPriority" and "getThreadGroup" should not be invoked on virtual threads (java:S6901)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Thread</code> class has some methods that are used to monitor and manage its execution. With the introduction of virtual threads in Java
21, there are three of these methods that behave differently between the standard platform threads and the virtual ones.</p>
<p>For virtual threads:</p>
<ul>
  <li> <code>Thread.setDaemon(boolean)</code> will throw an <code>IllegalArgumentException</code> if <code>false</code> is passed as an argument as a
  virtual thread daemon status is always true. </li>
  <li> <code>Thread.setPriority(int priority)</code> will never change the actual priority of a virtual thread, which is always equal to
  <code>Thread.NORM_PRIORITY</code> </li>
  <li> <code>Thread.getThreadGroup()</code> will return a dummy "VirtualThreads" group that is empty and should not be used </li>
</ul>
<p>This rule reports an issue when one of these methods is invoked on a virtual thread.</p>

<h4>Noncompliant code example</h4>
<pre>
Thread t = Thread.ofVirtual().unstarted(()-&gt;{/* some task */});
t.setPriority(1); // Noncompliant; virtual threads' priority cannot be changed
t.setDaemon(false); // Noncompliant; will throw IllegalArgumentException
t.setDaemon(true); // Noncompliant; redundant
t.start();
var threadGroup = t.getThreadGroup(); // Noncompliant; virtual thread groups should not be used
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#setDaemon(boolean)">Thread.setDaemon</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#setPriority(int)">Thread.setPriority</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#getThreadGroup()">Thread.getThreadGroup</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/ThreadGroup.html#virtualthreadgroup">Virtual threads group</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Avoid using "FetchType.EAGER" (java:S6904)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p><code>FetchType</code> is an enumeration in the Java Persistence API (JPA) that is used to define the fetching strategy for associations
(relationships) between entities in a relational database.</p>
<p>There are two main values for FetchType:</p>
<ul>
  <li> <code>FetchType.EAGER</code>: the association is loaded immediately when the owning entity is loaded. </li>
  <li> <code>FetchType.LAZY</code>: the association is not loaded unless it is explicitly accessed. </li>
</ul>
<p>This rule raises an issue when the <code>fetch</code> argument is explicitly set to <code>FetchType.EAGER</code>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javaee/7/api/javax/persistence/FetchType.html">Java EE 7 API - FetchType</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Remove or replace <code>FetchType.EAGER</code> with <code>FetchType.LAZY</code> in JPA annotations.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@OneToMany(mappedBy = "parent", fetch = FetchType.EAGER) // Noncompliant
private List&lt;ChildEntity&gt; children;

@OneToMany(mappedBy = "child", fetch = FetchType.EAGER) // Noncompliant
private List&lt;ParentEntity&gt; parents;
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@OneToMany(mappedBy = "parent", fetch = FetchType.LAZY) // Compliant
private List&lt;ChildEntity&gt; children;

@OneToMany(mappedBy = "child") // Compliant
private List&lt;ParentEntity&gt; parents;
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Using <code>FetchType.EAGER</code> can lead to inefficient data loading and potential performance issues. Eager Loading initializes associated data
on the spot, potentially fetching more data than needed.</p></p>
            </div>
        <div class="rule">
            <h3>Virtual threads should not run tasks that include synchronized code (java:S6906)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://openjdk.org/jeps/444#:~:text=There%20are%20two,by%20capturing%20carriers">Virtual threads, pinning
  scenarios</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java 21 virtual threads allow the JVM to optimize the usage of OS threads, by mounting and unmounting them on an OS thread when needed, and making
them more efficient when dealing with blocking operations such as HTTP requests or I/O.</p>
<p>However, when code is executed inside a <code>synchronized</code> block or <code>synchronized</code> method, the virtual thread stays pinned to the
underlying OS thread and cannot be unmounted during a blocking operation. This will cause the OS thread to be blocked, which can impact the
scalability of the application.</p>
<p>Therefore, virtual threads should not execute code that contains <code>synchronized</code> blocks or invokes <code>synchronized</code> methods.
Platform threads should be used in these cases.</p>
<p>This rule raises an issue when a virtual thread contains <code>synchronized</code> blocks or invokes <code>synchronized</code> methods.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void enqueue(){
    Thread.startVirtualThread(() -&gt; { // Noncompliant; use a platform thread instead
            setupOperations();
            dequeLogic();
        }
    });
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void enqueue(){
    new Thread(() -&gt; {
        synchronized {
            setupOperations();
            dequeLogic();
        }
    }).start();
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
void enqueue2(){
    Thread.startVirtualThread(() -&gt; { // Noncompliant; use a platform thread instead of a virtual one
        if(someCondition){
            synchronizedMethod();
        }else{
            defaultLogic();
        }
    });
}
synchronized void synchronizedMethod(){}
void defaultLogic(){}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
void enqueue2(){
    new Thread(() -&gt; {
        if(someCondition){
            synchronizedMethod();
        }else{
            defaultLogic();
        }
    }).start();
}
synchronized void synchronizedMethod(){}
void defaultLogic(){}
</pre></p>
            </div>
        <div class="rule">
            <h3>Constant parameters in a "PreparedStatement" should not be set more than once (java:S6909)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>PreparedStatement</code> is frequently used in loops because it allows to conveniently set parameters. A small optimization is possible
by setting constant parameters outside the loop or hard-coding them in the query whenever possible.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <em>Performance</em>: the unnecessary calls to the setter methods bring overhead. </li>
  <li> <em>Sustainability</em>: the extra overhead has a negative impact on the environment. </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.sql/java/sql/PreparedStatement.html">Oracle SDK - PreparedStatement</a> </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html">Oracle Tutorial - Using Prepared Statements</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>The <code>java.sql.PreparedStatement</code> represents a precompiled SQL statement that can be efficiently executed multiple times.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Place calls to setter methods that take a constant argument outside the loop.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class DatabaseExample {

    public record Order(String id, BigDecimal price) {}

    public void updateTodayOrders(Connection connection, List&lt;Order&gt; orders) {
            Date today = java.sql.Date.valueOf(LocalDate.now());
            String insertQuery = "INSERT INTO Order (id, price, executionDate) VALUES (?, ?, ?)";
            PreparedStatement preparedStatement = connection.prepareStatement(insertQuery);

            for(Order order: orders) {
                preparedStatement.setString(1, order.id());
                preparedStatement.setString(2, order.price());
                preparedStatement.setDate(3, today); // Noncompliant
                preparedStatement.executeUpdate();
            }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class DatabaseExample {

    public record Order(String id, BigDecimal price) {}

    public void updateTodayOrders(Connection connection, List&lt;Order&gt; orders) {
            Date today = java.sql.Date.valueOf(LocalDate.now());
            String insertQuery = "INSERT INTO Order (id, price, executionDate) VALUES (?, ?, ?)";
            PreparedStatement preparedStatement = connection.prepareStatement(insertQuery);

            preparedStatement.setDate(3, today); // Compliant
            for(Order order: orders) {
                preparedStatement.setString(1, order.id());
                preparedStatement.setString(2, order.price());
                preparedStatement.executeUpdate();
            }
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Class variable fields should not have public accessibility (java:S1104)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Public fields in public classes do not respect the encapsulation principle and have three main disadvantages:</p>
<ul>
  <li> Additional behavior such as validation cannot be added. </li>
  <li> The internal representation is exposed, and cannot be changed afterwards. </li>
  <li> Member values are subject to change from anywhere in the code and may not meet the programmer’s assumptions. </li>
</ul>
<p>To prevent unauthorized modifications, private attributes and accessor methods (set and get) should be used.</p>
<h3>What is the potential impact?</h3>
<p>Public fields can be modified by any part of the code and this can lead to unexpected changes and hard-to-trace bugs.</p>
<p>Public fields don’t hide the implementation details. As a consequence, it is no longer possible to change how the data is stored internally without
impacting the client code of the class.</p>
<p>The code is harder to maintain.</p>
<h3>Exceptions</h3>
<p>This rule ignores <code>public final</code> fields because they are not modifiable. Also, annotated fields, whatever the annotation(s) will be
ignored, as annotations are often used by injection frameworks, which in exchange require having public fields.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/493">CWE-493 - Critical Public Variable Without Final Modifier</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Depending on your need there are multiple options:</p>
<ul>
  <li> Encapsulate the field
    <ol>
      <li> Make the field private. </li>
      <li> Define methods to get and set the value of the field.<br> These methods are commonly known as getter and setter methods and are prefixed by
      <code>get</code> and <code>set</code> followed by the name of the field. <em>Note:</em> as a bonus it is now possible to monitor value changes
      using breakpoints. </li>
    </ol>  </li>
  <li> Mark the field as <code>public final</code> if it is not supposed to change. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {

  public static final int SOME_CONSTANT = 0;     // Compliant - constants are not checked

  public String firstName;                       // Noncompliant

}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {

  public static final int SOME_CONSTANT = 0;     // Compliant - constants are not checked

  private String firstName;

  public String getFirstName() {
    return firstName;
  }

  public void setFirstName(String firstName) {
    this.firstName = firstName;
  }

}
</pre>
<h3>How does this work?</h3>
<p>By having a setter and a getter the code can control how the field is accessed and modified. For example, adding validation in the setter method
will ensure that only valid values are set.</p>
<p>The access modifiers on the setter can also be changed to <code>private</code> or <code>protected</code> to restrain which code can modify the
value.</p></p>
            </div>
        <div class="rule">
            <h3>An open curly brace should be located at the beginning of a line (java:S1106)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared coding conventions make it possible to collaborate efficiently. This rule makes it mandatory to place the open curly brace at the beginning
of a line.</p>
<h3>Noncompliant code example</h3>
<pre>
public void myMethod {  // Noncompliant
  if(something) {  // Noncompliant
    executeTask();
  } else {  // Noncompliant
    doSomethingElse();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void myMethod
{
  if(something)
  {
    executeTask();
  } else
  {
    doSomethingElse();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Close curly brace and the next "else", "catch" and "finally" keywords should be located on the same line (java:S1107)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared coding conventions make it possible for a team to collaborate efficiently.</p>
<p>This rule makes it mandatory to place closing curly braces on the same line as the next <code>else</code>, <code>catch</code> or
<code>finally</code> keywords.</p>
<h3>Noncompliant code example</h3>
<pre>
public void myMethod() {
  if(something) {
    executeTask();
  } else if (somethingElse) {
    doSomethingElse();
  }
  else {                               // Noncompliant
     generateError();
  }

  try {
    generateOrder();
  } catch (Exception e) {
    log(e);
  }
  finally {                            // Noncompliant
    closeConnection();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void myMethod() {
  if(something) {
    executeTask();
  } else if (somethingElse) {
    doSomethingElse();
  } else {
     generateError();
  }

  try {
    generateOrder();
  } catch (Exception e) {
    log(e);
  } finally {
    closeConnection();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Close curly brace and the next "else", "catch" and "finally" keywords should be on two different lines (java:S1108)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared coding conventions make it possible for a team to collaborate efficiently.</p>
<p>This rule makes it mandatory to place a closing curly brace and the next <code>else</code>, <code>catch</code> or <code>finally</code> keyword on
two different lines.</p>
<h3>Noncompliant code example</h3>
<pre>
public void myMethod() {
  if(something) {
    executeTask();
  } else if (somethingElse) {          // Noncompliant
    doSomethingElse();
  }
  else {                               // Compliant
     generateError();
  }

  try {
    generateOrder();
  } catch (Exception e) {
    log(e);
  }
  finally {
    closeConnection();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void myMethod() {
  if(something) {
    executeTask();
  }
  else if (somethingElse) {
    doSomethingElse();
  }
  else {
     generateError();
  }

  try {
    generateOrder();
  }
  catch (Exception e) {
    log(e);
  }
  finally {
    closeConnection();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>A close curly brace should be located at the beginning of a line (java:S1109)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared coding conventions make it possible for a team to efficiently collaborate. This rule makes it mandatory to place a close curly brace at the
beginning of a line.</p>
<h3>Noncompliant code example</h3>
<pre>
if(condition) {
  doSomething();}
</pre>
<h3>Compliant solution</h3>
<pre>
if(condition) {
  doSomething();
}
</pre>
<h3>Exceptions</h3>
<p>When blocks are inlined (open and close curly braces on the same line), no issue is triggered.</p>
<pre>
if(condition) {doSomething();}
</pre></p>
            </div>
        <div class="rule">
            <h3>Execution of the Garbage Collector should be triggered only by the JVM (java:S1215)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Calling <code>System.gc()</code> or <code>Runtime.getRuntime().gc()</code> is a bad idea for a simple reason: there is no way to know exactly what
will be done under the hood by the JVM because the behavior will depend on its vendor, version and options:</p>
<ul>
  <li> Will the whole application be frozen during the call? </li>
  <li> Is the <code>-XX:DisableExplicitGC</code> option activated? </li>
  <li> Will the JVM simply ignore the call? </li>
  <li> …​ </li>
</ul>
<p>Like for <code>System.gc()</code>, there is no reason to manually call <code>runFinalization()</code> to force the call of finalization methods of
any objects pending finalization.</p>
<p>An application relying on these unpredictable methods is also unpredictable and therefore broken. The task of running the garbage collector and
calling <code>finalize()</code> methods should be left exclusively to the JVM.</p></p>
            </div>
        <div class="rule">
            <h3>The default unnamed package should not be used (java:S1220)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-packages">Baeldung - Guide to Java Packages</a> </li>
  <li> <a
  href="https://www.tutorialspoint.com/what-are-the-best-practices-to-keep-in-mind-while-using-packages-in-java#:~:text=Naming%20conventions%20and%20best%20practices%20for%20packages">tutorialspoint - What are the best practices to keep in mind while using packages in Java?</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java packages serve two purposes:</p>
<ol>
  <li> Structure — Packages give a structure to the set of classes of your project. It is a bad practice to put all classes flat into the source
  directory of a project without a package structure. A structure helps to mentally break down a project into smaller parts, simplifying readers'
  understanding of how components are connected and how they interact. </li>
  <li> Avoiding name clashes — a class part of the <em>default package</em> if no explicit package name is specified. This can easily cause name
  collisions when other projects define a class of the same name. </li>
</ol>
<p>When no package is explicitly specified for the classes in your project, this makes the project harder to understand and may cause name collisions
with other projects. Also, classes located in the default package not be accessed from classes within named packages since Java 1.4.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Move your class to a package directory and explicitly state the package’s name at the top of the class. If your project does not have a package
structure, think of a structure that fits your needs. The package names should be unique to your project. You can find some best practices when
choosing package names in the Ressources section below.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass { /* ... */ } // Noncompliant, no package spacified
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
package org.example; // Compliant

public class MyClass{ /* ... */ }
</pre></p>
            </div>
        <div class="rule">
            <h3>Methods should not be named "tostring", "hashcode" or "equal" (java:S1221)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Due to the similar name with the methods <code>Object.toString</code>, <code>Object.hashCode</code> and <code>Object.equals</code>, there is a
significant likelihood that a developer intended to override one of these methods but made a spelling error.</p>
<p>Even if no such error exists and the naming was done on purpose, these method names can be misleading. Readers might not notice the difference, or
if they do, they may falsely assume that the developer made a mistake.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>If you intended to override one of the methods <code>Object.toString</code>, <code>Object.hashCode</code>, or <code>Object.equals</code>, correct
the spelling. Also, you should add the <code>@Override</code> modifier, which causes a compiler error message in case the annotated method does not
override anything.</p>
<p>If the naming was done on purpose, you should rename the methods to be more distinctive.</p>

<h4>Noncompliant code example</h4>
<pre>
public int hashcode() { /* ... */ }             // Noncompliant

public String tostring() { /* ... */ }          // Noncompliant

public boolean equal(Object obj) { /* ... */ }  // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre>
@Override
public int hashCode() { /* ... */ }             // Compliant

@Override
public String toString() { /* ... */ }          // Compliant

@Override
public boolean equals(Object obj) { /* ... */ } // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Non-constructor methods should not have the same name as the enclosing class (java:S1223)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Having a class and some of its methods sharing the same name is misleading, and leaves others to wonder whether it was done that way on purpose, or
was the methods supposed to be a constructor.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Foo {
   public Foo() {...}
   public void Foo(String label) {...}  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Foo {
   public Foo() {...}
   public void foo(String label) {...}  // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Packages should have a javadoc file 'package-info.java' (java:S1228)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Each package in a Java project should include a <code>package-info.java</code> file. The purpose of this file is to document the Java package using
javadoc and declare package annotations.</p>
<h3>Compliant solution</h3>
<pre>
/**
* This package has non null parameters and is documented.
**/
@ParametersAreNonnullByDefault
package org.foo.bar;
</pre></p>
            </div>
        <div class="rule">
            <h3>Constructors should only call non-overridable methods (java:S1699)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Calling an overridable method from a constructor could result in failures or strange behaviors when instantiating a subclass which overrides the
method.</p>
<p>For example:</p>
<ul>
  <li> The subclass class constructor starts by contract by calling the parent class constructor. </li>
  <li> The parent class constructor calls the method, which has been overridden in the child class. </li>
  <li> If the behavior of the child class method depends on fields that are initialized in the child class constructor, unexpected behavior (like a
  <code>NullPointerException</code>) can result, because the fields aren’t initialized yet. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
public class Parent {

  public Parent () {
    doSomething();  // Noncompliant
  }

  public void doSomething () {  // not final; can be overridden
    ...
  }
}

public class Child extends Parent {

  private String foo;

  public Child(String foo) {
    super(); // leads to call doSomething() in Parent constructor which triggers a NullPointerException as foo has not yet been initialized
    this.foo = foo;
  }

  public void doSomething () {
    System.out.println(this.foo.length());
  }

}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/8zZGBQ">CERT, MET05-J.</a> - Ensure that constructors do not call overridable methods </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/6ns-BQ">CERT, OOP50-CPP.</a> - Do not invoke virtual functions from constructors or destructors
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Unnecessary bit operations should not be performed (java:S2437)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Certain bit operations are just silly and should not be performed because their results are predictable.</p>
<p>Specifically, using <code>&amp; -1</code> with any value will always result in the original value, as will <code>anyValue ^ 0</code> and
<code>anyValue | 0</code>.</p></p>
            </div>
        <div class="rule">
            <h3>"Thread" should not be used where a "Runnable" argument is expected (java:S2438)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The semantics of <code>Thread</code> and <code>Runnable</code> are different, and while it is technically correct to use <code>Thread</code> where
a <code>Runnable</code> is expected, it is a bad practice to do so.</p>
<p>The crux of the issue is that <code>Thread</code> is a larger concept than <code>Runnable</code>. A <code>Runnable</code> represents a task. A
<code>Thread</code> represents a task and its execution management (ie: how it should behave when started, stopped, resumed, …​). It is both a task
and a lifecycle management.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public static void main(String[] args) {
	Thread runnable = new Thread() {
		@Override
		public void run() { /* ... */ }
	};
	new Thread(runnable).start();  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public static void main(String[] args) {
	Runnable runnable = new Runnable() {
		@Override
		public void run() { /* ... */ }
	};
	new Thread(runnable).start();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>The value returned from a stream read should be checked (java:S2674)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/VzdGBQ">CERT, FIO10-J.</a> - Ensure the array is filled when using read() to fill an array </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>You cannot assume that any given stream reading call will fill the <code>byte[]</code> passed in to the method. Instead, you must check the value
returned by the read method to see how many bytes were read. Fail to do so, and you introduce bug that is both harmful and difficult to reproduce.</p>
<p>Similarly, you cannot assume that <code>InputStream.skip</code> will actually skip the requested number of bytes, but must check the value returned
from the method.</p>
<p>This rule raises an issue when an <code>InputStream.read</code> method that accepts a <code>byte[]</code> is called, but the return value is not
checked, and when the return value of <code>InputStream.skip</code> is not checked. The rule also applies to <code>InputStream</code> child
classes.</p>
<h3>Noncompliant code example</h3>
<pre>
public void doSomething(String fileName) {
  try {
    InputStream is = new InputStream(file);
    byte [] buffer = new byte[1000];
    is.read(buffer);  // Noncompliant
    // ...
  } catch (IOException e) { ... }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void doSomething(String fileName) {
  try {
    InputStream is = new InputStream(file);
    byte [] buffer = new byte[1000];
    int count = 0;
    while (count = is.read(buffer) &gt; 0) {
      // ...
    }
  } catch (IOException e) { ... }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"readObject" should not be "synchronized" (java:S2675)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>readObject</code> method is implemented when a <code>Serializable</code> object requires special handling to be reconstructed from a
file. The object created by <code>readObject</code> is accessed only by the thread that called the method, thus using the <code>synchronized</code>
keyword in this context is unnecessary and causes confusion.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
private synchronized void readObject(java.io.ObjectInputStream in)
     throws IOException, ClassNotFoundException { // Noncompliant
  //...
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
private void readObject(java.io.ObjectInputStream in)
     throws IOException, ClassNotFoundException { // Compliant
  //...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/io/Serializable.html">Oracle SDK 20 - Serializable</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/io/ObjectInputStream.html">Oracle SDK 20 - ObjectInputStream</a>
  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-serialization">Serialization in Java</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"Math.abs" and negation should not be used on numbers that could be "MIN_VALUE" (java:S2676)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Math.html#abs(int)">Oracle SDK 20 - Math.abs(int)</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>This rule involves the use of <code>Math.abs</code> and negation on numbers that could be <code>MIN_VALUE</code>. It is a problem because it can
lead to incorrect results and unexpected behavior in the program.</p>
<p>When <code>Math.abs</code> and negation are used on numbers that could be <code>MIN_VALUE</code>, the result can be incorrect due to integer
overflow. Common methods that can return a <code>MIN_VALUE</code> and raise an issue when used together with <code>Math.abs</code> are:</p>
<ul>
  <li> <code>Random.nextInt()</code> and <code>Random.nextLong()</code> </li>
  <li> <code>hashCode()</code> </li>
  <li> <code>compareTo()</code> </li>
</ul>
<p>Alternatively, the <code>absExact()</code> method throws an <code>ArithmeticException</code> for <code>MIN_VALUE</code>.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doSomething(String str) {
  if (Math.abs(str.hashCode()) &gt; 0) { // Noncompliant
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public void doSomething(String str) {
  if (str.hashCode() != 0) {
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"read" and "readLine" return values should be used (java:S2677)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Reader.read()</code> and the <code>BufferedReader.readLine()</code> are used for reading data from a data source. The return value of
these methods is the data read from the data source, or <code>null</code> when the end of the data source is reached. If the return value is ignored,
the data read from the source is thrown away and may indicate a bug.</p>
<p>This rule raises an issue when the return values of <code>Reader.read()</code> and <code>BufferedReader.readLine()</code> and their subclasses are
ignored or merely null-checked.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doSomethingWithFile(String fileName) {
  try(BufferedReader buffReader = new BufferedReader(new FileReader(fileName))) {
    while (buffReader.readLine() != null) { // Noncompliant
      // ...
    }
  } catch (IOException e) {
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public void doSomethingWithFile(String fileName) {
  try(BufferedReader buffReader = new BufferedReader(new FileReader(fileName))) {
    String line = null;
    while ((line = buffReader.readLine()) != null) {
      // ...
    }
  } catch (IOException e) {
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/io/Reader.html#read()">Oracle SDK 20 - Reader.read()</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/io/BufferedReader.html#readLine()">Oracle SDK 20 -
  BufferedReader.readLine()</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"null" should not be used with "Optional" (java:S2789)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/util/Optional.html">Oracle SDK 20 - Optional</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-optional">Java Optional Guide</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>There are a few ways to fix this issue:</p>
<ul>
  <li> Avoid returning <code>null</code> from a method whose return type is <code>Optional</code>. </li>
  <li> Remove the null-check of an <code>Optional</code> and use <code>Optional</code> methods instead, like <code>isPresent()</code> or
  <code>ifPresent()</code>. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doSomething () {
  Optional&lt;String&gt; optional = getOptional();
  if (optional != null) {  // Noncompliant
    // do something with optional...
  }
  Optional&lt;String&gt; text = null; // Noncompliant, a variable whose type is Optional should never itself be null
  // ...
}

@Nullable // Noncompliant
public Optional&lt;String&gt; getOptional() {
  // ...
  return null;  // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void doSomething () {
  Optional&lt;String&gt; optional = getOptional();
  optional.ifPresent(
    // do something with optional...
  );
  Optional&lt;String&gt; text = Optional.empty();
  // ...
}

public Optional&lt;String&gt; getOptional() {
  // ...
  return Optional.empty();
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>Optional</code> acts as a container object that may or may not contain a non-null value. It is introduced in Java 8 to help avoid
<code>NullPointerException</code>. It provides methods to check if a value is present and retrieve the value if it is present.</p>
<p><code>Optional</code> is used instead of <code>null</code> values to make the code more readable and avoid potential errors.</p>
<p>It is a bad practice to use <code>null</code> with <code>Optional</code> because it is unclear whether a value is present or not, leading to
confusion and potential <code>NullPointerException</code> errors.</p></p>
            </div>
        <div class="rule">
            <h3>Methods should not return constants (java:S3400)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There’s no point in forcing the overhead of a method call for a method that always returns the same constant value. Even worse, the fact that a
method call must be made will likely mislead developers who call the method thinking that something more is done. Declare a constant instead.</p>
<p>This rule raises an issue if on methods that contain only one statement: the <code>return</code> of a constant value.</p>
<h3>Noncompliant code example</h3>
<pre>
int getBestNumber() {
  return 12;  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
static final int BEST_NUMBER = 12;
</pre>
<h3>Exceptions</h3>
<p>The following types of method are ignored:</p>
<ul>
  <li> methods that override a method. </li>
  <li> methods that are not final (not having the <code>final</code>, <code>private</code> or <code>static</code> modifier and not in a record or a
  final class). </li>
  <li> methods with annotations, such as <code>@Override</code> or Spring’s <code>@RequestMapping</code>. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Arrays should not be created for varargs parameters (java:S3878)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There’s no point in creating an array solely for the purpose of passing it as a varargs (<code>...</code>) argument; varargs <em>is</em> an array.
Simply pass the elements directly. They will be consolidated into an array automatically. Incidentally passing an array where <code>Object ...</code>
is expected makes the intent ambiguous: Is the array supposed to be one object or a collection of objects?</p>
<h3>Noncompliant code example</h3>
<pre>
public void callTheThing() {
  //...
  doTheThing(new String[] { "s1", "s2"});  // Noncompliant: unnecessary
  doTheThing(new String[12]);  // Compliant
  doTheOtherThing(new String[8]);  // Noncompliant: ambiguous
  // ...
}

public void doTheThing (String ... args) {
  // ...
}

public void doTheOtherThing(Object ... args) {
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void callTheThing() {
  //...
  doTheThing("s1", "s2");
  doTheThing(new String[12]);
  doTheOtherThing((Object[]) new String[8]);
   // ...
}

public void doTheThing (String ... args) {
  // ...
}

public void doTheOtherThing(Object ... args) {
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Spring beans should be considered by "@ComponentScan" (java:S4605)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Spring beans belonging to packages that are not included in a <code>@ComponentScan</code> configuration will not be accessible in the Spring
Application Context. Therefore, it’s likely to be a configuration mistake that will be detected by this rule.</p>
<p><strong>Note:</strong> the <code>@ComponentScan</code> is implicit in the <code>@SpringBootApplication</code> annotation, case in which Spring Boot
will auto scan for components in the package containing the Spring Boot main class and its sub-packages.</p>
<h3>Noncompliant code example</h3>
<pre>
package com.mycompany.app;

@Configuration
@ComponentScan("com.mycompany.app.beans")
public class Application {
...
}

package com.mycompany.app.web;

@Controller
public class MyController { // Noncompliant; MyController belong to "com.mycompany.app.web" while the ComponentScan is looking for beans in "com.mycompany.app.beans" package
...
}
</pre>
<h3>Compliant solution</h3>
<pre>
package com.mycompany.app;

@Configuration
@ComponentScan({"com.mycompany.app.beans","com.mycompany.app.web"})
or
@ComponentScan("com.mycompany.app")
or
@ComponentScan
public class Application {
...
}

package com.mycompany.app.web;

@Controller
public class MyController { // "com.mycompany.app.web" is referenced by a @ComponentScan annotated class
...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Java features should be preferred to Guava (java:S4738)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Some Guava features were really useful for Java 7 application because Guava was bringing APIs missing in the JDK. Java 8 fixed some of these
limitations. When migrating an application to Java 8 or even when starting a new one, it’s recommended to prefer Java 8 APIs over Guava ones to ease
its maintenance: developers don’t need to learn how to use two APIs and can stick to the standard one.</p>
<p>Java 9 brought even more useful methods to the standard Java library and if Java version is equal to or higher than 9, these standard methods
should be used.</p>
<p>This rule raises an issue when the following Guava APIs are used:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Guava API</th>
      <th>Java 8 API</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>com.google.common.io.BaseEncoding#base64()</p></td>
      <td><p>java.util.Base64</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.io.BaseEncoding#base64Url()</p></td>
      <td><p>java.util.Base64</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Joiner.on()</p></td>
      <td><p>java.lang.String#join() or java.util.stream.Collectors#joining()</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Optional#of()</p></td>
      <td><p>java.util.Optional#of()</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Optional#absent()</p></td>
      <td><p>java.util.Optional#empty()</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Optional#fromNullable()</p></td>
      <td><p>java.util.Optional#ofNullable()</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Optional</p></td>
      <td><p>java.util.Optional</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Predicate</p></td>
      <td><p>java.util.function.Predicate</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Function</p></td>
      <td><p>java.util.function.Function</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.base.Supplier</p></td>
      <td><p>java.util.function.Supplier</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.io.Files.createTempDir</p></td>
      <td><p>java.nio.file.Files.createTempDirectory</p></td>
    </tr>
  </tbody>
</table>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Guava API</th>
      <th>Java 9 API</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>com.google.common.collect.ImmutableSet#of()</p></td>
      <td><p>java.util.Set#of()</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.collect.ImmutableList#of()</p></td>
      <td><p>java.util.List#of()</p></td>
    </tr>
    <tr>
      <td><p>com.google.common.collect.ImmutableMap#of()</p></td>
      <td><p>java.util.Map#of() or java.util.Map#ofEntries()</p></td>
    </tr>
  </tbody>
</table></p>
            </div>
        <div class="rule">
            <h3>The upper bound of type variables and wildcards should not be "final" (java:S4968)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a type variable or a wildcard declares an upper bound that is <code>final</code>, the parametrization is not generic at all because it accepts
one and only one type at runtime: the one that is <code>final</code>. Instead of using <code>Generics</code>, it’s simpler to directly use the
concrete <code>final</code> class.</p>
<h3>Noncompliant code example</h3>
<pre>
public static &lt;T extends String&gt; T getMyString() { // Noncompliant; String is a "final" class and so can't be extended
 [...]
}
</pre>
<h3>Compliant solution</h3>
<pre>
public static String getMyString() { // Compliant
  [...]
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Derived exceptions should not hide their parents' catch blocks (java:S4970)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>catch</code> block of a checked exception "E" may be hidden because the corresponding <code>try</code> block only throws exceptions
derived from E.</p>
<p>These derived exceptions are handled in dedicated <code>catch</code> blocks prior to the <code>catch</code> block of the base exception E.</p>
<p>The <code>catch</code> block of E is unreachable and should be considered dead code. It should be removed, or the entire try-catch structure should
be refactored.</p>
<p>It is also possible that a single exception type in a multi-catch block may be hidden while the catch block itself is still reachable. In that case
it is enough to only remove the hidden exception type or to replace it with another type.</p>
<h3>Noncompliant code example</h3>
<pre>
public class HiddenCatchBlock {

  public static class CustomException extends Exception {
  }

  public static class CustomDerivedException extends CustomException {
  }

  public static void main(String[] args) {
    try {
      throwCustomDerivedException();
    } catch(CustomDerivedException e) {
      // ...
    } catch(CustomException e) { // Noncompliant; this code is unreachable
      // ...
    }
  }

  private static void throwCustomDerivedException() throws CustomDerivedException {
    throw new CustomDerivedException();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class HiddenCatchBlock {

  public static class CustomException extends Exception {
  }

  public static class CustomDerivedException extends CustomException {
  }

  public static void main(String[] args) {
    try {
      throwCustomDerivedException();
    } catch(CustomDerivedException e) { // Compliant; try-catch block is "catching" only the Exception that can be thrown in the "try"
      //...
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Strings and Boxed types should be compared using "equals()" (java:S4973)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It’s almost always a mistake to compare two instances of <code>java.lang.String</code> or boxed types like <code>java.lang.Integer</code> using
reference equality <code>==</code> or <code>!=</code>, because it is not comparing actual value but locations in memory.</p>
<h3>Noncompliant code example</h3>
<pre>
String firstName = getFirstName(); // String overrides equals
String lastName = getLastName();

if (firstName == lastName) { ... }; // Non-compliant; false even if the strings have the same value
</pre>
<h3>Compliant solution</h3>
<pre>
String firstName = getFirstName();
String lastName = getLastName();

if (firstName != null &amp;&amp; firstName.equals(lastName)) { ... };
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/595">CWE-595 - Comparison of Object References Instead of Object Contents</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/597">CWE-597 - Use of Wrong Operator in String Comparison</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/UjdGBQ">CERT, EXP03-J.</a> - Do not use the equality operators when comparing values of boxed
  primitives </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/yDdGBQ">CERT, EXP50-J.</a> - Do not confuse abstract object equality with reference equality
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Type parameters should not shadow other type parameters (java:S4977)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shadowing makes it impossible to use the type parameter from the outer scope. Also, it can be confusing to distinguish which type parameter is
being used.</p>
<p>This rule raises an issue when a type parameter from an inner scope uses the same name as one in an outer scope.</p>
<h3>Noncompliant code example</h3>
<pre>
 public class TypeParameterHidesAnotherType&lt;T&gt; {

    public class Inner&lt;T&gt; { // Noncompliant
      //...
    }

    private &lt;T&gt; T method() { // Noncompliant
      return null;
    }

  }
</pre>
<h3>Compliant solution</h3>
<pre>
public class NoTypeParameterHiding&lt;T&gt; {

    public class Inner&lt;S&gt; { // Compliant
      List&lt;S&gt; listOfS;
    }

    private &lt;V&gt; V method() { // Compliant
      return null;
    }

  }
</pre></p>
            </div>
        <div class="rule">
            <h3>SQL queries should retrieve only necessary fields (java:S6905)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A common reason for a poorly performant query is because it’s processing more data than required.</p>
<p>Querying unnecessary data demands extra work on the server, adds network overhead, and consumes memory and CPU resources on the application server.
The effect is amplified when the query includes multiple <em>joins</em>.</p>
<p>The rule flags an issue when a <code>SELECT *</code> query is provided as an argument to methods in <code>java.sql.Connection</code> and
<code>java.sql.Statement</code>.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <em>Performance</em>: the unnecessary extra data being processed brings overhead. </li>
  <li> <em>Sustainability</em>: the extra resources used have a negative impact on the environment. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Make the <code>SELECT *</code> an explicit selection of the required fields.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class OrderRepository {

    public record OrderSummary(String name, String orderId, BigDecimal price) { }

    public List&lt;OrderSummary&gt; queryOrderSummaries(Connection conn) {
            String sql = "SELECT * " +                                                         // Noncompliant
                          "FROM Orders JOIN Customers ON Orders.customerId = Customers.id ";

            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery(sql);

            return convertResultToOrderSummaryList(rs);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class OrderRepository {

    public record OrderSummary(String name, String orderId, BigDecimal price) { }

    public List&lt;OrderSummary&gt; queryOrderSummaries(Connection conn) {
            String sql = "SELECT Customers.name, Orders.id, Orders.price " +                   // Compliant
                          "FROM Orders JOIN Customers ON Orders.customerId = Customers.id ";

            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery(sql);

            return convertResultToOrderSummaryList(rs);
    }
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>The <em>Java Database Connectivity (JDBC) API</em> provides the <code>java.sql.Statement</code> interface that allows to represent an SQL statement
and to execute queries with the database.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.sql/java/sql/Statement.html">Oracle SDK - Statement</a> </li>
  <li> <a href="https://www.oreilly.com/library/view/high-performance-mysql/9780596101718/ch04.html">O’Reilly - High Performance MySQL - Query
  Performance Optimization</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.geeksforgeeks.org/difference-between-execute-query-and-update-methods-in-java/">GeeksforGeeks - Difference Between
  Execute(), query() and Update() Methods in Java</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Use batch Processing in JDBC (java:S6912)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.sql/java/sql/Statement.html">Oracle Java SE 21 API - java.sql.Statement</a>
  </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.sql/java/sql/PreparedStatement.html">Oracle Java SE 21 API -
  java.sql.PreparedStatement</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/jdbc-batch-processing">Baeldung - JDBC Batch Processing</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Executing a batch of SQL queries instead of individual queries improves performance by reducing communication overhead with the database.</p>
<p>Batching SQL statements is beneficial in common situations where a SQL statement is executed within a loop. In such cases, adding the statement to
a batch and subsequently executing it reduces the number of interactions with the database. This results in improved efficiency and faster execution
times.</p>
<p>The rule raises an issue when it detects a <code>java.sql.Statement</code> being executed within a loop instruction, such as <code>for</code>,
<code>while</code> or the <code>forEach</code> method of <code>java.lang.Iterable</code>, <code>java.util.Map</code> and
<code>java.util.stream.Stream</code>.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Group SQL statements by using the method <code>addBatch</code> to add them to a batch and then execute them using <code>executeBatch</code> to send
them to the database in a single call.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void execute(Connection connection) {
  try {
    Statement statement = connection.createStatement();

    for (int i = 0; i &lt; 10; i++) {
      statement.execute("INSERT INTO myTable (column1, column2) VALUES (" + i + ", 'value" + i + "')"); // Noncompliant
    }

    statement.close();
    connection.close();
  } catch (SQLException e) {
    e.printStackTrace();
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void execute(Connection connection) {
  try {
    Statement statement = connection.createStatement();

    for (int i = 0; i &lt; 10; i++) {
      statement.addBatch("INSERT INTO myTable (column1, column2) VALUES (" + i + ", 'value" + i + "')"); // Compliant
    }
    statement.executeBatch();

    statement.close();
    connection.close();
  } catch (SQLException e) {
    e.printStackTrace();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Math.clamp" should be used with correct ranges (java:S6913)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Java 21 introduces the new method <code>Math.clamp(value, min, max)</code> that fits a value within a specified interval. Before Java 21, this
behavior required explicit calls to the <code>Math.min</code> and <code>Math.max</code> methods, as in <code>Math.min(max, Math.max(value,
min))</code>.</p>
<p>If <code>min &gt; max</code>, <code>Math.clamp</code> throws an <code>IllegalArgumentException</code>, indicating an invalid interval. This can
occur if the <code>min</code> and <code>max</code> arguments are mistakenly reversed.</p>
<p>Note that <code>Math.clamp</code> is not a general substitute for <code>Math.min</code> or <code>Math.max</code>, but for the combination of both.
If <code>value</code> is the same as <code>min</code> or <code>max</code>, using <code>Math.clamp</code> is unnecessary and <code>Math.min</code> or
<code>Math.max</code> should be used instead.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Math.html#clamp(long,int,int)">Math.clamp</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><ul>
  <li> If 2nd argument &gt; 3rd argument, use <code>Math.clamp(value, min, max)</code> instead of <code>Math.clamp(value, max, min)</code>. </li>
  <li> If <code>value</code> is the same as <code>min</code>, fix the logic or use <code>Math.min(value, max)</code> instead. </li>
  <li> If <code>value</code> is the same as <code>max</code>, fix the logic or use <code>Math.max(min, value)</code> instead. </li>
  <li> If <code>min</code> is the same as <code>max</code>, fix the logic because <code>Math.clamp(value, x, x)</code> will always return
  <code>x</code>. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
Math.clamp(red, 255, 0); // Noncompliant, [255,0] is not a valid range
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
Math.clamp(red, 0, 255); // Compliant
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
Math.clamp(red, red, 255); // Noncompliant, use Math.min(red, 255)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
Math.min(red, 255); // Compliant
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="3" data-diff-type="noncompliant">
Math.clamp(red, 0, red); // Noncompliant, use Math.max(red, 0)
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
Math.max(red, 0); // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Use Fused Location to optimize battery power (java:S6914)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://developers.google.com/android/reference/com/google/android/gms/location/FusedLocationProviderClient.html">Google Play Services
  - FusedLocationProviderClient</a> </li>
  <li> <a href="https://developer.android.com/develop/sensors-and-location/location/battery">Android Developers - Optimize location for battery</a>
  </li>
  <li> <a href="https://developer.android.com/reference/android/location/package-summary">Android Developers - Android Location</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace the usages of <code>android.location.LocationManager</code> or <code>com.google.android.gms.location.LocationClient</code> with
<code>com.google.android.gms.location.FusedLocationProviderClient</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class LocationsActivity extends Activity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        // ...

        LocationManager locationManager = (LocationManager) this.getSystemService(Context.LOCATION_SERVICE); // Noncompliant

        LocationListener locationListener = new LocationListener() {
            public void onLocationChanged(Location location) {
                // Use the location object as needed
            }
        };

        locationManager.requestLocationUpdates(LocationManager.GPS_PROVIDER, 0, 0, locationListener);
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class LocationsActivity extends Activity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        // ...

        FusedLocationProviderClient fusedLocationClient = LocationServices.getFusedLocationProviderClient(this); // Compliant

        fusedLocationClient.getLastLocation()
            .addOnSuccessListener(this, location -&gt; {
                // Use the location object as needed
            });
    }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The location awareness feature can significantly drain the device’s battery.</p>
<p>The recommended way to maximize the battery life is to use the <em>fused location provider</em> which combines signals from GPS, Wi-Fi, and cell
networks, as well as accelerometer, gyroscope, magnetometer and other sensors. The <code>FusedLocationProviderClient</code> automatically chooses the
best method to retrieve a device’s location based on the device’s context.</p>
<p>The rule flags an issue when <code>android.location.LocationManager</code> or <code>com.google.android.gms.location.LocationClient</code> is used
instead of <code>com.google.android.gms.location.FusedLocationProviderClient</code>.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <em>Usability</em>: the non-optimized location API consumer more battery. </li>
  <li> <em>Sustainability</em>: the extra energy required has a negative impact on the environment. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Location awareness is a common feature for mobile application that enhance the user experience by providing context-specific services.</p></p>
            </div>
        <div class="rule">
            <h3>"String.indexOf" should be used with correct ranges (java:S6915)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><ul>
  <li> Use <code>String.indexOf(what, beginIndex, endIndex)</code> instead of <code>String.indexOf(what, endIndex, beginIndex)</code>. </li>
  <li> Use <code>String.indexOf(what, 0, endIndex)</code> instead of <code>String.indexOf(what, -1, endIndex)</code>. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
String hello = "Hello, world!";
int index = hello.indexOf('o', 11, 7); // Noncompliant, 11..7 is not a valid range
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
String hello = "Hello, world!";
int index = hello.indexOf('o', 7, 11); // Compliant
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
String hello = "Hello, world!";
int index = hello.indexOf('o', -1, 11); // Noncompliant, because beginIndex is negative
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
String hello = "Hello, world!";
int index = hello.indexOf('o', 0, 11); // Compliant
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java 21 adds new <code>String.indexOf</code> methods that accept ranges (<code>beginIndex</code>, to <code>endIndex</code>) rather than just a
start index. A <code>StringIndexOutOfBounds</code> can be thrown when indicating an invalid range, namely when:</p>
<ul>
  <li> <code>beginIndex &gt; endIndex</code> (eg: <code>beginIndex</code> and <code>endIndex</code> arguments are mistakenly reversed) </li>
  <li> <code>beginIndex &lt; 0</code> (eg: because the older <code>String.indexOf(what, fromIndex)</code> accepts negative values) </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html#indexOf(int,int,int)">String.indexOf(int, int, int)</a>
  </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html#indexOf(java.lang.String,int,int)">String.indexOf(java.lang.String,int,int)</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Use when instead of a single if inside a pattern match body (java:S6916)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace the <code>if</code> statement with a guarded case label.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void testObject(Object response) {
    switch (response) {
        case String s -&gt; {
            if(s.length() &gt; 80) { // Noncompliant; use the "when" keyword
                System.out.println("This string is too long");
            }
        }
        case Integer i -&gt; {
            if(i &gt; 80) { // Noncompliant; use the "when" keyword
                System.out.println("This integer is too big");
            }
        }
        default -&gt; System.out.println("Unknown type");
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void testObject(Object response) {
    switch (response) {
        case String s when s.length() &gt; 80 -&gt; {
            System.out.println("This string is too long");
        }
        case Integer i when i &gt; 80 -&gt; {
            System.out.println("This integer is too big");
        }
        default -&gt; System.out.println("Unknown type");
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://openjdk.org/jeps/441">Pattern Matching for switch</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java 21 has introduced enhancements to switch statements and expressions, allowing them to operate on any type, not just specific ones, as in
previous versions. Furthermore, case labels have been upgraded to support patterns, providing an alternative to the previous restriction of only
accepting constants.</p>
<pre>
// As of Java 21
String patternMatchSwitch(Object obj) {
    return switch (obj) {
        case String s  -&gt; String.format("String %s", s);
        case Integer i -&gt; String.format("int %d", i);
        default        -&gt; obj.toString();
    };
}
</pre>
<p>This allows to use the <code>when</code> keyword to specify a condition for a case label, also called a guarded case label.</p>
<pre>
String guardedCaseSwitch(Object obj) {
    return switch (obj) {
        case String s when s.length() &gt; 0 -&gt; String.format("String %s", s);
        case Integer i when i &gt; 0 -&gt; String.format("int %d", i);
        default        -&gt; obj.toString();
    };
}
</pre>
<p>This syntax is more readable and less error-prone than using an if statement inside the case block and should be preferred.</p>
<p>This rule reports an issue when a single <code>if</code> statement is used inside a case block.</p></p>
            </div>
        <div class="rule">
            <h3>An open curly brace should be located at the end of a line (java:S1105)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared naming conventions allow teams to collaborate effectively. This rule raises an issue when an open curly brace is not placed at the end of a
line of code.</p>
<h3>Noncompliant code example</h3>
<pre>
if(condition)
{
  doSomething();
}
</pre>
<h3>Compliant solution</h3>
<pre>
if(condition) {
  doSomething();
}
</pre>
<h3>Exceptions</h3>
<p>When blocks are inlined (left and right curly braces on the same line), no issue is triggered.</p>
<pre>
if(condition) {doSomething();}
</pre></p>
            </div>
        <div class="rule">
            <h3>Method parameters, caught exceptions and foreach variables' initial values should not be ignored (java:S1226)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>While it is technically correct to assign to parameters from within method bodies, doing so before the parameter value is read is likely a bug.
Instead, initial values of parameters, caught exceptions, and foreach parameters should be, if not treated as <code>final</code>, then at least read
before reassignment.</p>
<h3>Noncompliant code example</h3>
<pre>
public void doTheThing(String str, int i, List&lt;String&gt; strings) {
  str = Integer.toString(i); // Noncompliant

  for (String s : strings) {
    s = "hello world"; // Noncompliant
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Track uses of "NOPMD" suppression comments (java:S1310)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule allows you to track the use of the PMD suppression comment mechanism.</p>
<h3>Noncompliant code example</h3>
<pre>
// NOPMD
</pre></p>
            </div>
        <div class="rule">
            <h3>Loggers should be "private static final" and should share a naming convention (java:S1312)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Regardless of the logging framework in use (logback, log4j, commons-logging, java.util.logging, …​), loggers should be:</p>
<ul>
  <li> <code>private</code>: never be accessible outside of its parent class. If another class needs to log something, it should instantiate its own
  logger. </li>
  <li> <code>static</code>: not be dependent on an instance of a class (an object). When logging something, contextual information can of course be
  provided in the messages but the logger should be created at class level to prevent creating a logger along with each object. </li>
  <li> <code>final</code>: be created once and only once per class. </li>
</ul>
<h3>Noncompliant code example</h3>
<p>With a default regular expression of <code>LOG(?:GER)?</code>:</p>
<pre>
public Logger logger = LoggerFactory.getLogger(Foo.class);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
private static final Logger LOGGER = LoggerFactory.getLogger(Foo.class);
</pre>
<h3>Exceptions</h3>
<p>Variables of type <code>org.apache.maven.plugin.logging.Log</code> are ignored.</p></p>
            </div>
        <div class="rule">
            <h3>Using hardcoded IP addresses is security-sensitive (java:S1313)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Hardcoding IP addresses is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2006-5901">CVE-2006-5901</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-3725">CVE-2005-3725</a> </li>
</ul>
<p>Today’s services have an ever-changing architecture due to their scaling and redundancy needs. It is a mistake to think that a service will always
have the same IP address. When it does change, the hardcoded IP will have to be modified too. This will have an impact on the product development,
delivery, and deployment:</p>
<ul>
  <li> The developers will have to do a rapid fix every time this happens, instead of having an operation team change a configuration file. </li>
  <li> It misleads to use the same address in every environment (dev, sys, qa, prod). </li>
</ul>
<p>Last but not least it has an effect on application security. Attackers might be able to decompile the code and thereby discover a potentially
sensitive address. They can perform a Denial of Service attack on the service, try to get access to the system, or try to spoof the IP address to
bypass security checks. Such attacks can always be possible, but in the case of a hardcoded IP address solving the issue will take more time, which
will increase an attack’s impact.</p>
<h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Sensitive Code Example</h2>
<pre>
String ip = "192.168.12.42"; // Sensitive
Socket socket = new Socket(ip, 6667);
</pre>
<h2>Compliant Solution</h2>
<pre>
String ip = System.getenv("IP_ADDRESS"); // Compliant
Socket socket = new Socket(ip, 6667);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Loopback addresses 127.0.0.0/8 in CIDR notation (from 127.0.0.0 to 127.255.255.255) </li>
  <li> Broadcast address 255.255.255.255 </li>
  <li> Non-routable address 0.0.0.0 </li>
  <li> Strings of the form <code>2.5.&lt;number&gt;.&lt;number&gt;</code> as they <a href="http://www.oid-info.com/introduction.htm">often match
  Object Identifiers</a> (OID) </li>
  <li> Addresses in the ranges 192.0.2.0/24, 198.51.100.0/24, 203.0.113.0/24, reserved for documentation purposes by <a
  href="https://datatracker.ietf.org/doc/html/rfc5737">RFC 5737</a> </li>
  <li> Addresses in the range 2001:db8::/32, reserved for documentation purposes by <a href="https://datatracker.ietf.org/doc/html/rfc3849">RFC
  3849</a> </li>
</ul>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">CERT, MSC03-J.</a> - Never hard code sensitive information </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Don’t hard-code the IP address in the source code, instead make it configurable with environment variables, configuration files, or a similar
approach. Alternatively, if confidentially is not required a domain name can be used since it allows to change the destination quickly without having
to rebuild the software.</p>
<h2>Compliant Solution</h2>
<pre>
String ip = System.getenv("IP_ADDRESS"); // Compliant
Socket socket = new Socket(ip, 6667);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">CERT, MSC03-J.</a> - Never hard code sensitive information </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<p>The disclosed IP address is sensitive, e.g.:</p>
<ul>
  <li> Can give information to an attacker about the network topology. </li>
  <li> It’s a personal (assigned to an identifiable person) IP address. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
String ip = "192.168.12.42"; // Sensitive
Socket socket = new Socket(ip, 6667);
</pre>
</p>
            </div>
        <div class="rule">
            <h3>Octal values should not be used (java:S1314)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/atYxBQ">CERT, DCL18-C.</a> - Do not begin integer constants with 0 when specifying a decimal
  value </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/7DZGBQ">CERT, DCL50-J.</a> - Use visually distinct identifiers </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Integer literals starting with a zero are octal rather than decimal values. While using octal values is fully supported, most developers do not
have experience with them. They may not recognize octal values as such, mistaking them instead for decimal values.</p>
<h3>Noncompliant code example</h3>
<pre>
int myNumber = 010; // Noncompliant. myNumber will hold 8, not 10 - was this really expected?
</pre>
<h3>Compliant solution</h3>
<pre>
int myNumber = 8;
</pre></p>
            </div>
        <div class="rule">
            <h3>Track uses of "CHECKSTYLE:OFF" suppression comments (java:S1315)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule allows you to track the use of the Checkstyle suppression comment mechanism.</p>
<h3>Noncompliant code example</h3>
<pre>
// CHECKSTYLE:OFF
</pre></p>
            </div>
        <div class="rule">
            <h3>"StringBuilder" and "StringBuffer" should not be instantiated with a character (java:S1317)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a developer uses the <code>StringBuilder</code> or <code>StringBuffer</code> constructor with a single character as an argument, the likely
intention is to create an instance with the character as the initial string value.</p>
<p>However, this is not what happens because of the absence of a dedicated <code>StringBuilder(char)</code> or <code>StringBuffer(char)</code>
constructor. Instead, <code>StringBuilder(int)</code> or <code>StringBuffer(int)</code> is invoked, which results in an instance with the provided
<code>int</code> value as the initial capacity of the <code>StringBuilder</code> or <code>StringBuffer</code>.</p>
<p>The reason behind this behavior lies in the automatic widening of <code>char</code> expressions to <code>int</code> when required. Consequently,
the UTF-16 code point value of the character (for example, <code>65</code> for the character <code>'A'</code>) is interpreted as an <code>int</code>
to specify the initial capacity.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>If the argument is a <code>char</code> literal, use a string literal instead:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
StringBuffer foo = new StringBuffer('x'); // Noncompliant, replace with String
</pre>
<pre data-diff-id="1" data-diff-type="compliant">
StringBuffer foo = new StringBuffer("x"); // Compliant
</pre>
<p>If the argument is it is a non-literal <code>char</code> expression, convert it to <code>String</code> using the <code>String.valueOf()</code>
method:</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
StringBuffer foo(char firstChar) {
  return new StringBuffer(firstChar);                 // Noncompliant
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
StringBuffer foo(char firstChar) {
  return new StringBuffer(String.valueOf(firstChar)); // Compliant
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when the <code>StringBuilder</code> or <code>StringBuffer</code> constructor is called with a single character as an
argument.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se10/html/jls-5.html#jls-5.1.2">Oracle - Java Language Specification, section 5.1.2. Widening
  Primitive Conversion</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.w3schools.com/java/java_type_casting.asp">W3schools - Java Type Casting</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Declarations should use Java collection interfaces such as "List" rather than specific implementation classes such as "LinkedList" (java:S1319)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a collection implementation class from <code>java.util.*</code> is used:</p>
<ul>
  <li> as a return type of a <code>public</code> method. </li>
  <li> as an argument type of a <code>public</code> method. </li>
  <li> as the type of a <code>public</code> field. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The Java Collections API offers a well-structured hierarchy of interfaces designed to hide collection implementation details. For the various
collection data structures like lists, sets, and maps, specific interfaces (<code>java.util.List</code>, <code>java.util.Set</code>,
<code>java.util.Map</code>) cover the essential features.</p>
<p>When passing collections as method parameters, return values, or when exposing fields, it is generally recommended to use these interfaces instead
of the implementing classes. The implementing classes, such as <code>java.util.LinkedList</code>, <code>java.util.ArrayList</code>, and
<code>java.util.HasMap</code>, should only be used for collection instantiation. They provide finer control over the performance characteristics of
those structures, and developers choose them depending on their use case.</p>
<p>For example, if fast random element access is essential, <code>java.util.ArrayList</code> should be instantiated. If inserting elements at a random
position into a list is crucial, a <code>java.util.LinkedList</code> should be preferred. However, this is an implementation detail your API should
not expose.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Employees {
  public final HashSet&lt;Employee&gt; employees   // Noncompliant, field type should be "Set"
    = new HashSet&lt;Employee&gt;();

  public HashSet&lt;Employee&gt; getEmployees() {  // Noncompliant, return type should be "Set"
    return employees;
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Employees {
  public final Set&lt;Employee&gt; employees       // Compliant
    = new HashSet&lt;Employee&gt;();

  public Set&lt;Employee&gt; getEmployees() {      // Compliant
    return employees;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Unary prefix operators should not be repeated (java:S2761)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The repetition of a unary operator is usually a typo. The second operator invalidates the first one in most cases:</p>
<pre>
int i = 1;

int j = - - -i;  // Noncompliant: equivalent to "-i"
int k = ~~~i;    // Noncompliant: equivalent to "~i"
int m = + +i;    // Noncompliant: equivalent to "i"

boolean b = false;
boolean c = !!!b;   // Noncompliant
</pre>
<p>On the other hand, while repeating the increment and decrement operators is technically correct, it obfuscates the meaning:</p>
<pre>
int i = 1;
int j = ++ ++i;  // Noncompliant
int k = i-- --; // Noncompliant
</pre>
<p>Using <code>+=</code> or <code>-=</code> improves readability:</p>
<pre>
int i = 1;
i += 2;
int j = i;
int k = i;
i -=2;
</pre>
<p>This rule raises an issue for repetitions of <code>!</code>, <code>~</code>, <code>-</code>, <code>+</code>, prefix increments <code>++</code> and
prefix decrements <code>--</code>.</p>
<h3>Exceptions</h3>
<p>Overflow handling for GWT compilation using <code>~~</code> is ignored.</p></p>
            </div>
        <div class="rule">
            <h3>Non-thread-safe fields should not be static (java:S2885)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Remove the <code>static</code> keyword from non-thread-safe fields.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
  private static Calendar calendar = Calendar.getInstance();  // Noncompliant
  private static SimpleDateFormat format = new SimpleDateFormat("HH-mm-ss");  // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
  private Calendar calendar = Calendar.getInstance();
  private SimpleDateFormat format = new SimpleDateFormat("HH-mm-ss");
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When an object is marked as <code>static</code>, it means that it belongs to the class rather than any class instance. This means there is only one
copy of the static object in memory, regardless of how many class instances are created. Static objects are shared among all instances of the class
and can be accessed using the class name rather than an instance of the class.</p>
<p>A data type is considered thread-safe if it can be used correctly by multiple threads, regardless of how those threads are executed, without
requiring additional coordination from the calling code. In other words, a thread-safe data type can be accessed and modified by multiple threads
simultaneously without causing any issues or requiring extra work from the programmer to ensure correct behavior.</p>
<p>Non-thread-safe objects are objects that are not designed to be used in a multi-threaded environment and can lead to race conditions and data
inconsistencies when accessed by multiple threads simultaneously. Using them in a multi-threaded manner is highly likely to cause data problems or
exceptions at runtime.</p>
<p>When a non-thread-safe object is marked as static in a multi-threaded environment, it can cause issues because the non-thread-safe object will be
shared across different instances of the containing class.</p>
<p>This rule raises an issue when any of the following instances and their subtypes are marked as <code>static</code>:</p>
<ul>
  <li> <code>java.util.Calendar</code>, </li>
  <li> <code>java.text.DateFormat</code>, </li>
  <li> <code>javax.xml.xpath.XPath</code>, or </li>
  <li> <code>javax.xml.validation.SchemaFactory</code>. </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://web.mit.edu/6.005/www/fa14/classes/18-thread-safety/">MIT - Thread safety</a> </li>
  <li> <a href="https://www.baeldung.com/java-thread-safety">Baeldung - Thread safety</a> </li>
  <li> <a href="https://www.baeldung.com/java-static">Baeldung - Static</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222567">Application Security and
  Development: V-222567</a> - The application must not be vulnerable to race conditions. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Getters and setters should be synchronized in pairs (java:S2886)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A synchronized method is a method marked with the <code>synchronized</code> keyword, meaning it can only be accessed by one thread at a time. If
multiple threads try to access the synchronized method simultaneously, they will be blocked until the method is available.</p>
<p>Synchronized methods prevent race conditions and data inconsistencies in multi-threaded environments. Ensuring that only one thread can access a
method at a time, prevents multiple threads from modifying the same data simultaneously, and causing conflicts.</p>
<p>When one part of a getter/setter pair is <code>synchronized</code> the other should be too. Failure to synchronize both sides may result in
inconsistent behavior at runtime as callers access an inconsistent method state.</p>
<p>This rule raises an issue when either the method or the contents of one method in a getter/setter pair are synchronized, but the other is not.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html">Oracle Java - Synchronized Methods</a> </li>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se20/html/jls-8.html#jls-8.4.3.6">Oracle SE 20 - Synchronized Methods</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://web.mit.edu/6.005/www/fa14/classes/18-thread-safety/">MIT - Thread safety</a> </li>
  <li> <a href="https://www.baeldung.com/java-thread-safety">Baeldung - Thread safety</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/4jdGBQ">CERT, VNA01-J.</a> - Ensure visibility of shared references to immutable objects </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222567">Application Security and
  Development: V-222567</a> - The application must not be vulnerable to race conditions. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Synchronize both <code>get</code> and <code>set</code> methods by marking the method with the <code>synchronize</code> keyword or using a
<code>synchronize</code> block inside them.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Person {
  String name;
  int age;

  public synchronized void setName(String name) {
    this.name = name;
  }

  public String getName() {  // Noncompliant
    return this.name;
  }

  public void setAge(int age) {  // Noncompliant
    this.age = age;
  }

  public int getAge() {
    synchronized (this) {
      return this.age;
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Person {
  String name;
  int age;

  public synchronized void setName(String name) {
    this.name = name;
  }

  public synchronized String getName() {
    return this.name;
  }

  public void setAge(int age) {
    synchronized (this) {
      this.age = age;
   }
  }

  public int getAge() {
    synchronized (this) {
      return this.age;
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Stream.peek" should be used with caution (java:S3864)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#peek-java.util.function.Consumer-">Java 8 API Documentation</a>
  </li>
  <li> 4comprehension: <a href="https://4comprehension.com/idiomatic-peeking/">Idiomatic Peeking with Java Stream API</a> </li>
  <li> Data Geekery: <a href="https://blog.jooq.org/2014/06/13/java-8-friday-10-subtle-mistakes-when-using-the-streams-api/">10 Subtle Mistakes When
  Using the Streams API</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>According to its JavaDocs, the intermediate Stream operation <code>java.util.Stream.peek()</code> “exists mainly to support debugging”
purposes.</p>
<p>A key difference with other intermediate Stream operations is that the Stream implementation is free to skip calls to <code>peek()</code> for
optimization purpose. This can lead to <code>peek()</code> being unexpectedly called only for some or none of the elements in the Stream.</p>
<p>As a consequence, relying on <code>peek()</code> without careful consideration can lead to error-prone code.</p>
<p>This rule raises an issue for each use of peek() to be sure that it is challenged and validated by the team to be meant for production
debugging/logging purposes.</p>
<h3>Noncompliant code example</h3>
<pre>
Stream.of("one", "two", "three", "four")
         .filter(e -&gt; e.length() &gt; 3)
         .peek(e -&gt; System.out.println("Filtered value: " + e)); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
Stream.of("one", "two", "three", "four")
         .filter(e -&gt; e.length() &gt; 3)
         .foreach(e -&gt; System.out.println("Filtered value: " + e));
</pre></p>
            </div>
        <div class="rule">
            <h3>Conditionals should start on new lines (java:S3972)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Placing an <code>if</code> statement on the same line as the closing <code>}</code> from a preceding <code>if</code>, <code>else</code>, or
<code>else if</code> block can lead to confusion and potential errors. It may indicate a missing <code>else</code> statement or create ambiguity for
maintainers who might fail to understand that the two statements are unconnected.</p>
<p>The following code snippet is confusing:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
if (condition1) {
  // ...
} if (condition2) {  // Noncompliant
  //...
}
</pre>
<p>Either the two conditions are unrelated and they should be visually separated:</p>
<pre data-diff-id="1" data-diff-type="compliant">
if (condition1) {
  // ...
}

if (condition2) {
  //...
}
</pre>
<p>Or they were supposed to be exclusive and you should use <code>else if</code> instead:</p>
<pre>
if (condition1) {
  // ...
} else if (condition2) {
  //...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>A conditionally executed single line should be denoted by indentation (java:S3973)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the line immediately after a conditional has neither curly braces nor indentation, the intent of the code is unclear and perhaps not what is
executed. Additionally, such code is confusing to maintainers.</p>
<pre>
if (condition)  // Noncompliant
doTheThing();
doTheOtherThing(); // Was the intent to call this function unconditionally?
</pre>
<p>It becomes even more confusing and bug-prone if lines get commented out.</p>
<pre>
if (condition)  // Noncompliant
//  doTheThing();
doTheOtherThing(); // Was the intent to call this function conditionally?
</pre>
<p>Indentation alone or together with curly braces makes the intent clear.</p>
<pre>
if (condition)
  doTheThing();
doTheOtherThing(); // Clear intent to call this function unconditionally

// or

if (condition) {
  doTheThing();
}
doTheOtherThing(); // Clear intent to call this function unconditionally
</pre>
<p>This rule raises an issue if the line controlled by a conditional has the same indentation as the conditional and is not enclosed in curly
braces.</p></p>
            </div>
        <div class="rule">
            <h3>Unused "private" classes should be removed (java:S3985)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>private</code> classes that are never used are dead code: unnecessary, inoperative code that should be removed. Cleaning out dead code
decreases the size of the maintained codebase, making it easier to understand the program and preventing bugs from being introduced.</p>

<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class TopLevel
{
  private class Nested {...} // Noncompliant: Nested is never used
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class TopLevel
{
  void doSomething() {
    Nested a = new Nested();
    ...
  }
  private class Nested {...}
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a private nested class is never used.</p></p>
            </div>
        <div class="rule">
            <h3>Methods setUp() and tearDown() should be correctly annotated starting with JUnit4 (java:S5826)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>setUp()</code> and <code>tearDown()</code> methods (initially introduced with JUnit3 to execute a block of code before and after each
test) need to be correctly annotated with the equivalent annotation in order to preserve the same behavior when migrating from JUnit3 to JUnit4 or
JUnit5.</p>
<p>This rule consequently raise issues on <code>setUp()</code> and <code>tearDown()</code> methods which are not annotated in test classes.</p>
<h3>Noncompliant code example</h3>
<ul>
  <li> JUnit4: </li>
</ul>
<pre>
public void setUp() { ... } // Noncompliant; should be annotated with @Before
public void tearDown() { ... }  // Noncompliant; should be annotated with @After
</pre>
<ul>
  <li> JUnit5: </li>
</ul>
<pre>
public void setUp() { ... } // Noncompliant; should be annotated with @BeforeEach
public void tearDown() { ... }  // Noncompliant; should be annotated with @AfterEach
</pre>
<h3>Compliant solution</h3>
<ul>
  <li> JUnit4: </li>
</ul>
<pre>
@Before
public void setUp() { ... }

@After
public void tearDown() { ... }
</pre>
<ul>
  <li> JUnit5: </li>
</ul>
<pre>
@BeforeEach
void setUp() { ... }

@AfterEach
void tearDown() { ... }
</pre></p>
            </div>
        <div class="rule">
            <h3>DateTimeFormatters should not use mismatched year and week numbers (java:S5917)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When creating a <code>DateTimeFormatter</code> using the <code>WeekFields.weekBasedYear()</code> temporal field, the resulting year number may be
off by 1 at the beginning of a new year (when the date to format is in a week that is shared by two consecutive years).</p>
<p>Using this year number in combination with an incompatible week temporal field yields a result that may be confused with the first week of the
previous year.</p>
<p>Instead, when paired with a week temporal field, the week-based year should only be used with the week of week-based year temporal field
<code>WeekFields.weekOfWeekBasedYear()</code>.</p>
<p>Alternatively the temporal field <code>ChronoField.ALIGNED_WEEK_OF_YEAR</code> can be used together with a regular year (but not the week based
year).</p>
<h3>Noncompliant code example</h3>
<pre>
new DateTimeFormatterBuilder()
      .appendValue(ChronoField.YEAR, 4) // Noncompliant: using week of week-based year with regular year
      .appendLiteral('-')
      .appendValue(WeekFields.ISO.weekOfWeekBasedYear(), 2)
      .toFormatter();

new DateTimeFormatterBuilder()
      .appendValue(ChronoField.YEAR_OF_ERA, 4) // Noncompliant: using week of week-based year with regular year
      .appendLiteral('-')
      .appendValue(WeekFields.ISO.weekOfWeekBasedYear(), 2)
      .toFormatter();

new DateTimeFormatterBuilder()
      .appendValue(WeekFields.ISO.weekBasedYear(), 4) // Noncompliant: using aligned week of year with week-based year
      .appendLiteral('-')
      .appendValue(ChronoField.ALIGNED_WEEK_OF_YEAR, 2)
      .toFormatter();
</pre>
<p>Here the first two formatters would wrongly format the 1st of January 2016 as "2016-53" while the last one would format it as "2015-01"</p>
<h3>Compliant solution</h3>
<pre>
new DateTimeFormatterBuilder()
      .appendValue(WeekFields.ISO.weekBasedYear(), 4)
      .appendLiteral('-')
      .appendValue(WeekFields.ISO.weekOfWeekBasedYear(), 2)
      .toFormatter();

new DateTimeFormatterBuilder()
      .appendValue(ChronoField.YEAR, 4)
      .appendLiteral('-')
      .appendValue(ChronoField.ALIGNED_WEEK_OF_YEAR, 2)
      .toFormatter();

new DateTimeFormatterBuilder()
      .appendValue(ChronoField.YEAR_OF_ERA, 4)
      .appendLiteral('-')
      .appendValue(ChronoField.ALIGNED_WEEK_OF_YEAR, 2)
      .toFormatter();
</pre>
<p>Here the first formatter would format the 1st of January 2016 as "2015-53" while the last two would produce "2016-01", both of which are correct
depending on how you count the weeks.</p>
<h3>Exceptions</h3>
<p>No issue is raised when week-based year is not used in combination with a week temporal field.</p>
<p>Similarly, no issue is raised if week of week-based year is not used in combination with a year temporal field.</p></p>
            </div>
        <div class="rule">
            <h3>Classes should not be coupled to too many other classes (java:S1200)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>According to the Single Responsibility Principle, introduced by Robert C. Martin in his book "Principles of Object Oriented Design", a class should
have only one responsibility:</p>
<blockquote>
  <p>If a class has more than one responsibility, then the responsibilities become coupled.</p>
  <p>Changes to one responsibility may impair or inhibit the class' ability to meet the others.</p>
  <p>This kind of coupling leads to fragile designs that break in unexpected ways when changed.</p>
</blockquote>
<p>Classes which rely on many other classes tend to aggregate too many responsibilities and should be split into several smaller ones.</p>
<p>Nested classes dependencies are not counted as dependencies of the outer class.</p>
<h3>Noncompliant code example</h3>
<p>With a threshold of 5:</p>
<pre>
class Foo {                        // Noncompliant - Foo depends on too many classes: T1, T2, T3, T4, T5, T6 and T7
  T1 a1;                           // Foo is coupled to T1
  T2 a2;                           // Foo is coupled to T2
  T3 a3;                           // Foo is coupled to T3

  public T4 compute(T5 a, T6 b) {  // Foo is coupled to T4, T5 and T6
    T7 result = a.getResult(b);    // Foo is coupled to T7
    return result;
  }

  public static class Bar {        // Compliant - Bar depends on 2 classes: T8 and T9
    T8 a8;
    T9 a9;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"equals" method overrides should accept "Object" parameters (java:S1201)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Java, the <code>Object.equals()</code> method is used for object comparison, and it is typically overridden in classes to provide a custom
equality check based on your criteria for equality.</p>
<p>The default implementation of <code>equals()</code> provided by the <code>Object</code> class compares the memory references of the two objects,
that means it checks if the objects are actually the same instance in memory.</p>
<p>The "equals" as a method name should be used exclusively to override <code>Object.equals(Object)</code> to prevent confusion.</p>
<p>It is important to note that when you override <code>equals()</code>, you should also override the <code>hashCode()</code> method to maintain the
contract between <code>equals()</code> and <code>hashCode()</code>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)">Oracle SDK -
  Object.equals(Object)</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Either override <code>Object.equals(Object)</code> or rename the method.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyClass {
  private int foo = 1;

  public boolean equals(MyClass o) {  // Noncompliant; does not override Object.equals(Object)
    return o != null &amp;&amp; o.foo == this.foo;
  }

  public static void main(String[] args) {
    MyClass o1 = new MyClass();
    Object o2 = new MyClass();
    System.out.println(o1.equals(o2));  // Prints "false" because o2 an Object not a MyClass
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class MyClass {
  private int foo = 1;

  @Override
  public boolean equals(Object o) {  // Compliant
    if (this == o) {
        return true;
    }

    if (o == null || getClass() != o.getClass()) {
      return false;
    }

    MyClass other = (MyClass)o;
    return this.foo == other.foo;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"equals(Object obj)" and "hashCode()" should be overridden in pairs (java:S1206)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyClass {    // Noncompliant - should also override "hashCode()"

  @Override
  public boolean equals(Object obj) {
    /* ... */
  }

}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class MyClass {    // Compliant

  @Override
  public boolean equals(Object obj) {
    /* ... */
  }

  @Override
  public int hashCode() {
    /* ... */
  }

}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/581">CWE-581 - Object Model Violation: Just One of Equals and Hashcode Defined</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/7DVGBQ">CERT, MET09-J.</a> - Classes that define an equals() method must also define a
  hashCode() method </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>According to the Java Language Specification, there is a contract between <code>equals(Object)</code> and <code>hashCode()</code>:</p>
<blockquote>
  <p>If two objects are equal according to the <code>equals(Object)</code> method, then calling the <code>hashCode</code> method on each of the two
  objects must produce the same integer result.</p>
  <p>It is not required that if two objects are unequal according to the <code>equals(java.lang.Object)</code> method, then calling the
  <code>hashCode</code> method on each of the two objects must produce distinct integer results.</p>
  <p>However, the programmer should be aware that producing distinct integer results for unequal objects may improve the performance of
  hashtables.</p>
</blockquote>
<p>In order to comply with this contract, those methods should be either both inherited, or both overridden.</p></p>
            </div>
        <div class="rule">
            <h3>"public static" fields should be constant (java:S1444)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/500">CWE-500 - Public Static Field Not Marked Final</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/WjdGBQ">CERT OBJ10-J.</a> - Do not use public static nonfinal fields </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>There is no good reason to declare a field "public" and "static" without also declaring it "final". Most of the time this is a kludge to share a
state among several objects. But with this approach, any object can do whatever it wants with the shared state, such as setting it to
<code>null</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Greeter {
  public static Foo foo = new Foo();
  ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Greeter {
  public static final Foo FOO = new Foo();
  ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes should not have too many methods (java:S1448)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A class that grows too much tends to aggregate too many responsibilities and inevitably becomes harder to understand and therefore to maintain.
Above a specific threshold, it is strongly advised to refactor the class into smaller ones which focus on well defined topics.</p></p>
            </div>
        <div class="rule">
            <h3>String operations should not rely on the default system locale (java:S1449)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Failure to specify a locale when calling the methods <code>toLowerCase()</code>, <code>toUpperCase()</code> or <code>format()</code> on
<code>String</code> objects means the system default encoding will be used, possibly creating problems with international characters or number
representations. For instance with the Turkish language, when converting the small letter 'i' to upper case, the result is capital letter 'I' with a
dot over it.</p>
<p>Case conversion without a locale may work fine in its "home" environment, but break in ways that are extremely difficult to diagnose for customers
who use different encodings. Such bugs can be nearly, if not completely, impossible to reproduce when it’s time to fix them. For locale-sensitive
strings, the correct locale should always be used, but <code>Locale.ROOT</code> can be used for case-insensitive ones.</p>
<h3>Noncompliant code example</h3>
<pre>
myString.toLowerCase()
</pre>
<h3>Compliant solution</h3>
<pre>
myString.toLowerCase(Locale.TR)
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/4zdGBQ">CERT, STR02-J.</a> - Specify an appropriate locale when comparing locale-dependent data
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Jump statements should not be redundant (java:S3626)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Jump statements such as <code>return</code> and <code>continue</code> let you change the default flow of program execution, but jump statements
that direct the control flow to the original direction are just a waste of keystrokes.</p>
<h3>Noncompliant code example</h3>
<pre>
public void foo() {
  while (condition1) {
    if (condition2) {
      continue; // Noncompliant
    } else {
      doTheThing();
    }
  }
  return; // Noncompliant; this is a void method
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void foo() {
  while (condition1) {
    if (!condition2) {
      doTheThing();
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Raw types should not be used (java:S3740)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>For any usage of parameterized types, bind the type parameters with type arguments. For example, when a function returns a list of strings, the
return type is <code>List&lt;String&gt;</code>, where the type parameter <code>E</code> in interface <code>List&lt;E&gt;</code> is bound with the
argument <code>String</code>.</p>
<p>If the concrete binding is unknown, you still should not use the type raw. Use a wildcard type argument instead, with optional lower or upper
bound, such as in <code>List&lt;?&gt;</code> for a list whose element type is unknown, or <code>List&lt;? extends Number&gt;</code> for a list whose
element type is <code>Number</code> or a subtype of it.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
// List is supposed to store integers only
List integers = new ArrayList&lt;&gt;();

// Yet, we can add strings, because we did not give
// this information to the compiler
integers.add("Hello World!");

// Type is checked during runtime and will throw a ClassCastException
Integer a = (Integer) integers.get(0);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
// List is supposed to store integers, and we let the compiler know
List&lt;Integer&gt; integers = new ArrayList&lt;&gt;();

// Now we can add only integers.
// Adding a string results in a compile time error.
integers.add(42);

// No cast required anymore, and no possible ClassCastException
Integer a = integers.get(0);
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
String getStringFromForcedList(Object object) {
  // Cast expression and instanceof can check runtime type only.
  // The solution is _not_ to skip the type argument in that case.
  return object instanceof List stringList ? (String) stringList.getFirst(): "";
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
String getStringFromForcedList(Object object) {
  // The solution is to use a wildcard type argument in that case.
  return object instanceof List&lt;?&gt; stringList ? (String) stringList.getFirst(): "";
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="3" data-diff-type="noncompliant">
String getStringFromForcedList(Object object) {
  return object instanceof List stringList ? (String) stringList.getFirst(): "";
}

String returnString() {
  Object object = List.of("Hello");
  return getStringFromForcedList(object);
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
Object getObjectFromForcedList(Object object) {
  // You may also choose not to make assumptions about type arguments you cannot infer.
  return object instanceof List&lt;?&gt; list ? list.getFirst(): "";
}

String returnString(Object object) {
  // Instead, delegate the decision to use-site, which may have more information.
  Object object = List.of("Hello");
  return (String) getObjectFromForcedList(object);
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Generic types should not be used raw (without type arguments). To fix this issue, add the type parameters.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A generic type is a generic class or interface that is parameterized over types. For example, <code>java.util.List</code> has one type parameter:
the type of its elements.</p>
<p>Using generic types raw (without binding arguments to the type parameters) prevents compile-time type checking for expressions that use these type
parameters. Explicit type casts are necessary for them, which do perform a runtime type check that may fail with a
<code>ClassCastException</code>.</p>
<h3>What is the potential impact?</h3>
<p>The compiler cannot assert that the program is inherently type safe. When a cast fails, a <code>ClassCastException</code> is thrown during runtime
and the program most likely crashes. Therefore, this issue might impact the availability and reliability of your application.</p>
<h3>Exceptions</h3>
<p>The rule does not raise an issue for the simple <code>instanceof</code> operator, which checks against runtime types where type parameter
information has been erased. Since it does not return a rawly typed instance but a boolean value, it does not prevent compile-time type checking.</p>
<p>This, however, is not the case for the <code>cast</code> operator as well as the extended <code>instanceof</code> operator which are both not an
exception from this rule. Since they operate on the erased runtime type as well, they must use wildcard type arguments when checked against a
parameterized type (see the examples).</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/generics/rawTypes.html">Raw types</a> in the Java Tutorial. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Members of Spring components should be injected (java:S3749)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Add one of these annotations to all non-<code>static</code> members: <code>@Resource</code>, <code>@Inject</code>, <code>@Autowired</code> or
<code>@Value</code>.</p>

<h4>Noncompliant code example</h4>
<pre>
@Controller
public class HelloWorld {

  private String name = null;

  @RequestMapping("/greet", method = GET)
  public String greet(String greetee) {

    if (greetee != null) {
      this.name = greetee;
    }

    return "Hello " + this.name;  // if greetee is null, you see the previous user's data
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Spring <code>@Component</code>, <code>@Controller</code>, <code>@RestController</code>,<code>@Service</code>, and <code>@Repository</code> classes
are singletons by default, meaning only one instance of the class is ever instantiated in the application. Typically such a class might have a few
<code>static</code> members, such as a logger, but all non-<code>static</code> members should be managed by Spring.</p>
<p>This rule raises an issue when a singleton <code>@Component</code>, <code>@Controller</code>, <code>@RestController</code>, <code>@Service</code>,
or <code>@Repository</code>, not annotated with <code>@ConfigurationProperties</code>, has non-<code>static</code> members that are not annotated with
one of:</p>
<ul>
  <li> <code>org.springframework.beans.factory.annotation.Autowired</code> </li>
  <li> <code>org.springframework.beans.factory.annotation.Value</code> </li>
  <li> <code>javax.annotation.Inject</code> </li>
  <li> <code>javax.annotation.Resource</code> </li>
  <li> <code>javax.persistence.PersistenceContext</code> </li>
  <li> <code>jakarta.annotation.Resource</code> </li>
  <li> <code>jakarta.inject.Inject</code> </li>
  <li> <code>jakarta.persistence.PersistenceContext</code> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Collection sizes and array length comparisons should make sense (java:S3981)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The size of a collection and the length of an array are always greater than or equal to zero. Testing it doesn’t make sense, since the result is
always <code>true</code>.</p>
<pre>
if (myList.size() &gt;= 0) {...} // Noncompliant: always true

boolean result = myArray.length &gt;= 0; // Noncompliant: true
</pre>
<p>Similarly testing that it is less than zero will always return <code>false</code>.</p>
<pre>
if (myList.size() &lt; 0) {...} // Noncompliant: always false
</pre>
<p>Fix the code to properly check for emptiness if it was the intent, or remove the redundant code to keep the current behavior.</p></p>
            </div>
        <div class="rule">
            <h3>Exceptions should not be created without being thrown (java:S3984)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Creating a new <code>Throwable</code> without actually throwing it is useless and is probably due to a mistake.</p>
<h3>Noncompliant code example</h3>
<pre>
if (x &lt; 0)
  new IllegalArgumentException("x must be nonnegative");
</pre>
<h3>Compliant solution</h3>
<pre>
if (x &lt; 0)
  throw new IllegalArgumentException("x must be nonnegative");
</pre></p>
            </div>
        <div class="rule">
            <h3>Week Year ("YYYY") should not be used for date formatting (java:S3986)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Few developers are aware of the difference between <code>Y</code> for "Week year" and <code>y</code> for Year when formatting and parsing a date
with <code>SimpleDateFormat</code> or <code>DateTimeFormatter</code>. That’s likely because for most dates, Week year and Year are the same, so
testing at any time other than the first or last week of the year will yield the same value for both <code>y</code> and <code>Y</code>. But in the
last week of December and the first week of January, you may get unexpected results.</p>
<p>According to the <a href="http://docs.oracle.com/javase/8/docs/api/java/util/GregorianCalendar.html#week_year">Javadoc</a>:</p>
<blockquote>
  <p>A week year is in sync with a WEEK_OF_YEAR cycle. All weeks between the first and last weeks (inclusive) have the same week year value.
  Therefore, the first and last days of a week year may have different calendar year values.</p>
  <p>For example, January 1, 1998 is a Thursday. If getFirstDayOfWeek() is MONDAY and getMinimalDaysInFirstWeek() is 4 (ISO 8601 standard compatible
  setting), then week 1 of 1998 starts on December 29, 1997, and ends on January 4, 1998. The week year is 1998 for the last three days of calendar
  year 1997. If, however, getFirstDayOfWeek() is SUNDAY, then week 1 of 1998 starts on January 4, 1998, and ends on January 10, 1998; the first three
  days of 1998 then are part of week 53 of 1997 and their week year is 1997.</p>
</blockquote>
<h3>Noncompliant code example</h3>
<pre>
Date date = new SimpleDateFormat("yyyy/MM/dd").parse("2015/12/31");
String result = new SimpleDateFormat("YYYY/MM/dd").format(date);   //Noncompliant; yields '2016/12/31'
result = DateTimeFormatter.ofPattern("YYYY/MM/dd").format(date); //Noncompliant; yields '2016/12/31'
</pre>
<h3>Compliant solution</h3>
<pre>
Date date = new SimpleDateFormat("yyyy/MM/dd").parse("2015/12/31");
String result = new SimpleDateFormat("yyyy/MM/dd").format(date);   //Yields '2015/12/31' as expected
result = DateTimeFormatter.ofPattern("yyyy/MM/dd").format(date); //Yields '2015/12/31' as expected
</pre>
<h3>Exceptions</h3>
<pre>
Date date = new SimpleDateFormat("yyyy/MM/dd").parse("2015/12/31");
String result = new SimpleDateFormat("YYYY-ww").format(date);  //compliant, 'Week year' is used along with 'Week of year'. result = '2016-01'
DateTimeFormatter.ofPattern("YYYY-ww").format(date); //compliant; yields '2016-01' as expected
</pre></p>
            </div>
        <div class="rule">
            <h3>"StandardCharsets" constants should be preferred (java:S4719)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>JDK7 introduced the class <code>java.nio.charset.StandardCharsets</code>. It provides constants for all charsets that are guaranteed to be
available on every implementation of the Java platform.</p>
<ul>
  <li> ISO_8859_1 </li>
  <li> US_ASCII </li>
  <li> UTF_16 </li>
  <li> UTF_16BE </li>
  <li> UTF_16LE </li>
  <li> UTF_8 </li>
</ul>
<p>These constants should be preferred to:</p>
<ul>
  <li> the use of a String such as "UTF-8" which has the drawback of requiring the <code>catch</code>/<code>throw</code> of an
  <code>UnsupportedEncodingException</code> that will never actually happen </li>
  <li> the use of Guava’s <code>Charsets</code> class, which has been obsolete since JDK7 </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
try {
  byte[] bytes = string.getBytes("UTF-8"); // Noncompliant; use a String instead of StandardCharsets.UTF_8
} catch (UnsupportedEncodingException e) {
  throw new AssertionError(e);
}
// ...
byte[] bytes = string.getBytes(Charsets.UTF_8); // Noncompliant; Guava way obsolete since JDK7
</pre>
<h3>Compliant solution</h3>
<pre>
byte[] bytes = string.getBytes(StandardCharsets.UTF_8)
</pre></p>
            </div>
        <div class="rule">
            <h3>Server certificates should be verified during SSL/TLS connections (java:S4830)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability makes it possible that an encrypted communication is intercepted.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Transport Layer Security (TLS) provides secure communication between systems over the internet by encrypting the data sent between them.
Certificate validation adds an extra layer of trust and security to this process to ensure that a system is indeed the one it claims to be.</p>
<p>When certificate validation is disabled, the client skips a critical security check. This creates an opportunity for attackers to pose as a trusted
entity and intercept, manipulate, or steal the data being transmitted.</p>
<h3>What is the potential impact?</h3>
<p>Establishing trust in a secure way is a non-trivial task. When you disable certificate validation, you are removing a key mechanism designed to
build this trust in internet communication, opening your system up to a number of potential threats.</p>
<h4>Identity spoofing</h4>
<p>If a system does not validate certificates, it cannot confirm the identity of the other party involved in the communication. An attacker can
exploit this by creating a fake server and masquerading as a legitimate one. For example, they might set up a server that looks like your bank’s
server, tricking your system into thinking it is communicating with the bank. This scenario, called identity spoofing, allows the attacker to collect
any data your system sends to them, potentially leading to significant data breaches.</p>
<h4>Loss of data integrity</h4>
<p>When TLS certificate validation is disabled, the integrity of the data you send and receive cannot be guaranteed. An attacker could modify the data
in transit, and you would have no way of knowing. This could range from subtle manipulations of the data you receive to the injection of malicious
code or malware into your system. The consequences of such breaches of data integrity can be severe, depending on the nature of the data and the
system.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of disabled certificate validation.</p>
<p>The certificate validation gets disabled by overriding <code>X509TrustManager</code> with an empty implementation. It is highly recommended to use
the original implementation.</p>
<h4>Noncompliant code example</h4>
<pre>
class TrustAllManager implements X509TrustManager {

    @Override
    public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException {  // Noncompliant
    }

    @Override
    public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException { // Noncompliant
    }

    @Override
    public X509Certificate[] getAcceptedIssuers() {
        return null;
    }
}
</pre>
<h3>How does this work?</h3>
<p>Addressing the vulnerability of disabled TLS certificate validation primarily involves re-enabling the default validation.</p>
<p>To avoid running into problems with invalid certificates, consider the following sections.</p>
<h4>Using trusted certificates</h4>
<p>If possible, always use a certificate issued by a well-known, trusted CA for your server. Most programming environments come with a predefined list
of trusted root CAs, and certificates issued by these authorities are validated automatically. This is the best practice, and it requires no
additional code or configuration.</p>
<h4>Working with self-signed certificates or non-standard CAs</h4>
<p>In some cases, you might need to work with a server using a self-signed certificate, or a certificate issued by a CA not included in your trusted
roots. Rather than disabling certificate validation in your code, you can add the necessary certificates to your trust store.</p>
<p>Here is a sample command to import a certificate to the Java trust store:</p>
<pre>
keytool -import -alias myserver -file myserver.crt -keystore cacerts
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-NETWORK/">Mobile AppSec Verification Standard - Network Communication Requirements</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/295">CWE-295 - Improper Certificate Validation</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222550">Application Security and
  Development: V-222550</a> - The application must validate certificates by constructing a certification path to an accepted trust anchor. </li>
  <li> <a
  href="https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms">https://wiki.sei.cmu.edu/confluence/display/java/MSC61-J.+Do+not+use+insecure+or+weak+cryptographic+algorithms</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>An iteration on a Collection should be performed on the type handled by the Collection (java:S4838)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When iterating over an <code>Iterable</code> with a <code>for</code> loop, the iteration variable could have the same type as the type returned by
the iterator (the item type of the <code>Iterable</code>). This rule reports when a supertype of the item type is used for the variable instead, but
the variable is then explicitly downcast in the loop body.</p>
<p>Using explicit type casts instead of leveraging the language’s type system is a bad practice. It disables static type checking by the compiler for
the cast expressions, but potential errors will throw a <code>ClassCastException</code> during runtime instead.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>When declaring the iteration variable, use the item type for it instead of a supertype. Remove the explicit downcasts in the loop body.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
for (Object item : getPersons()) { // Noncompliant, iteration element is implicitly upcast here
  Person person = (Person) item; // Noncompliant, item is explicitly downcast here
  person.getAddress();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
for (Person person : getPersons()) { // Compliant
  person.getAddress();
}
</pre>
<h4>Noncompliant code example</h4>
<p>Alternatively, use the <code>var</code> keyword to automatically infer the variable type (since Java 10).</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
for (Object item : getPersons()) { // Noncompliant, iteration element is implicitly upcast here
  Person person = (Person) item; // Noncompliant, item is explicitly downcast here
  person.getAddress();
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
for (var person : getPersons()) { // Compliant
  person.getAddress();
}
</pre>
<h4>Compliant solution</h4>
<p>The implicit upcast in the loop header is not reported when there is no downcast in the loop body.</p>
<pre>
for (Object item : getPersons()) { // Compliant
  System.out.println(item);
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Class members annotated with "@VisibleForTesting" should not be accessed from production code (java:S5803)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>@VisibleForTesting can be used to mark methods, fields and classes whose visibility restrictions have been relaxed more than necessary for the API
to allow for easier unit testing.</p>
<p>Access to such methods, fields and classes only possible thanks to this relaxed visibility is fine for test code, but it should be avoided in
production code. In production code these methods should be treated as if they are private.</p>
<p>Supported framework:</p>
<ul>
  <li> Guava: <code>com.google.common.annotations.VisibleForTesting</code> </li>
  <li> AssertJ: <code>org.assertj.core.util.VisibleForTesting</code> </li>
  <li> Android: <code>androidx.annotation.VisibleForTesting</code> </li>
  <li> Apache Flink: <code>org.apache.flink.annotation.VisibleForTesting</code> </li>
</ul>
<p>or any other annotation named <code>VisibleForTesting</code></p>
<h3>Noncompliant code example</h3>
<pre>
/** src/main/java/MyObject.java */

@VisibleForTesting String foo;

/** src/main/java/Service.java */

new MyObject().foo; // Noncompliant, foo is accessed from production code
</pre>
<h3>Compliant solution</h3>
<pre>
/** src/main/java/MyObject.java */

@VisibleForTesting String foo;

/** src/test/java/MyObjectTest.java */

new MyObject().foo; // Compliant, foo is accessed from test code
</pre></p>
            </div>
        <div class="rule">
            <h3>Authorizations should be based on strong decisions (java:S5808)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/285">CWE-285 - Improper Authorization</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Access control is a critical aspect of web frameworks that ensures proper authorization and restricts access to sensitive resources or actions. To
enable access control, web frameworks offer components that are responsible for evaluating user permissions and making access control decisions. They
might examine the user’s credentials, such as roles or privileges, and compare them against predefined rules or policies to determine whether the user
should be granted access to a specific resource or action.</p>
<p>Conventionally, these checks should never grant access to every request received. If an endpoint or component is meant to be public, then it should
be ignored by access control components. Conversely, if an endpoint should deny some users from accessing it, then access control has to be configured
correctly for this endpoint.</p>
<p>Granting unrestricted access to all users can lead to security vulnerabilities and potential misuse of critical functionalities. It is important to
carefully assess access decisions based on factors such as user roles, resource sensitivity, and business requirements. Implementing a robust and
granular access control mechanism is crucial for the security and integrity of the web application itself and its surrounding environment.</p>
<h3>What is the potential impact?</h3>
<p>Not verifying user access strictly can introduce significant security risks. Some of the most prominent risks are listed below. Depending on the
use case, it is very likely that other risks are introduced on top of the ones listed.</p>
<h4>Unauthorized access</h4>
<p>As the access of users is not checked strictly, it becomes very easy for an attacker to gain access to restricted areas or functionalities,
potentially compromising the confidentiality, integrity, and availability of sensitive resources. They may exploit this access to perform malicious
actions, such as modifying or deleting data, impersonating legitimate users, or gaining administrative privileges, ultimately compromising the
security of the system.</p>
<h4>Theft of sensitive data</h4>
<p>Theft of sensitive data can result from incorrect access control if attackers manage to gain access to databases, file systems, or other storage
mechanisms where sensitive data is stored. This can lead to the theft of personally identifiable information (PII), financial data, intellectual
property, or other confidential information. The stolen data can be used for various malicious purposes, such as identity theft, financial fraud, or
selling the data on the black market, causing significant harm to individuals and organizations affected by the breach.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>When granting users access to resources of an application, such an authorization should be based on strong decisions. For instance, a user may be
authorized to access a resource only if they are authenticated, or if they have the correct role and privileges.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>The <code>vote</code> method of an <a
href="https://docs.spring.io/spring-security/site/docs/6.1.x/api/org/springframework/security/access/AccessDecisionVoter.html">AccessDecisionVoter</a>
implementation is not compliant when it returns only an affirmative decision (<code>ACCESS_GRANTED</code>) or abstains to make a decision
(<code>ACCESS_ABSTAIN</code>):</p>
<pre data-diff-id="101" data-diff-type="noncompliant">
public class WeakNightVoter implements AccessDecisionVoter {
    @Override
    public int vote(Authentication authentication, Object object, Collection collection) {
        Calendar calendar = Calendar.getInstance();
        int currentHour = calendar.get(Calendar.HOUR_OF_DAY);

        if (currentHour &gt;= 8 &amp;&amp; currentHour &lt;= 19) {
            return ACCESS_GRANTED;
        }

        return ACCESS_ABSTAIN; // Noncompliant: when users connect during the night, no decision is made
    }
}
</pre>
<p>The <code>hasPermission</code> method of a <a
href="https://docs.spring.io/spring-security/site/docs/6.1.x/api/org/springframework/security/access/PermissionEvaluator.html">PermissionEvaluator</a>
implementation is not compliant when it doesn’t return <code>false</code>:</p>
<pre data-diff-id="102" data-diff-type="noncompliant">
public class MyPermissionEvaluator implements PermissionEvaluator {
    @Override
    public boolean hasPermission(Authentication authentication, Object targetDomainObject, Object permission) {
        Object user = authentication.getPrincipal();

        if (user.getRole().equals(permission)) {
              return true;
        }

        return true; // Noncompliant
    }
}
</pre>
<h4>Compliant solution</h4>
<p>The <code>vote</code> method of an <a
href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/access/AccessDecisionVoter.html">AccessDecisionVoter</a>
implementation should return a negative decision (<code>ACCESS_DENIED</code>):</p>
<pre data-diff-id="101" data-diff-type="compliant">
public class StrongNightVoter implements AccessDecisionVoter {
    @Override
    public int vote(Authentication authentication, Object object, Collection collection) {
        Calendar calendar = Calendar.getInstance();
        int currentHour = calendar.get(Calendar.HOUR_OF_DAY);

        if (currentHour &gt;= 8 &amp;&amp; currentHour &lt;= 19) {
            return ACCESS_GRANTED;
        }

        return ACCESS_DENIED; // Users are not allowed to connect during the night
    }
}
</pre>
<p>The <code>hasPermission</code> method of a <a
href="https://docs.spring.io/spring-security/site/docs/4.2.13.RELEASE/apidocs/org/springframework/security/access/PermissionEvaluator.html">PermissionEvaluator</a>
implementation should return <code>false</code>:</p>
<pre data-diff-id="102" data-diff-type="compliant">
public class MyPermissionEvaluator implements PermissionEvaluator {
    @Override
    public boolean hasPermission(Authentication authentication, Object targetDomainObject, Object permission) {
        Object user = authentication.getPrincipal();

        if (user.getRole().equals(permission)) {
              return true;
        }

        return false;
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>A field should not duplicate the name of its containing class (java:S1700)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It’s confusing to have a class member with the same name (case differences aside) as its enclosing class. This is particularly so when you consider
the common practice of naming a class instance for the class itself.</p>
<p>Best practice dictates that any field or member with the same name as the enclosing class be renamed to be more descriptive of the particular
aspect of the class it represents or holds.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Foo {
  private String foo;

  public String getFoo() { }
}

Foo foo = new Foo();
foo.getFoo() // what does this return?
</pre>
<h3>Compliant solution</h3>
<pre>
public class Foo {
  private String name;

  public String getName() { }
}

//...

Foo foo = new Foo();
foo.getName()
</pre>
<h3>Exceptions</h3>
<p>When the type of the field is the containing class and that field is static, no issue is raised to allow singletons named like the type.</p>
<pre>
public class Foo {
  ...
  private static Foo foo;
  public Foo getInstance() {
    if(foo==null) {
      foo = new Foo();
    }
    return foo;
  }
  ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"switch" statements and expressions should not be nested (java:S1821)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Nested <code>switch</code> structures are difficult to understand because you can easily confuse the cases of an inner <code>switch</code> as
belonging to an outer statement or expression. Therefore nested <code>switch</code> statements and expressions should be avoided.</p>
<p>Specifically, you should structure your code to avoid the need for nested <code>switch</code> statements or expressions, but if you cannot, then
consider moving the inner <code>switch</code> to another method.</p>
<h3>Noncompliant code example</h3>
<pre>
void foo(int n, int m) {
  switch (n) {
    case 0:
      switch (m) {  // Noncompliant; nested switch
        // ...
      }
    case 1:
      // ...
    default:
      // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
void foo(int n, int m) {
  switch (n) {
    case 0:
      bar(m);
    case 1:
      // ...
    default:
      // ...
  }
}

void bar(int m){
  switch(m) {
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Boolean checks should not be inverted (java:S1940)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It is needlessly complex to invert the result of a boolean comparison. The opposite comparison should be made instead.</p>
<h3>Noncompliant code example</h3>
<pre>
if ( !(a == 2)) { ...}  // Noncompliant
boolean b = !(i &lt; 10);  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
if (a != 2) { ...}
boolean b = (i &gt;= 10);
</pre></p>
            </div>
        <div class="rule">
            <h3>Variables should not be declared before they are relevant (java:S1941)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>For the sake of clarity, variables should be declared as close to where they’re used as possible. This is particularly true when considering
methods that contain early returns and the potential to throw exceptions. In these cases, it is not only pointless, but also confusing to declare a
variable that may never be used because conditions for an early return are met first.</p>
<h3>Noncompliant code example</h3>
<pre>
public boolean isConditionMet(int a, int b) {
  int difference = a - b;
  MyClass foo = new MyClass(a);  // Noncompliant; not used before early return

  if (difference &lt; 0) {
    return false;
  }

  // ...

  if (foo.doTheThing()) {
    return true;
  }
  return false;
}
</pre>
<h3>Compliant solution</h3>
<pre>
public boolean isConditionMet(int a, int b) {
  int difference = a - b;

  if (difference &lt; 0) {
    return false;
  }

  // ...

  MyClass foo = new MyClass(a);
  if (foo.doTheThing()) {
    return true;
  }
  return false;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Simple class names should be used (java:S1942)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Java’s <code>import</code> mechanism allows the use of simple class names. Therefore, using a class' fully qualified name in a file that
<code>import</code>s the class is redundant and confusing.</p>
<h3>Noncompliant code example</h3>
<pre>
import java.util.List;
import java.sql.Timestamp;

//...

java.util.List&lt;String&gt; myList;  // Noncompliant
java.sql.Timestamp tStamp; // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
import java.util.List;
import java.sql.Timestamp;

//...

List&lt;String&gt; myList;
Timestamp tStamp;
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes and methods that rely on the default system encoding should not be used (java:S1943)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/pzdGBQ">CERT, STR04-J.</a> - Use compatible character encodings when communicating string data
  between JVMs </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ujZGBQ">CERT, STR50-J.</a> - Use the appropriate method for counting characters in a string
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Using classes and methods that rely on the default system encoding can result in code that works fine in its "home" environment. But that code may
break for customers who use different encodings in ways that are extremely difficult to diagnose and nearly, if not completely, impossible to
reproduce when it’s time to fix them.</p>
<p>This rule detects uses of the following classes and methods:</p>
<ul>
  <li> <code>FileReader</code> </li>
  <li> <code>FileWriter</code> </li>
  <li> String constructors with a <code>byte[]</code> argument but no <code>Charset</code> argument
    <ul>
      <li> <code>String(byte[] bytes)</code> </li>
      <li> <code>String(byte[] bytes, int offset, int length)</code> </li>
    </ul>  </li>
  <li> <code>String.getBytes()</code> </li>
  <li> <code>String.getBytes(int srcBegin, int srcEnd, byte[] dst, int dstBegin)</code> </li>
  <li> <code>InputStreamReader(InputStream in)</code> </li>
  <li> <code>OutputStreamWriter(OutputStream out)</code> </li>
  <li> <code>ByteArrayOutputStream.toString()</code> </li>
  <li> Some <code>Formatter</code> constructors
    <ul>
      <li> <code>Formatter(String fileName)</code> </li>
      <li> <code>Formatter(File file)</code> </li>
      <li> <code>Formatter(OutputStream os)</code> </li>
    </ul>  </li>
  <li> Some <code>Scanner</code> constructors
    <ul>
      <li> <code>Scanner(File source)</code> </li>
      <li> <code>Scanner(Path source)</code> </li>
      <li> <code>Scanner(InputStream source)</code> </li>
    </ul>  </li>
  <li> Some <code>PrintStream</code> constructors
    <ul>
      <li> <code>PrintStream(File file)</code> </li>
      <li> <code>PrintStream(OutputStream out)</code> </li>
      <li> <code>PrintStream(OutputStream out, boolean autoFlush)</code> </li>
      <li> <code>PrintStream(String fileName)</code> </li>
    </ul>  </li>
  <li> Some <code>PrintWriter</code> constructors
    <ul>
      <li> <code>PrintWriter(File file)</code> </li>
      <li> <code>PrintWriter(OutputStream out)</code> </li>
      <li> <code>PrintWriter(OutputStream out, boolean autoFlush)</code> </li>
      <li> <code>PrintWriter(String fileName)</code> </li>
    </ul>  </li>
  <li> methods from Apache commons-io library which accept an encoding argument when that argument is null, and overloads of those methods that omit
  the encoding argument
    <ul>
      <li> <code>IOUtils.copy(InputStream, Writer)</code> </li>
      <li> <code>IOUtils.copy(Reader, OutputStream)</code> </li>
      <li> <code>IOUtils.readLines(InputStream)</code> </li>
      <li> <code>IOUtils.toByteArray(Reader)</code> </li>
      <li> <code>IOUtils.toByteArray(String)</code> </li>
      <li> <code>IOUtils.toCharArray(InputStream)</code> </li>
      <li> <code>IOUtils.toInputStream(TypeCriteria.subtypeOf(CharSequence))</code> </li>
      <li> <code>IOUtils.toString(byte[])</code> </li>
      <li> <code>IOUtils.toString(URI)</code> </li>
      <li> <code>IOUtils.toString(URL)</code> </li>
      <li> <code>IOUtils.write(char[], OutputStream)</code> </li>
      <li> <code>IOUtils.write(CharSequence, OutputStream)</code> </li>
      <li> <code>IOUtils.writeLines(Collection, String, OutputStream)</code> </li>
      <li> <code>FileUtils.readFileToString(File)</code> </li>
      <li> <code>FileUtils.readLines(File)</code> </li>
      <li> <code>FileUtils.write(File, CharSequence)</code> </li>
      <li> <code>FileUtils.write(File, CharSequence, boolean)</code> </li>
      <li> <code>FileUtils.writeStringToFile(File, String)</code> </li>
    </ul>  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Fields in a "Serializable" class should either be transient or serializable (java:S1948)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/594">CWE-594 - Saving Unserializable Objects to Disk</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/Serializable.html">Interface Serializable - Java SE 11 API
  Documentation</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/Serializable.html">Interface Serializable - Java SE 17 API
  Documentation</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Consider the following scenario.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Address {
    ...
}

public class Person implements Serializable {
  private static final long serialVersionUID = 1905122041950251207L;

  private String name;
  private Address address;  // Noncompliant, Address is not serializable
}
</pre>
<p>How to fix this issue depends on the application’s needs. If the field’s value should be preserved during serialization and deserialization, you
may want to make the field’s value serializable.</p>
<pre data-diff-id="1" data-diff-type="compliant">
public class Address implements Serializable {
  private static final long serialVersionUID = 2405172041950251807L;

    ...
}

public class Person implements Serializable {
  private static final long serialVersionUID = 1905122041950251207L;

  private String name;
  private Address address; // Compliant, Address is serializable
}
</pre>
<p>If the field’s value does not need to be preserved during serialization and deserialization, mark it as <code>transient</code>. The field will be
ignored when the object is serialized. After deserialization, the field will be set to the default value corresponding to its type (e.g.,
<code>null</code> for object references).</p>
<pre>
public class Address {
    ...
}

public class Person implements Serializable {
  private static final long serialVersionUID = 1905122041950251207L;

  private String name;
  private transient Address address; // Compliant, the field is transient
}
</pre>
<p>The alternative to making all members serializable or <code>transient</code> is to implement special methods which take on the responsibility of
properly serializing and de-serializing the object <code>writeObject</code> and <code>readObject</code>. These methods can be used to properly
(de-)serialize an object, even though it contains fields that are not transient or serializable. Hence, this rule does not raise issues on fields of
classes which implement these methods.</p>
<pre>
public class Address {
    ...
}

public class Person implements Serializable {
  private static final long serialVersionUID = 1905122041950251207L;

  private String name;
  private Address address; // Compliant, writeObject and readObject handle this field

  private void writeObject(java.io.ObjectOutputStream out) throws IOException {
    // Appropriate serialization logic here
  }

  private void readObject(java.io.ObjectInputStream in) throws IOException, ClassNotFoundException {
    // Appropriate deserialization logic here
  }
}
</pre>
<p>Finally, static fields are out of scope for serialization, so making a field static prevents issues from being raised.</p>
<pre>
public class Person implements Serializable {
  private static final long serialVersionUID = 1905122041950251207L;

  private String name;

  private static Logger log = getLogger(); // Compliant, static fields are not serialized
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>By contract, non-static fields in a <code>Serializable</code> class must themselves be either <code>Serializable</code> or <code>transient</code>.
Even if the class is never explicitly serialized or deserialized, it is not safe to assume that this cannot happen. For instance, under load, most
J2EE application frameworks flush objects to disk.</p>
<p>An object that implements <code>Serializable</code> but contains non-transient, non-serializable data members (and thus violates the contract)
could cause application crashes and open the door to attackers. In general, a <code>Serializable</code> class is expected to fulfil its contract and
not exhibit unexpected behaviour when an instance is serialized.</p>
<p>This rule raises an issue on:</p>
<ul>
  <li> Non-<code>Serializable</code> fields. </li>
  <li> When a field is assigned a non-<code>Serializable</code> type within the class. </li>
  <li> Collection fields when they are not <code>private</code>. Values that are not serializable could be added to these collections externally. Due
  to type erasure, it cannot be guaranteed that the collection will only contain serializable objects at runtime despite being declared as a
  collection of serializable types. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue on a non-transient and non-serializable field within a serializable class, if said class does not have
<code>writeObject</code> and <code>readObject</code> methods defined.</p></p>
            </div>
        <div class="rule">
            <h3>"close()" calls should not be redundant (java:S4087)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Java 7’s try-with-resources structure automatically handles closing the resources that the <code>try</code> itself opens. Thus, adding an explicit
<code>close()</code> call is redundant and potentially confusing.</p>
<h3>Noncompliant code example</h3>
<pre>
try (PrintWriter writer = new PrintWriter(process.getOutputStream())) {
  String contents = file.contents();
  writer.write(new Gson().toJson(new MyObject(contents)));
  writer.flush();
  writer.close();  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
try (PrintWriter writer = new PrintWriter(process.getOutputStream())) {
  String contents = file.contents();
  writer.write(new Gson().toJson(new MyObject(contents)));
  writer.flush();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Allowing user enumeration is security-sensitive (java:S5804)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The application discloses that a username exists in its database: most of the time it’s possible to avoid this kind of leak except for the
  "registration/sign-on" part of a website because in this case the user must choose a valid username (not already taken by another user). </li>
  <li> There is no rate limiting and CAPTCHA protection in place for requests involving a username. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>In a Spring-security web application the username leaks when:</p>
<ul>
  <li> The string used as argument of <a
  href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetailsService.html">loadUserByUsername</a> method is used in an exception message: </li>
</ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  MyUserDetailsService s1 = new MyUserDetailsService();
  MyUserPrincipal u1 = s1.loadUserByUsername(username);

  if(u1 == null) {
    throw new BadCredentialsException(username+" doesn't exist in our database"); // Sensitive
  }
  // ....
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/userdetails/UsernameNotFoundException.html">UsernameNotFoundException</a> is thrown (except when it is in the loadUserByUsername method): </li>
</ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  if(user == null) {
      throw new UsernameNotFoundException("user not found"); // Sensitive
  }
  // ....
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-">HideUserNotFoundExceptions</a> is set to false: </li>
</ul>
<pre>
DaoAuthenticationProvider daoauth = new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(false); // Sensitive
builder.authenticationProvider(daoauth);
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>User enumeration refers to the ability to guess existing usernames in a web application database. This can happen, for example, when using
"sign-in/sign-on/forgot password" functionalities of a website.</p>
<p>When an user tries to "sign-in" to a website with an incorrect username/login, the web application should not disclose that the username doesn’t
exist with a message similar to "this username is incorrect", instead a generic message should be used like "bad credentials", this way it’s not
possible to guess whether the username or password was incorrect during the authentication.</p>
<p>If a user-management feature discloses information about the existence of a username, attackers can use brute force attacks to retrieve a large
amount of valid usernames that will impact the privacy of corresponding users and facilitate other attacks (phishing, password guessing etc …​).</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application discloses that a username exists in its database: most of the time it’s possible to avoid this kind of leak except for the
  "registration/sign-on" part of a website because in this case the user must choose a valid username (not already taken by another user). </li>
  <li> There is no rate limiting and CAPTCHA protection in place for requests involving a username. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>When a user performs a request involving a username, it should not be possible to spot differences between a valid and incorrect username:</p>
<ul>
  <li> Error messages should be generic and not disclose if the username is valid or not. </li>
  <li> The response time must be similar for a valid username or not. </li>
  <li> CAPTCHA and other rate limiting solutions should be implemented. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>In a Spring-security web application the username leaks when:</p>
<ul>
  <li> The string used as argument of <a
  href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/userdetails/UserDetailsService.html">loadUserByUsername</a> method is used in an exception message: </li>
</ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  MyUserDetailsService s1 = new MyUserDetailsService();
  MyUserPrincipal u1 = s1.loadUserByUsername(username);

  if(u1 == null) {
    throw new BadCredentialsException(username+" doesn't exist in our database"); // Sensitive
  }
  // ....
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/3.0.x/apidocs/org/springframework/security/core/userdetails/UsernameNotFoundException.html">UsernameNotFoundException</a> is thrown (except when it is in the loadUserByUsername method): </li>
</ul>
<pre>
public String authenticate(String username, String password) {
  // ....
  if(user == null) {
      throw new UsernameNotFoundException("user not found"); // Sensitive
  }
  // ....
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-">HideUserNotFoundExceptions</a> is set to false: </li>
</ul>
<pre>
DaoAuthenticationProvider daoauth = new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(false); // Sensitive
builder.authenticationProvider(daoauth);
</pre>
<h2>Compliant Solution</h2>
<p>In a Spring-security web application:</p>
<ul>
  <li> the same message should be used regardless of whether it is the wrong user or password: </li>
</ul>
<pre>
public String authenticate(String username, String password) throws AuthenticationException {
  Details user = null;
  try {
    user = loadUserByUsername(username);
  } catch (UsernameNotFoundException | DataAccessException e) {
    // Hide this exception reason to not disclose that the username doesn't exist
  }
  if (user == null || !user.isPasswordCorrect(password)) {
     // User should not be able to guess if the bad credentials message is related to the username or the password
    throw new BadCredentialsException("Bad credentials");
  }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-">HideUserNotFoundExceptions</a> should be set to true: </li>
</ul>
<pre>
DaoAuthenticationProvider daoauth = new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(true); // Compliant
builder.authenticationProvider(daoauth);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>When a user performs a request involving a username, it should not be possible to spot differences between a valid and incorrect username:</p>
<ul>
  <li> Error messages should be generic and not disclose if the username is valid or not. </li>
  <li> The response time must be similar for a valid username or not. </li>
  <li> CAPTCHA and other rate limiting solutions should be implemented. </li>
</ul>
<h2>Compliant Solution</h2>
<p>In a Spring-security web application:</p>
<ul>
  <li> the same message should be used regardless of whether it is the wrong user or password: </li>
</ul>
<pre>
public String authenticate(String username, String password) throws AuthenticationException {
  Details user = null;
  try {
    user = loadUserByUsername(username);
  } catch (UsernameNotFoundException | DataAccessException e) {
    // Hide this exception reason to not disclose that the username doesn't exist
  }
  if (user == null || !user.isPasswordCorrect(password)) {
     // User should not be able to guess if the bad credentials message is related to the username or the password
    throw new BadCredentialsException("Bad credentials");
  }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-security/site/docs/4.0.x/apidocs/org/springframework/security/authentication/dao/AbstractUserDetailsAuthenticationProvider.html#setHideUserNotFoundExceptions-boolean-">HideUserNotFoundExceptions</a> should be set to true: </li>
</ul>
<pre>
DaoAuthenticationProvider daoauth = new DaoAuthenticationProvider();
daoauth.setUserDetailsService(new MyUserDetailsService());
daoauth.setPasswordEncoder(new BCryptPasswordEncoder());
daoauth.setHideUserNotFoundExceptions(true); // Compliant
builder.authenticationProvider(daoauth);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>User enumeration refers to the ability to guess existing usernames in a web application database. This can happen, for example, when using
"sign-in/sign-on/forgot password" functionalities of a website.</p>
<p>When an user tries to "sign-in" to a website with an incorrect username/login, the web application should not disclose that the username doesn’t
exist with a message similar to "this username is incorrect", instead a generic message should be used like "bad credentials", this way it’s not
possible to guess whether the username or password was incorrect during the authentication.</p>
<p>If a user-management feature discloses information about the existence of a username, attackers can use brute force attacks to retrieve a large
amount of valid usernames that will impact the privacy of corresponding users and facilitate other attacks (phishing, password guessing etc …​).</p>
</p>
            </div>
        <div class="rule">
            <h3>AWS region should not be set with a hardcoded String (java:S6262)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When explicitly setting the region on an AWS Client, you should always prefer providing the value from the Enum <a
href="https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/index.html?com/amazonaws/regions/Regions.html">Regions</a> instead of a hardcoded String.
This will allow you to transparently support any change in the API and avoid mistakes.</p>
<p>This rule reports an issue when a hardcoded string is used instead of an available enum value.</p>
<h3>Noncompliant code example</h3>
<pre>
AmazonS3ClientBuilder.standard().withRegion("eu_west_1").build();
</pre>
<h3>Compliant solution</h3>
<pre>
AmazonS3ClientBuilder.standard().withRegion(Regions.EU_WEST_1).build();
</pre></p>
            </div>
        <div class="rule">
            <h3>Using long-term access keys is security-sensitive (java:S6263)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Default:</p>
            <p><p>In AWS, long-term access keys will be valid until you manually revoke them. This makes them highly sensitive as any exposure can have serious
consequences and should be used with care.</p>
<p>This rule will trigger when encountering an instantiation of <code>com.amazonaws.auth.BasicAWSCredentials</code>.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The access key is used directly in an application or AWS CLI script running on an Amazon EC2 instance. </li>
  <li> Cross-account access is needed. </li>
  <li> The access keys need to be embedded within a mobile application. </li>
  <li> Existing identity providers (SAML 2.0, on-premises identity store) already exists. </li>
</ul>
<p>For more information, see <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html#use-roles">Use IAM roles
instead of long-term access keys</a>.</p>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Consider using IAM roles or other features of the AWS Security Token Service that provide temporary credentials, limiting the risks.</p>
<h2>Sensitive Code Example</h2>
<pre>
import com.amazonaws.auth.AWSCredentials;
import com.amazonaws.auth.BasicAWSCredentials;
// ...

AWSCredentials awsCredentials = new BasicAWSCredentials(accessKeyId, secretAccessKey);
</pre>
<h2>Compliant Solution</h2>
<p>Example for AWS STS (see <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/prog-services-sts.html">Getting Temporary Credentials
with AWS STS</a>).</p>
<pre>
BasicSessionCredentials sessionCredentials = new BasicSessionCredentials(
   session_creds.getAccessKeyId(),
   session_creds.getSecretAccessKey(),
   session_creds.getSessionToken());
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html">Best practices for managing AWS access keys</a>
  </li>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html">Managing access keys for IAM users</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The access key is used directly in an application or AWS CLI script running on an Amazon EC2 instance. </li>
  <li> Cross-account access is needed. </li>
  <li> The access keys need to be embedded within a mobile application. </li>
  <li> Existing identity providers (SAML 2.0, on-premises identity store) already exists. </li>
</ul>
<p>For more information, see <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html#use-roles">Use IAM roles
instead of long-term access keys</a>.</p>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
import com.amazonaws.auth.AWSCredentials;
import com.amazonaws.auth.BasicAWSCredentials;
// ...

AWSCredentials awsCredentials = new BasicAWSCredentials(accessKeyId, secretAccessKey);
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Consider using IAM roles or other features of the AWS Security Token Service that provide temporary credentials, limiting the risks.</p>
<h2>Compliant Solution</h2>
<p>Example for AWS STS (see <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/prog-services-sts.html">Getting Temporary Credentials
with AWS STS</a>).</p>
<pre>
BasicSessionCredentials sessionCredentials = new BasicSessionCredentials(
   session_creds.getAccessKeyId(),
   session_creds.getSecretAccessKey(),
   session_creds.getSessionToken());
</pre>
<h2>See</h2>
<ul>
  <li> <a href="https://docs.aws.amazon.com/general/latest/gr/aws-access-keys-best-practices.html">Best practices for managing AWS access keys</a>
  </li>
  <li> <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html">Managing access keys for IAM users</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In AWS, long-term access keys will be valid until you manually revoke them. This makes them highly sensitive as any exposure can have serious
consequences and should be used with care.</p>
<p>This rule will trigger when encountering an instantiation of <code>com.amazonaws.auth.BasicAWSCredentials</code>.</p>
</p>
            </div>
        <div class="rule">
            <h3>Classes should not have too many fields (java:S1820)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A class that grows too much tends to aggregate too many responsibilities and inevitably becomes harder to understand and therefore to maintain, and
having a lot of fields is an indication that a class has grown too large.</p>
<p>Above a specific threshold, it is strongly advised to refactor the class into smaller ones which focus on well defined topics.</p></p>
            </div>
        <div class="rule">
            <h3>Redundant casts should not be used (java:S1905)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>To fix your code remove the unnecessary casting expression.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Example {
    public void example(List&lt;String&gt; list) {
        for (String item: (List&lt;String&gt;) list) {  // Noncompliant, Remove this unnecessary cast to "List".
          //...
        }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class Example {
    public void example() {
        for (String foo : getFoos()) {
          //...
        }
    }

    public List&lt;String&gt; getFoos() {
        return List.of("foo1", "foo2");
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Geeksforgeeks - <a href="https://www.geeksforgeeks.org/type-conversion-java-examples/">Type conversion in Java with Examples</a> </li>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Type_conversion">Type Conversion</a> </li>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">Strong and Weak Typing</a> </li>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Polymorphism_(computer_science)"> Polymorphism (Computer Science)</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Casting expressions are utilized to convert one data type to another, such as transforming an integer into a string. This is especially crucial in
strongly typed languages like C, C++, C#, Java, Python, and others.</p>
<p>However, there are instances where casting expressions are not needed. These include situations like:</p>
<ul>
  <li> casting a variable to its own type </li>
  <li> casting a subclass to a parent class (in the case of polymorphism) </li>
  <li> the programming language is capable of automatically converting the given type to another </li>
</ul>
<p>These scenarios are considered unnecessary casting expressions. They can complicate the code and make it more difficult to understand, without
offering any advantages.</p>
<p>As a result, it’s generally advised to avoid unnecessary casting expressions. Instead, rely on the language’s type system to ensure type safety and
code clarity.</p>
<h3>Exceptions</h3>
<p>Casting may be required to distinguish the method to call in the case of overloading:</p>
<pre>
class A {}
class B extends A{}
class C {
  void fun(A a){}
  void fun(B b){}

  void foo() {
    B b = new B();
    fun(b);
    fun((A) b); // Compliant, required to call the first method so cast is not redundant.
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Extensions and implementations should not be redundant (java:S1939)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>All classes extend <code>Object</code> implicitly. Doing so explicitly is redundant.</p>
<p>Further, declaring the implementation of an interface <em>and</em> one if its parents is also redundant. If you implement the interface, you also
implicitly implement its parents and there’s no need to do so explicitly.</p>
<h3>Noncompliant code example</h3>
<pre>
public interface MyFace {
  // ...
}

public interface MyOtherFace extends MyFace {
  // ...
}

public class Foo
    extends Object // Noncompliant
    implements MyFace, MyOtherFace {  // Noncompliant
  //...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public interface MyFace {
  // ...
}

public interface MyOtherFace extends MyFace {
  // ...
}

public class Foo implements MyOtherFace {
  //...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"ThreadLocal.withInitial" should be preferred (java:S4065)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Java 8 introduced <code>ThreadLocal.withInitial</code> which is a simpler alternative to creating an anonymous inner class to initialise a
<code>ThreadLocal</code> instance.</p>
<p>This rule raises an issue when a <code>ThreadLocal</code> anonymous inner class can be replaced by a call to
<code>ThreadLocal.withInitial</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
ThreadLocal&lt;List&lt;String&gt;&gt; myThreadLocal =
    new ThreadLocal&lt;List&lt;String&gt;&gt;() { // Noncompliant
        @Override
        protected List&lt;String&gt; initialValue() {
            return new ArrayList&lt;String&gt;();
        }
    };
</pre>
<h3>Compliant solution</h3>
<pre>
ThreadLocal&lt;List&lt;String&gt;&gt; myThreadLocal = ThreadLocal.withInitial(ArrayList::new);
</pre></p>
            </div>
        <div class="rule">
            <h3>Single-character alternations in regular expressions should be replaced with character classes (java:S6035)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When an alternation contains multiple alternatives that consist of a single character, it can be rewritten as a character class. This should be
preferred because it is more efficient and can even help prevent stack overflows when used inside a repetition (see rule <a href='/coding_rules#rule_key=java%3AS5998'>S5998</a>).</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("a|b|c"); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("[abc]");
// or
Pattern.compile("[a-c]");
</pre></p>
            </div>
        <div class="rule">
            <h3>String multiline concatenation should be replaced with Text Blocks (java:S6126)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/378">JEP 378: Text Blocks</a> </li>
  <li> <a href="https://openjdk.org/projects/amber/guides/text-blocks-guide">Programmer’s Guide To Text Blocks</a>, by Jim Laskey and Stuart Marks
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 15 Text Blocks are now official and can be used. The most common pattern for multiline strings in Java &lt; 15 was to write String
concatenation. Now it’s possible to do it in a more natural way using Text Blocks.</p>
<h3>Noncompliant code example</h3>
<pre>
String textBlock =
               "&lt;html&gt;\n" +
               "    &lt;body&gt;\n" +
               "        &lt;tag&gt;\n" +
               "        &lt;/tag&gt;\n" +
               "    &lt;/body&gt;\n" +
               "&lt;/html&gt;";
</pre>
<h3>Compliant solution</h3>
<pre>
String textBlock = """
        &lt;html&gt;
            &lt;body&gt;
                &lt;tag&gt;
                &lt;/tag&gt;
            &lt;/body&gt;
        &lt;/html&gt;""";
</pre></p>
            </div>
        <div class="rule">
            <h3>Credentials Provider should be set explicitly when creating a new "AwsClient" (java:S6242)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://aws.amazon.com/fr/blogs/developer/tuning-the-aws-java-sdk-2-x-to-reduce-startup-time/">Tuning the AWS Java SDK 2.x to reduce
  startup time</a> </li>
  <li> <a href="https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/lambda-optimize-starttime.html">Optimizing cold start performance for
  AWS Lambda</a> </li>
  <li> <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-envvars.html">Environment variable configuration</a> </li>
  <li> <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/credentials.html">Default Credential Provider Chain</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>If the credentials provider is not specified when creating a new AwsClient with an <a
href="https://sdk.amazonaws.com/java/api/latest/software/amazon/awssdk/awscore/client/builder/AwsClientBuilder.html">AwsClientBuilder</a>, the AWS SDK
will execute some logic to identify it automatically.</p>
<p>While it will probably identify the correct one, this extra logic will slow down startup time, already known to be a hotspot.</p>
<p>You should therefore always define the logic to set the credentials provider yourself. This is typically done by retrieving it from the Lambda
provided environment variable.</p>
<p>This will make the code more explicit and spare initialization time.</p>
<p>This rule reports an issue when the credentials provider is not set when creating an AwsClient.</p>
<h3>Noncompliant code example</h3>
<pre>
S3Client.builder()
    .region(Region.of(System.getenv(SdkSystemSetting.AWS_REGION.environmentVariable())))
    .build();
</pre>
<h3>Compliant solution</h3>
<pre>
S3Client.builder()
    .region(Region.of(System.getenv(SdkSystemSetting.AWS_REGION.environmentVariable()))
    .credentialsProvider(EnvironmentVariableCredentialsProvider.create())
    .build();
</pre></p>
            </div>
        <div class="rule">
            <h3>Lambdas should not invoke other lambdas synchronously (java:S6246)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Invoking other Lambdas synchronously from a Lambda is a scalability anti-pattern. Lambdas have a maximum execution time before they timeout (15
minutes as of May 2021). Having to wait for another Lambda to finish its execution could lead to a timeout.</p>
<p>A better solution is to generate&nbsp;events that can be consumed asynchronously by other Lambdas.</p>
<h3>Noncompliant code example</h3>
<p>With AWS SDKv1</p>
<pre>
InvokeRequest invokeRequest = new InvokeRequest()
         .withFunctionName("myFunction");

AWSLambda awsLambda = AWSLambdaClientBuilder.standard()
		.withCredentials(new ProfileCredentialsProvider())
		.withRegion(Regions.US_WEST_2).build();

awsLambda.invoke(invokeRequest); // Noncompliant
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html">Best practices for working with AWS Lambda functions</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Enabling JavaScript support for WebViews is security-sensitive (java:S6362)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The WebWiew only renders static web content that does not require JavaScript code to be executed. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(true); // Sensitive
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered. In the context of a
WebView, JavaScript code can exfiltrate local files that might be sensitive or even worse, access exposed functions of the application that can result
in more severe vulnerabilities such as code injection. Thus JavaScript support should not be enabled for WebViews unless it is absolutely necessary
and the authenticity of the web resources can be guaranteed.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The WebWiew only renders static web content that does not require JavaScript code to be executed. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable JavaScript support for WebViews unless it is necessary to execute JavaScript code. Only trusted pages should be
rendered.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered. In the context of a
WebView, JavaScript code can exfiltrate local files that might be sensitive or even worse, access exposed functions of the application that can result
in more severe vulnerabilities such as code injection. Thus JavaScript support should not be enabled for WebViews unless it is absolutely necessary
and the authenticity of the web resources can be guaranteed.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable JavaScript support for WebViews unless it is necessary to execute JavaScript code. Only trusted pages should be
rendered.</p>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setJavaScriptEnabled(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Enabling file access for WebViews is security-sensitive (java:S6363)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> No local files have to be accessed by the Webview. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(true); // Sensitive
webView.getSettings().setAllowContentAccess(true); // Sensitive
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered.</p>
<p>If malicious JavaScript code in a WebView is executed this can leak the contents of sensitive files when access to local files is enabled.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>WebViews can be used to display web content as part of a mobile application. A browser engine is used to render and display the content. Like a web
application, a mobile application that uses WebViews can be vulnerable to Cross-Site Scripting if untrusted code is rendered.</p>
<p>If malicious JavaScript code in a WebView is executed this can leak the contents of sensitive files when access to local files is enabled.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> No local files have to be accessed by the Webview. </li>
  <li> The WebView contains untrusted data that could cause harm when rendered. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable access to local files for WebViews unless it is necessary. In the case of a successful attack through a Cross-Site
Scripting vulnerability the attackers attack surface decreases drastically if no files can be read out.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(true); // Sensitive
webView.getSettings().setAllowContentAccess(true); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(false);
webView.getSettings().setAllowContentAccess(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>It is recommended to disable access to local files for WebViews unless it is necessary. In the case of a successful attack through a Cross-Site
Scripting vulnerability the attackers attack surface decreases drastically if no files can be read out.</p>
<h2>Compliant Solution</h2>
<pre>
import android.webkit.WebView;

WebView webView = (WebView) findViewById(R.id.webview);
webView.getSettings().setAllowFileAccess(false);
webView.getSettings().setAllowContentAccess(false);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Non-capturing groups without quantifier should not be used (java:S6395)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Sub-patterns can be wrapped by parentheses to build a group. This enables to restrict alternations, back reference the group or apply quantifier to
the sub-pattern.</p>
<p>If this group should not be part of the match result or if no reference to this group is required, a non-capturing group can be created by adding
<code>?:</code> behind the opening parenthesis.</p>
<p>However, if this non-capturing group does not have a quantifier, or does not wrap an alternation, then imaging this group is redundant.</p>
<h3>Noncompliant code example</h3>
<pre>
"(?:number)\\d{2}"
</pre>
<h3>Compliant solution</h3>
<pre>
"number\\d{2}"      	// it is anyway required
"(?:number)?\\d{2}"  	// it is in fact optional
</pre>
<h3>Exceptions</h3>
<p>This rule does not report an issue if the non-capturing group is an alternation.</p>
<pre>
"(?:number|string)"
</pre></p>
            </div>
        <div class="rule">
            <h3>Superfluous curly brace quantifiers should be avoided (java:S6396)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Curly brace quantifiers in regular expressions can be used to have a more fine-grained control over how many times the character or the
sub-expression preceeding them should occur. They can be used to match an expression exactly n times with <code>{n}</code>, between n and m times with
<code>{n,m}</code>, or at least n times with <code>{n,}</code>. In some cases, using such a quantifier is superfluous for the semantic of the regular
expression, and it can be removed to improve readability. This rule raises an issue when one of the following quantifiers is encountered:</p>
<ul>
  <li> <code>{1,1}</code> or <code>{1}</code>: they match the expression exactly once. The same behavior can be achieved without the quantifier. </li>
  <li> <code>{0,0}</code> or <code>{0}</code>: they match the expression zero times. The same behavior can be achieved by removing the expression.
  </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
"ab{1,1}c"
"ab{1}c"
"ab{0,0}c"
"ab{0}c"
</pre>
<h3>Compliant solution</h3>
<pre>
"abc"
"ac"
</pre></p>
            </div>
        <div class="rule">
            <h3>Character classes in regular expressions should not contain only one character (java:S6397)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Character classes in regular expressions are a convenient way to match one of several possible characters by listing the allowed characters or
ranges of characters. If a character class contains only one character, the effect is the same as just writing the character without a character
class.</p>
<p>Thus, having only one character in a character class is usually a simple oversight that remained after removing other characters of the class.</p>
<h3>Noncompliant code example</h3>
<pre>
"a[b]c"
"[\\^]"
</pre>
<h3>Compliant solution</h3>
<pre>
"abc"
"\\^"
"a[*]c" // Compliant, see Exceptions
</pre>
<h3>Exceptions</h3>
<p>This rule does not raise when the character inside the class is a metacharacter. This notation is sometimes used to avoid escaping (e.g.,
<code>[.]{3}</code> to match three dots).</p></p>
            </div>
        <div class="rule">
            <h3>"ThreadLocal" variables should be cleaned up when no longer used (java:S5164)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://www.baeldung.com/java-memory-leaks">Understanding Memory Leaks in Java</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>ThreadLocal</code> variables are supposed to be garbage collected once the holding thread is no longer alive. Memory leaks can occur when
holding threads are re-used which is the case on application servers using pool of threads.</p>
<p>To avoid such problems, it is recommended to always clean up <code>ThreadLocal</code> variables using the <code>remove()</code> method to remove
the current thread’s value for the <code>ThreadLocal</code> variable.</p>
<p>In addition, calling <code>set(null)</code> to remove the value might keep the reference to <code>this</code> pointer in the map, which can cause
memory leak in some scenarios. Using <code>remove</code> is safer to avoid this issue.</p>
<h3>Noncompliant code example</h3>
<pre>
public class ThreadLocalUserSession implements UserSession {

  private static final ThreadLocal&lt;UserSession&gt; DELEGATE = new ThreadLocal&lt;&gt;();

  public UserSession get() {
    UserSession session = DELEGATE.get();
    if (session != null) {
      return session;
    }
    throw new UnauthorizedException("User is not authenticated");
  }

  public void set(UserSession session) {
    DELEGATE.set(session);
  }

   public void incorrectCleanup() {
     DELEGATE.set(null); // Noncompliant
   }

  // some other methods without a call to DELEGATE.remove()
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class ThreadLocalUserSession implements UserSession {

  private static final ThreadLocal&lt;UserSession&gt; DELEGATE = new ThreadLocal&lt;&gt;();

  public UserSession get() {
    UserSession session = DELEGATE.get();
    if (session != null) {
      return session;
    }
    throw new UnauthorizedException("User is not authenticated");
  }

  public void set(UserSession session) {
    DELEGATE.set(session);
  }

  public void unload() {
    DELEGATE.remove(); // Compliant
  }

  // ...
}
</pre>
<h3>Exceptions</h3>
<p>Rule will not detect non-private <code>ThreadLocal</code> variables, because <code>remove()</code> can be called from another class.</p></p>
            </div>
        <div class="rule">
            <h3>Back references in regular expressions should only refer to capturing groups that are matched before the reference (java:S6001)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a back reference in a regex refers to a capturing group that hasn’t been defined yet (or at all), it can never be matched. Named back
references throw a <code>PatternSyntaxException</code> in that case; numeric back references fail silently when they can’t match, simply making the
match fail.</p>
<p>When the group is defined before the back reference but on a different control path (like in <code>(.)|\1</code> for example), this also leads to a
situation where the back reference can never match.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("\\1(.)"); // Noncompliant, group 1 is defined after the back reference
Pattern.compile("(.)\\2"); // Noncompliant, group 2 isn't defined at all
Pattern.compile("(.)|\\1"); // Noncompliant, group 1 and the back reference are in different branches
Pattern.compile("(?&lt;x&gt;.)|\\k&lt;x&gt;"); // Noncompliant, group x and the back reference are in different branches
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("(.)\\1");
Pattern.compile("(?&lt;x&gt;.)\\k&lt;x&gt;");
</pre></p>
            </div>
        <div class="rule">
            <h3>Regex lookahead assertions should not be contradictory (java:S6002)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a regex lookahead contradicts the rest of the regex.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Lookahead assertions are a regex feature that makes it possible to look ahead in the input without consuming it. It is often used at the end of
regular expressions to make sure that substrings only match when they are followed by a specific pattern.</p>
<p>For example, the following pattern will match an "a" only if it is directly followed by a "b". This does not consume the "b" in the process:</p>
<pre>
Pattern.compile("a(?=b)");
</pre>
<p>However, lookaheads can also be used in the middle (or at the beginning) of a regex. In that case there is the possibility that what comes after
the lookahead contradicts the pattern inside the lookahead. Since the lookahead does not consume input, this makes the lookahead impossible to match
and is a sign that there’s a mistake in the regular expression that should be fixed.</p>

<h4>Noncompliant code example</h4>
<pre>
Pattern.compile("(?=a)b"); // Noncompliant, the same character can't be equal to 'a' and 'b' at the same time
</pre>
<h4>Compliant solution</h4>
<pre>
Pattern.compile("(?&lt;=a)b");
Pattern.compile("a(?=b)");
</pre></p>
            </div>
        <div class="rule">
            <h3>Reluctant quantifiers in regular expressions should be followed by an expression that can't match the empty string (java:S6019)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a reluctant quantifier (such as <code>*?</code> or <code>+?</code>) is followed by a pattern that can match the empty string or directly by
the end of the regex, it will always match the empty string when used with methods that find partial matches (such as <code>find</code>,
<code>replaceAll</code>, <code>split</code> etc.).</p>
<p>Similarly, when used with methods that find full matches, a reluctant quantifier that’s followed directly by the end of the regex (or a pattern
that always matches the empty string, such as <code>()</code>) behaves indistinguishably from a greedy quantifier while being less efficient.</p>
<p>This is likely a sign that the regex does not work as intended.</p>
<h3>Noncompliant code example</h3>
<pre>
"start123endstart456".replaceAll("start\\w*?(end)?", "x"); // Noncompliant. In contrast to what one would expect, the result is not "xx".
str.matches("\\d*?"); // Noncompliant. Matches the same as "\d*", but will backtrack in every position.
</pre>
<h3>Compliant solution</h3>
<pre>
"start123endstart456".replaceAll("start\\w*?(end|$)", "x"); // Result is "xx".
str.matches("\\d*");
</pre></p>
            </div>
        <div class="rule">
            <h3>Region should be set explicitly when creating a new "AwsClient" (java:S6241)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://aws.amazon.com/fr/blogs/developer/tuning-the-aws-java-sdk-2-x-to-reduce-startup-time/">Tuning the AWS Java SDK 2.x to reduce
  startup time</a> </li>
  <li> <a href="https://docs.aws.amazon.com/sdk-for-java/latest/developer-guide/lambda-optimize-starttime.html">Optimizing cold start performance for
  AWS Lambda</a> </li>
  <li> <a href="https://docs.aws.amazon.com/lambda/latest/dg/configuration-envvars.html">Environment variable configuration</a> </li>
  <li> <a
  href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/java-dg-region-selection.html#automatically-determine-the-aws-region-from-the-environment">Automatically Determine the AWS Region</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>If the region is not specified when creating a new AwsClient with an <a
href="https://sdk.amazonaws.com/java/api/latest/software/amazon/awssdk/awscore/client/builder/AwsClientBuilder.html">AwsClientBuilder</a>, the AWS SDK
will execute some logic to identify the endpoint automatically.</p>
<p>While it will probably identify the correct one, this extra logic will slow down startup time, already known to be a hotspot.</p>
<p>You should therefore always define the logic to set the region yourself. This is typically done by retrieving the region from the Lambda provided
AWS_REGION environment variable.</p>
<p>This will make the code more explicit and spare initialization time.</p>
<p>This rule reports an issue when the region is not set when creating an AwsClient.</p>
<h3>Noncompliant code example</h3>
<pre>
S3Client.builder()
    .credentialsProvider(EnvironmentVariableCredentialsProvider.create())
    .build();
</pre>
<h3>Compliant solution</h3>
<pre>
S3Client.builder()
    .region(Region.of(System.getenv(SdkSystemSetting.AWS_REGION.environmentVariable()))
    .credentialsProvider(EnvironmentVariableCredentialsProvider.create())
    .build();
</pre></p>
            </div>
        <div class="rule">
            <h3>Reusable resources should be initialized at construction time of Lambda functions (java:S6243)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://aws.amazon.com/fr/blogs/developer/tuning-the-aws-java-sdk-2-x-to-reduce-startup-time/">Tuning the AWS Java SDK 2.x to reduce
  startup time</a> </li>
  <li> <a href="https://docs.aws.amazon.com/lambda/latest/dg/best-practices.html">Best practices for working with AWS Lambda functions</a> </li>
  <li> <a href="https://aws.amazon.com/fr/blogs/compute/container-reuse-in-lambda/">Understanding Container Reuse in AWS Lambda</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Resources that can be reused across multiple invocations of the Lambda function should be initialized at construction time. For example in the
constructor of the class, or in field initializers. This way, when the same container is reused for multiple function invocations, the existing
instance can be reused, along with all resources stored in its fields. It is a good practice to reuse SDK clients and database connections by
initializing them at class construction time, to avoid recreating them on every lambda invocation. Failing to do so can lead to performance
degradation, and when not closed properly, even out of memory errors.</p>
<p>This rule reports an issue when the SDK client or the database connection is initialized locally inside a Lambda function.</p>
<h3>Noncompliant code example</h3>
<pre>
public class App implements RequestHandler&lt;Object, Object&gt; {
    @Override
    public Object handleRequest(final Object input, final Context context) {
      S3Client s3Client = DependencyFactory.s3Client();
      s3Client.listBuckets();
      // ...
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class App implements RequestHandler&lt;Object, Object&gt; {
    private final S3Client s3Client;

    public App() {
      s3Client = DependencyFactory.s3Client();
    }

    @Override
    public Object handleRequest(final Object input, final Context context) {
      s3Client.listBuckets();
      // ...
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Consumer Builders should be used (java:S6244)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Some API, like the AWS SDK, heavily rely on the builder pattern to create different data structures. Despite all the benefits, this pattern can
become really verbose, especially when dealing with nested structures. In order to reach a more concise code, "Consumer Builders", also called
"Consumer Interface" are often introduced.</p>
<p>The idea is to overload the methods taking others structures in a Builder with a Consumer of Builder instead. This enables to use a lambda instead
of nesting another Builder, resulting in more concise and readable code.</p>
<p>This rule reports an issue when the Consumer Builder methods could be used instead of the classical ones.</p>
<h3>Noncompliant code example</h3>
<pre>
SendEmailRequest.builder()
  .destination(Destination.builder()
    .toAddresses("to-email@domain.com")
    .bccAddresses("bcc-email@domain.com")
    .build())
.build();
</pre>
<h3>Compliant solution</h3>
<pre>
SendEmailRequest.builder()
  .destination(d -&gt; d.toAddresses("to-email@domain.com").bccAddresses("bcc-email@domain.com"))
  .build();
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://aws.amazon.com/fr/blogs/developer/consumer-builders-in-the-aws-sdk-for-java-v2/">Consumer Builders in the AWS SDK for Java
  v2</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>XML parsers should not allow inclusion of arbitrary files (java:S6373)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the XML parser will encounter an <code>xinclude</code> element, it will try to load the file pointed to by the <code>href</code> attribute
into the document. Included files can either be local files found on the file system of the application server, or remote files that are downloaded
over HTTP, SMB, or other protocols, depending on the capabilities of the application and server.</p>
<p>The files that can be accessed that way are only limited by the entitlement of the application on the local system and the network filtering the
server is subject to.</p>
<p>This issue is particularly severe when the XML parser is used to parse untrusted documents. For example, when user-submitted XML messages are
parsed that way.</p>
<h3>What is the potential impact?</h3>
<p>Allowing the inclusion of arbitrary files in XML documents can have two main consequences depending on what type of file is included: local or
remote.</p>
<h4>Sensitive file disclosure</h4>
<p>If the application allows the inclusion of arbitrary files through the use of the <code>xinclude</code> element, it might be used to disclose
arbitrary files from the local file system. Depending on the application’s permissions on the file system, configuration files, runtime secrets, or
Personally Identifiable Information could be leaked.</p>
<p>This is particularly true if the affected parser is used to process untrusted XML documents.</p>
<h4>Server-side request forgery</h4>
<p>When used to retrieve remote files, the application will send network requests to remote hosts. Moreover, it will do so from its current network
location, which can have severe consequences if the application server is located on a sensitive network, such as the company corporate network or a
DMZ hosting other applications.</p>
<p>Attackers exploiting this issue could try to access internal backend services or corporate file shares. It could allow them to access more
sensitive files, bypass authentication mechanisms from frontend applications, or exploit further vulnerabilities in the local services. Note that, in
some cases, the requests sent from the application can be automatically authenticated on federated locations. This is often the case in Windows
environments when using Active Directory federated authentication.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code is vulnerable because it explicitly enables the <code>xinclude</code> feature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.xml.parsers.SAXParserFactory;

SAXParserFactory factory = SAXParserFactory.newInstance();

factory.setXIncludeAware(true); // Noncompliant
factory.setFeature("http://apache.org/xml/features/xinclude", true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.xml.parsers.SAXParserFactory;

SAXParserFactory factory = SAXParserFactory.newInstance();

factory.setXIncludeAware(false);
factory.setFeature("http://apache.org/xml/features/xinclude", false);
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>XML standard allows the inclusion of XML files with the <code>xinclude</code> element. When an XML parser component is set up with the
<code>http://apache.org/xml/features/xinclude</code> feature, it will follow the standard and allow the inclusion of remote files.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code is vulnerable because it explicitly enables the <code>xinclude</code> feature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="3" data-diff-type="noncompliant">
import org.jdom2.input.SAXBuilder;

SAXBuilder builder = new SAXBuilder();
builder.setFeature("http://apache.org/xml/features/xinclude", true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
import org.jdom2.input.SAXBuilder;

SAXBuilder builder = new SAXBuilder();
builder.setFeature("http://apache.org/xml/features/xinclude", false);
</pre>
<h3>How does this work?</h3>
<p>The compliant code example explicitly prevents the inclusion of files in XML documents by setting the
<code>http://apache.org/xml/features/xinclude</code> feature property to <code>false</code>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java">OWASP XXE Prevention
  Cheat Sheet</a> </li>
  <li> Java documentation - <a
  href="https://docs.oracle.com/en/java/javase/13/security/java-api-xml-processing-jaxp-security-guide.html#GUID-8CD65EF5-D113-4D5C-A564-B875C8625FAC">XML External Entity Injection Attack</a> </li>
  <li> W3C - <a href="https://www.w3.org/TR/xinclude-11/">XML Inclusions (XInclude) Version 1.1</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 - Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 - Category A5 - Security Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/611">CWE-611 - Improper Restriction of XML External Entity Reference</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/827">CWE-827 - Improper Control of Document Type Definition</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222608">Application Security and
  Development: V-222608</a> - The application must not be vulnerable to XML-oriented attacks. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code is vulnerable because it explicitly enables the <code>xinclude</code> feature.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
import org.dom4j.io.SAXReader;

SAXReader xmlReader = new SAXReader();
xmlReader.setFeature("http://apache.org/xml/features/xinclude", true); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
import org.dom4j.io.SAXReader;

SAXReader xmlReader = new SAXReader();
xmlReader.setFeature("http://apache.org/xml/features/xinclude", false);
</pre></p>
            </div>
        <div class="rule">
            <h3>XML signatures should be validated securely (java:S6377)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>XML signatures are a method used to ensure the integrity and authenticity of XML documents. However, if XML signatures are not validated securely,
it can lead to potential vulnerabilities.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>For versions of Java before 17, secure validation is disabled by default unless the application runs with a security manager, which is rare. It
should be enabled explicitly by setting the <code>org.jcp.xml.dsig.secureValidation</code> attribute to true with the
<code>javax.xml.crypto.dsig.dom.DOMValidateContext.setProperty</code> method.</p>
<p>For Java 17 and higher, secure validation is enabled by default.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
NodeList signatureElement = doc.getElementsByTagNameNS(XMLSignature.XMLNS, "Signature");

XMLSignatureFactory fac = XMLSignatureFactory.getInstance("DOM");
DOMValidateContext valContext = new DOMValidateContext(new KeyValueKeySelector(), signatureElement.item(0)); // Noncompliant
XMLSignature signature = fac.unmarshalXMLSignature(valContext);

boolean signatureValidity = signature.validate(valContext);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
NodeList signatureElement = doc.getElementsByTagNameNS(XMLSignature.XMLNS, "Signature");

XMLSignatureFactory fac = XMLSignatureFactory.getInstance("DOM");
DOMValidateContext valContext = new DOMValidateContext(new KeyValueKeySelector(), signatureElement.item(0));
valContext.setProperty("org.jcp.xml.dsig.secureValidation", Boolean.TRUE);
XMLSignature signature = fac.unmarshalXMLSignature(valContext);

boolean signatureValidity = signature.validate(valContext);
</pre>
<h3>How does this work?</h3>
<p>When XML Signature secure validation mode is enabled, XML Signatures are processed more securely. It enforces a number of restrictionsto to protect
from XML Documents that may contain hostile constructs that can cause denial-of-service or other types of security issues.</p>
<p>These restrictions can protect you from XML Signatures that may contain potentially hostile constructs that can cause denial-of-service or other
types of security issues.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Oracle Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/security/java-xml-digital-signature-api-overview-and-tutorial.html">XML Digital Signature API
  Overview and Tutorial</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10:2021 A02:2021 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/347">CWE-347 - Improper Verification of Cryptographic Signature</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222608">Application Security and
  Development: V-222608</a> - The application must not be vulnerable to XML-oriented attacks. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Before Java 17, XML Digital Signature API does not apply restrictions on XML signature validation unless the application runs with a security
manager, which is rare.</p>
<h2>What is the potential impact</h2>
<p>By not enforcing secure validation, the XML Digital Signature API is more susceptible to attacks such as signature spoofing and injections.</p>
<h3>Increased Vulnerability to Signature Spoofing</h3>
<p>By disabling secure validation, the application becomes more susceptible to signature spoofing attacks. Attackers can potentially manipulate the
XML signature in a way that bypasses the validation process, allowing them to forge or tamper with the signature. This can lead to the acceptance of
invalid or maliciously modified signatures, compromising the integrity and authenticity of the XML documents.</p>
<h3>Risk of Injection Attacks</h3>
<p>Disabling secure validation can expose the application to injection attacks. Attackers can inject malicious code or entities into the XML document,
taking advantage of the weakened validation process. In some cases, it can also expose the application to denial-of-service attacks. Attackers can
exploit vulnerabilities in the validation process to cause excessive resource consumption or system crashes, leading to service unavailability or
disruption.</p></p>
            </div>
        <div class="rule">
            <h3>Hash-based collections with known capacity should be initialized with the proper related static method. (java:S6485)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When creating an instance of HashMap or HashSet, the developer can pick a constructor with known capacity. However, the requested capacity is not
fully allocated by default. Indeed, when the collection reaches the load factor of the collection (default: 0.75), the collection is resized on the
fly, leading to unexpected performance issues.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>As of Java 19, hash-based collections provide a static method that allocates the requested capacity at construction time.</p>

<h4>Noncompliant code example</h4>
<pre>
private static final int KNOWN_CAPACITY = 1_000_000;

public static Map&lt;String, Integer&gt; buildAMap() {
    return new HashMap&lt;&gt;(KNOWN_CAPACITY); // Noncompliant
}

public static Set&lt;String&gt; buildASet() {
    return new HashSet&lt;&gt;(KNOWN_CAPACITY); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre>
private static final int KNOWN_CAPACITY = 1_000_000;

public static Map&lt;String, Integer&gt; buildABetterMap() {
    return HashMap.newHashMap(KNOWN_CAPACITY);
}

public static Set&lt;String&gt; buildABetterSet() {
    return HashSet.newHashSet(KNOWN_CAPACITY);
}

public static Set&lt;String&gt; buildABetterSet(float customLoadFactor) {
    return new HashSet&lt;&gt;(KNOWN_CAPACITY, customLoadFactor);
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Hash-based collections with known capacity should be initialized with the proper related static method.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/HashMap.html#newHashMap(int">https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/HashMap.html#newHashMap(int</a>) </li>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/HashSet.html#newHashSet(int">https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/HashSet.html#newHashSet(int</a>) </li>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/LinkedHashMap.html#newLinkedHashMap(int">https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/LinkedHashMap.html#newLinkedHashMap(int</a>) </li>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/LinkedHashSet.html#newLinkedHashSet(int">https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/LinkedHashSet.html#newLinkedHashSet(int</a>) </li>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/WeakHashMap.html#newWeakHashMap(int">https://docs.oracle.com/en/java/javase/19/docs/api/java.base/java/util/WeakHashMap.html#newWeakHashMap(int</a>) </li>
</ul>
<p>Message:<br> Replace this call to the constructor with the better suited static method.</p>
<p>Highlighting:<br> The infringing constructor call.</p></p>
            </div>
        <div class="rule">
            <h3>Parentheses should be removed from a single lambda parameter when its type is inferred (java:S1611)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Lambda expressions with only one argument with an inferred type (i.e., no explicit type declaration) can be written without parentheses around that
single parameter. This syntax is simpler, more compact and readable than using parentheses and is therefore preferred.</p>
<p>This rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>8</code>, as lambda expressions were
introduced in Java 8.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
(x) -&gt; x * 2
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
x -&gt; x * 2
</pre></p>
            </div>
        <div class="rule">
            <h3>Lambdas should be replaced with method references (java:S1612)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Refer to the called method by its reference instead of wrapping it in a lambda expression.</p>
<p>For instance:</p>
<ul>
  <li> <code>null</code> checks can be replaced with references to <code>Objects::isNull</code> and <code>Objects::nonNull</code> </li>
  <li> Casts can be replaced with <code>SomeClass.class::cast</code> </li>
  <li> <code>instanceof</code> can be replaced with <code>SomeClass.class::isInstance</code> </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class A {
  void process(List&lt;A&gt; list) {
    list.stream()
      .filter(myListValue -&gt; myListValue instanceof B)     // Noncompliant
      .map(listValueToMap -&gt; (B) listValueToMap)           // Noncompliant
      .map(bValueToMap -&gt; bValueToMap.&lt;String&gt;getObject()) // Noncompliant
      .forEach(o -&gt; System.out.println(o));                // Noncompliant
  }
}

class B extends A {
  &lt;T&gt; T getObject() {
    return null;
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class A {
  void process(List&lt;A&gt; list) {
    list.stream()
      .filter(B.class::isInstance)   // Compliant
      .map(B.class::cast)            // Compliant
      .map(B::&lt;String&gt;getObject)     // Compliant
      .forEach(System.out::println); // Compliant
  }
}

class B extends A {
  &lt;T&gt; T getObject() {
    return null;
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html">Method References - The Java™ Tutorials</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Method or constructor references are more readable than lambda expressions in many situations, and may therefore be preferred.</p>
<p>However, method references are sometimes less concise than lambdas. In such cases, it might be preferrable to keep the lambda expression for better
readability. Therefore, this rule only raises issues on lambda expressions where the replacement method reference is shorter.</p>
<p>This rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>8</code>, as lambda expressions were
introduced in Java 8.</p></p>
            </div>
        <div class="rule">
            <h3>Unused assignments should be removed (java:S1854)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Remove the unnecesarry assignment, then test the code to make sure that the right-hand side of a given assignment had no side effects (e.g. a
method that writes certain data to a file and returns the number of written bytes).</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
int foo(int y) {
  int x = 100; // Noncompliant: dead store
  x = 150;     // Noncompliant: dead store
  x = 200;
  return x + y;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
int foo(int y) {
  int x = 200; // Compliant: no unnecessary assignment
  return x + y;
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Dead stores refer to assignments made to local variables that are subsequently never used or immediately overwritten. Such assignments are
unnecessary and don’t contribute to the functionality or clarity of the code. They may even negatively impact performance. Removing them enhances code
cleanliness and readability. Even if the unnecessary operations do not do any harm in terms of the program’s correctness, they are - at best - a waste
of computing resources.</p>
<h3>Exceptions</h3>
<p>This rule ignores initializations to <code>-1</code>, <code>0</code>, <code>1</code>, <code>null</code>, <code>true</code>, <code>false</code> and
<code>""</code>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/563">CWE-563 - Assignment to Variable without Use ('Unused Variable')</a> </li>
</ul>
<h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS2583'>S2583</a> - Conditionally executed code should be reachable </li>
  <li> <a href='/coding_rules#rule_key=java%3AS2589'>S2589</a> - Boolean expressions should not be gratuitous </li>
  <li> <a href='/coding_rules#rule_key=java%3AS3516'>S3516</a> - Methods returns should not be invariant </li>
  <li> <a href='/coding_rules#rule_key=java%3AS3626'>S3626</a> - Jump statements should not be redundant </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"toString()" should never be called on a String object (java:S1858)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Invoking a method designed to return a string representation of an object which is already a string is a waste of keystrokes. This redundant
construction may be optimized by the compiler, but will be confusing in the meantime.</p>
<h3>Noncompliant code example</h3>
<pre>
String message = "hello world";
System.out.println(message.toString()); // Noncompliant;
</pre>
<h3>Compliant solution</h3>
<pre>
String message = "hello world";
System.out.println(message);
</pre></p>
            </div>
        <div class="rule">
            <h3>Synchronization should not be done on instances of value-based classes (java:S1860)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace instances of value-based classes with a new object instance to synchronize on.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
private static final Boolean bLock = Boolean.FALSE;
private static final Integer iLock = Integer.valueOf(0);
private static final String sLock = "LOCK";
private static final List&lt;String&gt; listLock = List.of("a", "b", "c", "d");

public void doSomething() {

  synchronized(bLock) {  // Noncompliant
      ...
  }
  synchronized(iLock) {  // Noncompliant
      ...
  }
  synchronized(sLock) {  // Noncompliant
      ...
  }
  synchronized(listLock) {  // Noncompliant
      ...
  }
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
private static final Object lock1 = new Object();
private static final Integer iLock = new Integer(42);
private static final String sLock = new String("A brand new string in memory!");
private static final List&lt;String&gt; listLock = new ArrayList&lt;&gt;();

public void doSomething() {

  synchronized(lock1) { // Compliant
      ...
  }
  synchronized(iLock) { // Compliant
      ...
  }
  synchronized(sLock) { // Compliant
      ...
  }
  synchronized(listLock) { // Compliant
      ...
  }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/1zdGBQ">Do not synchronize on objects that may be reused</a> </li>
  <li> OpenJDK - <a href="https://openjdk.java.net/jeps/390">JEP 390: Warnings for Value-Based Classes</a> </li>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/doc-files/ValueBased.html">Value-based
  Classes</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Java, value-based classes are those for which instances are final and immutable, like <code>String</code>, <code>Integer</code> and so on, and
their identity relies on their value and not their reference. When a variable of one of these types is instantiated, the JVM caches its value, and the
variable is just a reference to that value. For example, multiple <code>String</code> variables with the same value "Hello world!" will refer to the
same cached string literal in memory.</p>
<p>The <code>synchronized</code> keyword tells the JVM to only allow the execution of the code contained in the following block to one
<code>Thread</code> at a time. This mechanism relies on the identity of the object that is being synchronized between threads, to prevent that if
object X is locked, it will still be possible to lock another object Y.</p>
<p>It means that the JVM will fail to correctly synchronize threads on instances of the aforementioned value-based classes, for instance:</p>
<pre>
// These variables "a" and "b" will effectively reference the same object in memory
Integer a = 0;
Integer b = 0;

// This means that in the following code, the JVM could try to lock and execute
// on the variable "a" because "b" was notified to be released, as the two Integer variables
// are the same object to the JVM
void syncMethod(int x) {
    synchronized (a) {
        if (a == x) {
        // ... do something here
        }
    }
    synchronized (b) {
        if (b == x) {
        // ... do something else
        }
    }
}
</pre>
<p>This behavior can cause unrelated threads to deadlock with unclear stacktraces.</p>
<p>Within the JDK, types which should not be used for synchronization include:</p>
<ul>
  <li> <code>String</code> literals </li>
  <li> Primitive wrapper classes in <code>java.lang</code> (such as <code>Boolean</code> with <code>Boolean.FALSE</code> and
  <code>Boolean.TRUE</code>) </li>
  <li> The class <code>java.lang.Runtime.Version</code> </li>
  <li> The <code>Optional*</code> classes in <code>java.util</code>: <code>Optional</code>, <code>OptionalInt</code>, <code>OptionalLong</code>, and
  <code>OptionalDouble</code> </li>
  <li> Various classes in the <code>java.time</code> API: <code>Instant</code>, <code>LocalDate</code>, <code>LocalTime</code>,
  <code>LocalDateTime</code>, <code>ZonedDateTime</code>, <code>ZoneId</code>, <code>OffsetTime</code>, <code>OffsetDateTime</code>,
  <code>ZoneOffset</code>, <code>Duration</code>, <code>Period</code>, <code>Year</code>, <code>YearMonth</code>, and <code>MonthDay</code> </li>
  <li> Various classes in the <code>java.time.chrono</code> API: <code>MinguoDate</code>, <code>HijrahDate</code>, <code>JapaneseDate</code>, and
  <code>ThaiBuddhistDate</code> </li>
  <li> The interface <code>java.lang.ProcessHandle</code> and its implementation classes </li>
  <li> The implementation classes of the collection factories in <code>java.util</code>: <code>List.of</code>, <code>List.copyOf</code>,
  <code>Set.of</code>, <code>Set.copyOf</code>, <code>Map.of</code>, <code>Map.copyOf</code>, <code>Map.ofEntries</code>, and <code>Map.entry</code>.
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Related "if/else if" statements should not have the same condition (java:S1862)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/5dUxBQ">CERT, MSC12-C.</a> - Detect and remove code that has no effect or is never executed
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A chain of <code>if</code>/<code>else if</code> statements is evaluated from top to bottom. At most, only one branch will be executed: the first
one with a condition that evaluates to <code>true</code>.</p>
<p>Therefore, duplicating a condition automatically leads to dead code. Usually, this is due to a copy/paste error. At best, it’s simply dead code and
at worst, it’s a bug that is likely to induce further bugs as the code is maintained, and obviously it could lead to unexpected behavior.</p>
<h3>Noncompliant code example</h3>
<pre>
if (param == 1)
  openWindow();
else if (param == 2)
  closeWindow();
else if (param == 1)  // Noncompliant
  moveWindowToTheBackground();
}
</pre>
<h3>Compliant solution</h3>
<pre>
if (param == 1)
  openWindow();
else if (param == 2)
  closeWindow();
else if (param == 3)
  moveWindowToTheBackground();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Exceptions should not be thrown from servlet methods (java:S1989)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Articles &amp; blog posts</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/600">CWE-600 - Uncaught Exception in Servlet</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/-zZGBQ">CERT, ERR01-J.</a> - Do not allow exceptions to expose sensitive information </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Servlets are components in Java web development, responsible for processing HTTP requests and generating responses. In this context, exceptions are
used to handle and manage unexpected errors or exceptional conditions that may occur during the execution of a servlet.</p>
<p>Catching exceptions within the servlet allows us to convert them into meaningful, user-friendly messages. Otherwise, failing to catch exceptions
will propagate them to the servlet container, where the default error-handling mechanism may impact the overall security and stability of the
server.</p>
<p>Possible security problems are:</p>
<ol>
  <li> <strong>Vulnerability to denial-of-service attacks:</strong> Not caught exceptions can leave the servlet container in an unstable state, which
  can exhaust the available resources and make the system unavailable in the worst cases. </li>
  <li> <strong>Exposure of sensitive information:</strong> Exceptions handled by the servlet container, by default, expose detailed error messages or
  debugging information to the user, which may contain sensitive data such as stack traces, database connection, or system configuration. </li>
</ol>
<p>Unfortunately, servlet method signatures do not force developers to handle <code>IOException</code> and <code>ServletException</code>:</p>
<pre>
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
}
</pre>
<p>To prevent this risk, this rule enforces all exceptions to be caught within the "do*" methods of servlet classes.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Surround all method calls that may throw an exception with a <code>try/catch</code> block.</p>

<p>In the following example, the <code>getByName</code> method may throw an <code>UnknownHostException</code>.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
  InetAddress addr = InetAddress.getByName(request.getRemoteAddr()); // Noncompliant
  //...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {
  try {
    InetAddress addr = InetAddress.getByName(request.getRemoteAddr());
    //...
  }
  catch (UnknownHostException ex) {  // Compliant
    //...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Literal boolean values and nulls should not be used in assertions (java:S2701)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There’s no reason to use literal boolean values or nulls in assertions. Instead of using them with <em>assertEquals</em>, <em>assertNotEquals</em>
and similar methods, you should be using <em>assertTrue</em>, <em>assertFalse</em>, <em>assertNull</em> or <em>assertNotNull</em> instead (or
<em>isNull</em> etc. when using Fest). Using them with assertions unrelated to equality (such as <em>assertNull</em>) is most likely a bug.</p>
<p>Supported frameworks:</p>
<ul>
  <li> JUnit3 </li>
  <li> JUnit4 </li>
  <li> JUnit5 </li>
  <li> Fest assert </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
Assert.assertTrue(true);  // Noncompliant
assertThat(null).isNull(); // Noncompliant

assertEquals(true, something()); // Noncompliant
assertNotEquals(null, something()); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
assertTrue(something());
assertNotNull(something());
</pre></p>
            </div>
        <div class="rule">
            <h3>"DateUtils.truncate" from Apache Commons Lang library should not be used (java:S2718)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>ZonedDateTime</code> is an immutable representation of a date-time with a time-zone, introduced in Java 8. This class stores all date and
time fields, to a precision of nanoseconds, and a time zone, with a zone offset used to handle ambiguous local date times.</p>
<p>Date truncation to a specific time unit means setting the values up to the specific time unit to zero while keeping the values of the larger time
units unchanged.</p>
<p>The <code>ZonedDateTime</code> class provides a <code>truncatedTo</code> method that allows truncating the date in a significantly faster way than
the <code>DateUtils</code> class from Commons Lang.</p>
<p><strong>Note</strong> that this rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>8</code>.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public Date trunc(Date date) {
  return DateUtils.truncate(date, Calendar.SECOND);  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public Date trunc(Date date) {
  Instant instant = date.toInstant();
  ZonedDateTime zonedDateTime = instant.atZone(ZoneId.systemDefault());
  ZonedDateTime truncatedZonedDateTime = zonedDateTime.truncatedTo(ChronoUnit.SECONDS);
  Instant truncatedInstant = truncatedZonedDateTime.toInstant();
  return Date.from(truncatedInstant);
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/time/ZonedDateTime.html#truncatedTo(java.time.temporal.TemporalUnit)">Oracle
  SDK 20 - ZonedDateTime#truncatedTo</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Unnecessary semicolons should be omitted (java:S2959)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Under the reasoning that cleaner code is better code, the semicolon at the end of a try-with-resources construct should be omitted because it can
be omitted.</p>
<h3>Noncompliant code example</h3>
<pre>
try (ByteArrayInputStream b = new ByteArrayInputStream(new byte[10]);  // ignored; this one's required
      Reader r = new InputStreamReader(b);)   // Noncompliant
{
   //do stuff
}
</pre>
<h3>Compliant solution</h3>
<pre>
try (ByteArrayInputStream b = new ByteArrayInputStream(new byte[10]);
      Reader r = new InputStreamReader(b))
{
   //do stuff
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Expanding archive files without controlling resource consumption is security-sensitive (java:S5042)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Compliant Solution</h2>
<p>Do not rely on <a href="https://docs.oracle.com/javase/7/docs/api/java/util/zip/ZipEntry.html#getSize()">getsize</a> to retrieve the size of an
uncompressed entry because this method returns what is defined in the archive headers which can be forged by attackers, instead calculate the actual
entry size when unzipping it:</p>
<pre>
File f = new File("ZipBomb.zip");
ZipFile zipFile = new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();

int THRESHOLD_ENTRIES = 10000;
int THRESHOLD_SIZE = 1000000000; // 1 GB
double THRESHOLD_RATIO = 10;
int totalSizeArchive = 0;
int totalEntryArchive = 0;

while(entries.hasMoreElements()) {
  ZipEntry ze = entries.nextElement();
  InputStream in = new BufferedInputStream(zipFile.getInputStream(ze));
  OutputStream out = new BufferedOutputStream(new FileOutputStream("./output_onlyfortesting.txt"));

  totalEntryArchive ++;

  int nBytes = -1;
  byte[] buffer = new byte[2048];
  int totalSizeEntry = 0;

  while((nBytes = in.read(buffer)) &gt; 0) { // Compliant
      out.write(buffer, 0, nBytes);
      totalSizeEntry += nBytes;
      totalSizeArchive += nBytes;

      double compressionRatio = totalSizeEntry / ze.getCompressedSize();
      if(compressionRatio &gt; THRESHOLD_RATIO) {
        // ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
        break;
      }
  }

  if(totalSizeArchive &gt; THRESHOLD_SIZE) {
      // the uncompressed data size is too much for the application resource capacity
      break;
  }

  if(totalEntryArchive &gt; THRESHOLD_ENTRIES) {
      // too much entries in this archive, can lead to inodes exhaustion of the system
      break;
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.+Safely+extract+files+from+ZipInputStream">CERT, IDS04-J.</a> - Safely
  extract files from ZipInputStream </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
File f = new File("ZipBomb.zip");
ZipFile zipFile = new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries(); // Sensitive

while(entries.hasMoreElements()) {
  ZipEntry ze = entries.nextElement();
  File out = new File("./output_onlyfortesting.txt");
  Files.copy(zipFile.getInputStream(ze), out.toPath(), StandardCopyOption.REPLACE_EXISTING);
}
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Successful Zip Bomb attacks occur when an application expands untrusted archive files without controlling the size of the expanded data, which can
lead to denial of service. A Zip bomb is usually a malicious archive file of a few kilobytes of compressed data but turned into gigabytes of
uncompressed data. To achieve this extreme <a href="https://en.wikipedia.org/wiki/Data_compression_ratio">compression ratio</a>, attackers will
compress irrelevant data (eg: a long string of repeated bytes).</p>
<h2>Ask Yourself Whether</h2>
<p>Archives to expand are untrusted and:</p>
<ul>
  <li> There is no validation of the number of entries in the archive. </li>
  <li> There is no validation of the total size of the uncompressed data. </li>
  <li> There is no validation of the ratio between the compressed and uncompressed archive entry. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Define and control the ratio between compressed and uncompressed data, in general the data compression ratio for most of the legit archives is
  1 to 3. </li>
  <li> Define and control the threshold for maximum total size of the uncompressed data. </li>
  <li> Count the number of file entries extracted from the archive and abort the extraction if their number is greater than a predefined threshold, in
  particular it’s not recommended to recursively expand archives (an entry of an archive could be also an archive). </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
File f = new File("ZipBomb.zip");
ZipFile zipFile = new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries(); // Sensitive

while(entries.hasMoreElements()) {
  ZipEntry ze = entries.nextElement();
  File out = new File("./output_onlyfortesting.txt");
  Files.copy(zipFile.getInputStream(ze), out.toPath(), StandardCopyOption.REPLACE_EXISTING);
}
</pre>
<h2>Compliant Solution</h2>
<p>Do not rely on <a href="https://docs.oracle.com/javase/7/docs/api/java/util/zip/ZipEntry.html#getSize()">getsize</a> to retrieve the size of an
uncompressed entry because this method returns what is defined in the archive headers which can be forged by attackers, instead calculate the actual
entry size when unzipping it:</p>
<pre>
File f = new File("ZipBomb.zip");
ZipFile zipFile = new ZipFile(f);
Enumeration&lt;? extends ZipEntry&gt; entries = zipFile.entries();

int THRESHOLD_ENTRIES = 10000;
int THRESHOLD_SIZE = 1000000000; // 1 GB
double THRESHOLD_RATIO = 10;
int totalSizeArchive = 0;
int totalEntryArchive = 0;

while(entries.hasMoreElements()) {
  ZipEntry ze = entries.nextElement();
  InputStream in = new BufferedInputStream(zipFile.getInputStream(ze));
  OutputStream out = new BufferedOutputStream(new FileOutputStream("./output_onlyfortesting.txt"));

  totalEntryArchive ++;

  int nBytes = -1;
  byte[] buffer = new byte[2048];
  int totalSizeEntry = 0;

  while((nBytes = in.read(buffer)) &gt; 0) { // Compliant
      out.write(buffer, 0, nBytes);
      totalSizeEntry += nBytes;
      totalSizeArchive += nBytes;

      double compressionRatio = totalSizeEntry / ze.getCompressedSize();
      if(compressionRatio &gt; THRESHOLD_RATIO) {
        // ratio between compressed and uncompressed data is highly suspicious, looks like a Zip Bomb Attack
        break;
      }
  }

  if(totalSizeArchive &gt; THRESHOLD_SIZE) {
      // the uncompressed data size is too much for the application resource capacity
      break;
  }

  if(totalEntryArchive &gt; THRESHOLD_ENTRIES) {
      // too much entries in this archive, can lead to inodes exhaustion of the system
      break;
  }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/409">CWE-409 - Improper Handling of Highly Compressed Data (Data Amplification)</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/IDS04-J.+Safely+extract+files+from+ZipInputStream">CERT, IDS04-J.</a> - Safely
  extract files from ZipInputStream </li>
  <li> <a href="https://www.bamsoftware.com/hacks/zipbomb/">bamsoftware.com</a> - A better Zip Bomb </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Call to Mockito method "verify", "when" or "given" should be simplified (java:S6068)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Mockito provides <em>argument matchers</em> for flexibly stubbing or verifying method calls.</p>
<p><code>Mockito.verify()</code>, <code>Mockito.when()</code>, <code>Stubber.when()</code> and <code>BDDMockito.given()</code> each have overloads
with and without argument matchers.</p>
<p>However, the default matching behavior (i.e. without argument matchers) uses <code>equals()</code>. If only the matcher
<code>org.mockito.ArgumentMatchers.eq()</code> is used, the call is equivalent to the call without matchers, i.e. the <code>eq()</code> is not
necessary and can be omitted. The resulting code is shorter and easier to read.</p>
<h3>Noncompliant code example</h3>
<pre>
@Test
public void myTest() {
  given(foo.bar(eq(v1), eq(v2), eq(v3))).willReturn(null);   // Noncompliant
  when(foo.baz(eq(v4), eq(v5))).thenReturn("foo");   // Noncompliant
  doThrow(new RuntimeException()).when(foo).quux(eq(42));    // Noncompliant
  verify(foo).bar(eq(v1), eq(v2), eq(v3));   // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
@Test
public void myTest() {
  given(foo.bar(v1, v2, v3)).willReturn(null);
  when(foo.baz(v4, v5)).thenReturn("foo");
  doThrow(new RuntimeException()).when(foo).quux(42);
  verify(foo).bar(v1, v2, v3);
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html#argument_matchers">Mockito documentation</a> -
  argument matchers </li>
  <li> <a href='/coding_rules#rule_key=java%3AS6073'>S6073</a> - Mockito argument matchers should be used on all parameters </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>XML parsers should not be vulnerable to Denial of Service attacks (java:S6376)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="3" data-diff-type="noncompliant">
import org.jdom2.input.SAXBuilder;

SAXBuilder builder = new SAXBuilder();
builder.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false);  // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
import org.jdom2.input.SAXBuilder;

SAXBuilder builder = new SAXBuilder();
builder.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/parsers/DocumentBuilderFactory.html">DocumentBuilderFactory Class</a>
  </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/parsers/SAXParserFactory.html">SAXParserFactory Class</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/validation/SchemaFactory.html">SchemaFactory Class</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.xml/javax/xml/transform/TransformerFactory.html">TransformerFactory Class</a> </li>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/21/security/java-api-xml-processing-jaxp-security-guide.html">Java API for
  XML Processing (JAXP) Security Guide</a> </li>
  <li> Dom4j Documentation - <a href="https://dom4j.github.io/javadoc/2.1.4/org/dom4j/io/SAXReader.html">SAXReader Class</a> </li>
  <li> Jdom2 Documentation - <a href="https://javadoc.io/static/org.jdom/jdom2/2.0.6.1/org/jdom2/input/SAXBuilder.html">SAXBuilder class</a> </li>
  <li> OWASP - <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java">XXE Prevention Cheat
  Sheet</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A4_2017-XML_External_Entities_(XXE)">Top 10 2017 Category A4 - XML External
  Entities (XXE)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/776">CWE-776 - Improper Restriction of Recursive Entity References in DTDs ('XML Entity
  Expansion')</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222593">Application Security and
  Development: V-222593</a> - XML-based applications must mitigate DoS attacks by using XML filters, parser options, or gateways. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222667">Application Security and
  Development: V-222667</a> - Protections against DoS attacks must be implemented. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222608">Application Security and
  Development: V-222608</a> - The application must not be vulnerable to XML-oriented attacks. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>XML files are complex data structures. When a malicious user is able to submit an XML file, it triggers complex processing that may overwhelm the
parser. Most of the time, those complex processing are enabled by default, and XML parsers do not take preventive measures against Denial of Service
attacks.</p>
<h3>What is the potential impact?</h3>
<p>When an attacker successfully exploits the vulnerability, it can lead to a Denial of Service (DoS) condition.</p>
<h3>System Unavailability</h3>
<p>Affected system becomes unresponsive or crashes, rendering it unavailable to legitimate users. This can have severe consequences, especially for
critical systems that rely on continuous availability, such as web servers, APIs, or network services.</p>
<h3>Amplification Attacks</h3>
<p>In some cases, XML parsers Denial of Service attacks can be used as a part of larger-scale amplification attacks. By leveraging the vulnerability,
attackers can generate a disproportionately large response from the targeted system, amplifying the impact of their attack. This can result in
overwhelming network bandwidth and causing widespread disruption.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>XML parsers Denial of Service attacks target XML parsers, which are software components responsible for parsing and interpreting XML documents.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.xml.parsers.DocumentBuilderFactory;

DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import javax.xml.parsers.DocumentBuilderFactory;

DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
</pre></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
import org.dom4j.io.SAXReader;

SAXReader xmlReader = new SAXReader();
xmlReader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, false); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
import org.dom4j.io.SAXReader;

SAXReader xmlReader = new SAXReader();
xmlReader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);
</pre></p>
            </div>
        <div class="rule">
            <h3>"String.isEmpty()" should be used to test for emptiness (java:S7158)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#isEmpty()">java.lang.String.isEmpty() method</a>
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Calling <code>String.isEmpty()</code> clearly communicates the code’s intention, which is to test if the string is empty. Using
<code>String.length() == 0</code> is less direct and makes the code less readable.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
if ("string".length() == 0) { /* … */ } // Noncompliant

if ("string".length() &gt; 0) { /* … */ } // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
if ("string".isEmpty()){ /* … */ }

if (!"string".isEmpty()){ /* … */ }
</pre></p>
            </div>
        <div class="rule">
            <h3>Track comments matching a regular expression (java:S124)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule template can be used to create rules which will be triggered when the full content of a comment matches a given regular expression. Note
that the regular expression should be expressed using the dotall format (where the <code>.</code> character matches any character).</p>
<p>For example, one can create a rule with the regular expression <code>.*REVIEW.*</code> to match all comment containing "REVIEW".</p>
<p>Note that, in order to match REVIEW regardless of the case, the <code>(?i)</code> modifier should be prepended to the expression, as in
<code>(?i).*REVIEW.*</code>.</p></p>
            </div>
        <div class="rule">
            <h3>Sections of code should not be commented out (java:S125)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Commented-out code distracts the focus from the actual executed code. It creates a noise that increases maintenance code. And because it is never
executed, it quickly becomes out of date and invalid.</p>
<p>Commented-out code should be deleted and can be retrieved from source control history if required.</p></p>
            </div>
        <div class="rule">
            <h3>"if ... else if" constructs should end with "else" clauses (java:S126)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule applies whenever an <code>if</code> statement is followed by one or more <code>else if</code> statements; the final <code>else if</code>
should be followed by an <code>else</code> statement.</p>
<p>The requirement for a final <code>else</code> statement is defensive programming.</p>
<p>The <code>else</code> statement should either take appropriate action or contain a suitable comment as to why no action is taken. This is
consistent with the requirement to have a final <code>default</code> clause in a <code>switch</code> statement.</p>
<h3>Noncompliant code example</h3>
<pre>
if (x == 0) {
  doSomething();
} else if (x == 1) {
  doSomethingElse();
}
</pre>
<h3>Compliant solution</h3>
<pre>
if (x == 0) {
  doSomething();
} else if (x == 1) {
  doSomethingElse();
} else {
  throw new IllegalStateException();
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/RtYxBQ">CERT, MSC01-C.</a> - Strive for logical completeness </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/jzZGBQ">CERT, MSC57-J.</a> - Strive for logical completeness </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"for" loop stop conditions should be invariant (java:S127)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>for</code> loop termination condition should test the loop counter against an invariant value that does not change during the execution of
the loop. Invariant termination conditions make the program logic easier to understand and maintain.</p>
<p>This rule tracks three types of non-invariant termination conditions:</p>
<ul>
  <li> When the loop counters are updated in the body of the <code>for</code> loop </li>
  <li> When the termination condition depends on a method call </li>
  <li> When the termination condition depends on an object property since such properties could change during the execution of the loop. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>Make the termination condition invariant by using a constant or a local variable instead of an expression that could change during the execution of
the loop.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
for (int i = 0; i &lt; foo(); i++) { // Noncompliant, "foo()" is not an invariant
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
int end = foo();
for (int i = 0; i &lt; end; i++) { // Compliant, "end" does not change during loop execution
  // ...
}
</pre>
<h4>Noncompliant code example</h4>
<p>If this is impossible and the counter variable must be updated in the loop’s body, use a <code>while</code> or <code>do</code> <code>while</code>
loop instead of a <code>for</code> loop.</p>
<pre data-diff-id="2" data-diff-type="noncompliant">
for (int i = 0; i &lt; 10; i++) {
  // ...
  if (condition) i++; // Noncompliant, i is updated from within body
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
int i = 0;
while (i++ &lt; 10) { // Compliant
  // ...
  if (condition) sum++;
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Switch cases should end with an unconditional "break" statement (java:S128)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/484">CWE-484 - Omitted Break Statement in Switch</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ldYxBQ">CERT, MSC17-C.</a> - Finish every set of statements associated with a case label with a
  break statement </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/1DdGBQ">CERT, MSC52-J.</a> - Finish every set of statements associated with a case label with a
  break statement </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When the execution is not explicitly terminated at the end of a switch case, it continues to execute the statements of the following case. While
this is sometimes intentional, it often is a mistake which leads to unexpected behavior.</p>
<h3>Noncompliant code example</h3>
<pre>
switch (myVariable) {
  case 1:
    foo();
    break;
  case 2:  // Both 'doSomething()' and 'doSomethingElse()' will be executed. Is it on purpose ?
    doSomething();
  default:
    doSomethingElse();
    break;
}
</pre>
<h3>Compliant solution</h3>
<pre>
switch (myVariable) {
  case 1:
    foo();
    break;
  case 2:
    doSomething();
    break;
  default:
    doSomethingElse();
    break;
}
</pre>
<h3>Exceptions</h3>
<p>This rule is relaxed in the following cases:</p>
<pre>
switch (myVariable) {
  case 0:                                // Empty case used to specify the same behavior for a group of cases.
  case 1:
    doSomething();
    break;
  case 2:                                // Use of a fallthrough comment
    // fallthrough
  case 3:                                // Use of return statement
    return;
  case 4:                                // Use of throw statement
    throw new IllegalStateException();
  case 5:                                // Use of continue statement
    continue;
  default:                               // For the last case, use of break statement is optional
    doSomethingElse();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"switch" statements should have "default" clauses (java:S131)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The requirement for a final <code>default</code> clause is defensive programming. The clause should either take appropriate action, or contain a
suitable comment as to why no action is taken.</p>
<h3>Noncompliant code example</h3>
<pre>
switch (param) {  //missing default clause
  case 0:
    doSomething();
    break;
  case 1:
    doSomethingElse();
    break;
}

switch (param) {
  default: // default clause should be the last one
    error();
    break;
  case 0:
    doSomething();
    break;
  case 1:
    doSomethingElse();
    break;
}
</pre>
<h3>Compliant solution</h3>
<pre>
switch (param) {
  case 0:
    doSomething();
    break;
  case 1:
    doSomethingElse();
    break;
  default:
    error();
    break;
}
</pre>
<h3>Exceptions</h3>
<p>If the <code>switch</code> parameter is an <code>Enum</code> and if all the constants of this enum are used in the <code>case</code> statements,
then no <code>default</code> clause is expected.</p>
<p>Example:</p>
<pre>
public enum Day {
    SUNDAY, MONDAY
}
...
switch(day) {
  case SUNDAY:
    doSomething();
    break;
  case MONDAY:
    doSomethingElse();
    break;
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/478">CWE-478 - Missing Default Case in Switch Statement</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/RtYxBQ">CERT, MSC01-C.</a> - Strive for logical completeness </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Control flow statements "if", "for", "while", "switch" and "try" should not be nested too deeply (java:S134)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://en.wikipedia.org/wiki/Guard_(computer_science)">Guard clauses in programming</a> - one of the approaches to reducing the depth
  of nesting </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following example demonstrates the behavior of the rule with the default threshold of 3 levels of nesting and one of the potential ways to fix
the code smell by introducing guard clauses:</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
if (condition1) {                  // Compliant - depth = 1
  /* ... */
  if (condition2) {                // Compliant - depth = 2
    /* ... */
    for (int i = 0; i &lt; 10; i++) {  // Compliant - depth = 3
      /* ... */
      if (condition4) {            // Noncompliant - depth = 4, which exceeds the limit
        if (condition5) {          // Depth = 5, exceeding the limit, but issues are only reported on depth = 4
          /* ... */
        }
        return;
      }
    }
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
if (!condition1) {
  return;
}
/* ... */
if (!condition2) {
  return;
}
for (int i = 0; i &lt; 10; i++) {
  /* ... */
  if (condition4) {
    if (condition5) {
      /* ... */
    }
    return;
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Nested control flow statements such as <code>if</code>, <code>for</code>, <code>while</code>, <code>switch</code>, and <code>try</code> are often
key ingredients in creating what’s known as "Spaghetti code". This code smell can make your program difficult to understand and maintain.</p>
<p>When numerous control structures are placed inside one another, the code becomes a tangled, complex web. This significantly reduces the code’s
readability and maintainability, and it also complicates the testing process.</p></p>
            </div>
        <div class="rule">
            <h3>Anonymous inner classes containing only one method should become lambdas (java:S1604)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html">Lambda Expressions - The Java™ Tutorials</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Before Java 8, the only way to partially support closures in Java was by using anonymous inner classes. Java 8 introduced lambdas, which are
significantly more readable and should be used instead.</p>
<p>This rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>8</code>, as lambda expressions were
introduced in Java 8.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
myCollection.stream().map(new Function&lt;String,String&gt;() { // Noncompliant, use a lambda expression instead
  @Override
  public String apply(String input) {
    return new StringBuilder(input).reverse().toString();
  }
})
  ...
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
myCollection.stream()
  .map(input -&gt; new StringBuilder(input).reverse().toString()) // Compliant
    ...
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
Predicate&lt;String&gt; isEmpty = new Predicate&lt;String&gt;() { // Noncompliant, use a lambda expression instead
  @Override
  public boolean test(String myString) {
    return myString.isEmpty();
  }
};
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
Predicate&lt;String&gt; isEmpty = myString -&gt; myString.isEmpty(); // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>JUnit4 @Ignored and JUnit5 @Disabled annotations should be used to disable tests and should provide a rationale (java:S1607)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a test fails due, for example, to infrastructure issues, you might want to ignore it temporarily. But without some kind of notation about why
the test is being ignored, it may never be reactivated. Such tests are difficult to address without comprehensive knowledge of the project, and end up
polluting their projects.</p>
<p>This rule raises an issue for each ignored test that does not have any comment about why it is being skipped.</p>
<ul>
  <li> For Junit4, this rule targets the @Ignore annotation. </li>
  <li> For Junit5, this rule targets the @Disabled annotation. </li>
  <li> Cases where assumeTrue(false) or assumeFalse(true) are used to skip tests are targeted as well. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
@Ignore  // Noncompliant
@Test
public void testDoTheThing() {
  // ...
</pre>
<p>or</p>
<pre>
@Test
public void testDoTheThing() {
  Assume.assumeFalse(true); // Noncompliant
  // ...
</pre>
<h3>Compliant solution</h3>
<pre>
@Test
@Ignore("See Ticket #1234")
public void testDoTheThing() {
  // ...
</pre></p>
            </div>
        <div class="rule">
            <h3>Annotation repetitions should not be wrapped (java:S1710)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Before Java 8, a container annotation was required as wrapper to use multiple instances of the same annotation. As of Java 8, this is no longer
necessary. Instead, these annotations should be used directly without a wrapper, resulting in cleaner and more readable code.</p>
<p>This rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>8</code> as repeating annotations were
introduced in Java 8.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@SomeAnnotations({  // Noncompliant, wrapper annotations are not necessary in Java 8+
  @SomeAnnotation(..a..),
  @SomeAnnotation(..b..),
  @SomeAnnotation(..c..),
})
public class SomeClass {
  ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@SomeAnnotation(..a..)
@SomeAnnotation(..b..)
@SomeAnnotation(..c..)
public class SomeClass {
  ...
}
</pre>
<h2>References</h2>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/annotations/repeating.html">Repeating Annotations - The Java™ Tutorials</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Standard functional interfaces should not be redefined (java:S1711)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Just as there is little justification for writing your own String class, there is no good reason to re-define one of the existing, standard
functional interfaces.</p>
<p>Doing so may seem tempting, since it would allow you to specify a little extra context with the name. But in the long run, it will be a source of
confusion, because maintenance programmers will wonder what is different between the custom functional interface and the standard one.</p>
<h3>Noncompliant code example</h3>
<pre>
@FunctionalInterface
public interface MyInterface { // Noncompliant
	double toDouble(int a);
}

@FunctionalInterface
public interface ExtendedBooleanSupplier { // Noncompliant
  boolean get();
  default boolean isFalse() {
    return !get();
  }
}

public class MyClass {
    private int a;
    public double myMethod(MyInterface instance){
	return instance.toDouble(a);
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
@FunctionalInterface
public interface ExtendedBooleanSupplier extends BooleanSupplier { // Compliant, extends java.util.function.BooleanSupplier
  default boolean isFalse() {
    return !getAsBoolean();
  }
}

public class MyClass {
    private int a;
    public double myMethod(IntToDoubleFunction instance){
	return instance.applyAsDouble(a);
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Object.wait" should not be called on objects that implement "java.util.concurrent.locks.Condition" (java:S1844)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>java.util.concurrent.locks.Condition</code> interface provides an alternative to the <code>Object</code> monitor methods
(<code>wait</code>, <code>notify</code> and <code>notifyAll</code>). Hence, the purpose of implementing said interface is to gain access to its more
nuanced <code>await</code> methods.</p>
<p>Consequently, calling the method <code>Object.wait</code> on a class implementing the <code>Condition</code> interface is contradictory and should
be avoided. Use <code>Condition.await</code> instead.</p>
<h2>Code examples</h2>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
void doSomething(Condition condition) {
    condition.wait(); // Noncompliant, Object.wait is called

        ...
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
void doSomething(Condition condition) {
    condition.await(); // Compliant, Condition.await is called

        ...
}
</pre>
<h2>References</h2>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/Condition.html">Interface Condition - Java™ Platform SE 8, API
  Specification</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Methods and field names should not be the same or differ only by capitalization (java:S1845)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when there is a method and a field in a class with names that differ only by capitalization.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Looking at the set of methods in a class, including superclass methods, and finding two methods or fields that differ only by capitalization is
confusing to users of the class. It is similarly confusing to have a method and a field which differ only in capitalization or a method and a field
with exactly the same name and visibility.</p>
<p>In the case of methods, it may have been a mistake on the part of the original developer, who intended to override a superclass method, but instead
added a new method with nearly the same name.</p>
<p>Otherwise, this situation simply indicates poor naming. Method names should be action-oriented, and thus contain a verb, which is unlikely in the
case where both a method and a member have the same name (with or without capitalization differences). However, renaming a public method could be
disruptive to callers. Therefore renaming the member is the recommended action.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Car{

  public DriveTrain drive;

  public void tearDown(){...}

  public void drive() {...}  // Noncompliant; duplicates field name
}

public class MyCar extends Car{
  public void teardown(){...}  // Noncompliant; not an override. It it really what's intended?

  public void drivefast(){...}

  public void driveFast(){...} //Huh?
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Car{

  private DriveTrain drive;

  public void tearDown(){...}

  public void drive() {...}  // field visibility reduced
}

public class MyCar extends Car{
  @Override
  public void tearDown(){...}

  public void drivefast(){...}

  public void driveReallyFast(){...}

}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Iterator.hasNext()" should not call "Iterator.next()" (java:S1849)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/Iterator.html">Interface Iterator&lt;E&gt; - Java® Platform SE
  11 API Specification</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>How to fix this issue strongly depends on the specific implementation of the iterator. Make sure that the logic of the <code>hasNext()</code>
implementation does not change the state of the iterator or any underlying data sources. Instead, it should merely return state information.</p>
<h2>Code examples</h2>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyIterator implements Iterator&lt;Integer&gt; {

  private Queue&lt;Integer&gt; elements;

    ...

  @Override
  public boolean hasNext() {
    try {
      next(); // Noncompliant, next() is called from hasNext()
      return true;
    } catch (NoSuchElementException e) {
      return false;
    }
  }

  @Override
  public Integer next() {
    return elements.remove();
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
class MyIterator implements Iterator&lt;Integer&gt; {

  private Queue&lt;Integer&gt; elements;

    ...

  @Override
  public boolean hasNext() {
    return !elements.isEmpty(); // Compliant, no call to next()
  }

  @Override
  public Integer next() {
    return elements.remove();
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Calling <code>Iterator.hasNext()</code> is not supposed to have any side effects and hence should not change the iterator’s state.
<code>Iterator.next()</code> advances the iterator by one item. So calling it inside <code>Iterator.hasNext()</code> breaks the <code>hasNext()</code>
contract and will lead to unexpected behavior in production.</p></p>
            </div>
        <div class="rule">
            <h3>JUnit rules should be used (java:S2924)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>JUnit rules are predefined classes that extend the behavior of JUnit tests, allowing to add new functionalities, such as managing resources,
modifying test behavior, and handling exceptions.</p>
<p>Unused JUnit rules can lead to confusion when reading the test code, making tests harder to understand and maintain. Having unused rules can also
slow down the test suite, as JUnit has to process the rules even though they are not being used. Some <code>TestRule</code> classes have the desired
effect without being directly referenced by a test, while others do not. There’s no reason to leave them cluttering the file if they’re not in
use.</p>
<p>The rule raises an issue when in a <code>Test</code> class, there is no method referencing a declared <code>TestRule</code> of the following
types:</p>
<ul>
  <li> <code>TemporaryFolder</code> and <code>TestName</code> in JUnit </li>
  <li> <code>TempDir</code> and <code>TestInfo</code> in JUnit 5 </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://junit.org/junit4/javadoc/4.12/org/junit/Rule.html">Junit API - Rule</a> </li>
  <li> <a href="https://github.com/junit-team/junit4/wiki/Rules">Junit - Rules</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/junit-4-rules">Junit 4 Rules</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Remove the unused <code>TestRule</code> field that is expected to be referenced inside a test method.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ProjectDefinitionTest {

  @Rule
  public TemporaryFolder temp = new TemporaryFolder();  // Noncompliant

  @Test
  public void shouldSetKey() {
    ProjectDefinition def = ProjectDefinition.create();
    def.setKey("mykey");
    assertThat(def.getKey(), is("mykey"));
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ProjectDefinitionTest {

  @Test
  public void shouldSetKey() {
    ProjectDefinition def = ProjectDefinition.create();
    def.setKey("mykey");
    assertThat(def.getKey(), is("mykey"));
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Thread.sleep" should not be used in tests (java:S2925)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In asynchronous testing, the test code is written in a way that allows it to wait for the asynchronous operation to complete before continuing with
the test.</p>
<p>Using <code>Thread.sleep</code> in this case can cause flaky tests, slow test execution, and inaccurate test results. It creates brittle tests that
can fail unpredictably depending on the environment or load.</p>
<p>Use mocks or libraries such as <code>Awaitility</code> instead. These tools provide features such as timeouts, assertions, and error handling to
make it easier to write and manage asynchronous tests.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Test
public void testDoTheThing(){

  MyClass myClass = new MyClass();
  myClass.doTheThing();

  Thread.sleep(500);  // Noncompliant
  // assertions...
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
@Test
public void testDoTheThing(){

  MyClass myClass = new MyClass();
  myClass.doTheThing();

  await().atMost(2, Duration.SECONDS).until(didTheThing());  // Compliant
  // assertions...
}

private Callable&lt;Boolean&gt; didTheThing() {
  return new Callable&lt;Boolean&gt;() {
    public Boolean call() throws Exception {
      // check the condition that must be fulfilled...
    }
  };
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/20/docs/api/java.base/java/lang/Thread.html">Oracle SE 20 - Thread</a> </li>
  <li> <a href="http://www.awaitility.org/">Awaitility</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://www.baeldung.com/java-thread-sleep-vs-awaitility-await">Baeldung - Thread.sleep() vs Awaitility.await()</a> </li>
  <li> <a href="https://www.baeldung.com/awaitility-testing">Baeldung - Awaitility testing</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>All branches in a conditional structure should not have exactly the same implementation (java:S3923)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Having all branches of a <code>switch</code> or <code>if</code> chain with the same implementation indicates a problem.</p>
<p>In the following code:</p>
<pre>
if (b == 0) {  // Noncompliant
  doOneMoreThing();
} else {
  doOneMoreThing();
}

int b = a &gt; 12 ? 4 : 4;  // Noncompliant

switch (i) {  // Noncompliant
  case 1:
    doSomething();
    break;
  case 2:
    doSomething();
    break;
  case 3:
    doSomething();
    break;
  default:
    doSomething();
}
</pre>
<p>Either there is a copy-paste error that needs fixing or an unnecessary <code>switch</code> or <code>if</code> chain that should be removed.</p>
<h3>Exceptions</h3>
<p>This rule does not apply to <code>if</code> chains without <code>else</code>, nor to <code>switch</code> without a <code>default</code> clause.</p>
<pre>
if(b == 0) {    //no issue, this could have been done on purpose to make the code more readable
  doSomething();
} else if(b == 1) {
  doSomething();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Use Java 14 "switch" expression (java:S5194)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Many existing switch statements are essentially simulations of switch expressions, where each arm either assigns to a common target variable or
returns a value. Expressing this as a statement is roundabout, repetitive, and error-prone.</p>
<p>Java 14 added support for switch expressions, which provide more succinct and less error-prone version of switch.</p>
<h3>Noncompliant code example</h3>
<pre>
void day_of_week(DoW day) {
    int numLetters;
    switch (day) {  // Noncompliant
      case MONDAY:
      case FRIDAY:
      case SUNDAY:
        numLetters = 6;
        break;
      case TUESDAY:
        numLetters = 7;
        break;
      case THURSDAY:
      case SATURDAY:
        numLetters = 8;
        break;
      case WEDNESDAY:
        numLetters = 9;
        break;
      default:
        throw new IllegalStateException("Wat: " + day);
    }
}

int return_switch(int x) {
    switch (x) { // Noncompliant
      case 1:
        return 1;
      case 2:
        return 2;
      default:
        throw new IllegalStateException();
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
int numLetters = switch (day) {
    case MONDAY, FRIDAY, SUNDAY -&gt; 6;
    case TUESDAY                -&gt; 7;
    case THURSDAY, SATURDAY     -&gt; 8;
    case WEDNESDAY              -&gt; 9;
};
</pre></p>
            </div>
        <div class="rule">
            <h3>The regex escape sequence \cX should only be used with characters in the @-_ range (java:S6070)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In regular expressions the escape sequence <code>\cX</code>, where the X stands for any character that’s either <code>@</code>, any capital ASCII
letter, <code>[</code>, <code>\</code>, <code>]</code>, <code>^</code> or <code>_</code>, represents the control character that "corresponds" to the
character following <code>\c</code>, meaning the control character that comes 64 bytes before the given character in the ASCII encoding.</p>
<p>In some other regex engines (for example in that of Perl) this escape sequence is case insensitive and <code>\cd</code> produces the same control
character as <code>\cD</code>. Further using <code>\c</code> with a character that’s neither <code>@</code>, any ASCII letter, <code>[</code>,
<code>\</code>, <code>]</code>, <code>^</code> nor <code>_</code>, will produce a warning or error in those engines. Neither of these things is true
in Java, where the value of the character is always XORed with 64 without checking that this operation makes sense. Since this won’t lead to a
sensible result for characters that are outside of the <code>@</code> to <code>_</code> range, using <code>\c</code> with such characters is almost
certainly a mistake.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("\\ca"); // Noncompliant, 'a' is not an upper case letter
Pattern.compile("\\c!"); // Noncompliant, '!' is outside of the '@'-'_' range
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("\\cA"); // Compliant, this will match the "start of heading" control character
Pattern.compile("\\c^"); // Compliant, this will match the "record separator" control character
</pre></p>
            </div>
        <div class="rule">
            <h3>Mockito argument matchers should be used on all parameters (java:S6073)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html#argument_matchers">Mockito documentation</a> -
  argument matchers </li>
  <li> <a href="https://sonarsource.github.io/rspec/#/rspec/<a href='/coding_rules#rule_key=java%3AS6068'>S6068</a>/java"><a href='/coding_rules#rule_key=java%3AS6068'>S6068</a> - Call to Mockito method "verify", "when" or
  "given" should be simplified</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Mockito provides <em>argument matchers</em> and <em>argument captors</em> for flexibly stubbing or verifying method calls.</p>
<p><code>Mockito.verify()</code>, <code>Mockito.when()</code>, <code>Stubber.when()</code> and <code>BDDMockito.given()</code> each have overloads
with and without argument matchers.</p>
<p>However, if argument matchers or captors are used only on some of the parameters, all the parameters need to have matchers as well, otherwise an
<code>InvalidUseOfMatchersException</code> will be thrown.</p>
<p>This rule consequently raises an issue every time matchers are not used on all the parameters of a stubbed/verified method.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Test
public void myTest() {
    // Setting up mock responses
    given(foo.bar(anyInt(), i1, i2)).willReturn(null); // Noncompliant, no matchers for "i1" and "i2"
    when(foo.baz(eq(val1), val2)).thenReturn("hi"); // Noncompliant, no matcher for "val2"

    // Simulating exceptions
    doThrow(new RuntimeException()).when(foo).quux(intThat(x -&gt; x &gt;= 42), -1); // Noncompliant, no matcher for "-1"

    // Verifying method invocations
    verify(foo).bar(i1, anyInt(), i2); // Noncompliant, no matchers for "i1" and "i2"

    // Capturing arguments for verification
    ArgumentCaptor&lt;Integer&gt; captor = ArgumentCaptor.forClass(Integer.class);
    verify(foo).bar(captor.capture(), i1, any()); // Noncompliant, no matchers for "i1"
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Test
public void myTest() {
    // Setting up mock responses
    given(foo.bar(anyInt(), eq(i1), eq(i2))).willReturn(null); // Compliant, all arguments have matchers
    when(foo.baz(val1, val2)).thenReturn("hi"); // Compliant, no argument has matchers

    // Simulating exceptions
    doThrow(new RuntimeException()).when(foo).quux(intThat(x -&gt; x &gt;= 42), eq(-1)); // Compliant, all arguments have matchers

    // Verifying method invocations
    verify(foo).bar(eq(i1), anyInt(), eq(i2)); // Compliant, all arguments have matchers

    // Capturing arguments for verification
    ArgumentCaptor&lt;Integer&gt; captor = ArgumentCaptor.forClass(Integer.class);
    verify(foo).bar(captor.capture(), any(), any()); // Compliant, all arguments have matchers
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Authorizing non-authenticated users to use keys in the Android KeyStore is security-sensitive (java:S6288)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable user authentication (by setting <code>setUserAuthenticationRequired</code> to <code>true</code> during key generation)
to use keys for a limited duration of time (by setting appropriate values to <code>setUserAuthenticationValidityDurationSeconds</code>), after which
the user must re-authenticate.</p>
<h2>Compliant Solution</h2>
<p>The use of the key is limited to authenticated users (for a duration of time defined to 60 seconds):</p>
<pre>
KeyGenerator keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore");

KeyGenParameterSpec builder = new KeyGenParameterSpec.Builder("test_secret_key", KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT)
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .setUserAuthenticationRequired(true)
    .setUserAuthenticationParameters (60, KeyProperties.AUTH_DEVICE_CREDENTIAL)
    .build();

keyGenerator.init(builder)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore">developer.android.com</a> - Android keystore system </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore#UserAuthentication">developer.android.com</a> - Require user
  authentication for key use </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Authentication and Session Management
  Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">Mobile Top 10 2016 Category M4 - Insecure
  Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/522">CWE-522 - Insufficiently Protected Credentials</a> </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>Android KeyStore is a secure container for storing key materials, in particular it prevents key materials extraction, i.e. when the application
process is compromised, the attacker cannot extract keys but may still be able to use them. It’s possible to enable an Android security feature, user
authentication, to restrict usage of keys to only authenticated users. The lock screen has to be unlocked with defined credentials
(pattern/PIN/password, biometric).</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The application requires prohibiting the use of keys in case of compromise of the application process. </li>
  <li> The key material is used in the context of a highly sensitive application like a e-banking mobile app. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to enable user authentication (by setting <code>setUserAuthenticationRequired</code> to <code>true</code> during key generation)
to use keys for a limited duration of time (by setting appropriate values to <code>setUserAuthenticationValidityDurationSeconds</code>), after which
the user must re-authenticate.</p>
<h2>Sensitive Code Example</h2>
<p>Any user can use the key:</p>
<pre>
KeyGenerator keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore");

KeyGenParameterSpec builder = new KeyGenParameterSpec.Builder("test_secret_key_noncompliant", KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT) // Noncompliant
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .build();

keyGenerator.init(builder);
</pre>
<h2>Compliant Solution</h2>
<p>The use of the key is limited to authenticated users (for a duration of time defined to 60 seconds):</p>
<pre>
KeyGenerator keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore");

KeyGenParameterSpec builder = new KeyGenParameterSpec.Builder("test_secret_key", KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT)
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .setUserAuthenticationRequired(true)
    .setUserAuthenticationParameters (60, KeyProperties.AUTH_DEVICE_CREDENTIAL)
    .build();

keyGenerator.init(builder)
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore">developer.android.com</a> - Android keystore system </li>
  <li> <a href="https://developer.android.com/privacy-and-security/keystore#UserAuthentication">developer.android.com</a> - Require user
  authentication for key use </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Authentication and Session Management
  Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">Mobile Top 10 2016 Category M4 - Insecure
  Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/522">CWE-522 - Insufficiently Protected Credentials</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Android KeyStore is a secure container for storing key materials, in particular it prevents key materials extraction, i.e. when the application
process is compromised, the attacker cannot extract keys but may still be able to use them. It’s possible to enable an Android security feature, user
authentication, to restrict usage of keys to only authenticated users. The lock screen has to be unlocked with defined credentials
(pattern/PIN/password, biometric).</p>
</p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The application requires prohibiting the use of keys in case of compromise of the application process. </li>
  <li> The key material is used in the context of a highly sensitive application like a e-banking mobile app. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>Any user can use the key:</p>
<pre>
KeyGenerator keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, "AndroidKeyStore");

KeyGenParameterSpec builder = new KeyGenParameterSpec.Builder("test_secret_key_noncompliant", KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT) // Noncompliant
    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
    .build();

keyGenerator.init(builder);
</pre>
</p>
            </div>
        <div class="rule">
            <h3>Inheritance tree of classes should not be too deep (java:S110)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Inheritance is one of the most valuable concepts in object-oriented programming. It’s a way to categorize and reuse code by creating collections of
attributes and behaviors called classes, which can be based on previously created classes.</p>
<p>But abusing this concept by creating a deep inheritance tree can lead to complex and unmaintainable source code. Often, an inheritance tree
becoming too deep is the symptom of systematic use of "inheritance" when other approaches like "composition" would be better suited.</p>
<p>This rule raises an issue when the inheritance tree, starting from <code>Object</code>, has a greater depth than is allowed.</p>
<p>The rule has one parameter to filter out classes of the count of inheritance. The following rules apply to define this parameter:</p>
<ul>
  <li> <code>?</code> matches a single character </li>
  <li> <code>*</code> matches zero or more characters </li>
  <li> <code>**</code> matches zero or more packages </li>
</ul>
<p>Examples:</p>
<ul>
  <li> <code>java.fwk.AbstractFwkClass</code>: the count stops when AbstractFwkClass class is reached. </li>
  <li> <code>java.fwk.*</code>: any member of java.fwkPackage package is reached. </li>
  <li> <code>java.fwk.**</code>: same as above, but including sub-packages. </li>
</ul>
<h2>Exceptions:</h2>
<p>The rule stops counting when it encounters a class from one of the following packages (or sub-packages):</p>
<ul>
  <li> <code>android.**</code> </li>
  <li> <code>com.intellij.**</code> </li>
  <li> <code>com.persistit.**</code> </li>
  <li> <code>javax.swing.**</code> </li>
  <li> <code>org.eclipse.**</code> </li>
  <li> <code>org.springframework.**</code> </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<p><a href="https://en.wikipedia.org/wiki/Composition_over_inheritance">Composition over inheritance: difference between composition and inheritance
in object-oriented programming</a></p></p>
            </div>
        <div class="rule">
            <h3>Loops should not contain more than a single "break" or "continue" statement (java:S135)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The use of <code>break</code> and <code>continue</code> statements increases the complexity of the control flow and makes it harder to understand
the program logic. In order to keep a good program structure, they should not be applied more than once per loop.</p>
<p>This rule reports an issue when there is more than one <code>break</code> or <code>continue</code> statement in a loop. The code should be
refactored to increase readability if there is more than one.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
for (int i = 1; i &lt;= 10; i++) {     // Noncompliant; two "continue" statements
  if (i % 2 == 0) {
    continue;
  }

  if (i % 3 == 0) {
    continue;
  }
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
for (int i = 1; i &lt;= 10; i++) {
  if (i % 2 == 0 || i % 3 == 0) {
    continue;
  }
  // ...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se20/html/jls-14.html#jls-14.7">Oracle - Labeled Statements</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> <a href="https://softwareengineering.stackexchange.com/questions/185944/java-labels-to-be-or-not-to-be/185945">StackExchange - Java labels. To
  be or not to be</a> </li>
  <li> <a href="https://stackoverflow.com/questions/33689466/labels-in-java-bad-practice">StackOverflow - Labels in Java - bad practice?</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Methods should not have too many lines (java:S138)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A method that grows too large tends to aggregate too many responsibilities. Such method inevitably become harder to understand and therefore harder
to maintain.</p>
<p>Above a specific threshold, it is strongly advised to refactor into smaller methods which focus on well-defined tasks. Those smaller methods will
not only be easier to understand, but also probably easier to test.</p></p>
            </div>
        <div class="rule">
            <h3>Comments should not be located at the end of lines of code (java:S139)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule verifies that single-line comments are not located at the ends of lines of code. The main idea behind this rule is that in order to be
really readable, trailing comments would have to be properly written and formatted (correct alignment, no interference with the visual structure of
the code, not too long to be visible) but most often, automatic code formatters would not handle this correctly: the code would end up less readable.
Comments are far better placed on the previous empty line of code, where they will always be visible and properly formatted.</p>
<h3>Noncompliant code example</h3>
<pre>
int a1 = b + c; // This is a trailing comment that can be very very long
</pre>
<h3>Compliant solution</h3>
<pre>
// This very long comment is better placed before the line of code
int a2 = b + c;
</pre></p>
            </div>
        <div class="rule">
            <h3>Lambdas containing only one statement should not nest this statement in a block (java:S1602)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The right-hand side of a lambda expression can be written in two ways:</p>
<ol>
  <li> Expression notation: the right-hand side is as an expression, such as in <code>(a, b) → a + b</code> </li>
  <li> Block notation: the right-hand side is a conventional function body with a code block and an optional return statement, such as in <code>(a, b)
  → {return a + b;}</code> </li>
</ol>
<p>By convention, expression notation is preferred over block notation. Block notation must be used when the function implementation requires more
than one statement. However, when the code block consists of only one statement (which may or may not be a <code>return</code> statement), it can be
rewritten using expression notation.</p>
<p>This convention exists because expression notation has a cleaner, more concise, functional programming style and is regarded as more readable.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><ul>
  <li> If the code block consists only of a <code>return</code> statement, replace the code block with the argument expression from the
  <code>return</code> statement. </li>
  <li> If the code block consists of a single statement that is not a <code>return</code> statement, replace the code block with that statement. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
(a, b) -&gt; { return a + b; } // Noncompliant, replace code block with expression
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
(a, b) -&gt; a + b             // Compliant
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
x -&gt; {System.out.println(x+1);} // Noncompliant, replace code block with statement
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
x -&gt; System.out.println(x+1)    // Compliant
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a lambda expression uses block notation while expression notation could be used.</p></p>
            </div>
        <div class="rule">
            <h3>JUnit test cases should call super methods (java:S2188)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Overriding a parent class method prevents that method from being called unless an explicit <code>super</code> call is made in the overriding
method. In some cases, not calling the parent method is fine. However, <code>setUp</code> and <code>tearDown</code> provide some shared logic that is
called before all test cases. This logic may change over the lifetime of your codebase. To make sure that your test cases are set up and cleaned up
consistently, your overriding implementations of <code>setUp</code> and <code>tearDown</code> should call the parent implementations explicitly.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Add an explicit call to <code>super.setUp()</code> and <code>super.tearDown()</code> in the overriding methods.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClassTest extends MyAbstractTestCase {

  private MyClass myClass;

  @Override
  protected void setUp() throws Exception {  // Noncompliant
    myClass = new MyClass();
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClassTest extends MyAbstractTestCase {

  private MyClass myClass;

  @Override
  protected void setUp() throws Exception {
    super.setUp();
    myClass = new MyClass();
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Loops should not be infinite (java:S2189)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/lzZGBQ">CERT, MSC01-J.</a> - Do not use an empty infinite loop </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>An infinite loop will never end while the program runs, meaning you have to kill the program to get out of the loop. Every loop should have an end
condition, whether by meeting the loop’s termination condition or via a <code>break</code> statement.</p>
<h3>Noncompliant code example</h3>
<pre>
for (;;) {  // Noncompliant; end condition omitted
  // ...
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
int j;
while (true) { // Noncompliant; end condition omitted
  j++;
}
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
int k;
boolean b = true;
while (b) { // Noncompliant; b never written to in loop
  k++;
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="2" data-diff-type="compliant">
int j;
while (true) { // reachable end condition added
  j++;
  if (j  == Integer.MIN_VALUE) {  // true at Integer.MAX_VALUE +1
    break;
  }
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
int k;
boolean b = true;
while (b) {
  k++;
  b = k &lt; Integer.MAX_VALUE;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Abstract methods should not be redundant (java:S3038)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There’s no point in redundantly defining an <code>abstract</code> method with the same signature as a method in an <code>interface</code> that the
class <code>implements</code>. Any concrete child classes will have to implement the method either way.</p>
<h3>Noncompliant code example</h3>
<pre>
public interface Reportable {
  String getReport();
}

public abstract class AbstractRuleReport implements Reportable{
  public abstract String getReport();  // Noncompliant

  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Indexes to passed to "String" operations should be within the string's bounds (java:S3039)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There are various <code>String</code> operations that take one or more character indexes as arguments and return a portion of the original string.
Indexing in this context is zero-based, meaning that the first character’s index is <code>0</code>. As a result, given a string <code>myString</code>,
its last character is at index <code>myString.length() - 1</code>.</p>
<p>The <code>String</code> operation methods throw a <code>StringIndexOutOfBoundsException</code> when one of their index argument is smaller than 0
(E.G.: -1). <code>String::substring</code> also throws this exception when the <code>beginIndex</code> or <code>endIndex</code> argument is larger
than <code>myString.length()</code>, and <code>String::charAt</code> when the <code>index</code> argument is larger than <code>myString.length() -
1</code> For instance, it is not possible to use <code>String::charAt</code> to retrieve a value before the start or after the end of a string.
Furthermore, it is not possible to use <code>String::substring</code> with <code>beginIndex &gt; endIndex</code> to reverse the order of characters in
a string.</p>
<p>This rule raises an issue when a negative literal or an index that is too large is passed as an argument to the <code>String::substring</code>,
<code>String::charAt</code>, and related methods. It also raises an issue when the start index passed to <code>String::substring</code> is larger than
the end index.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use non-negative indexes that are smaller than or equal to the length of the string in question with <code>String::substring</code> and strictly
smaller with <code>String::charAt</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
String speech = "Lorem ipsum dolor sit amet";

String substr1 = speech.substring(-1, speech.length()); // Noncompliant, -1 is out of bounds
String substr2 = speech.substring(speech.length(), 0);  // Noncompliant, the beginIndex must be smaller than or equal to the endIndex
char ch = speech.charAt(speech.length());               // Noncompliant, speech.length() is out of bounds
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
String speech = "Lorem ipsum dolor sit amet";

String substr1 = speech;                                         // Compliant, no string operation used
String substr2 = new StringBuilder(speech).reverse().toString(); // Compliant, the string can be reversed using StringBuilder::reverse()
char ch = speech.charAt(speech.length() - 1);                    // Compliant, speech.length() - 1 is in bounds.
</pre></p>
            </div>
        <div class="rule">
            <h3>"private" methods called only by inner classes should be moved to those classes (java:S3398)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a <code>private</code> method is only invoked by an inner class, there’s no reason not to move it into that class. It will still have the same
access to the outer class' members, but the outer class will be clearer and less cluttered.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Outie {
  private int i=0;

  private void increment() {  // Noncompliant
    i++;
  }

  public class Innie {
    public void doTheThing() {
      Outie.this.increment();
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Outie {
  private int i=0;

  public class Innie {
    public void doTheThing() {
      increment();
    }

    private void increment() {
      Outie.this.i++;
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Regex patterns should not be created needlessly (java:S4248)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>java.util.regex.Pattern.compile()</code> methods have a significant performance cost, and therefore should be used sensibly.</p>
<p>Moreover they are the only mechanism available to create instances of the Pattern class, which are necessary to do any pattern matching using
regular expressions. Unfortunately that can be hidden behind convenience methods like <code>String.matches()</code> or
<code>String.split()</code>.</p>
<p>It is therefore somewhat easy to inadvertently repeatedly compile the same regular expression at great performance cost with no valid reason.</p>
<p>This rule raises an issue when:</p>
<ul>
  <li> A <code>Pattern</code> is compiled from a <code>String</code> literal or constant and is not stored in a static final reference. </li>
  <li> <code>String.matches</code>, <code>String.split</code>, <code>String.replaceAll</code> or <code>String.replaceFirst</code> are invoked with a
  <code>String</code> literal or constant. In which case the code should be refactored to use a <code>java.util.regex.Pattern</code> while respecting
  the previous rule. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
public void doingSomething(String stringToMatch) {
  Pattern regex = Pattern.compile("myRegex");  // Noncompliant
  Matcher matcher = regex.matcher("s");
  // ...
  if (stringToMatch.matches("myRegex2")) {  // Noncompliant
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
private static final Pattern myRegex = Pattern.compile("myRegex");
private static final Pattern myRegex2 = Pattern.compile("myRegex2");

public void doingSomething(String stringToMatch) {
  Matcher matcher = myRegex.matcher("s");
  // ...
  if (myRegex2.matcher(stringToMatch).matches()) {
    // ...
  }
}
</pre>
<h3>Exceptions</h3>
<p><code>String.split</code> doesn’t create a regex when the string passed as argument meets either of these 2 conditions:</p>
<ul>
  <li> It is a one-char String and this character is not one of the RegEx’s meta characters ".$|()[{^?*+\" </li>
  <li> It is a two-char String and the first char is the backslash and the second is not the ascii digit or ascii letter. </li>
</ul>
<p>In which case no issue will be raised.</p></p>
            </div>
        <div class="rule">
            <h3>Using unencrypted databases in mobile applications is security-sensitive (java:S6291)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local databases that contain sensitive information. Most systems provide secure alternatives to plain-text
storage that should be used. If no secure alternative is available the data can also be encrypted manually before it is stored.</p>
<p>The encryption password should not be hard-coded in the application. There are different approaches how the password can be provided to encrypt and
decrypt the database. In the case of <code>EncryptedSharedPreferences</code> the Android Keystore can be used to store the password. Other databases
can rely on <code>EncryptedSharedPreferences</code> to store passwords. The password can also be provided dynamically by the user of the application
or it can be fetched from a remote server if the other methods are not feasible.</p>
<h2>Compliant Solution</h2>
<p>Instead of SQLiteDatabase you can use <a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/">SQLCipher</a>:</p>
<pre>
SQLiteDatabase db = SQLiteDatabase.openOrCreateDatabase("test.db", getKey(), null);
</pre>
<p>Instead of SharedPreferences you can use <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences">EncryptedSharedPreferences</a>:</p>
<pre>
String masterKeyAlias = new MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);
EncryptedSharedPreferences.create(
    "secret",
    masterKeyAlias,
    context,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
);
</pre>
<p>For Realm an encryption key can be specified in the config:</p>
<pre>
RealmConfiguration config = new RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build();
Realm realm = Realm.getInstance(config);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard</a> - Data Storage and Privacy
  Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2</a> - Insecure Data
  Storage </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://developer.android.com/reference/kotlin/android/database/sqlite/SQLiteDatabase">SQLiteDatabase</a>:</p>
<pre>
SQLiteDatabase db = activity.openOrCreateDatabase("test.db", Context.MODE_PRIVATE, null); // Sensitive
</pre>
<p>For <a href="https://developer.android.com/training/data-storage/shared-preferences">SharedPreferences</a>:</p>
<pre>
SharedPreferences pref = activity.getPreferences(Context.MODE_PRIVATE); // Sensitive
</pre>
<p>For <a href="https://docs.mongodb.com/realm/">Realm</a>:</p>
<pre>
RealmConfiguration config = new RealmConfiguration.Builder().build();
Realm realm = Realm.getInstance(config); // Sensitive
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Storing data locally is a common task for mobile applications. Such data includes preferences or authentication tokens for external services, among
other things. There are many convenient solutions that allow storing data persistently, for example SQLiteDatabase, SharedPreferences, and Realm. By
default these systems store the data unencrypted, thus an attacker with physical access to the device can read them out easily. Access to sensitive
data can be harmful for the user of the application, for example when the device gets stolen.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Storing data locally is a common task for mobile applications. Such data includes preferences or authentication tokens for external services, among
other things. There are many convenient solutions that allow storing data persistently, for example SQLiteDatabase, SharedPreferences, and Realm. By
default these systems store the data unencrypted, thus an attacker with physical access to the device can read them out easily. Access to sensitive
data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The database contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local databases that contain sensitive information. Most systems provide secure alternatives to plain-text
storage that should be used. If no secure alternative is available the data can also be encrypted manually before it is stored.</p>
<p>The encryption password should not be hard-coded in the application. There are different approaches how the password can be provided to encrypt and
decrypt the database. In the case of <code>EncryptedSharedPreferences</code> the Android Keystore can be used to store the password. Other databases
can rely on <code>EncryptedSharedPreferences</code> to store passwords. The password can also be provided dynamically by the user of the application
or it can be fetched from a remote server if the other methods are not feasible.</p>
<h2>Sensitive Code Example</h2>
<p>For <a href="https://developer.android.com/reference/kotlin/android/database/sqlite/SQLiteDatabase">SQLiteDatabase</a>:</p>
<pre>
SQLiteDatabase db = activity.openOrCreateDatabase("test.db", Context.MODE_PRIVATE, null); // Sensitive
</pre>
<p>For <a href="https://developer.android.com/training/data-storage/shared-preferences">SharedPreferences</a>:</p>
<pre>
SharedPreferences pref = activity.getPreferences(Context.MODE_PRIVATE); // Sensitive
</pre>
<p>For <a href="https://docs.mongodb.com/realm/">Realm</a>:</p>
<pre>
RealmConfiguration config = new RealmConfiguration.Builder().build();
Realm realm = Realm.getInstance(config); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Instead of SQLiteDatabase you can use <a href="https://www.zetetic.net/sqlcipher/sqlcipher-for-android/">SQLCipher</a>:</p>
<pre>
SQLiteDatabase db = SQLiteDatabase.openOrCreateDatabase("test.db", getKey(), null);
</pre>
<p>Instead of SharedPreferences you can use <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences">EncryptedSharedPreferences</a>:</p>
<pre>
String masterKeyAlias = new MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);
EncryptedSharedPreferences.create(
    "secret",
    masterKeyAlias,
    context,
    EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV,
    EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM
);
</pre>
<p>For Realm an encryption key can be specified in the config:</p>
<pre>
RealmConfiguration config = new RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build();
Realm realm = Realm.getInstance(config);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard</a> - Data Storage and Privacy
  Requirements </li>
  <li> <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2</a> - Insecure Data
  Storage </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Using biometric authentication without a cryptographic solution is security-sensitive (java:S6293)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Default:</p>
            <p><p>Android comes with Android KeyStore, a secure container for storing key materials. It’s possible to define certain keys to be unlocked when users
authenticate using biometric credentials. This way, even if the application process is compromised, the attacker cannot access keys, as presence of
the authorized user is required.</p>
<p>These keys can be used, to encrypt, sign or create a message authentication code (MAC) as proof that the authentication result has not been
tampered with. This protection defeats the scenario where an attacker with physical access to the device would try to hook into the application
process and call the <code>onAuthenticationSucceeded</code> method directly. Therefore he would be unable to extract the sensitive data or to perform
the critical operations protected by the biometric authentication.</p>
<h2>Ask Yourself Whether</h2>
<p>The application contains:</p>
<ul>
  <li> Cryptographic keys / sensitive information that need to be protected using biometric authentication. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to tie the biometric authentication to a cryptographic operation by using a <code>CryptoObject</code> during authentication.</p>
<h2>Sensitive Code Example</h2>
<p>A <code>CryptoObject</code> is not used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt = new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo); // Noncompliant
</pre>
<h2>Compliant Solution</h2>
<p>A <code>CryptoObject</code> is used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt = new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo, new BiometricPrompt.CryptoObject(cipher)); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.android.com/training/sign-in/biometric-auth">developer.android.com</a> - Use a cryptographic solution that depends
  on authentication </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">Mobile Top 10 2016 Category M4 - Insecure
  Authentication</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-AUTH/">Mobile AppSec Verification Standard - Authentication and Session Management
  Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/287">CWE-287 - Improper Authentication</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<p>The application contains:</p>
<ul>
  <li> Cryptographic keys / sensitive information that need to be protected using biometric authentication. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Sensitive Code Example</h2>
<p>A <code>CryptoObject</code> is not used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt = new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo); // Noncompliant
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Android comes with Android KeyStore, a secure container for storing key materials. It’s possible to define certain keys to be unlocked when users
authenticate using biometric credentials. This way, even if the application process is compromised, the attacker cannot access keys, as presence of
the authorized user is required.</p>
<p>These keys can be used, to encrypt, sign or create a message authentication code (MAC) as proof that the authentication result has not been
tampered with. This protection defeats the scenario where an attacker with physical access to the device would try to hook into the application
process and call the <code>onAuthenticationSucceeded</code> method directly. Therefore he would be unable to extract the sensitive data or to perform
the critical operations protected by the biometric authentication.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to tie the biometric authentication to a cryptographic operation by using a <code>CryptoObject</code> during authentication.</p>
<h2>Compliant Solution</h2>
<p>A <code>CryptoObject</code> is used during authentication:</p>
<pre>
// ...
BiometricPrompt biometricPrompt = new BiometricPrompt(activity, executor, callback);
// ...
biometricPrompt.authenticate(promptInfo, new BiometricPrompt.CryptoObject(cipher)); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.android.com/training/sign-in/biometric-auth">developer.android.com</a> - Use a cryptographic solution that depends
  on authentication </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m4-insecure-authentication">Mobile Top 10 2016 Category M4 - Insecure
  Authentication</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-AUTH/">Mobile AppSec Verification Standard - Authentication and Session Management
  Requirements</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/287">CWE-287 - Improper Authentication</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Mobile database encryption keys should not be disclosed (java:S6301)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>In the example below, a local database is opened using a hardcoded key. To fix this, the key is moved to a secure location instead and retrieved
using a <code>getKey()</code> method.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="201" data-diff-type="noncompliant">
String key = "gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g";
RealmConfiguration config = new RealmConfiguration.Builder();
    .encryptionKey(key.toByteArray()) // Noncompliant
    .build();
Realm realm = Realm.getInstance(config);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="201" data-diff-type="compliant">
RealmConfiguration config = new RealmConfiguration.Builder()
    .encryptionKey(getKey())
    .build();
Realm realm = Realm.getInstance(config);
</pre>
<h3>How does this work?</h3>
<h4>Using Android’s builtin key storage options</h4>
<p>The <a href="https://developer.android.com/privacy-and-security/keystore">Android Keystore</a> system allows apps to store encryption keys in a
container that is protected on a system level. Additionally, it can restrict when and how the keys are used. For example, it allows the app to require
user authentication (for example using a fingerprint) before the key is made available. This is the recommended way to store cryptographic keys on
Android.</p>
<h4>Dynamically retrieving encryption keys remotely</h4>
<p>As user devices are less trusted than controlled environments such as the application backend, the latter should be preferred for the storage of
encryption keys. This requires that a user’s device has an internet connection, which may not be suitable for every use case.</p>
<h3>Going the extra mile</h3>
<h4>Avoid storing sensitive data on user devices</h4>
<p>In general, it is always preferable to store as little sensitive data on user devices as possible.</p>
<p>Of course, some sensitive data always has to be stored on client devices, such as the data required for authentication. In this case, consider
whether the application logic can also function with a hash (or otherwise non-reversible form) of that data. For example, if an email address is
required for authentication, it might be possible to use and store a hashed version of this address instead.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>In the example below, a local database is opened using a hardcoded key. To fix this, the key is moved to a secure location instead and retrieved
using a <code>getKey()</code> method.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
String key = "gb09ym9ydoolp3w886d0tciczj6ve9kszqd65u7d126040gwy86xqimjpuuc788g";
SQLiteDatabase db = SQLiteDatabase.openOrCreateDatabase("test.db", key, null); // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
SQLiteDatabase db = SQLiteDatabase.openOrCreateDatabase("test.db", getKey(), null);
</pre>
<h3>How does this work?</h3>
<h4>Using Android’s builtin key storage options</h4>
<p>The <a href="https://developer.android.com/privacy-and-security/keystore">Android Keystore</a> system allows apps to store encryption keys in a
container that is protected on a system level. Additionally, it can restrict when and how the keys are used. For example, it allows the app to require
user authentication (for example using a fingerprint) before the key is made available. This is the recommended way to store cryptographic keys on
Android.</p>
<h4>Dynamically retrieving encryption keys remotely</h4>
<p>As user devices are less trusted than controlled environments such as the application backend, the latter should be preferred for the storage of
encryption keys. This requires that a user’s device has an internet connection, which may not be suitable for every use case.</p>
<h3>Going the extra mile</h3>
<h4>Avoid storing sensitive data on user devices</h4>
<p>In general, it is always preferable to store as little sensitive data on user devices as possible.</p>
<p>Of course, some sensitive data always has to be stored on client devices, such as the data required for authentication. In this case, consider
whether the application logic can also function with a hash (or otherwise non-reversible form) of that data. For example, if an email address is
required for authentication, it might be possible to use and store a hashed version of this address instead.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Mobile applications often need to store data (which might be sensitive) locally. For Android, there exist several libraries that simplify this
process by offering a feature-rich database system. <a href="https://www.zetetic.net/sqlcipher/">SQLCipher</a> and <a
href="https://realm.io/">Realm</a> are examples of such libraries. These libraries often add support for database encryption, to protect the contents
from being read by other apps or by attackers.</p>
<p>When using encryption for such a database, it is important that the encryption key stays secret. If this key is hardcoded in the application, then
it should be considered compromised. The key will be known by anyone with access to the application’s binary code or source code. This means that the
sensitive encrypted data can be decrypted by anyone having access to the binary of the mobile application.</p>
<p>Furthermore, if the key is hardcoded, it is the same for every user. A compromise of this encryption key implicates every user of the app.</p>
<p>The encryption key is meant to stay secret and should not be hard-coded in the application as it would mean that:</p>
<h3>What is the potential impact?</h3>
<p>If an attacker is able to find the encryption key for the mobile database, this can potentially have severe consequences.</p>
<h4>Theft of sensitive data</h4>
<p>If a mobile database is encrypted, it is likely to contain data that is sensitive for the user or the app publisher. For example, it can contain
personally identifiable information (PII), financial data, login credentials, or other sensitive user data.</p>
<p>By not protecting the encryption key properly, it becomes very easy for an attacker to recover it and then decrypt the mobile database. At that
point, the theft of sensitive data might lead to identity theft, financial fraud, and other forms of malicious activities.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>When storing local data in a mobile application, it is common to use a database that can be encrypted. When encryption of this database is enabled,
the encryption key must be protected properly.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Android Documentation - <a href="https://developer.android.com/privacy-and-security/keystore">Android Keystore system</a> </li>
  <li> Android Documentation - <a href="https://developer.android.com/privacy-and-security/security-tips#UserData">Security tips - User data</a> </li>
  <li> OWASP Mobile Application Security Testing Guide - <a href="https://mas.owasp.org/MASTG/0x05d-Testing-Data-Storage/">Data Storage on Android</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Data Storage and Privacy
  Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/321">CWE-321 - Use of Hard-coded Cryptographic Key</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Lines should not be too long (java:S103)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Scrolling horizontally to see a full line of code lowers the code readability.</p></p>
            </div>
        <div class="rule">
            <h3>Files should not have too many lines of code (java:S104)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a source file grows too much, it can accumulate numerous responsibilities and become challenging to understand and maintain.</p>
<p>Above a specific threshold, refactor the file into smaller files whose code focuses on well-defined tasks. Those smaller files will be easier to
understand and test.</p></p>
            </div>
        <div class="rule">
            <h3>Tabulation characters should not be used (java:S105)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The tab width can differ from one development environment to another. Using tabs may require other developers to configure their environment (text
editor, preferences, etc.) to read source code.</p>
<p>That is why using spaces is preferable.</p></p>
            </div>
        <div class="rule">
            <h3>Generic exceptions should never be thrown (java:S112)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>To fix this issue, make sure to throw specific exceptions that are relevant to the context in which they arise. It is recommended to either:</p>
<ul>
  <li> Raise a specific exception from the Java standard library when one matches. For example an <code>IllegalArgumentException</code> should be
  thrown when a method receives an invalid argument. </li>
  <li> Create a custom exception class deriving from <code>Exception</code> or one of its subclasses. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void checkValue(int value) throws Throwable { // Noncompliant: signature is too broad
    if (value == 42) {
        throw new RuntimeException("Value is 42"); // Noncompliant: This will be difficult for consumers to handle
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void checkValue(int value) {
    if (value == 42) {
        throw new IllegalArgumentException("Value is 42"); // Compliant
    }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Throwing generic exceptions such as <code>Error</code>, <code>RuntimeException</code>, <code>Throwable</code>, and <code>Exception</code> will have
a negative impact on any code trying to catch these exceptions.</p>
<p>From a consumer perspective, it is generally a best practice to only catch exceptions you intend to handle. Other exceptions should ideally be let
to propagate up the stack trace so that they can be dealt with appropriately. When a generic exception is thrown, it forces consumers to catch
exceptions they do not intend to handle, which they then have to re-throw.</p>
<p>Besides, when working with a generic type of exception, the only way to distinguish between multiple exceptions is to check their message, which is
error-prone and difficult to maintain. Legitimate exceptions may be unintentionally silenced and errors may be hidden.</p>
<p>For instance, when a <code>Throwable</code> is caught and not re-thrown, it may mask errors such as <code>OutOfMemoryError</code> and prevent the
program from terminating gracefully.</p>
<p>When throwing an exception, it is therefore recommended to throw the most specific exception possible so that it can be handled intentionally by
consumers.</p>
<h3>Exceptions</h3>
<p>Generic exceptions in the signatures of overriding methods are ignored, because an overriding method has to follow the signature of the throw
declaration in the superclass. The issue will be raised on superclass declaration of the method (or won’t be raised at all if superclass is not part
of the analysis).</p>
<pre>
@Override
public void myMethod() throws Exception {...}
</pre>
<p>Generic exceptions are also ignored in the signatures of methods that make calls to methods that throw generic exceptions.</p>
<pre>
public void myOtherMethod() throws Exception {
  doTheThing();  // this method throws Exception
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a generic exception (such as <code>Error</code>, <code>RuntimeException</code>, <code>Throwable</code>, or
<code>Exception</code>) is thrown.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/397">CWE-397 Declaration of Throws for Generic Exception</a> </li>
  <li> CERT - <a href="https://wiki.sei.cmu.edu/confluence/x/_DdGBQ">ERR07-J. Do not throw RuntimeException, Exception, or Throwable</a> </li>
</ul>
<h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS1181'>S1181</a> - Generic exceptions should not be caught </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Custom serialization methods should have required signatures (java:S2061)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Ensure that the serialization-related method’s signatures match exactly those required by the JVM.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Watermelon implements Serializable {

  void writeObject(java.io.ObjectOutputStream out)         // Noncompliant, "writeObject" needs to be private, which it is not here
        throws IOException
  {...}

  static Object readResolve() throws ObjectStreamException // Noncompliant, "readResolve" should not be static
  {...}

  Watermelon writeReplace() throws ObjectStreamException   // Noncompliant, "writeReplace" must return "java.lang.Object"
  {...}
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Watermelon implements Serializable {

  private void writeObject(java.io.ObjectOutputStream out)    // Compliant, method declared as private
        throws IOException
  {...}

  protected Object readResolve() throws ObjectStreamException // Compliant, method is not static
  {...}

  private Object writeReplace() throws ObjectStreamException  // Compliant, method returns "java.lang.Object"
  {...}
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java offers a built-in serialization mechanism for classes that implement the <code>Serializable</code> interface. The developer can either rely on
Java’s default serialization and deserialization logic or implement custom methods for these tasks. The JVM will use methods such as
<code>readObject</code> and <code>writeObject</code> to execute custom behavior. This only works, however, if these methods match exactly the expected
signatures. If they do not, the JVM will fall back to the default logic, resulting in unexpected behavior at runtime, while the developer believes
that the default logic has been overidden.</p>
<p>This rule raises an issue if an implementation of <code>writeObject</code>, <code>readObject</code>, <code>readObjectNoData</code>,
<code>writeReplace</code>, or <code>readResolve</code> has an incorrect access modifier, return type, or is not static when it should be (and
vice-versa).</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/WTdGBQ">CERT, SER01-J.</a> - Do not deviate from the proper signatures of serialization methods
  </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Serializable.html">Oracle SDK - java.io.Serializable</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"readResolve" methods should be inheritable (java:S2062)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Developers may want to add some logic to handle deserialized objects before they are returned to the caller. This can be achieved by implementing
the <code>readResolve</code> method.</p>
<p>Non-final classes implementing <code>readResolve</code> should not set its visibility to <code>private</code> as this would make it unavailable to
child classes. Instead, mark <code>readResolve</code> as <code>protected</code>, allowing it to be inherited.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Fruit implements Serializable {
  private static final long serialVersionUID = 1;

  private Object readResolve() throws ObjectStreamException // Noncompliant, `readResolve` should not be private
  {...}

  //...
}

public class Raspberry extends Fruit implements Serializable { // This class has no access to the parent's "readResolve" method
  //...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Fruit implements Serializable {
  private static final long serialVersionUID = 1;

  protected Object readResolve() throws ObjectStreamException // Compliant, `readResolve` is protected
  {...}

  //...
}

public class Raspberry extends Fruit implements Serializable { // This class has access to the parent's "readResolve"
  //...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/platform/serialization/spec/input.html#a5903">Java Object Serialization Specification - Object
  Input Classes</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Comparators should be "Serializable" (java:S2063)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A non-serializable <code>Comparator</code> can prevent an otherwise-<code>Serializable</code> ordered collection from being serializable. Since the
overhead to make a <code>Comparator</code> serializable is usually low, doing so can be considered good defensive programming.</p>
<h3>Noncompliant code example</h3>
<pre>
public class FruitComparator implements Comparator&lt;Fruit&gt; {  // Noncompliant
  int compare(Fruit f1, Fruit f2) {...}
  boolean equals(Object obj) {...}
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class FruitComparator implements Comparator&lt;Fruit&gt;, Serializable {
  private static final long serialVersionUID = 1;

  int compare(Fruit f1, Fruit f2) {...}
  boolean equals(Object obj) {...}
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Fields in non-serializable classes should not be "transient" (java:S2065)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://www.baeldung.com/java-transient-keyword">Baeldung - The transient Keyword in Java</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ask yourself whether this class should be serializable. If yes, ensure it implements <code>Serializable</code> and provides any additional logic
required to serialize and deserialize an instance of this type. Otherwise, remove the <code>transient</code> modifier from this field.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Vegetable {
  private transient Season ripe; // Noncompliant, the "Vegetable" class does not implement "Serializable" but the field is marked as "transient"
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class Vegetable {
  private Season ripe; // Compliant, the field is not marked as "transient"
  // ...
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Fields marked as <code>transient</code> in a <code>Serializable</code> class will be ignored during serialization and consequently not written out
to a file (or stream).</p>
<p>This can be useful in situations such as where the content of a field can be recomputed from other fields. To reduce the output size, this field
can be marked as <code>transient</code> and recomputed when a given object is deserialized.</p>
<p>Since <code>transient</code> is very specific to classes that implement <code>Serializable</code>, it is superfluous in classes that do not.</p>
<p>This rule raises an issue when a field is marked as <code>transient</code>, even though the containing class does not implement
<code>Serializable</code>.</p></p>
            </div>
        <div class="rule">
            <h3>"Serializable" inner classes of non-serializable outer classes should be "static" (java:S2066)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Non-static inner classes contain a reference to an instance of the outer class. Hence, serializing a non-static inner class will result in an
attempt at serializing the outer class as well. If the outer class is not serializable, serialization will fail, resulting in a runtime error.</p>
<p>Making the inner class <code>static</code> (i.e., "nested") avoids this problem, as no reference to an instance of the outer class is required.
Serializing the inner class can be done independently of the outer class. Hence, inner classes implementing <code>Serializable</code> should be
<code>static</code> if the outer class does not implement <code>Serializable</code>.</p>
<p>Be aware of the semantic differences between an inner class and a nested one:</p>
<ul>
  <li> an inner class can only be instantiated within the context of an instance of the outer class. </li>
  <li> a nested (<code>static</code>) class can be instantiated independently of the outer class. </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ZTdGBQ">CERT SER05-J.</a> - Do not serialize instances of inner classes </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Make the inner class <code>static</code> or make the outer class <code>Serializable</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Pomegranate {
  // ...

  public class Seed implements Serializable {  // Noncompliant, serialization will fail due to the outer class not being serializable
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Pomegranate {
  // ...

  public static class Seed implements Serializable { // Compliant, the outer class will not be serialized and hence cannot be the cause for a failure at runtime
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Hard-coded passwords are security-sensitive (java:S2068)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The password allows access to a sensitive component like a database, a file storage, an API, or a service. </li>
  <li> The password is used in production environments. </li>
  <li> Application re-distribution is required before updating the password. </li>
</ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
String username = "steve";
String password = "blue";
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/test?" +
                  "user=" + username + "&amp;password=" + password); // Sensitive
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Because it is easy to extract strings from an application source code or binary, passwords should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Passwords should be stored outside of the code in a configuration file, a database, or a password management service.</p>
<p>This rule flags instances of hard-coded passwords used in database and LDAP connections. It looks for hard-coded passwords in connection strings,
and for variable names that match any of the patterns from the provided list.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Because it is easy to extract strings from an application source code or binary, passwords should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-13466">CVE-2019-13466</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15389">CVE-2018-15389</a> </li>
</ul>
<p>Passwords should be stored outside of the code in a configuration file, a database, or a password management service.</p>
<p>This rule flags instances of hard-coded passwords used in database and LDAP connections. It looks for hard-coded passwords in connection strings,
and for variable names that match any of the patterns from the provided list.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The password allows access to a sensitive component like a database, a file storage, an API, or a service. </li>
  <li> The password is used in production environments. </li>
  <li> Application re-distribution is required before updating the password. </li>
</ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
String username = "steve";
String password = "blue";
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/test?" +
                  "user=" + username + "&amp;password=" + password); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String username = getEncryptedUser();
String password = getEncryptedPassword();
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/test?" +
                  "user=" + username + "&amp;password=" + password);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">CERT, MSC03-J.</a> - Never hard code sensitive information </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the credentials in a configuration file that is not pushed to the code repository. </li>
  <li> Store the credentials in a database. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a password has been disclosed through the source code: change it. </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
String username = getEncryptedUser();
String password = getEncryptedPassword();
Connection conn = DriverManager.getConnection("jdbc:mysql://localhost/test?" +
                  "user=" + username + "&amp;password=" + password);
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">CERT, MSC03-J.</a> - Never hard code sensitive information </li>
  <li> Derived from FindSecBugs rule <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#HARD_CODE_PASSWORD">Hard Coded Password</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Ints and longs should not be shifted by zero or more than their number of bits-1 (java:S2183)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public int shift(int a) {
  int x = a &gt;&gt; 32; // Noncompliant
  return a &lt;&lt; 48;  // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public int shift(int a) {
  int x = a &gt;&gt; 31;
  return a &lt;&lt; 16;
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Since an <code>int</code> is a 32-bit variable, shifting by more than +/-31 is confusing at best and an error at worst. When the runtime shifts
32-bit integers, it uses the lowest 5 bits of the shift count operand. In other words, shifting an <code>int</code> by 32 is the same as shifting it
by 0, and shifting it by 33 is the same as shifting it by 1.</p>
<p>Similarly, when shifting 64-bit integers, the runtime uses the lowest 6 bits of the shift count operand and shifting <code>long</code> by 64 is the
same as shifting it by 0, and shifting it by 65 is the same as shifting it by 1.</p></p>
            </div>
        <div class="rule">
            <h3>Math operands should be cast before assignment (java:S2184)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When arithmetic is performed on integers, the result will always be an integer. You can assign that result to a <code>long</code>,
<code>double</code>, or <code>float</code> with automatic type conversion, but having started as an <code>int</code> or <code>long</code>, the result
will likely not be what you expect.</p>
<p>For instance, if the result of <code>int</code> division is assigned to a floating-point variable, precision will have been lost before the
assignment. Likewise, if the result of multiplication is assigned to a <code>long</code>, it may have already overflowed before the assignment.</p>
<p>In either case, the result will not be what was expected. Instead, at least one operand should be cast or promoted to the final type before the
operation takes place.</p>
<h3>Noncompliant code example</h3>
<pre>
float twoThirds = 2/3; // Noncompliant; int division. Yields 0.0
long millisInYear = 1_000*3_600*24*365; // Noncompliant; int multiplication. Yields 1471228928
long bigNum = Integer.MAX_VALUE + 2; // Noncompliant. Yields -2147483647
long bigNegNum =  Integer.MIN_VALUE-1; //Noncompliant, gives a positive result instead of a negative one.
Date myDate = new Date(seconds * 1_000); //Noncompliant, won't produce the expected result if seconds &gt; 2_147_483
...
public long compute(int factor){
  return factor * 10_000;  //Noncompliant, won't produce the expected result if factor &gt; 214_748
}

public float compute2(long factor){
  return factor / 123;  //Noncompliant, will be rounded to closest long integer
}
</pre>
<h3>Compliant solution</h3>
<pre>
float twoThirds = 2f/3; // 2 promoted to float. Yields 0.6666667
long millisInYear = 1_000L*3_600*24*365; // 1000 promoted to long. Yields 31_536_000_000
long bigNum = Integer.MAX_VALUE + 2L; // 2 promoted to long. Yields 2_147_483_649
long bigNegNum =  Integer.MIN_VALUE-1L; // Yields -2_147_483_649
Date myDate = new Date(seconds * 1_000L);
...
public long compute(int factor){
  return factor * 10_000L;
}

public float compute2(long factor){
  return factor / 123f;
}
</pre>
<p>or</p>
<pre>
float twoThirds = (float)2/3; // 2 cast to float
long millisInYear = (long)1_000*3_600*24*365; // 1_000 cast to long
long bigNum = (long)Integer.MAX_VALUE + 2;
long bigNegNum =  (long)Integer.MIN_VALUE-1;
Date myDate = new Date((long)seconds * 1_000);
...
public long compute(long factor){
  return factor * 10_000;
}

public float compute2(float factor){
  return factor / 123;
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/190">CWE-190 - Integer Overflow or Wraparound</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/AjdGBQ">CERT, NUM50-J.</a> - Convert integers to floating point for floating-point operations
  </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/I9cxBQ">CERT, INT18-C.</a> - Evaluate integer expressions in a larger size before comparing or
  assigning to that size </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222612">Application Security and
  Development: V-222612</a> - The application must not be vulnerable to overflow attacks. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Do not perform unnecessary mathematical operations (java:S2185)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Some mathematical operations are unnecessary and should not be performed because their results are predictable.</p>
<p>For instance, <code>anyValue % 1</code> will always return 0, as any integer value can be divided by 1 without remainder.</p>
<p>Similarly, casting a non-floating-point to a floating-point value and then passing it to <code>Math.round</code>, <code>Math.ceil</code>, or
<code>Math.floor</code> is also unnecessary, as the result will always be the original value.</p>
<p>The following operations are unnecessary when given any constant value: <code>Math.abs</code>, <code>Math.ceil</code>, <code>Math.floor</code>,
<code>Math.rint</code>, <code>Math.round</code>. Instead, use the result of the operation directly.</p>
<p>The following operations are unnecessary with certain constants and can be replaced by the result of the operation directly:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Operation</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p>acos</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>asin</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>atan</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>atan2</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>cbrt</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>cos</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>cosh</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>exp</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>expm1</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>log</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>log10</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>sin</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>sinh</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>sqrt</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>tan</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>tanh</p></td>
      <td><p>0.0</p></td>
    </tr>
    <tr>
      <td><p>toDegrees</p></td>
      <td><p>0.0 or 1.0</p></td>
    </tr>
    <tr>
      <td><p>toRadians</p></td>
      <td><p>0.0</p></td>
    </tr>
  </tbody>
</table></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ask yourself if the questionable operation represents the desired calculation or if a value used is erroneous. If the calculation is correct,
replace it with the result to avoid having to perform the unnecessary operation at runtime.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void doMath(int a) {
  double res1 = Math.floor((double)a); // Noncompliant, the result will always be equal to '(double) a'
  double res2 = Math.ceil(4.2);        // Noncompliant, the result will always be 5.0
  double res3 = Math.atan(0.0);        // Noncompliant, the result will always be 0.0
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void doMath(int a) {
  double res1 = a;    // Compliant
  double res2 = 5.0;  // Compliant
  double res3 = 0.0;  // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>JUnit assertions should not be used in "run" methods (java:S2186)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>JUnit assertions should not be made from the <code>run</code> method of a <code>Runnable</code>, because their failure may not be detected in the
test that initiated them. Failed assertions throw assertion errors. However, if the error is thrown from another thread than the one that initiated
the test, the thread will exit but the test will not fail.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Assertions in <code>Runnable</code> tasks should be extracted or executed by the main thread to make the whole test fail.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class RunnableWithAnAssertion extends Thread {
  @Override
  public void run() {
    Assert.assertEquals(expected, actual);  // Noncompliant
  }

  @Test
  void test() {
    RunnableWithAnAssertion otherThread = new RunnableWithAnAssertion();
    otherThread.start(); // The assertion in the run method above will be executed by other thread than the current one
    // ...
    // Perform some actions that do not make the test fail
    // ...
    Assert.assertTrue(true);
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class RunnableWithAnAssertion extends Thread {
  @Override
  public void run() {
    Assert.assertEquals(expected, actual);  // Noncompliant
  }

  @Test
  void test() {
    RunnableWithAnAssertion otherThread = new RunnableWithAnAssertion();
    otherThread.run();
    // ...
    // The failed assertions in the run method will prevent us from reaching the assertion below
    // ...
    Assert.assertTrue(true);
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>TestCases should contain tests (java:S2187)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There’s no point in having a JUnit <code>TestCase</code> without any test methods. Similarly, you shouldn’t have a file in the tests directory
named <code>*Test</code>, <code>*Tests</code>, or <code>*TestCase</code>, but no tests in the file. Doing either of these things may lead someone to
think that uncovered classes have been tested.</p>
<p>This rule raises an issue when files in the test directory are named <code>*Test</code>, <code>*Tests</code>, or <code>*TestCase</code> or
implement <code>TestCase</code> but don’t contain any tests.</p>
<p>Supported frameworks:</p>
<ul>
  <li> JUnit3 </li>
  <li> JUnit4 </li>
  <li> JUnit5 </li>
  <li> TestNG </li>
  <li> Zohhak </li>
  <li> ArchUnit </li>
  <li> Pact </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Classes should not have too many "static" imports (java:S3030)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Importing a class statically allows you to use its <code>public static</code> members without qualifying them with the class name. That can be
handy, but if you import too many classes statically, your code can become confusing and difficult to maintain.</p>
<h3>Noncompliant code example</h3>
<p>With the default threshold value: 4</p>
<pre>
import static java.lang.Math.*;
import static java.util.Collections.*;
import static com.myco.corporate.Constants.*;
import static com.myco.division.Constants.*;
import static com.myco.department.Constants.*;  // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>JEE applications should not "getClassLoader" (java:S3032)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Using the standard <code>getClassLoader()</code> may not return the <em>right</em> class loader in a JEE context. Instead, go through the
<code>currentThread</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
ClassLoader cl = this.getClass().getClassLoader();  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
ClassLoader cl = Thread.currentThread().getContextClassLoader();
</pre></p>
            </div>
        <div class="rule">
            <h3>Raw byte values should not be used in bitwise operations in combination with shifts (java:S3034)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>This rule raises an issue any time a <code>byte</code> value is used as an operand combined with shifts without being masked.</p>
<p>To prevent such accidental value conversions, you can mask promoted bytes to only consider the least significant 8 bits. Masking can be achieved
with the bitwise AND operator <code>&amp;</code> and the appropriate mask of <code>0xff</code> (255 in decimal and <code>0b1111_1111</code> in binary)
or, since Java 8, with the more convenient <code>Byte.toUnsignedInt(byte b)</code> or <code>Byte.toUnsignedLong(byte b)</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
  public static void main(String[] args) {
    byte[] bytes12 = BigInteger.valueOf(12).toByteArray(); // This byte array will be simply [12]
    System.out.println(intFromBuffer(bytes12)); // In this case, the bytes promotion will not cause any issues, and "12" will be printed.

    // Here the bytes will be [2, -128] since 640 in binary is represented as 0b0000_0010_1000_0000
    // which is equivalent to the concatenation of 2 bytes: 0b0000_0010 = 2, and 0b1000_0000 = -128
    byte[] bytes640 = BigInteger.valueOf(640).toByteArray();

    // In this case, the shifting operation combined with the bitwise OR, will produce the wrong binary string and "-128" will be printed.
    System.out.println(intFromBuffer(bytes640));
  }

  static int intFromBuffer(byte[] bytes) {
    int originalInt = 0;
    for (int i = 0; i &lt; bytes.length; i++) {
      // Here the right operand of the bitwise OR, which is a byte, will be promoted to an `int`
      // and if its value was negative, the added ones in front of the binary string will alter the value of the `originalInt`
      originalInt = (originalInt &lt;&lt; 8) | bytes[i]; // Noncompliant
    }
    return originalInt;
  }
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
  public static void main(String[] args) {
    byte[] bytes12 = BigInteger.valueOf(12).toByteArray(); // This byte array will be simply [12]
    System.out.println(intFromBuffer(bytes12)); // In this case, the bytes promotion will not cause any issues, and "12" will be printed.

    // Here the bytes will be [2, -128] since 640 in binary is represented as 0b0000_0010_1000_0000
    // which is equivalent to the concatenation of 2 bytes: 0b0000_0010 = 2, and 0b1000_0000 = -128
    byte[] bytes640 = BigInteger.valueOf(640).toByteArray();

    // This will correctly print "640" now.
    System.out.println(intFromBuffer(bytes640));
  }

  static int intFromBuffer(byte[] bytes) {
    int originalInt = 0;
    for (int i = 0; i &lt; bytes.length; i++) {
      originalInt = (originalInt &lt;&lt; 8) | Byte.toUnsignedInt(bytes[i]); // Compliant, only the relevant 8 least significant bits will affect the bitwise OR
    }
    return originalInt;
  }
</pre>
<h2>References</h2>
<ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/kDZGBQ">CERT, NUM52-J.</a> - Be aware of numeric promotion behavior </li>
  <li> <a href="https://en.wikipedia.org/wiki/Signed_number_representations#Two.27s_complement">Wikipedia</a> - Two’s complement </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Java, numeric promotions happen when two operands of an arithmetic expression have different sizes. More specifically, narrower operands get
promoted to the type of wider operands. For instance, an operation between a <code>byte</code> and an <code>int</code>, will trigger a promotion of
the <code>byte</code> operand, converting it into an <code>int</code>.</p>
<p>When this happens, the sequence of 8 bits that represents the <code>byte</code> will need to be extended to match the 32-bit long sequence that
represents the <code>int</code> operand. Since Java uses two’s complement notation for signed number types, the promotion will fill the missing
leading bits with zeros or ones, depending on the sign of the value. For instance, the byte <code>0b1000_0000</code> (equal to <code>-128</code> in
decimal notation), when promoted to <code>int</code>, will become <code>0b1111_1111_1111_1111_1111_1111_1000_0000</code>.</p>
<p>When performing shifting or bitwise operations without considering that bytes are signed, the bits added during the promotion may have unexpected
effects on the final result of the operations.</p></p>
            </div>
        <div class="rule">
            <h3>Composed "@RequestMapping" variants should be preferred (java:S4488)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Spring framework 4.3 introduced variants of the <code>@RequestMapping</code> annotation to better represent the semantics of the annotated methods.
The use of <code>@GetMapping</code>, <code>@PostMapping</code>, <code>@PutMapping</code>, <code>@PatchMapping</code> and <code>@DeleteMapping</code>
should be preferred to the use of the raw <code>@RequestMapping(method = RequestMethod.XYZ)</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
@RequestMapping(path = "/greeting", method = RequestMethod.GET) // Noncompliant
public Greeting greeting(@RequestParam(value = "name", defaultValue = "World") String name) {
...
}
</pre>
<h3>Compliant solution</h3>
<pre>
@GetMapping(path = "/greeting") // Compliant
public Greeting greeting(@RequestParam(value = "name", defaultValue = "World") String name) {
...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Using clear-text protocols is security-sensitive (java:S5332)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>These clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> libraries are based on unencrypted protocols and
are not recommended:</p>
<pre>
TelnetClient telnet = new TelnetClient(); // Sensitive

FTPClient ftpClient = new FTPClient(); // Sensitive

SMTPClient smtpClient = new SMTPClient(); // Sensitive
</pre>
<p>Unencrypted HTTP connections, when using <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance, should be avoided:</p>
<pre>
ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.CLEARTEXT) // Sensitive
  .build();
</pre>
<p>Android WebView can be configured to allow a secure origin to load content from any other origin, even if that origin is insecure (mixed
content):</p>
<pre>
import android.webkit.WebView

WebView webView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_ALWAYS_ALLOW); // Sensitive
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Compliant Solution</h2>
<p>Use instead these clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> and <a
href="http://www.jcraft.com/jsch/">JSch/ssh</a> library:</p>
<pre>
JSch jsch = new JSch();

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  FTPSClient ftpsClient = new FTPSClient(true);
}
else {
  FTPSClient ftpsClient = new FTPSClient();
}

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  SMTPSClient smtpsClient = new SMTPSClient(true);
}
else {
  SMTPSClient smtpsClient = new SMTPSClient();
  smtpsClient.connect("127.0.0.1", 25);
  if (smtpsClient.execTLS()) {
    // commands
  }
}
</pre>
<p>Perform HTTP encrypted connections, with <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance:</p>
<pre>
ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
  .build();
</pre>
<p>The most secure mode for Android WebView is <code>MIXED_CONTENT_NEVER_ALLOW</code>:</p>
<pre>
import android.webkit.WebView

WebView webView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_NEVER_ALLOW);
</pre>
<h2>See</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">Listeners for
  your Application Load Balancers</a> </li>
  <li> AWS Documentation - <a
  href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">Stream Encryption</a>
  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Google - <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Moving towards more secure web</a> </li>
  <li> Mozilla - <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Deprecating non secure http</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-NETWORK/">Mobile AppSec Verification Standard - Network Communication Requirements</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222397">Application Security and
  Development: V-222397</a> - The application must implement cryptographic mechanisms to protect the integrity of remote access sessions. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222534">Application Security and
  Development: V-222534</a> - Service-Oriented Applications handling non-releasable data must authenticate endpoint devices via mutual SSL/TLS. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222562">Application Security and
  Development: V-222562</a> - Applications used for non-local maintenance must implement cryptographic mechanisms to protect the integrity of
  maintenance and diagnostic communications. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222563">Application Security and
  Development: V-222563</a> - Applications used for non-local maintenance must implement cryptographic mechanisms to protect the confidentiality of
  maintenance and diagnostic communications. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222577">Application Security and
  Development: V-222577</a> - The application must not expose session IDs. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222596">Application Security and
  Development: V-222596</a> - The application must protect the confidentiality and integrity of transmitted information. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222597">Application Security and
  Development: V-222597</a> - The application must implement cryptographic mechanisms to prevent unauthorized disclosure of information and/or detect
  changes to information during transmission. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222598">Application Security and
  Development: V-222598</a> - The application must maintain the confidentiality and integrity of information during preparation for transmission.
  </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222599">Application Security and
  Development: V-222599</a> - The application must maintain the confidentiality and integrity of information during reception. </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Application data needs to be protected against falsifications or leaks when transiting over the network. </li>
  <li> Application data transits over an untrusted network. </li>
  <li> Compliance rules require the service to encrypt data in transit. </li>
  <li> Your application renders web pages with a relaxed mixed content policy. </li>
  <li> OS-level protections against clear-text traffic are deactivated. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Make application data transit over a secure, authenticated and encrypted protocol like TLS or SSH. Here are a few alternatives to the most
  common clear-text protocols:
    <ul>
      <li> Use <code>ssh</code> as an alternative to <code>telnet</code>. </li>
      <li> Use <code>sftp</code>, <code>scp</code>, or <code>ftps</code> instead of <code>ftp</code>. </li>
      <li> Use <code>https</code> instead of <code>http</code>. </li>
      <li> Use <code>SMTP</code> over <code>SSL/TLS</code> or <code>SMTP</code> with <code>STARTTLS</code> instead of clear-text SMTP. </li>
    </ul>  </li>
  <li> Enable encryption of cloud components communications whenever it is possible. </li>
  <li> Configure your application to block mixed content when rendering web pages. </li>
  <li> If available, enforce OS-level deactivation of all clear-text traffic. </li>
</ul>
<p>It is recommended to secure all transport channels, even on local networks, as it can take a single non-secure connection to compromise an entire
application or system.</p>
<h2>Sensitive Code Example</h2>
<p>These clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> libraries are based on unencrypted protocols and
are not recommended:</p>
<pre>
TelnetClient telnet = new TelnetClient(); // Sensitive

FTPClient ftpClient = new FTPClient(); // Sensitive

SMTPClient smtpClient = new SMTPClient(); // Sensitive
</pre>
<p>Unencrypted HTTP connections, when using <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance, should be avoided:</p>
<pre>
ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.CLEARTEXT) // Sensitive
  .build();
</pre>
<p>Android WebView can be configured to allow a secure origin to load content from any other origin, even if that origin is insecure (mixed
content):</p>
<pre>
import android.webkit.WebView

WebView webView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_ALWAYS_ALLOW); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>Use instead these clients from <a href="https://commons.apache.org/proper/commons-net/">Apache commons net</a> and <a
href="http://www.jcraft.com/jsch/">JSch/ssh</a> library:</p>
<pre>
JSch jsch = new JSch();

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  FTPSClient ftpsClient = new FTPSClient(true);
}
else {
  FTPSClient ftpsClient = new FTPSClient();
}

if(implicit) {
  // implicit mode is considered deprecated but offer the same security than explicit mode
  SMTPSClient smtpsClient = new SMTPSClient(true);
}
else {
  SMTPSClient smtpsClient = new SMTPSClient();
  smtpsClient.connect("127.0.0.1", 25);
  if (smtpsClient.execTLS()) {
    // commands
  }
}
</pre>
<p>Perform HTTP encrypted connections, with <a href="https://square.github.io/okhttp/https/">okhttp</a> library for instance:</p>
<pre>
ConnectionSpec spec = new ConnectionSpec.Builder(ConnectionSpec.MODERN_TLS)
  .build();
</pre>
<p>The most secure mode for Android WebView is <code>MIXED_CONTENT_NEVER_ALLOW</code>:</p>
<pre>
import android.webkit.WebView

WebView webView = findViewById(R.id.webview)
webView.getSettings().setMixedContentMode(MIXED_CONTENT_NEVER_ALLOW);
</pre>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
<h2>See</h2>
<h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-listeners.html">Listeners for
  your Application Load Balancers</a> </li>
  <li> AWS Documentation - <a
  href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-kinesis-stream-streamencryption.html">Stream Encryption</a>
  </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Google - <a href="https://security.googleblog.com/2016/09/moving-towards-more-secure-web.html">Moving towards more secure web</a> </li>
  <li> Mozilla - <a href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">Deprecating non secure http</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-NETWORK/">Mobile AppSec Verification Standard - Network Communication Requirements</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m3-insecure-communication">Mobile Top 10 2016 Category M3 - Insecure
  Communication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Exposure of Sensitive Information to an Unauthorized Actor</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/319">CWE-319 - Cleartext Transmission of Sensitive Information</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222397">Application Security and
  Development: V-222397</a> - The application must implement cryptographic mechanisms to protect the integrity of remote access sessions. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222534">Application Security and
  Development: V-222534</a> - Service-Oriented Applications handling non-releasable data must authenticate endpoint devices via mutual SSL/TLS. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222562">Application Security and
  Development: V-222562</a> - Applications used for non-local maintenance must implement cryptographic mechanisms to protect the integrity of
  maintenance and diagnostic communications. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222563">Application Security and
  Development: V-222563</a> - Applications used for non-local maintenance must implement cryptographic mechanisms to protect the confidentiality of
  maintenance and diagnostic communications. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222577">Application Security and
  Development: V-222577</a> - The application must not expose session IDs. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222596">Application Security and
  Development: V-222596</a> - The application must protect the confidentiality and integrity of transmitted information. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222597">Application Security and
  Development: V-222597</a> - The application must implement cryptographic mechanisms to prevent unauthorized disclosure of information and/or detect
  changes to information during transmission. </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222598">Application Security and
  Development: V-222598</a> - The application must maintain the confidentiality and integrity of information during preparation for transmission.
  </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222599">Application Security and
  Development: V-222599</a> - The application must maintain the confidentiality and integrity of information during reception. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Clear-text protocols such as <code>ftp</code>, <code>telnet</code>, or <code>http</code> lack encryption of transported data, as well as the
capability to build an authenticated connection. It means that an attacker able to sniff traffic from the network can read, modify, or corrupt the
transported content. These protocols are not secure as they expose applications to an extensive range of risks:</p>
<ul>
  <li> sensitive data exposure </li>
  <li> traffic redirected to a malicious endpoint </li>
  <li> malware-infected software update or installer </li>
  <li> execution of client-side code </li>
  <li> corruption of critical information </li>
</ul>
<p>Even in the context of isolated networks like offline environments or segmented cloud environments, the insider threat exists. Thus, attacks
involving communications being sniffed or tampered with can still happen.</p>
<p>For example, attackers could successfully compromise prior security layers by:</p>
<ul>
  <li> bypassing isolation mechanisms </li>
  <li> compromising a component of the network </li>
  <li> getting the credentials of an internal IAM account (either from a service account or an actual person) </li>
</ul>
<p>In such cases, encrypting communications would decrease the chances of attackers to successfully leak data or steal credentials from other network
components. By layering various security practices (segmentation and encryption, for example), the application will follow the
<em>defense-in-depth</em> principle.</p>
<p>Note that using the <code>http</code> protocol is being deprecated by <a
href="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http">major web browsers</a>.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6169">CVE-2019-6169</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-12327">CVE-2019-12327</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-11065">CVE-2019-11065</a> </li>
</ul>
<h2>Exceptions</h2>
<p>No issue is reported for the following cases because they are not considered sensitive:</p>
<ul>
  <li> Insecure protocol scheme followed by loopback addresses like 127.0.0.1 or <code>localhost</code>. </li>
</ul>
</p>
            </div>
        <div class="rule">
            <h3>Using unencrypted files in mobile applications is security-sensitive (java:S6300)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Default:</p>
            <p><p>Storing files locally is a common task for mobile applications. Files that are stored unencrypted can be read out and modified by an attacker with
physical access to the device. Access to sensitive data can be harmful for the user of the application, for example when the device gets stolen.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The file contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local files that contain sensitive information. The class <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a> can be used to easily encrypt files.</p>
<h2>Sensitive Code Example</h2>
<pre>
Files.write(path, content); // Sensitive

FileOutputStream out = new FileOutputStream(file); // Sensitive

FileWriter fw = new FileWriter("outfilename", false); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
String masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);

File file = new File(context.getFilesDir(), "secret_data");
EncryptedFile encryptedFile = EncryptedFile.Builder(
    file,
    context,
    masterKeyAlias,
    EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
).build();

// write to the encrypted file
FileOutputStream encryptedOutputStream = encryptedFile.openFileOutput();
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Data Storage and Privacy
  Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Storing files locally is a common task for mobile applications. Files that are stored unencrypted can be read out and modified by an attacker with
physical access to the device. Access to sensitive data can be harmful for the user of the application, for example when the device gets stolen.</p>
</p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The file contains sensitive data that could cause harm when leaked. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
Files.write(path, content); // Sensitive

FileOutputStream out = new FileOutputStream(file); // Sensitive

FileWriter fw = new FileWriter("outfilename", false); // Sensitive
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>It’s recommended to password-encrypt local files that contain sensitive information. The class <a
href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a> can be used to easily encrypt files.</p>
<h2>Compliant Solution</h2>
<pre>
String masterKeyAlias = MasterKeys.getOrCreate(MasterKeys.AES256_GCM_SPEC);

File file = new File(context.getFilesDir(), "secret_data");
EncryptedFile encryptedFile = EncryptedFile.Builder(
    file,
    context,
    masterKeyAlias,
    EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB
).build();

// write to the encrypted file
FileOutputStream encryptedOutputStream = encryptedFile.openFileOutput();
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Data Storage and Privacy
  Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Redundant nullability annotations should be removed (java:S6665)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Nullability annotations in Java are used to indicate whether a variable or parameter can be assigned a null value or not. These annotations help to prevent Null Pointer Exceptions and improve the reliability of code.</p>
<p>Redundant nullability annotations can clutter the code and make it harder to read and understand. When a nullability annotation is already implied by the context or by other annotations, explicitly adding it again only adds noise and makes the code less clear.</p>
<p>Removing them improves code readability, maintainability, reduces the risk of inconsistencies, and ensures that the remaining annotations carry meaningful information.</p>
<h3>Noncompliant code example</h3>
JSpecify code example:
<pre data-diff-id="1" data-diff-type="noncompliant">
@NullMarked
class MyClass {
  public void method(@NonNull Object o) { // Noncompliant: @NonNull is redundant here
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
@NullMarked
class MyClass {
  public void method(Object o) {
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Standard outputs should not be used directly to log anything (java:S106)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In software development, logs serve as a record of events within an application, providing crucial insights for debugging. When logging, it is
essential to ensure that the logs are:</p>
<ul>
  <li> easily accessible </li>
  <li> uniformly formatted for readability </li>
  <li> properly recorded </li>
  <li> securely logged when dealing with sensitive data </li>
</ul>
<p>Those requirements are not met if a program directly writes to the standard outputs (e.g., System.out, System.err). That is why defining and using
a dedicated logger is highly recommended.</p>

<p>The following noncompliant code:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyClass {
  public void doSomething() {
    System.out.println("My Message");  // Noncompliant, output directly to System.out without a logger
  }
}
</pre>
<p>Could be replaced by:</p>
<pre data-diff-id="1" data-diff-type="compliant">
import java.util.logging.Logger;

class MyClass {

  Logger logger = Logger.getLogger(getClass().getName());

  public void doSomething() {
    // ...
    logger.info("My Message");  // Compliant, output via logger
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/7/docs/api/java/util/logging/Logger.html">Java SE 7 API Specification: java.util.logging.Logger</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">Top 10 2021 Category A9 - Security Logging and
  Monitoring Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/nzdGBQ">CERT, ERR02-J.</a> - Prevent exceptions while logging data </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Methods should not have too many parameters (java:S107)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Methods with a long parameter list are difficult to use because maintainers must figure out the role of each parameter and keep track of their
position.</p>
<pre>
void setCoordinates(int x1, int y1, int z1, int x2, int y2, int z2) { // Noncompliant
    // ...
}
</pre>
<p>The solution can be to:</p>
<ul>
  <li> Split the method into smaller ones </li>
</ul>
<pre>
// Each function does a part of what the original setCoordinates function was doing, so confusion risks are lower
void setOrigin(int x, int y, int z) {
   // ...
}

void setSize(int width, int height, int depth) {
   // ...
}
</pre>
<ul>
  <li> Find a better data structure for the parameters that group data in a way that makes sense for the specific application domain </li>
</ul>
<pre>
class Point // In geometry, Point is a logical structure to group data
{
    public int x;
    public int y;
    public int z;
 };

void setCoordinates(Point p1, Point p2) {
    // ...
}
</pre>
<p>This rule raises an issue when a method has more parameters than the provided threshold.</p>
<h3>Exceptions</h3>
<p>Methods annotated with :</p>
<ul>
  <li> Spring’s <code>@RequestMapping</code> (and related shortcut annotations, like <code>@GetRequest</code>) </li>
  <li> JAX-RS API annotations (like <code>@javax.ws.rs.GET</code>) </li>
  <li> Bean constructor injection with <code>@org.springframework.beans.factory.annotation.Autowired</code> </li>
  <li> CDI constructor injection with <code>@javax.inject.Inject</code> </li>
  <li> <code>@com.fasterxml.jackson.annotation.JsonCreator</code> </li>
  <li> Micronaut’s annotations (like <code>@io.micronaut.http.annotation.Get</code>) </li>
</ul>
<p>may have a lot of parameters, encapsulation being possible. Therefore the rule ignores such methods.</p>
<p>Also, if a class annotated as a Spring component (like <code>@org.springframework.stereotype.Component</code>) has a single constructor, that
constructor will be considered <code>@Autowired</code> and ignored by the rule.</p></p>
            </div>
        <div class="rule">
            <h3>Nested blocks of code should not be left empty (java:S108)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>An empty code block is confusing. It will require some effort from maintainers to determine if it is intentional or indicates the implementation is
incomplete.</p>
<pre>
for (int i = 0; i &lt; 42; i++){}  // Noncompliant: is the block empty on purpose, or is code missing?
</pre>
<p>Removing or filling the empty code blocks takes away ambiguity and generally results in a more straightforward and less surprising code.</p>
<h3>Exceptions</h3>
<p>The rule ignores code blocks that contain comments unless they are <code>synchronized</code> blocks because these can affect program flow.</p></p>
            </div>
        <div class="rule">
            <h3>Magic numbers should not be used (java:S109)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Replacing them with a constant allows us to provide a meaningful name associated with the value. Instead of adding complexity to the code, it
brings clarity and helps to understand the context and the global meaning.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public static void doSomething() {
  for (int i = 0; i &lt; 4; i++) {  // Noncompliant, 4 is a magic number
    ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public static final int NUMBER_OF_CYCLES = 4;
public static void doSomething() {
  for (int i = 0; i &lt; NUMBER_OF_CYCLES ; i++) { // Compliant
    ...
  }
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>A magic number is a hard-coded numerical value that may lack context or meaning. They should not be used because they can make the code less
readable and maintainable.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Magic numbers make the code more complex to understand as it requires the reader to have knowledge about the global context to understand the
number itself. Their usage may seem obvious when writing the code, but it may not be the case for another developer or later once the context faded
away. -1, 0, and 1 are not considered magic numbers.</p>
<h3>Exceptions</h3>
<p>This rule ignores <code>hashCode</code> methods.</p></p>
            </div>
        <div class="rule">
            <h3>Control structures should use curly braces (java:S121)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>While not technically incorrect, the omission of curly braces can be misleading and may lead to the introduction of errors during maintenance.</p>
<p>In the following example, the two calls seem to be attached to the <code>if</code> statement, but only the first one is, and
<code>checkSomething</code> will always be executed:</p>
<pre>
if (condition)  // Noncompliant
  executeSomething();
  checkSomething();
</pre>
<p>Adding curly braces improves the code readability and its robustness:</p>
<pre>
if (condition) {
  executeSomething();
  checkSomething();
}
</pre>
<p>The rule raises an issue when a control structure has no curly braces.</p>
<h3>Exceptions</h3>
<p>The rule doesn’t raise an issue when the body of an <code>if</code> statement is a single <code>return</code>, <code>break</code>, or
<code>continue</code> and is on the same line.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Control structures are code statements that impact the program’s control flow (e.g., if statements, for loops, etc.)</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/MzZGBQ">CERT, EXP52-J.</a> - Use braces for the body of an if, for, or while statement </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"Externalizable" classes should have no-arguments constructors (java:S2060)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A class that implements <code>java.io.Externalizable</code> is a class that provides a way to customize the serialization and deserialization,
allowing greater control over how the object’s state is written or read.</p>
<p>The first step of the deserialization process is to call the class' no-argument constructor before the <code>readExternal(ObjectInput in)</code>
method.</p>
<p>An implicit default no-argument constructor exists on a class when no constructor is explicitly defined within the class. But this implicit
constructor does not exist when any constructor is explicitly defined, and in this case, we should always ensure that one of the constructors has
no-argument.</p>
<p>It is an issue if the implicit or explicit no-argument constructor is missing or not public, because the deserialization will fail and throw an
<code>InvalidClassException: no valid constructor.</code>.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>This issue can be fixed by:</p>
<ul>
  <li> Adding an explicit public no-argument constructor. </li>
  <li> Or if all constructors can be removed, remove all constructors to benefit of the default implicit no-argument constructor. </li>
</ul>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Tomato implements Externalizable {

  public Color color;

  // Noncompliant; because of this constructor there is no implicit no-argument constructor,
  // deserialization will fail
  public Tomato(Color color) {
    this.color = color;
  }

  @Override
  public void writeExternal(ObjectOutput out) throws IOException {
    out.writeUTF(color.name());
  }

  @Override
  public void readExternal(ObjectInput in) throws IOException {
    color = Color.valueOf(in.readUTF());
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Tomato implements Externalizable {

  public Color color;

  // Compliant; deserialization will invoke this public no-argument constructor
  public Tomato() {
    this.color = Color.UNKNOWN;
  }

  public Tomato(Color color) {
    this.color = color;
  }

  @Override
  public void writeExternal(ObjectOutput out) throws IOException {
    out.writeUTF(color.name());
  }

  @Override
  public void readExternal(ObjectInput in) throws IOException {
    color = Color.valueOf(in.readUTF());
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Externalizable.html">Oracle SDK - java.io.Externalizable</a>
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"wait" should not be called when multiple locks are held (java:S3046)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When two locks are held simultaneously, a <code>wait</code> call only releases one of them. The other will be held until some other thread requests
a lock on the awaited object. If no unrelated code tries to lock on that object, then all other threads will be locked out, resulting in a
deadlock.</p>
<h3>Noncompliant code example</h3>
<pre>
synchronized (this.mon1) {  // threadB can't enter this block to request this.mon2 lock &amp; release threadA
	synchronized (this.mon2) {
		this.mon2.wait();  // Noncompliant; threadA is stuck here holding lock on this.mon1
	}
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Multiple loops over the same set should be combined (java:S3047)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a method loops multiple over the same set of data, whether it’s a list or a set of numbers, it is highly likely that the method could be made
more efficient by combining the loops into a single set of iterations.</p>
<h3>Noncompliant code example</h3>
<pre>
public void doSomethingToAList(List&lt;String&gt; strings) {
  for (String str : strings) {
    doStep1(str);
  }
  for (String str : strings) {  // Noncompliant
    doStep2(str);
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void doSomethingToAList(List&lt;String&gt; strings) {
  for (String str : strings) {
    doStep1(str);
    doStep2(str);
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Passwords should not be stored in plaintext or with a fast hashing algorithm (java:S5344)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>The improper storage of passwords poses a significant security risk to software applications. This vulnerability arises when passwords are stored
in plaintext or with a fast hashing algorithm. To exploit this vulnerability, an attacker typically requires access to the stored passwords.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<p>The following code is vulnerable because it uses a legacy digest-based password encoding that is not considered secure.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
@Autowired
public void configureGlobal(AuthenticationManagerBuilder auth, DataSource dataSource) throws Exception {
  auth.jdbcAuthentication()
    .dataSource(dataSource)
    .usersByUsernameQuery("SELECT * FROM users WHERE username = ?")
    .passwordEncoder(new StandardPasswordEncoder()); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
@Autowired
public void configureGlobal(AuthenticationManagerBuilder auth, DataSource dataSource) throws Exception {
  auth.jdbcAuthentication()
    .dataSource(dataSource)
    .usersByUsernameQuery("SELECT * FROM users WHERE username = ?")
    .passwordEncoder(new BCryptPasswordEncoder());
}
</pre>
<h3>How does this work?</h3>
<h4>Use secure password hashing algorithms</h4>
<p>In general, you should rely on an algorithm that has no known security vulnerabilities. The MD5 and SHA-1 algorithms should not be used.</p>
<p>Some algorithms, such as the SHA family functions, are considered strong for some use cases, but are too fast in computation and therefore
vulnerable to brute force attacks, especially with bruteforce-attack-oriented hardware.</p>
<p>To protect passwords, it is therefore important to choose modern, slow password-hashing algorithms. The following algorithms are, in order of
strength, the most secure password hashing algorithms to date:</p>
<ol>
  <li> Argon2 </li>
  <li> scrypt </li>
  <li> bcrypt </li>
  <li> PBKDF2 </li>
</ol>
<p>Argon2 should be the best choice, and others should be used when the previous one is not available. For systems that must use FIPS-140-certified
algorithms, PBKDF2 should be used.</p>
<p>Whenever possible, choose the strongest algorithm available. If the algorithm currently used by your system should be upgraded, OWASP documents
possible upgrade methods here: <a
href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#upgrading-legacy-hashes">Upgrading Legacy Hashes</a>.</p>
<p>In the previous example, the <code>BCryptPasswordEncoder</code> is a password hashing function in Java that is designed to be secure and resistant
to various types of attacks, including brute-force and rainbow table attacks. It is slow, adaptative, and automatically implements a salt.</p>
<h4>Never store passwords in plaintext</h4>
<p>A user password should never be stored in plaintext. Instead, a hash should be produced from it using a secure algorithm. When dealing with
password storage security, best practices recommend relying on a slow hashing algorithm, that will make brute force attacks more difficult. Using a
hashing function with adaptable computation and memory complexity also is recommended to be able to increase the security level with time.</p>
<p>Adding a salt to the digest computation is also recommended to prevent pre-computed table attacks (see rule <a href='/coding_rules#rule_key=java%3AS2053'>S2053</a>).</p>
<h3>Pitfalls</h3>
<h4>Pre-hashing passwords</h4>
<p>As bcrypt has a maximum length input length of 72 bytes for most implementations, some developers may be tempted to pre-hash the password with a
stronger algorithm before hashing it with bcrypt.</p>
<p>Pre-hashing passwords with bcrypt is not recommended as it can lead to a specific range of issues. Using a strong salt and a high number of rounds
is enough to protect the password.</p>
<p>More information about this can be found here: <a
href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html#pre-hashing-passwords-with-bcrypt">Pre-hashing Passwords with
Bcrypt</a>.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Spring Framework Security Documentation - <a
  href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/crypto/bcrypt/BCryptPasswordEncoder.html">Class
  BCryptPasswordEncoder</a> </li>
  <li> OWASP CheatSheet - <a href="https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html">Password Storage Cheat Sheet</a>
  </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/256">CWE-256 - Plaintext Storage of a Password</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/916">CWE-916 - Use of Password Hash With Insufficient Computational Effort</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222542">Application Security and
  Development: V-222542</a> - The application must only store cryptographic representations of passwords. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Attackers who would get access to the stored passwords could reuse them without further attacks or with little additional effort.<br> Obtaining the
plaintext passwords, they could then gain unauthorized access to user accounts, potentially leading to various malicious activities.</p>
<h3>What is the potential impact?</h3>
<p>Plaintext or weakly hashed password storage poses a significant security risk to software applications.</p>
<h4>Unauthorized Access</h4>
<p>When passwords are stored in plaintext or with weak hashing algorithms, an attacker who gains access to the password database can easily retrieve
and use the passwords to gain unauthorized access to user accounts. This can lead to various malicious activities, such as unauthorized data access,
identity theft, or even financial fraud.</p>
<h4>Credential Reuse</h4>
<p>Many users tend to reuse passwords across multiple platforms. If an attacker obtains plaintext or weakly hashed passwords, they can potentially use
these credentials to gain unauthorized access to other accounts held by the same user. This can have far-reaching consequences, as sensitive personal
information or critical systems may be compromised.</p>
<h4>Regulatory Compliance</h4>
<p>Many industries and jurisdictions have specific regulations and standards to protect user data and ensure its confidentiality. Storing passwords in
plaintext or with weak hashing algorithms can lead to non-compliance with these regulations, potentially resulting in legal consequences, financial
penalties, and damage to the reputation of the software application and its developers.</p></p>
            </div>
        <div class="rule">
            <h3>Allowing requests with excessive content length is security-sensitive (java:S5693)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>With default limit value of 8388608 (8MB).</p>
<p>A 100 MB file is allowed to be uploaded:</p>
<pre>
@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver();
  multipartResolver.setMaxUploadSize(104857600); // Sensitive (100MB)
  return multipartResolver;
}

@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver(); // Sensitive, by default if maxUploadSize property is not defined, there is no limit and thus it's insecure
  return multipartResolver;
}

@Bean
public MultipartConfigElement multipartConfigElement() {
  MultipartConfigFactory factory = new MultipartConfigFactory(); // Sensitive, no limit by default
  return factory.createMultipartConfig();
}
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Compliant Solution</h2>
<p>File upload size is limited to 8 MB:</p>
<pre>
@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  multipartResolver.setMaxUploadSize(8388608); // Compliant (8 MB)
  return multipartResolver;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> size limits are not defined for the different resources of the web application. </li>
  <li> the web application is not protected by <a href="https://en.wikipedia.org/wiki/Rate_limiting">rate limiting</a> features. </li>
  <li> the web application infrastructure has limited resources. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> For most of the features of an application, it is recommended to limit the size of requests to:
    <ul>
      <li> lower or equal to 8mb for file uploads. </li>
      <li> lower or equal to 2mb for other requests. </li>
    </ul>  </li>
</ul>
<p>It is recommended to customize the rule with the limit values that correspond to the web application.</p>
<h2>Sensitive Code Example</h2>
<p>With default limit value of 8388608 (8MB).</p>
<p>A 100 MB file is allowed to be uploaded:</p>
<pre>
@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver();
  multipartResolver.setMaxUploadSize(104857600); // Sensitive (100MB)
  return multipartResolver;
}

@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  CommonsMultipartResolver multipartResolver = new CommonsMultipartResolver(); // Sensitive, by default if maxUploadSize property is not defined, there is no limit and thus it's insecure
  return multipartResolver;
}

@Bean
public MultipartConfigElement multipartConfigElement() {
  MultipartConfigFactory factory = new MultipartConfigFactory(); // Sensitive, no limit by default
  return factory.createMultipartConfig();
}
</pre>
<h2>Compliant Solution</h2>
<p>File upload size is limited to 8 MB:</p>
<pre>
@Bean(name = "multipartResolver")
public CommonsMultipartResolver multipartResolver() {
  multipartResolver.setMaxUploadSize(8388608); // Compliant (8 MB)
  return multipartResolver;
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/Denial_of_Service_Cheat_Sheet.html">Owasp Cheat Sheet</a> - Owasp Denial of Service
  Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/770">CWE-770 - Allocation of Resources Without Limits or Throttling</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/400">CWE-400 - Uncontrolled Resource Consumption</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Rejecting requests with significant content length is a good practice to control the network traffic intensity and thus resource consumption in
order to prevent DoS attacks.</p>
</p>
            </div>
        <div class="rule">
            <h3>Credentials should not be hard-coded (java:S6437)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> AWS Documentation - <a href="https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html">What is AWS Secrets Manager</a> </li>
  <li> Azure Documentation - <a href="https://learn.microsoft.com/en-us/azure/key-vault/">Azure Key Vault</a> </li>
  <li> Google Cloud - <a href="https://cloud.google.com/secret-manager/docs">Secret Manager documentation</a> </li>
  <li> HashiCorp Developer - <a href="https://developer.hashicorp.com/vault/docs">Vault Documentation</a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 - Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 - Category A2 - Broken
  Authentication</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/259">CWE-259 - Use of Hard-coded Password</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p><strong>Revoke the secret</strong></p>
<p>Revoke any leaked secrets and remove them from the application source code.</p>
<p>Before revoking the secret, ensure that no other applications or processes are using it. Other usages of the secret will also be impacted when the
secret is revoked.</p>
<p><strong>Analyze recent secret use</strong></p>
<p>When available, analyze authentication logs to identify any unintended or malicious use of the secret since its disclosure date. Doing this will
allow determining if an attacker took advantage of the leaked secret and to what extent.</p>
<p>This operation should be part of a global incident response process.</p>
<p><strong>Use a secret vault</strong></p>
<p>A secret vault should be used to generate and store the new secret. This will ensure the secret’s security and prevent any further unexpected
disclosure.</p>
<p>Depending on the development platform and the leaked secret type, multiple solutions are currently available.</p>

<p>The following code example is noncompliant because it uses a hardcoded secret value.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.h2.security.SHA256;

String inputString = "s3cr37";
byte[] key         = inputString.getBytes();

SHA256.getHMAC(key, message);  // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.h2.security.SHA256;

String inputString = System.getenv("SECRET");
byte[] key         = inputString.getBytes();

SHA256.getHMAC(key, message);
</pre>
<h3>How does this work?</h3>
<p>While the noncompliant code example contains a hard-coded password, the compliant solution retrieves the secret’s value from its environment. This
allows to have an environment-dependent secret value and avoids storing the password in the source code itself.</p>
<p>Depending on the application and its underlying infrastructure, how the secret gets added to the environment might change.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Secret leaks often occur when a sensitive piece of authentication data is stored with the source code of an application. Considering the source
code is intended to be deployed across multiple assets, including source code repositories or application hosting servers, the secrets might get
exposed to an unintended audience.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In most cases, trust boundaries are violated when a secret is exposed in a source code repository or an uncontrolled deployment environment.
Unintended people who don’t need to know the secret might get access to it. They might then be able to use it to gain unwanted access to associated
services or resources.</p>
<p>The trust issue can be more or less severe depending on the people’s role and entitlement.</p>
<h3>What is the potential impact?</h3>
<p>The consequences vary greatly depending on the situation and the secret-exposed audience. Still, two main scenarios should be considered.</p>
<h4>Financial loss</h4>
<p>Financial losses can occur when a secret is used to access a paid third-party-provided service and is disclosed as part of the source code of
client applications. Having the secret, each user of the application will be able to use it without limit to use the third party service to their own
need, including in a way that was not expected.</p>
<p>This additional use of the secret will lead to added costs with the service provider.</p>
<p>Moreover, when rate or volume limiting is set up on the provider side, this additional use can prevent the regular operation of the affected
application. This might result in a partial denial of service for all the application’s users.</p>
<h4>Application’s security downgrade</h4>
<p>A downgrade can happen when the disclosed secret is used to protect security-sensitive assets or features of the application. Depending on the
affected asset or feature, the practical impact can range from a sensitive information leak to a complete takeover of the application, its hosting
server or another linked component.</p>
<p>For example, an application that would disclose a secret used to sign user authentication tokens would be at risk of user identity impersonation.
An attacker accessing the leaked secret could sign session tokens for arbitrary users and take over their privileges and entitlements.</p></p>
            </div>
        <div class="rule">
            <h3>Package names should comply with a naming convention (java:S120)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Rename packages with the expected naming convention</p>

<h4>Noncompliant code example</h4>
<p>With the default regular expression <code>^[a-z_]+(\.[a-z_][a-z0-9_]*)*$</code>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
package org.exAmple; // Noncompliant
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
package org.example;
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Shared naming conventions improve readability and allow teams to collaborate efficiently. This rule checks that all package names match a provided
regular expression.</p></p>
            </div>
        <div class="rule">
            <h3>Counter Mode initialization vectors should not be reused (java:S6432)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-CRYPTO/">Mobile AppSec Verification Standard - Cryptography Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m5-insufficient-cryptography">Mobile Top 10 2016 Category M5 -
  Insufficient Cryptography</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/323">CWE-323 - Reusing a Nonce, Key Pair in Encryption</a> </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38a.pdf">NIST, SP-800-38A</a> - Recommendation for Block Cipher
  Modes of Operation </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38c.pdf">NIST, SP-800-38C</a> - Recommendation for Block Cipher
  Modes of Operation: The CCM Mode for Authentication and Confidentiality </li>
  <li> <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST, SP-800-38D</a> - Recommendation for Block Cipher
  Modes of Operation: Galois/Counter Mode (GCM) and GMAC </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The example uses a hardcoded IV as a nonce, which causes AES-CCM to be insecure. To fix it, a nonce is randomly generated instead.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="201" data-diff-type="noncompliant">
public void encrypt(byte[] key, byte[] ptxt) {
    byte[] nonce = "7cVgr5cbdCZV".getBytes(StandardCharsets.UTF_8);

    BlockCipher engine = new AESEngine();
    AEADParameters params = new AEADParameters(new KeyParameter(key), 128, nonce);
    CCMBlockCipher cipher = new CCMBlockCipher(engine);

    cipher.init(true, params); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="201" data-diff-type="compliant">
public void encrypt(byte[] key, byte[] ptxt) {
    SecureRandom random = new SecureRandom();
    byte[] nonce = new byte[12];
    random.nextBytes(nonce);

    BlockCipher engine = new AESEngine();
    AEADParameters params = new AEADParameters(new KeyParameter(key), 128, nonce);
    CCMBlockCipher cipher = new CCMBlockCipher(engine);

    cipher.init(true, params);
}
</pre>
<h3>How does this work?</h3>
<p>For AES-GCM and AES-CCM, NIST recommends generating a nonce using either a deterministic approach or using a 'Random Bit Generator (RBG)'.</p>
<h4>Generating nonces using random number generation</h4>
<p>When using a randomized approach, NIST recommends a nonce of at least 96 bits using a cryptographically secure pseudorandom number generator
(CSPRNG.) Such a generator can create output with a sufficiently low probability of the same number being output twice (also called a
<em>collision</em>) for a long time. However, after 2<sup>32</sup> generated numbers for the same key, NIST recommends rotating this key for a new
one. After that amount of generated numbers, the probability of a collision is high enough to be considered insecure.</p>
<p>The code example above demonstrates how CSPRNGs can be used to generate nonces.</p>
<p>Be careful to use a random number generator that is sufficiently secure. Default (non-cryptographically secure) RNGs might be more prone to
collisions in their output, which is catastrophic for counter-based encryption modes.</p>
<h4>Deterministically generating nonces</h4>
<p>One method to prevent the same IV from being used multiple times for the same key is to update the IV in a deterministic way after each encryption.
The most straightforward deterministic method for this is a counter.</p>
<p>The way this works is simple: for any key, the first IV is the number zero. After this IV is used to encrypt something with a key, it is
incremented for that key (and is now equal to 1). Although this requires additional bookkeeping, it should guarantee that for each encryption key, an
IV is never repeated.</p>
<p>For a secure implementation, NIST suggests generating these nonces in two parts: a fixed field and an invocation field. The fixed field should be
used to identify the device executing the encryption (for example, it could contain a device ID), such that for one key, no two devices can generate
the same nonce. The invocation field contains the counter as described above. For a 96-bit nonce, NIST recommends (but does not require) using a
32-bit fixed field and a 64-bit invocation field. Additional details can be found in the <a
href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST Special Publication 800-38D</a>.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The example uses a hardcoded IV as a nonce, which causes AES-CCM to be insecure. To fix it, a nonce is randomly generated instead.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="101" data-diff-type="noncompliant">
public void encrypt(byte[] key, byte[] ptxt) {
    byte[] nonce = "7cVgr5cbdCZV".getBytes("UTF-8");

    Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");
    SecretKeySpec keySpec = new SecretKeySpec(key, "AES");
    GCMParameterSpec gcmSpec = new GCMParameterSpec(128, nonce);

    cipher.init(Cipher.ENCRYPT_MODE, keySpec, gcmSpec); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="101" data-diff-type="compliant">
public void encrypt(byte[] key, byte[] ptxt) {
    SecureRandom random = new SecureRandom();
    byte[] nonce = new byte[12];
    random.nextBytes(nonce);

    Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");
    SecretKeySpec keySpec = new SecretKeySpec(key, "AES");
    GCMParameterSpec gcmSpec = new GCMParameterSpec(128, nonce);

    cipher.init(Cipher.ENCRYPT_MODE, keySpec, gcmSpec);
}
</pre>
<h3>How does this work?</h3>
<p>For AES-GCM and AES-CCM, NIST recommends generating a nonce using either a deterministic approach or using a 'Random Bit Generator (RBG)'.</p>
<h4>Generating nonces using random number generation</h4>
<p>When using a randomized approach, NIST recommends a nonce of at least 96 bits using a cryptographically secure pseudorandom number generator
(CSPRNG.) Such a generator can create output with a sufficiently low probability of the same number being output twice (also called a
<em>collision</em>) for a long time. However, after 2<sup>32</sup> generated numbers for the same key, NIST recommends rotating this key for a new
one. After that amount of generated numbers, the probability of a collision is high enough to be considered insecure.</p>
<p>The code example above demonstrates how CSPRNGs can be used to generate nonces.</p>
<p>Be careful to use a random number generator that is sufficiently secure. Default (non-cryptographically secure) RNGs might be more prone to
collisions in their output, which is catastrophic for counter-based encryption modes.</p>
<h4>Deterministically generating nonces</h4>
<p>One method to prevent the same IV from being used multiple times for the same key is to update the IV in a deterministic way after each encryption.
The most straightforward deterministic method for this is a counter.</p>
<p>The way this works is simple: for any key, the first IV is the number zero. After this IV is used to encrypt something with a key, it is
incremented for that key (and is now equal to 1). Although this requires additional bookkeeping, it should guarantee that for each encryption key, an
IV is never repeated.</p>
<p>For a secure implementation, NIST suggests generating these nonces in two parts: a fixed field and an invocation field. The fixed field should be
used to identify the device executing the encryption (for example, it could contain a device ID), such that for one key, no two devices can generate
the same nonce. The invocation field contains the counter as described above. For a 96-bit nonce, NIST recommends (but does not require) using a
32-bit fixed field and a 64-bit invocation field. Additional details can be found in the <a
href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST Special Publication 800-38D</a>.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>When encrypting data using AES-GCM or AES-CCM, it is essential not to reuse the same initialization vector (IV, also called nonce) with a given
key. To prevent this, it is recommended to either randomize the IV for each encryption or increment the IV after each encryption.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When encrypting data using a counter (CTR) derived block cipher mode of operation, it is essential not to reuse the same initialization vector (IV)
for a given key. An IV that complies with this requirement is called a "nonce" (<strong>n</strong>umber used <strong>once</strong>). Galois/Counter
(GCM) and Counter with Cipher Block Chaining-Message Authentication Code (CCM) are both derived from counter mode.</p>
<p>When using AES-GCM or AES-CCM, a given key and IV pair will create a "keystream" that is used to encrypt a plaintext (original content) into a
ciphertext (encrypted content.) For any key and IV pair, this keystream is always deterministic. Because of this property, encrypting several
plaintexts with one key and IV pair can be catastrophic. If an attacker has access to one plaintext and its associated ciphertext, they are able to
decrypt everything that was created using the same pair.</p>
<p>Additionally, IV reuse also drastically decreases the key recovery computational complexity by downgrading it to a simpler polynomial root-finding
problem. This means that even without access to a plaintext/ciphertext pair, an attacker may still be able to decrypt all the sensitive data.</p>
<h3>What is the potential impact?</h3>
<p>If the encryption that is being used is flawed, attackers might be able to exploit it in several ways. They might be able to decrypt existing
sensitive data or bypass key protections.</p>
<p>Below are some real-world scenarios that illustrate some impacts of an attacker exploiting the vulnerability.</p>
<h4>Theft of sensitive data</h4>
<p>The encrypted message might contain data that is considered sensitive and should not be known to third parties.</p>
<p>By not using the encryption algorithm correctly, the likelihood that an attacker might be able to recover the original sensitive data drastically
increases.</p>
<h4>Additional attack surface</h4>
<p>Encrypted values are often considered trusted, since under normal circumstances it would not be possible for a third party to modify them. If an
attacker is able to modify the cleartext of the encrypted message, it might be possible to trigger other vulnerabilities in the code.</p></p>
            </div>
        <div class="rule">
            <h3>Interface names should comply with a naming convention (java:S114)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Sharing some naming conventions is a key point to make it possible for a team to efficiently collaborate. This rule allows to check that all
interface names match a provided regular expression.</p>
<h3>Noncompliant code example</h3>
<p>With the default regular expression <code>^[A-Z][a-zA-Z0-9]*$</code>:</p>
<pre>
public interface myInterface {...} // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
public interface MyInterface {...}
</pre></p>
            </div>
        <div class="rule">
            <h3>Statements should be on separate lines (java:S122)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Putting multiple statements on a single line lowers the code readability and makes debugging the code more complex.</p>
<pre>
if (someCondition) doSomething(); // Noncompliant
</pre>
<p>Write one statement per line to improve readability.</p>
<pre>
if (someCondition) {
  doSomething();
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Formatting SQL queries is security-sensitive (java:S2077)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 = null;
  Statement stmt2 = null;
  PreparedStatement pstmt;
  try {
    stmt1 = con.createStatement();
    ResultSet rs1 = stmt1.executeQuery("GETDATE()"); // No issue; hardcoded query

    stmt2 = con.createStatement();
    ResultSet rs2 = stmt2.executeQuery("select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=" + user);  // Sensitive

    pstmt = con.prepareStatement("select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=" + user);  // Sensitive
    ResultSet rs3 = pstmt.executeQuery();

    //...
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query = session.createQuery(
            "FROM students where fname = " + data);  // Sensitive
  // ...
}
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 = null;
  PreparedStatement pstmt = null;
  String query = "select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=?"
  try {
    stmt1 = con.createStatement();
    ResultSet rs1 = stmt1.executeQuery("GETDATE()");

    pstmt = con.prepareStatement(query);
    pstmt.setString(1, user);  // Good; PreparedStatements escape their inputs.
    ResultSet rs2 = pstmt.executeQuery();

    //...
  }
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query =  session.createQuery("FROM students where fname = ?");
  query = query.setParameter(0,data);  // Good; Parameter binding escapes all input

  org.hibernate.Query query2 =  session.createQuery("FROM students where fname = " + data); // Sensitive
  // ...
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/564">CWE-564 - SQL Injection: Hibernate</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/943">CWE-943 - Improper Neutralization of Special Elements in Data Query Logic</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/coding_rules#rule_key=javasecurity%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted queries.</p>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Formatted SQL queries can be difficult to maintain, debug and can increase the risk of SQL injection when concatenating untrusted values into the
query. However, this rule doesn’t detect SQL injections (unlike rule <a href='/coding_rules#rule_key=javasecurity%3AS3649'>S3649</a>), the goal is only to highlight complex/formatted queries.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Some parts of the query come from untrusted values (like user inputs). </li>
  <li> The query is repeated/duplicated in other parts of the code. </li>
  <li> The application must support different types of relational databases. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html">parameterized queries, prepared
  statements, or stored procedures</a> and bind variables to SQL query parameters. </li>
  <li> Consider using ORM frameworks if there is a need to have an abstract layer to access data. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 = null;
  Statement stmt2 = null;
  PreparedStatement pstmt;
  try {
    stmt1 = con.createStatement();
    ResultSet rs1 = stmt1.executeQuery("GETDATE()"); // No issue; hardcoded query

    stmt2 = con.createStatement();
    ResultSet rs2 = stmt2.executeQuery("select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=" + user);  // Sensitive

    pstmt = con.prepareStatement("select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=" + user);  // Sensitive
    ResultSet rs3 = pstmt.executeQuery();

    //...
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query = session.createQuery(
            "FROM students where fname = " + data);  // Sensitive
  // ...
}
</pre>
<h2>Compliant Solution</h2>
<pre>
public User getUser(Connection con, String user) throws SQLException {

  Statement stmt1 = null;
  PreparedStatement pstmt = null;
  String query = "select FNAME, LNAME, SSN " +
                 "from USERS where UNAME=?"
  try {
    stmt1 = con.createStatement();
    ResultSet rs1 = stmt1.executeQuery("GETDATE()");

    pstmt = con.prepareStatement(query);
    pstmt.setString(1, user);  // Good; PreparedStatements escape their inputs.
    ResultSet rs2 = pstmt.executeQuery();

    //...
  }
}

public User getUserHibernate(org.hibernate.Session session, String data) {

  org.hibernate.Query query =  session.createQuery("FROM students where fname = ?");
  query = query.setParameter(0,data);  // Good; Parameter binding escapes all input

  org.hibernate.Query query2 =  session.createQuery("FROM students where fname = " + data); // Sensitive
  // ...
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/89">CWE-89 - Improper Neutralization of Special Elements used in an SQL Command</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/564">CWE-564 - SQL Injection: Hibernate</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/20">CWE-20 - Improper Input Validation</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/943">CWE-943 - Improper Neutralization of Special Elements in Data Query Logic</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ITdGBQ">CERT, IDS00-J.</a> - Prevent SQL injection </li>
  <li> Derived from FindSecBugs rules <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JPA">Potential SQL/JPQL Injection
  (JPA)</a>, <a href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_JDO">Potential SQL/JDOQL Injection (JDO)</a>, <a
  href="https://h3xstream.github.io/find-sec-bugs/bugs.htm#SQL_INJECTION_HIBERNATE">Potential SQL/HQL Injection (Hibernate)</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Modulus results should not be checked for direct equality (java:S2197)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When the modulus of a negative number is calculated, the result will either be negative or zero. Thus, comparing the modulus of a variable for
equality with a positive number (or a negative one) could result in unexpected results.</p>
<h3>Noncompliant code example</h3>
<pre>
public boolean isOdd(int x) {
  return x % 2 == 1;  // Noncompliant; if x is an odd negative, x % 2 == -1
}
</pre>
<h3>Compliant solution</h3>
<pre>
public boolean isOdd(int x) {
  return x % 2 != 0;
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/pDdGBQ">CERT, NUM51-J.</a> - Do not assume that the remainder operator always returns a
  nonnegative result for integral operands </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/_NUxBQ">CERT, INT10-C</a> - Do not assume a positive remainder when using the % operator </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"writeObject" should not be the only "synchronized" code in a class (java:S3042)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Consider whether this class is used in a multithreaded context. If it is, ask yourself whether other methods in this class should also be marked as
<code>synchronized</code>. Otherwise, remove the <code>synchronized</code> modifier from this method.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class RubberBall implements Serializable {

  private Color color;
  private int diameter;

  public RubberBall(Color color, int diameter) {
    // ...
  }

  public void bounce(float angle, float velocity) {
    // ...
  }

  private synchronized void writeObject(ObjectOutputStream stream) throws IOException { // Noncompliant, "writeObject" is the only synchronized method in this class
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class RubberBall implements Serializable {

  private Color color;
  private int diameter;

  public RubberBall(Color color, int diameter) {
    // ...
  }

  public void bounce(float angle, float velocity) {
    // ...
  }

  private void writeObject(ObjectOutputStream stream) throws IOException { // Compliant, no methods in this class are synchronized
    // ...
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Synchronization is a mechanism used when multithreading in Java to ensure that only one thread executes a given block of code at a time. This is
done to avoid bugs that can occur when multiple threads share a given state and try to manipulate simultaneously.</p>
<p>Object serialization is not thread-safe by default. In a multithreaded environment, one option is to mark <code>writeObject</code> with
<code>synchronized</code> to improve thread safety. It is highly suspicious, however, if <code>writeObject</code> is the only
<code>synchronized</code> method in a class. It may indicate that serialization is not required, as multithreading is not used. Alternatively, it
could also suggest that other methods in the same class have been forgotten to be made thread-safe.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Serializable.html">Java SE 17 &amp; JDK 17 - Serializable
  Javadoc</a> </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html">The Java™ Tutorials - Synchronized Methods</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Files should end with a newline (java:S113)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Some tools work better when files end with a newline.</p>
<p>This rule simply generates an issue if it is missing.</p>
<p>For example, a Git diff looks like this if the empty line is missing at the end of the file:</p>
<pre>
+class Test {
+}
\ No newline at end of file
</pre></p>
            </div>
        <div class="rule">
            <h3>Constant names should comply with a naming convention (java:S115)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>Constants should be named consistently to communicate intent and improve maintainability. Rename your constants to follow your project’s naming
convention to address this issue.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Constants are variables whose value does not change during the runtime of a program after initialization. Oftentimes, constants are used in
multiple locations across different subroutines.</p>
<p>It is important that the names of constants follow a consistent and easily recognizable pattern. This way, readers immediately understand that the
referenced value does not change, which simplifies debugging.</p>
<p>Or, in the case of primitive constants, that accessing the constant is thread-safe.</p>
<p>This rule checks that all constant names match a given regular expression.</p>
<h3>What is the potential impact?</h3>
<p>Ignoring the naming convention for constants makes the code less readable since constants and variables are harder to tell apart. Code that is hard
to understand is also difficult to maintain between different team members.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>First, familiarize yourself with the particular naming convention of the project in question. Then, update the name of the constant to match the
convention, as well as all usages of the name. For many IDEs, you can use built-in renaming and refactoring features to update all usages of a
constant at once.</p>

<h4>Noncompliant code example</h4>
<p>The following example assumes that constant names should match the default regular expression <code>^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$</code>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
  public static final float pi = 3.14159f; // Noncompliant: Constant is not capitalized

  void myMethod() {
    System.out.println(pi);
  }
}

public enum MyEnum {
  optionOne, // Noncompliant
  optionTwo; // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
  public static final float PI = 3.14159f;

  void myMethod() {
    System.out.println(PI);
  }
}

public enum MyEnum {
  OPTION_ONE,
  OPTION_TWO;
}
</pre>
<h3>Exceptions</h3>
<p>The rule applies to fields of primitive types (for example, <code>float</code>), boxed primitives (<code>Float</code>), and Strings. We do not
apply it to other types, which can be mutated, or have methods with side effects.</p>
<pre>
public static final Logger log = getLogger(MyClass.class);
public static final List&lt;Integer&gt; myList = new ArrayList&lt;&gt;();

// call with side-effects
log.info("message")

// mutating an object
myList.add(28);
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>External coding guidelines</h3>
<ul>
  <li> <a href="https://google.github.io/styleguide/javaguide.html#s5.2.4-constant-names">The Google Java Style Guide on Constant Names</a>. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Field names should comply with a naming convention (java:S116)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Oracle - <a href="https://www.oracle.com/java/technologies/javase/codeconventions-namingconventions.html">Java SE Naming Conventions</a> </li>
  <li> Geeksforgeeks - <a href="https://www.geeksforgeeks.org/java-naming-conventions/">Java Naming Conventions</a> </li>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Naming_convention_(programming)">Naming Convention (programming)</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A naming convention in software development is a set of guidelines for naming code elements like variables, functions, and classes.</p>
<p>The goal of a naming convention is to make the code more readable and understandable, which makes it easier to maintain and debug. It also ensures
consistency in the code, especially when multiple developers are working on the same project.</p>
<p>This rule checks that field names match a provided regular expression.</p>
<p>Using the regular expression <code>^[a-z][a-zA-Z0-9]*$</code>, the noncompliant code below:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
class MyClass {
   private int my_field;
}
</pre>
<p>Should be replaced with:</p>
<pre data-diff-id="1" data-diff-type="compliant">
class MyClass {
   private int myField;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Local variable and method parameter names should comply with a naming convention (java:S117)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A naming convention in software development is a set of guidelines for naming code elements like variables, functions, and classes.<br> Local
variables and method parameters hold the meaning of the written code. Their names should be meaningful and follow a consistent and easily recognizable
pattern.<br> Adhering to a consistent naming convention helps to make the code more readable and understandable, which makes it easier to maintain and
debug. It also ensures consistency in the code, especially when multiple developers are working on the same project.</p>
<p>This rule checks that local variable and method parameter names match a provided regular expression.</p>
<h3>What is the potential impact?</h3>
<p>Inconsistent naming of local variables and method parameters can lead to several issues in your code:</p>
<ul>
  <li> <strong>Reduced Readability</strong>: Inconsistent local variable and method parameter names make the code harder to read and understand;
  consequently, it is more difficult to identify the purpose of each variable, spot errors, or comprehend the logic. </li>
  <li> <strong>Difficulty in Identifying Variables</strong>: The local variables and method parameters that don’t adhere to a standard naming
  convention are challenging to identify; thus, the coding process slows down, especially when dealing with a large codebase. </li>
  <li> <strong>Increased Risk of Errors</strong>: Inconsistent or unclear local variable and method parameter names lead to misunderstandings about
  what the variable represents. This ambiguity leads to incorrect assumptions and, consequently, bugs in the code. </li>
  <li> <strong>Collaboration Difficulties</strong>: In a team setting, inconsistent naming conventions lead to confusion and miscommunication among
  team members. </li>
  <li> <strong>Difficulty in Code Maintenance</strong>: Inconsistent naming leads to an inconsistent codebase. The code is difficult to understand,
  and making changes feels like refactoring constantly, as you face different naming methods. Ultimately, it makes the codebase harder to maintain.
  </li>
</ul>
<p>In summary, not adhering to a naming convention for local variables and method parameters can lead to confusion, errors, and inefficiencies, making
the code harder to read, understand, and maintain.</p>
<h3>Exceptions</h3>
<p>Loop counters are ignored by this rule.</p>
<pre>
for (int i_1 = 0; i_1 &lt; limit; i_1++) {  // Compliant
  // ...
}
</pre>
<p>as well as one-character <code>catch</code> variables:</p>
<pre>
try {
//...
} catch (Exception e) { // Compliant
}
</pre></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>First, familiarize yourself with the particular naming convention of the project in question. Then, update the name to match the convention, as
well as all usages of the name. For many IDEs, you can use built-in renaming and refactoring features to update all usages at once.</p>

<h4>Noncompliant code example</h4>
<p>With the default regular expression <code>^[a-z][a-zA-Z0-9]*$</code>:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
    public void doSomething(int myParam) {
      int LOCAL;    // Noncompliant
      // ...
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
    public void doSomething(int my_param) {
      int local;
      // ...
    }
}
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Local variables and method parameters should be named consistently to communicate intent and improve maintainability. Rename your local variable or
method parameter to follow your project’s naming convention to address this issue.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Oracle - <a href="https://www.oracle.com/java/technologies/javase/codeconventions-namingconventions.html">Java SE Naming Conventions</a> </li>
  <li> Geeksforgeeks - <a href="https://www.geeksforgeeks.org/java-naming-conventions/">Java Naming Conventions</a> </li>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Naming_convention_(programming)">Naming Convention (programming)</a> </li>
</ul>
<h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS100'>S100</a> - Method names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS101'>S101</a> - Class names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS114'>S114</a> - Interface names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS115'>S115</a> - Constant names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS116'>S116</a> - Field names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS118'>S118</a> - Abstract class names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS119'>S119</a> - Type parameter names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS120'>S120</a> - Package names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS1312'>S1312</a> - Loggers should be "private static final" and should share a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS3008'>S3008</a> - Static non-final field names should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS3577'>S3577</a> - Test classes should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS3578'>S3578</a> - Test methods should comply with a naming convention </li>
  <li> <a href='/coding_rules#rule_key=java%3AS4174'>S4174</a> - Local constants should follow naming conventions for constants </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Abstract class names should comply with a naming convention (java:S118)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Sharing some naming conventions is a key point to make it possible for a team to efficiently collaborate. This rule allows to check that all
<code>abstract</code> class names match a provided regular expression. If a non-abstract class match the regular expression, an issue is raised to
suggest to either make it abstract or to rename it.</p>
<h3>Noncompliant code example</h3>
<p>With the default regular expression: <code>^Abstract[A-Z][a-zA-Z0-9]*$</code>:</p>
<pre>
abstract class MyClass { // Noncompliant
}

class AbstractLikeClass { // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
abstract class AbstractClass {
}

class LikeClass {
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Type parameter names should comply with a naming convention (java:S119)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared naming conventions make it possible for a team to collaborate efficiently. Following the established convention of single-letter type
parameter names helps users and maintainers of your code quickly see the difference between a type parameter and a poorly named class.</p>
<p>This rule check that all type parameter names match a provided regular expression. The following code snippets use the default regular
expression.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass&lt;TYPE&gt; { // Noncompliant
  &lt;TYPE&gt; void method(TYPE t) { // Noncompliant
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyClass&lt;T&gt; {
  &lt;T&gt; void method(T t) {
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>The names of methods with boolean return values should start with "is" or "has" (java:S2047)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Well-named functions can allow the users of your code to understand at a glance what to expect from the function - even before reading the
documentation. Toward that end, methods returning a boolean should have names that start with "is" or "has" rather than with "get".</p>
<h3>Noncompliant code example</h3>
<pre>
public boolean getFoo() { // Noncompliant
  // ...
}

public boolean getBar(Bar c) { // Noncompliant
  // ...
}

public boolean testForBar(Bar c) { // Compliant - The method does not start by 'get'.
  // ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public boolean isFoo() {
  // ...
}

public boolean hasBar(Bar c) {
  // ...
}

public boolean testForBar(Bar c) {
  // ...
}
</pre>
<h3>Exceptions</h3>
<p>Overriding methods are excluded.</p>
<pre>
@Override
public boolean getFoo(){
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Double-checked locking should not be used (java:S2168)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html">The "Double-Checked Locking is Broken" Declaration</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/6zdGBQ">CERT, LCK10-J.</a> - Use a correct form of the double-checked locking idiom </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/609">CWE-609 - Double-checked locking</a> </li>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html#jls-12.4">JLS 12.4</a> - Initialization of Classes and Interfaces </li>
  <li> Wikipedia: <a href="https://en.wikipedia.org/wiki/Double-checked_locking#Usage_in_Java">Double-checked locking</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Given significant performance improvements of <code>synchronized</code> methods in recent JVM versions, <code>synchronized</code> methods are now
preferred over the less robust double-checked locking.</p>
<p>If marking the entire method as <code>synchronized</code> is not an option, consider using an inner <code>static class</code> to hold the reference
instead. Inner static classes are guaranteed to be initialized lazily.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class ResourceFactory {
    private static Resource resource;

    public static Resource getInstance() {
        if (resource == null) {
            synchronized (DoubleCheckedLocking.class) { // Noncompliant, not thread-safe due to the use of double-checked locking.
                if (resource == null)
                    resource = new Resource();
            }
        }
        return resource;
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class ResourceFactory {
    private static Resource resource;

    public static synchronized Resource getInstance() { // Compliant, the entire method is synchronized and hence thread-safe
        if (resource == null)
            resource = new Resource();
        return resource;
    }
}
</pre>
<h4>Compliant solution</h4>
<p>Alternatively, a static inner class can be used. However, this solution is less explicit in its intention and hence should be used with care.</p>
<pre>
public class ResourceFactory {
    private static class ResourceHolder {
        public static Resource resource = new Resource(); // Compliant, as this will be lazily initialised by the JVM
    }

    public static Resource getResource() {
        return ResourceFactory.ResourceHolder.resource;
    }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Double-checked locking is the practice of checking a lazy-initialized object’s state both before and after a <code>synchronized</code> block is
entered to determine whether to initialize the object. In early JVM versions, synchronizing entire methods was not performant, which sometimes caused
this practice to be used in its place.</p>
<p>Apart from <code>float</code> and <code>int</code> types, this practice does not work reliably in a platform-independent manner without additional
synchronization of mutable instances. Using double-checked locking for the lazy initialization of any other type of primitive or mutable object risks
a second thread using an uninitialized or partially initialized member while the first thread is still creating it. The results can be unexpected,
potentially even causing the application to crash.</p></p>
            </div>
        <div class="rule">
            <h3>Switches should be used for sequences of simple "String" tests (java:S2196)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Since Java 7, <code>String</code>s can be used as <code>switch</code> arguments. So when a single <code>String</code> is tested against three or
more values in an <code>if</code>/<code>else if</code> structure, it should be converted to a switch instead for greater readability.</p>
<p><strong>Note</strong> that this rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>7</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
if ("red".equals(choice)) {  // Noncompliant
  dispenseRed();
} else if ("blue".equals(choice)) {
  dispenseBlue();
} else if ("yellow".equals(choice)) {
  dispenseYellow();
} else {
  promptUser();
}
</pre>
<h3>Compliant solution</h3>
<pre>
switch(choice) {
  case "Red":
    dispenseRed();
    break;
  case "Blue":
    dispenseBlue():
    break;
  case "Yellow":
    dispenseYellow();
    break;
  default:
    promptUser();
    break;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Track uses of disallowed constructors (java:S4011)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>This rule allows banning usage of certain constructors.</p>
<h3>Noncompliant code example</h3>
<p>Given parameters:</p>
<ul>
  <li> className: java.util.Date </li>
  <li> argumentTypes: java.lang.String </li>
</ul>
<pre>
Date birthday;
birthday = new Date("Sat Sep 27 05:42:21 EDT 1986");  // Noncompliant
birthday = new Date(528176541000L); // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Secure random number generators should not output predictable values (java:S4347)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Random number generators are often used to generate random values for cryptographic algorithms. When a random number generator is used for
cryptographic purposes, the generated numbers must be as random and unpredictable as possible. When the random number generator is improperly seeded
with a constant or a predictable value, its output will also be predictable.</p>
<p>This can have severe security implications for cryptographic operations that rely on the randomness of the generated numbers. By using a
predictable seed, an attacker can potentially guess or deduce the generated numbers, compromising the security of whatever cryptographic algorithm
relies on the random number generator.</p>
<h3>What is the potential impact?</h3>
<p>It is crucial to understand that the strength of cryptographic algorithms heavily relies on the quality of the random numbers used. By improperly
seeding a CSPRNG, we introduce a significant weakness that can be exploited by attackers.</p>
<h4>Insecure cryptographic keys</h4>
<p>One of the primary use cases for CSPRNGs is generating cryptographic keys. If an attacker can predict the seed used to initialize the random number
generator, they may be able to derive the same keys. Depending on the use case, this can lead to multiple severe outcomes, such as:</p>
<ul>
  <li> Being able to decrypt sensitive documents, leading to privacy breaches or identity theft. </li>
  <li> Gaining access to a private key used for signing, allowing an attacker to forge digital signatures and impersonate legitimate entities. </li>
  <li> Bypassing authentication mechanisms that rely on public-key infrastructure (PKI), which can be abused to gain unauthorized access to systems or
  networks. </li>
</ul>
<h4>Session hijacking and man-in-the-middle attack</h4>
<p>Another scenario where this vulnerability can be exploited is in the generation of session tokens or nonces for secure communication protocols. If
an attacker can predict the seed used to generate these tokens, they can impersonate legitimate users or intercept sensitive information.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code uses a cryptographically strong random number generator to generate data that is not cryptographically strong.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
SecureRandom sr = new SecureRandom();
sr.setSeed(123456L); // Noncompliant
int v = sr.next(32);
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
SecureRandom sr = new SecureRandom("abcdefghijklmnop".getBytes("us-ascii")); // Noncompliant
int v = sr.next(32);
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
SecureRandom sr = new SecureRandom();
int v = sr.next(32);
</pre>
<p>This solution is available for JDK 1.8 and higher.</p>
<pre data-diff-id="2" data-diff-type="compliant">
SecureRandom sr = SecureRandom.getInstanceStrong();
int v = sr.next(32);
</pre>
<h3>How does this work?</h3>
<p>When the randomly generated data needs to be cryptographically strong, <code>SecureRandom</code> is the correct class to use. However, its
documentation also cites that "any seed material passed to a <code>SecureRandom</code> object must be unpredictable". When no seed is passed by the
user to the object, the <code>SecureRandom</code> object chooses an unpredictable seed by default. Therefore, the easiest way to fix the issue is to
use the default constructor without any calls to <code>SecureObject.setSeed()</code>.</p>
<p>To go the extra mile, <code>SecureObject.getInstanceStrong()</code> returns an instance of <code>SecureObject</code> that is guaranteed to use a
strong algorithm for its number generation.</p>
<p>If the randomly generated data is not used for cryptographic purposes and is not business critical, it may be a better choice to use
<code>java.util.Random</code> instead. In this case, setting a predictable seed may be acceptable depending on the situation.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/security/SecureRandom.html">Class
  <code>java.security.SecureRandom</code></a> </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/330">CWE-330 - Use of Insufficiently Random Values</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/332">CWE-332 - Insufficient Entropy in PRNG</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/336">CWE-336 - Same Seed in Pseudo-Random Number Generator (PRNG)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/337">CWE-337 - Predictable Seed in Pseudo-Random Number Generator (PRNG)</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/MSC63-J.+Ensure+that+SecureRandom+is+properly+seeded">CERT, MSC63J.</a> - Ensure that
  SecureRandom is properly seeded </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>Cryptographic operations often rely on unpredictable random numbers to enhance security. These random numbers are created by cryptographically
secure pseudo-random number generators (CSPRNG). It is important not to use a predictable seed with these random number generators otherwise the
random numbers will also become predictable.</p></p>
            </div>
        <div class="rule">
            <h3>"iterator" should not return "this" (java:S4348)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class FooIterator implements Iterator&lt;Foo&gt;, Iterable&lt;Foo&gt; {
  private Foo[] seq;
  private int idx = 0;

  public boolean hasNext() {
    return idx &lt; seq.length;
  }

  public Foo next() {
    return seq[idx++];
  }

  public Iterator&lt;Foo&gt; iterator() {
    return this; // Noncompliant
  }
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class FooSequence implements Iterable&lt;Foo&gt; {
  private Foo[] seq;

  public Iterator&lt;Foo&gt; iterator() {
    return new Iterator&lt;Foo&gt;() { // Compliant
      private int idx = 0;

      public boolean hasNext() {
        return idx &lt; seq.length;
      }

      public Foo next() {
        return seq[idx++];
      }
    };
  }
  // ...
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>An <code>Iterable</code> should not implement the <code>Iterator</code> interface or return <code>this</code> as an <code>Iterator</code>. The
reason is that <code>Iterator</code> represents the iteration process itself, while <code>Iterable</code> represents the object we want to iterate
over.</p>
<p>The <code>Iterator</code> instance encapsulates state information of the iteration process, such as the current and next element. Consequently,
distinct iterations require distinct <code>Iterator</code> instances, for which <code>Iterable</code> provides the factory method
<code>Iterable.iterator()</code>.</p>
<p>This rule raises an issue when the <code>Iterable.iterator()</code> of a class implementing both <code>Iterable</code> and <code>Iterator</code>
returns <code>this</code>.</p>
<h3>What is the potential impact?</h3>
<p>The <code>Iterable.iterator()</code> method returning the same <code>Iterator</code> instance many times would have the following effects:</p>
<ol>
  <li> For subsequent iterations, e.g., two subsequent <code>for</code> loops with iterators over the same object, only the first one would iterate,
  and the others would do nothing. </li>
  <li> For nested iterations over the same object, the different iteration processes would affect each other because they only have a common, shared
  state. </li>
</ol></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Iterable.html">Java SE 7 API Specification: java.lang.Iterable</a> </li>
  <li> <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Iterator.html">Java SE 7 API Specification: java.util.Iterator</a> </li>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.14.2">Java 7 Language Specification: The enhanced for
  statement</a> (since Java 1.5) </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"write(byte[],int,int)" should be overridden (java:S4349)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When directly subclassing <code>java.io.OutputStream</code> or <code>java.io.FilterOutputStream</code>, the only requirement is that you implement
the method <code>write(int)</code>. However most uses for such streams don’t write a single byte at a time and the default implementation for
<code>write(byte[],int,int)</code> will call <code>write(int)</code> for every single byte in the array which can create a lot of overhead and is
utterly inefficient. It is therefore strongly recommended that subclasses provide an efficient implementation of
<code>write(byte[],int,int)</code>.</p>
<p>This rule raises an issue when a direct subclass of <code>java.io.OutputStream</code> or <code>java.io.FilterOutputStream</code> doesn’t provide an
override of <code>write(byte[],int,int)</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyStream extends OutputStream { // Noncompliant
    private FileOutputStream fout;

    public MyStream(File file) throws IOException {
        fout = new FileOutputStream(file);
    }

    @Override
    public void write(int b) throws IOException {
        fout.write(b);
    }

    @Override
    public void close() throws IOException {
        fout.write("\n\n".getBytes());
        fout.close();
        super.close();
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyStream extends OutputStream {
    private FileOutputStream fout;

    public MyStream(File file) throws IOException {
        fout = new FileOutputStream(file);
    }

    @Override
    public void write(int b) throws IOException {
        fout.write(b);
    }

    @Override
    public void write(byte[] b, int off, int len) throws IOException {
        fout.write(b, off, len);
    }

    @Override
    public void close() throws IOException {
        fout.write("\n\n".getBytes());
        fout.close();
        super.close();
    }
}
</pre>
<h3>Exceptions</h3>
<p>This rule doesn’t raise an issue when the class is declared <code>abstract</code>.</p></p>
            </div>
        <div class="rule">
            <h3>OpenSAML2 should be configured to prevent authentication bypass (java:S5679)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>If the Service Provider does not manage to properly validate the incoming SAML response message signatures, attackers might be able to manipulate
the response content without the application noticing. Especially, they might be able to alter the authentication-targeted user.</p>
<h3>What is the potential impact?</h3>
<p>By exploiting this vulnerability, an attacker can manipulate the SAML Response to impersonate a different user. This, in turn, can have various
consequences on the application’s security.</p>
<h3>Unauthorized Access</h3>
<p>Exploiting this vulnerability allows an attacker with authenticated access to impersonate other users within the SAML-based SSO system. This can
lead to unauthorized access to sensitive information, resources, or functionalities the attacker should not have. By masquerading as legitimate users,
the attacker can bypass authentication mechanisms and gain unauthorized privileges, potentially compromising the entire system. By impersonating a
user with higher privileges, the attacker can gain access to additional resources. Privilege escalation can lead to further compromise of other
systems and unauthorized access to critical infrastructure.</p>
<h3>Data Breaches</h3>
<p>With the ability to impersonate other users, an attacker can gain access to sensitive data stored within the SAML-based SSO system. This includes
personally identifiable information (PII), financial data, intellectual property, or any other confidential information. Data breaches can result in
reputational damage, legal consequences, financial losses, and harm to individuals whose data is exposed.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>The Security Assertion Markup Language (SAML) is a widely used standard in single sign-on systems. In a simplified version, the user authenticates
to an Identity Provider which generates a signed SAML Response. This response is then forwarded to a Service Provider for validation and
authentication.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code examples are vulnerable because they explicitly include comments in signature checks. An attacker is able to change the field
identifying the authenticated user with XML comments.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import org.opensaml.xml.parse.StaticBasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  StaticBasicParserPool staticBasicParserPool = new StaticBasicParserPool();
  staticBasicParserPool.setIgnoreComments(false); // Noncompliant
  return staticBasicParserPool;
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
import org.opensaml.xml.parse.BasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  BasicParserPool basicParserPool = new BasicParserPool();
  basicParserPool.setIgnoreComments(false); // Noncompliant
  return basicParserPool;
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import org.opensaml.xml.parse.StaticBasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  return new StaticBasicParserPool();
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
import org.opensaml.xml.parse.BasicParserPool;
import org.opensaml.xml.parse.ParserPool;

public ParserPool parserPool() {
  return new BasicParserPool();
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> OpenSAML API - <a href="https://javadoc.io/doc/org.opensaml/xmltooling/latest/org/opensaml/xml/parse/BasicParserPool.html">Class
  BasicParserPool</a> </li>
  <li> OpenSAML API - <a href="https://javadoc.io/doc/org.opensaml/xmltooling/latest/org/opensaml/xml/parse/StaticBasicParserPool.html">Class
  StaticBasicParserPool</a> </li>
  <li> W3C Recommendation - <a href="https://www.w3.org/TR/xml-c14n11/">Canonical XML Version 1.1</a> </li>
  <li> W3C Recommendation - <a href="https://www.w3.org/TR/xmldsig-core1/">XML Signature Syntax and Processing Version 1.1</a> </li>
</ul>
<h3>Articles &amp; blog posts</h3>
<ul>
  <li> Cisco Duo - <a href="https://duo.com/blog/duo-finds-saml-vulnerabilities-affecting-multiple-implementations">Duo Finds SAML Vulnerabilities
  Affecting Multiple Implementations</a> </li>
  <li> Spring blog - <a href="https://spring.io/blog/2018/03/01/spring-security-saml-and-this-week-s-saml-vulnerability">Spring Security SAML and this
  week’s SAML Vulnerability</a> </li>
  <li> Spring Security SAML - <a href="https://github.com/spring-projects/spring-security-saml/issues/228">Issue #228 Multiple SAML libraries may
  allow authentication bypass via incorrect XML canonicalization and DOM traversal</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11427">CVE-2017-11427</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11428">CVE-2017-11428</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11429">CVE-2017-11429</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11430">CVE-2017-11430</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0489">CVE-2018-0489</a> </li>
  <li> CVE - <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7340">CVE-2018-7340</a> </li>
</ul>
<h2>Standards</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">Top 10 2021 Category A6 - Vulnerable and Outdated
  Components</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Proper Sensor Resource Management (java:S6889)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Ensure that resources are released when they are no longer needed. This can be done by calling the appropriate release method, such as
<code>release()</code>, <code>removeUpdates()</code>, <code>unregisterListener()</code>, or <code>stop()</code>.</p>

<ul>
  <li> <code>android.os.PowerManager.WakeLock</code> </li>
</ul>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void method() {
  PowerManager powerManager = (PowerManager) getSystemService(POWER_SERVICE);
  PowerManager.WakeLock wakeLock = powerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK, "My Wake Lock");
  wakeLock.acquire(); // Noncompliant
  // do some work...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void method() {
  PowerManager powerManager = (PowerManager) getSystemService(POWER_SERVICE);
  PowerManager.WakeLock wakeLock = powerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK, "My Wake Lock");
  wakeLock.acquire(); // Compliant
  // do some work...
  wakeLock.release();
}
</pre>
<ul>
  <li> <code>android.media.MediaPlayer</code> </li>
</ul>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
public void method() {
  MediaPlayer mediaPlayer = MediaPlayer.create(context, R.raw.sound_file_1);
  mediaPlayer.start(); // Noncompliant
  // do some work...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
public void onCreate() {
  MediaPlayer mediaPlayer = MediaPlayer.create(context, R.raw.sound_file_1);
  mediaPlayer.start(); // Compliant
  // do some work...
  wakeLock.release();
}
</pre>
<ul>
  <li> <code>android.hardware.SensorManager</code> </li>
</ul>
<h4>Noncompliant code example</h4>
<pre data-diff-id="3" data-diff-type="noncompliant">
public void method() {
  SensorManager sensorManager = getSystemService(SENSOR_SERVICE);
  Sensor accelerometer = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);
  sensorManager.registerListener(this, accelerometer, SensorManager.SENSOR_DELAY_NORMAL); // Noncompliant
  // do some work...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
public void method() {
  SensorManager sensorManager = getSystemService(SENSOR_SERVICE);
  Sensor accelerometer = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);
  sensorManager.registerListener(this, accelerometer, SensorManager.SENSOR_DELAY_NORMAL); // Compliant
  // do some work...
  sensorManager.unregisterListener(this);
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Optimizing resource usage and preventing unnecessary battery drain are critical considerations in Android development. Failing to release sensor
resources when they are no longer needed can lead to prolonged device activity, negatively impacting battery life. Common Android sensors, such as
cameras, GPS, and microphones, provide a method to release resources after they are not in use anymore.</p>
<p>This rule identifies situations where a sensor is not released after being utilized, helping developers maintain efficient and battery-friendly
applications.</p>
<ul>
  <li> Missing call to <code>release()</code> method:
    <ul>
      <li> <code>android.os.PowerManager.WakeLock</code> </li>
      <li> <code>android.net.wifi.WifiManager$MulticastLock</code> </li>
      <li> <code>android.hardware.Camera</code> </li>
      <li> <code>android.media.MediaPlayer</code> </li>
      <li> <code>android.media.MediaRecorder</code> </li>
      <li> <code>android.media.SoundPool</code> </li>
      <li> <code>android.media.audiofx.Visualizer</code> </li>
      <li> <code>android.hardware.display.VirtualDisplay</code> </li>
    </ul>  </li>
  <li> Missing call to <code>close()</code> method
    <ul>
      <li> <code>android.hardware.camera2.CameraDevice</code> </li>
    </ul>  </li>
  <li> Missing call to <code>removeUpdates()</code> method:
    <ul>
      <li> <code>android.location.LocationManager</code> </li>
    </ul>  </li>
  <li> Missing call to <code>unregisterListener()</code> method:
    <ul>
      <li> <code>android.hardware.SensorManager</code> </li>
    </ul>  </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://developer.android.com/reference/android/location/LocationManager">Android - LocationManager</a> </li>
  <li> <a href="https://developer.android.com/reference/android/os/PowerManager.WakeLock">Android - PowerManager.WakeLock</a> </li>
  <li> <a href="https://developer.android.com/reference/android/net/wifi/WifiManager.MulticastLock">Android - WifiManager.MulticastLock</a> </li>
  <li> <a href="https://developer.android.com/reference/android/media/projection/MediaProjection">Android - MediaProjection</a> </li>
  <li> <a href="https://developer.android.com/reference/android/media/MediaPlayer">Android - MediaPlayer</a> </li>
  <li> <a href="https://developer.android.com/reference/android/media/MediaRecorder">Android - MediaRecorder</a> </li>
  <li> <a href="https://developer.android.com/reference/android/media/SoundPool">Android - SoundPool</a> </li>
  <li> <a href="https://developer.android.com/reference/android/media/audiofx/Visualizer">Android - Visualizer</a> </li>
  <li> <a href="https://developer.android.com/reference/android/hardware/SensorManager">Android - SensorManager</a> </li>
  <li> <a href="https://developer.android.com/develop/background-work/background-tasks/scheduling/wakelock">Android - Keep the device awake</a> </li>
  <li> <a href="https://developer.android.com/media/platform/mediaplayer">Android - MediaPlayer Overview</a> </li>
  <li> <a href="https://developer.android.com/develop/sensors-and-location/sensors/sensors_overview">Android - Sensors Overview</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Nested code blocks should not be used (java:S1199)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Nested code blocks create new scopes where variables declared within are inaccessible from the outside, and their lifespan ends with the block.</p>
<p>Although this may appear beneficial, their usage within a function often suggests that the function is overloaded. Thus, it may violate the Single
Responsibility Principle, and the function needs to be broken down into smaller functions.</p>
<p>The presence of nested blocks that don’t affect the control flow might suggest possible mistakes in the code.</p>
<h3>Exceptions</h3>
<p>The usage of a code block after a <code>case</code> is allowed.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The nested code blocks should be extracted into separate methods.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Example {

    private final Deque&lt;Integer&gt; stack = new LinkedList&lt;&gt;();

    public void evaluate(int operator) {
      switch (operator) {
        case ADD: {
          /* ... */
          { // Noncompliant - Extract this nested code block into a method
            int a = stack.pop();
            int b = stack.pop();
            int result = a + b;
            stack.push(result);
          }
          /* ... */
          break;
        }
        /* ... */
      }
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
class Example {

    private final Deque&lt;Integer&gt; stack = new LinkedList&lt;&gt;();

    public void evaluate(int operator) {
      switch (operator) {
        case ADD: {
          /* ... */
          evaluateAdd();
          /* ... */
          break;
        }
        /* ... */
      }
    }

    private void evaluateAdd() {
      int a = stack.pop();
      int b = stack.pop();
      int result = a + b;
      stack.push(result);
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Wikipedia - <a href="https://en.wikipedia.org/wiki/Single-responsibility_principle">Single Responsibility Principle</a> </li>
  <li> Baeldung - <a href="https://www.baeldung.com/java-single-responsibility-principle">Single Responsibility Principle</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Math should not be performed on floats (java:S2164)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/CtcxBQ">CERT, FLP02-C.</a> - Avoid using floating-point numbers when precise computation is
  needed </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>For small numbers, <code>float</code> math has enough precision to yield the expected value, but for larger numbers, it does not.
<code>BigDecimal</code> is the best alternative, but if a primitive is required, use a <code>double</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
float a = 16777216.0f;
float b = 1.0f;
float c = a + b; // Noncompliant; yields 1.6777216E7 not 1.6777217E7

double d = a + b; // Noncompliant; addition is still between 2 floats
</pre>
<h3>Compliant solution</h3>
<pre>
float a = 16777216.0f;
float b = 1.0f;
BigDecimal c = BigDecimal.valueOf(a).add(BigDecimal.valueOf(b));

double d = (double)a + (double)b;
</pre>
<h3>Exceptions</h3>
<p>This rule doesn’t raise an issue when the mathematical expression is only used to build a string.</p>
<pre>
System.out.println("["+getName()+"] " +
           "\n\tMax time to retrieve connection:"+(max/1000f/1000f)+" ms.");
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes named like "Exception" should extend "Exception" or a subclass (java:S2166)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Clear, communicative naming is important in code. It helps maintainers and API users understand the intentions for and uses of a unit of code.
Using "exception" in the name of a class that does not extend <code>Exception</code> or one of its subclasses is a clear violation of the expectation
that a class' name will indicate what it is and/or does.</p>
<h3>Noncompliant code example</h3>
<pre>
public class FruitException {  // Noncompliant; this has nothing to do with Exception
  private Fruit expected;
  private String unusualCharacteristics;
  private boolean appropriateForCommercialExploitation;
  // ...
}

public class CarException {  // Noncompliant; the extends clause was forgotten?
  public CarException(String message, Throwable cause) {
  // ...
</pre>
<h3>Compliant solution</h3>
<pre>
public class FruitSport {
  private Fruit expected;
  private String unusualCharacteristics;
  private boolean appropriateForCommercialExploitation;
  // ...
}

public class CarException extends Exception {
  public CarException(String message, Throwable cause) {
  // ...
</pre></p>
            </div>
        <div class="rule">
            <h3>"compareTo" should not return "Integer.MIN_VALUE" (java:S2167)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html#compareTo-T-">Java SE 8 API Specification:
  Comparable.compareTo</a> </li>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html#MIN_VALUE">Java SE 8 API Specification: Integer.MIN_VALUE</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Comparable.compareTo</code> method returns a negative integer, zero, or a positive integer to indicate whether the object is less than,
equal to, or greater than the parameter. The sign of the return value or whether it is zero is what matters, not its magnitude.</p>
<p>Returning a positive or negative constant value other than the basic ones (-1, 0, or 1) provides no additional information to the caller. Moreover,
it could potentially confuse code readers who are trying to understand its purpose.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace any positive constant return value with 1. Replace any negative constant return value with -1.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public int compareTo(Name name) {
  if (condition) {
    return Integer.MIN_VALUE; // Noncompliant
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public int compareTo(Name name) {
  if (condition) {
    return -1; // Compliant
  }
}
</pre>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
public int compareTo(Name name) {
  if (condition) {
    return 42; // Noncompliant
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="2" data-diff-type="compliant">
public int compareTo(Name name) {
  if (condition) {
    return 1; // Compliant
  }
}
</pre>
<h4>Noncompliant code example</h4>
<p>It is compliant to return other values than -1, 0 or 1 if they are not constants.</p>
<pre data-diff-id="3" data-diff-type="noncompliant">
public int compareTo(Name name) {
  if (condition) {
    return 42; // Noncompliant
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="3" data-diff-type="compliant">
public int compareTo(Name name) {
  if (condition) {
    return hashCode() - name.hashCode(); // Compliant, not a constant
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"ThreadGroup" should not be used (java:S3014)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/YzdGBQ">CERT, THI01-J.</a> - Do not invoke ThreadGroup methods </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>ThreadGroup</code> class contains many deprecated methods like <code>allowThreadSuspension</code>, <code>resume</code>,
<code>stop</code>, and <code>suspend</code>. Also, some of the non-deprecated methods are obsolete or not thread-safe, and still others are insecure
(<code>activeCount</code>, <code>enumerate</code>). For these reasons, any use of <code>ThreadGroup</code> is suspicious and should be avoided.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Instead, use implementations of <code>java.util.concurrent.ExecutorService</code> to safely manage groups of threads.</p>

<h4>Noncompliant code example</h4>
<pre>
class NetworkHandler {

  void startThreadInGroup(ThreadGroup tg) { // Noncompliant, use an ExecutorService instead, which is more secure
    Thread thread = new Thread(tg, "controller");
    thread.start();
  }

}
</pre>
<h4>Compliant solution</h4>
<pre>
class NetworkHandler {

  void handleThreadsProperly() {
    ThreadFactory threadFactory = Executors.defaultThreadFactory();
    ThreadPoolExecutor executorPool = new ThreadPoolExecutor(3, 10, 5, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(2), threadFactory);
    for (int i = 0; i &lt; 10; i++) {
      executorPool.execute(new Thread("Job: " + i));
    }
    executorPool.shutdown();
  }

}
</pre></p>
            </div>
        <div class="rule">
            <h3>Use built-in "Math.clamp" methods (java:S6885)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 21 the <code>java.lang.Math</code> class was updated with the static method <code>Math.clamp</code>, to clamp a numerical value between a
min and a max value.</p>
<p>Using this built-in method is now the preferred way to restrict to a given interval, as it is more readable and less error-prone.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace your clamp method implementation with the <code>Math.clamp</code> method.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
int clampedValue = value &gt; max ? max : value &lt; min ? min : value; // Noncompliant; Replace with "Math.clamp"
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
int clampedValue = Math.max(min, Math.min(max, value)); // Noncompliant; Replace with "Math.clamp"
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
int clampedValue = Math.clamp(value, min, max);
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
int clampedValue = Math.clamp(value, min, max);
</pre></p>
            </div>
        <div class="rule">
            <h3>URIs should not be hardcoded (java:S1075)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Hard-coding a URI makes it difficult to test a program for a variety of reasons:</p>
<ul>
  <li> path literals are not always portable across operating systems </li>
  <li> a given absolute path may not exist in a specific test environment </li>
  <li> a specified Internet URL may not be available when executing the tests </li>
  <li> production environment filesystems usually differ from the development environment </li>
</ul>
<p>In addition, hard-coded URIs can contain sensitive information, like IP addresses, and they should not be stored in the code.</p>
<p>For all those reasons, a URI should never be hard coded. Instead, it should be replaced by a customizable parameter.</p>
<p>Further, even if the elements of a URI are obtained dynamically, portability can still be limited if the path delimiters are hard-coded.</p>
<p>This rule raises an issue when URIs or path delimiters are hard-coded.</p>
<h3>Exceptions</h3>
<p>This rule does not raise an issue when:</p>
<ul>
  <li> A constant path is relative and contains at most two parts. </li>
  <li> A constant path is used in an annotation </li>
  <li> A path is annotated </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Foo {
  public static final String FRIENDS_ENDPOINT = "/user/friends"; // Compliant path is relative and has only two parts

  public Collection&lt;User&gt; listUsers() {
    File userList = new File("/home/mylogin/Dev/users.txt"); // Noncompliant
    Collection&lt;User&gt; users = parse(userList);
    return users;
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class Foo {
  // Configuration is a class that returns customizable properties: it can be mocked to be injected during tests.
  private Configuration config;
  public Foo(Configuration myConfig) {
    this.config = myConfig;
  }
  public Collection&lt;User&gt; listUsers() {
    // Find here the way to get the correct folder, in this case using the Configuration object
    String listingFolder = config.getProperty("myApplication.listingFolder");
    // and use this parameter instead of the hard coded path
    File userList = new File(listingFolder, "users.txt"); // Compliant
    Collection&lt;User&gt; users = parse(userList);
    return users;
  }
}
</pre>
<p>Exceptions examples:</p>
<pre>
public class Foo {
  public static final String FRIENDS_ENDPOINT = "/user/friends"; // Compliant path is relative and has only two parts

  public static final String ACCOUNT = "/account/group/list.html"; // Compliant path is used in an annotation

  @Value("${base.url}" + ACCOUNT)
  private String groupUrl;

  @MyAnnotation()
  String path = "/default/url/for/site"; // Compliant path is annotated

}
</pre></p>
            </div>
        <div class="rule">
            <h3>Future keywords should not be used as names (java:S1190)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/22/docs/specs/unnamed-jls.html#jls-3.9">Oracle - Unnamed Variables and Patterns Keywords</a>
  </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/22/language/unnamed-variables-and-patterns.html">Oracle - Unnamed Variables and Patterns</a>
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Programming languages evolve over time, and new versions of Java introduce additional keywords. If future keywords are used in the current code, it
can create compatibility issues when transitioning to newer versions of Java. The code may fail to compile or behave unexpectedly due to conflicts
with newly introduced keywords.</p>
<p>The <code>_</code> keyword was deprecated in Java 9 and disallowed since Java 11. Starting from Java 22 the <code>_</code> was introduced as
<code>unnamed variable</code>.</p>
<p>This rule reports an issue when <code>_</code> is used in versions prior to Java 22.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Rename the <code>_</code> identifiers.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
    String _ = "";            // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
    String s = "";            // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Classes from "sun.*" packages should not be used (java:S1191)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The classes in the <code>sun.*</code> packages are not part of the official Java API and are not intended for public use. They are internal
implementation details specific to the Oracle JDK (Java Development Kit). Therefore, their availability, behavior, or compatibility is not guaranteed
across different Java implementations or versions.</p>
<p>Since these classes are not part of the official Java API, they usually lack proper documentation and support. Finding comprehensive and up-to-date
information about their usage, functionality, and potential limitations can be challenging. This lack of documentation can make it difficult to
understand how to use these classes correctly.</p>
<p>Classes in the <code>sun.*</code> packages are often platform-dependent and can vary between different operating systems or Java Virtual Machine
(JVM) implementations. Relying on these classes may lead to code that works on one platform but fails on others, limiting your code’s portability and
cross-platform compatibility.</p>
<h3>Noncompliant code example</h3>
<pre>
import sun.misc.BASE64Encoder; // Noncompliant
</pre>
<h2>Documentation</h2>
<ul>
  <li> <a href="https://www.oracle.com/java/technologies/faq-sun-packages.html">Sun Packages</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>String literals should not be duplicated (java:S1192)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Use constants to replace the duplicated string literals. Constants can be referenced from many places, but only need to be updated in a single
place.</p>

<h4>Noncompliant code example</h4>
<p>With the default threshold of 3:</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void run() {
  prepare("action1");                              // Noncompliant - "action1" is duplicated 3 times
  execute("action1");
  release("action1");
}

@SuppressWarning("all")                            // Compliant - annotations are excluded
private void method1() { /* ... */ }
@SuppressWarning("all")
private void method2() { /* ... */ }

public String printInQuotes(String a, String b) {
  return "'" + a + "'" + b + "'";               // Compliant - literal "'" has less than 5 characters and is excluded
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
private static final String ACTION_1 = "action1";  // Compliant

public void run() {
  prepare(ACTION_1);                               // Compliant
  execute(ACTION_1);
  release(ACTION_1);
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Duplicated string literals make the process of refactoring complex and error-prone, as any change would need to be propagated on all
occurrences.</p>
<h3>Exceptions</h3>
<p>To prevent generating some false-positives, literals having less than 5 characters are excluded.</p></p>
            </div>
        <div class="rule">
            <h3>Exception types should not be tested using "instanceof" in catch blocks (java:S1193)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/display/java/ERR51-J.+Prefer+user-defined+exceptions+over+more+general+exception+types">CERT,
  ERR51-J.</a> - Prefer user-defined exceptions over more general exception types </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/catch.html">Oracle - Exceptions</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>try-catch</code> block is used to handle exceptions or errors that may occur during the execution of a block of code. It allows you to
catch and handle exceptions gracefully, preventing your program from terminating abruptly.</p>
<p>The code that may throw an exception is enclosed within the <code>try</code> block, while each <code>catch</code> block specifies the type of
exception it can handle. The corresponding catch block is executed if the exception matches the type specified in any catch block. It is unnecessary
to manually check the types using <code>instanceof</code> because Java automatically matches the exception type to the appropriate catch block based
on the declared exception type in the catch clauses.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace <code>if</code> statements that check the exception type using <code>instanceof</code> with corresponding <code>catch</code> blocks.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
try {
  /* ... */
} catch (Exception e) {
  if(e instanceof IOException) { /* ... */ }         // Noncompliant
  if(e instanceof NullPointerException{ /* ... */ }  // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
try {
  /* ... */
} catch (IOException e) { /* ... */ }                // Compliant
} catch (NullPointerException e) { /* ... */ }       // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>"java.lang.Error" should not be extended (java:S1194)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>java.lang.Error</code> and its subclasses represent abnormal conditions, such as <code>OutOfMemoryError</code>, which should only be
encountered by the Java Virtual Machine.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyException extends Error { /* ... */ }       // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyException extends Exception { /* ... */ }   // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Array designators "[]" should be located after the type in method signatures (java:S1195)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Placing the array designators <code>[]</code> after the type helps maintain backward compatibility with older versions of the Java SE platform.
This syntax contributes to better readability as it becomes easier to distinguish between array types and non-array types. It helps convey the
intention of the method to both the developer implementing it and the developer using it.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class Cube {
    private int magicNumbers[] = { 42 };      // Noncompliant
    public int getVector()[] { /* ... */ }    // Noncompliant
    public int[] getMatrix()[] { /* ... */ }  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
public class Cube {
    private int[] magicNumbers = { 42 };      // Compliant
    public int[] getVector() { /* ... */ }    // Compliant
    public int[][] getMatrix() { /* ... */ }  // Compliant
}
</pre>
<h2>Documentation</h2>
<ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se20/html/jls-10.html">Oracle Java Language Specification</a> - Arrays </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Array designators "[]" should be on the type, not the variable (java:S1197)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Array designators should always be located on the type for better code readability. Otherwise, developers must look both at the type and the
variable name to know whether or not a variable is an array.</p>
<h3>Noncompliant code example</h3>
<pre>
int matrix[][];   // Noncompliant
int[] matrix[];   // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
int[][] matrix;   // Compliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Subclasses that add fields to classes that override "equals" should also override "equals" (java:S2160)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#equals-java.lang.Object-">Object.equals - Java SE 8 API
  Specification</a> </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This rule raises an issue when a subclass of a class that overrides <code>Object.equals</code> introduces new fields but does not also override the
<code>Object.equals</code> method.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Consider the following example:</p>
<pre>
class Foo {

  final int a;

  @Override
  public boolean equals(Object other) {
    if (other == null) return false;
    if (getClass() != other.getClass()) return false;
    return a == ((Foo) other).a;
  }
}
</pre>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Bar extends Foo { // Noncompliant, `equals` ignores the value of `b`
  final int b;
}
</pre>
<p>Override the <code>equals</code> method in the subclass to incorporate the new fields into the comparison:</p>
<pre data-diff-id="1" data-diff-type="compliant">
class Bar extends Foo { // Compliant, `equals` now also considers `b`

  final int b;

  @Override
  public boolean equals(Object other) {
    if (!super.equals(other)) return false;
    return b == ((Bar) other).b;
  }
}
</pre>
<p>In case the new fields should not be part of the comparison because they are, for example, auxiliary variables not contributing to the object value
(), still override the method to make the point clear that this was not just forgotten:</p>
<pre>
class Bar extends Foo { // Compliant, we do explicitly not want to take `b` into account

  final int b;

  @Override
  public boolean equals(Object other) {
    return super.equals(other);
  }
}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When a class overrides <code>Object.equals</code>, this indicates that the class not just considers object identity as equal (the default
implementation of <code>Object.equals</code>) but implements another logic for what is considered equal in the context of this class. Usually (but not
necessarily), the semantics of <code>equals</code> in this case is that two objects are equal when their state is equal field by field.</p>
<p>Because of this, adding new fields to a subclass of a class that overrides <code>Object.equals</code> but not updating the implementation of
<code>equals</code> in the subclass is most likely an error.</p></p>
            </div>
        <div class="rule">
            <h3>"equals" methods should be symmetric and work for subclasses (java:S2162)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A key facet of the <code>equals</code> contract is that if <code>a.equals(b)</code> then <code>b.equals(a)</code>, i.e. that the relationship is
symmetric.</p>
<p>Using <code>instanceof</code> breaks the contract when there are subclasses, because while the child is an <code>instanceof</code> the parent, the
parent is not an <code>instanceof</code> the child. For instance, assume that <code>Raspberry extends Fruit</code> and adds some fields (requiring a
new implementation of <code>equals</code>):</p>
<pre>
Fruit fruit = new Fruit();
Raspberry raspberry = new Raspberry();

if (raspberry instanceof Fruit) { ... } // true
if (fruit instanceof Raspberry) { ... } // false
</pre>
<p>If similar <code>instanceof</code> checks were used in the classes' <code>equals</code> methods, the symmetry principle would be broken:</p>
<pre>
raspberry.equals(fruit); // false
fruit.equals(raspberry); //true
</pre>
<p>Additionally, non <code>final</code> classes shouldn’t use a hardcoded class name in the <code>equals</code> method because doing so breaks the
method for subclasses. Instead, make the comparison dynamic.</p>
<p>Further, comparing to an unrelated class type breaks the contract for that unrelated type, because while
<code>thisClass.equals(unrelatedClass)</code> can return true, <code>unrelatedClass.equals(thisClass)</code> will not.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Fruit extends Food {
  private Season ripe;

  public boolean equals(Object obj) {
    if (obj == this) {
      return true;
    }
    if (obj == null) {
      return false;
    }
    if (Fruit.class == obj.getClass()) { // Noncompliant; broken for child classes
      return ripe.equals(((Fruit)obj).getRipe());
    }
    if (obj instanceof Fruit ) {  // Noncompliant; broken for child classes
      return ripe.equals(((Fruit)obj).getRipe());
    }
    else if (obj instanceof Season) { // Noncompliant; symmetry broken for Season class
      // ...
    }
    //...
</pre>
<h3>Compliant solution</h3>
<pre>
public class Fruit extends Food {
  private Season ripe;

  public boolean equals(Object obj) {
    if (obj == this) {
      return true;
    }
    if (obj == null) {
      return false;
    }
    if (this.getClass() == obj.getClass()) {
      return ripe.equals(((Fruit)obj).getRipe());
    }
    return false;
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/AzZGBQ">CERT, MET08-J.</a> - Preserve the equality contract when overriding the equals() method
  </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Static fields should not be updated in constructors (java:S3010)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Assigning a value to a <code>static</code> field in a constructor could cause unreliable behavior at runtime since it will change the value for all
instances of the class.</p>
<p>Instead remove the field’s <code>static</code> modifier, or initialize it statically.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Person {
  static Date dateOfBirth;
  static int expectedFingers;

  public Person(date birthday) {
    dateOfBirth = birthday;  // Noncompliant; now everyone has this birthday
    expectedFingers = 10;  // Noncompliant
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Person {
  Date dateOfBirth;
  static int expectedFingers = 10;

  public Person(date birthday) {
    dateOfBirth = birthday;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Reflection should not be used to increase accessibility of classes, methods, or fields (java:S3011)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming)">Wikipedia definition of Encapsulation</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/_jZGBQ">CERT, SEC05-J.</a> - Do not use reflection to increase accessibility of classes,
  methods, or fields </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Altering or bypassing the accessibility of classes, methods, or fields through reflection violates the encapsulation principle. This can break the
internal contracts of the accessed target and lead to maintainability issues and runtime errors.</p>
<p>This rule raises an issue when reflection is used to change the visibility of a class, method or field, and when it is used to directly update a
field value.</p>
<pre>
public void makeItPublic(String methodName) throws NoSuchMethodException {

  this.getClass().getMethod(methodName).setAccessible(true); // Noncompliant
}

public void setItAnyway(String fieldName, int value) {
  this.getClass().getDeclaredField(fieldName).setInt(this, value); // Noncompliant; bypasses controls in setter
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Arrays and lists should not be copied using loops (java:S3012)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#copyOf-T:A-int-:~:text=1.6-,copyOf,-public%20static%C2%A0byte">docs.oracle</a>
  - Arrays.copyOf documentation </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList-T…​-:~:text=1.6-,asList,-%40SafeVarargs%0Apublic%20static">docs.oracle</a> - Arrays.asList documentation </li>
  <li> <a
  href="https://docs.oracle.com/javase/8/docs/api/java/lang/System.html#arraycopy-java.lang.Object-int-java.lang.Object-int-int-:~:text=1.5-,arraycopy,-public%20static%C2%A0void">docs.oracle</a> - System.arraycopy documentation </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The JDK provides a set of built-in methods to copy the contents of an array into another array. Using a loop to perform the same operation is less
clear, more verbose and should be avoided.</p>
<h3>Exceptions</h3>
<p>The rule detects only the most idiomatic patterns, it will not consider loops with non-trivial control flow. For example, loops that copy array
elements conditionally are ignored.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>You can use:</p>
<ul>
  <li> <code>Arrays.copyOf</code> to copy an entire array into another array </li>
  <li> <code>System.arraycopy</code> to copy only a subset of an array into another array </li>
  <li> <code>Arrays.asList</code> to create a new list with the contents of the array </li>
  <li> <code>Collections.addAll</code> to add the elements of a collection into another collection </li>
</ul>
<p>Note that <code>Arrays.asList</code> returns a fixed-size <code>List</code>, so further steps are required if a non-fixed-size <code>List</code> is
needed.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public void copyArray(String[] source){
  String[] array = new String[source.length];
  for (int i = 0; i &lt; source.length; i++) {
    array[i] = source[i]; // Noncompliant
  }
}

public void copyList(List&lt;String&gt; source) {
  List&lt;String&gt; list = new ArrayList&lt;&gt;();
  for (String s : source) {
    list.add(s); // Noncompliant
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public void copyArray(String[] source){
  String[] array = Arrays.copyOf(source, source.length);
}

public void copyList(List&lt;String&gt; source) {
  List&lt;String&gt; list = new ArrayList&lt;&gt;();
  Collections.addAll(list, source);
}
</pre>
<pre>
public void makeCopiesConditional(int[] source) {
  int[] dest = new int[source.length];
  for (int i = 0; i &lt; source.length; i++) {
    if (source[i] &gt; 10) {
      dest[i] = source[i];  // Compliant, since the array elements are conditionally copied to the dest array
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"static" base class members should not be accessed via derived types (java:S3252)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In object-oriented programming, inappropriately accessing static members of a base class via derived types is considered a code smell.</p>
<p>Static members are associated with the class itself, not with any specific instance of the class or its children classes. Accessing through the
wrong type suggests a misunderstanding of the ownership and role of this member. This can make the maintenance of the code more complicated.</p>
<p>Therefore, the access should be done directly through the base class to maintain clarity and avoid potential misunderstandings.</p>
<h3>Noncompliant code example</h3>
<pre data-diff-id="1" data-diff-type="noncompliant">
class Parent {
  public static int counter;
}

class Child extends Parent {
  public Child() {
    Child.counter++;  // Noncompliant
  }
}
</pre>
<h3>Compliant solution</h3>
<pre data-diff-id="1" data-diff-type="compliant">
class Parent {
  public static int counter;
}

class Child extends Parent {
  public Child() {
    Parent.counter++;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Default annotation parameter values should not be passed as arguments (java:S3254)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Specifying the default value for an annotation parameter is redundant. Such values should be omitted in the interests of readability.</p>
<h3>Noncompliant code example</h3>
<pre>
@MyAnnotation(arg = "def")  // Noncompliant
public class MyClass {
  // ...
}
public @interface MyAnnotation {
  String arg() default "def";
}
</pre>
<h3>Compliant solution</h3>
<pre>
@MyAnnotation
public class MyClass {
  // ...
}
public @interface MyAnnotation {
  String arg() default "def";
}
</pre></p>
            </div>
        <div class="rule">
            <h3>JUnit5 inner test classes should be annotated with @Nested (java:S5790)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>If not annotated with <code>@Nested</code>, an inner class containing some tests will never be executed during tests execution. While you could
still be able to manually run its tests in an IDE, it won’t be the case during the build. By contrast, a static nested class containing some tests
should not be annotated with <code>@Nested</code>, JUnit5 will not share setup and state with an instance of its enclosing class.</p>
<p>This rule raises an issue on inner classes and static nested classes containing JUnit5 test methods which has a wrong usage of <code>@Nested</code>
annotation.</p>
<p>Note: This rule does not check if the context in which JUnit 5 is running (e.g. Maven Surefire Plugin) is properly configured to execute static
nested classes, it could not be the case using the default configuration.</p>
<h3>Noncompliant code example</h3>
<pre>
import org.junit.jupiter.api.Test;

class MyJunit5Test {
  @Test
  void test() { /* ... */ }

  class InnerClassTest { // Noncompliant, missing @Nested annotation
    @Test
    void test() { /* ... */ }
  }

  @Nested
  static class StaticNestedClassTest { // Noncompliant, invalid usage of @Nested annotation
    @Test
    void test() { /* ... */ }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.Nested;

class MyJunit5Test {
  @Test
  void test() { /* ... */ }

  @Nested
  class InnerClassTest {
    @Test
    void test() { /* ... */ }
  }

  static class StaticNestedClassTest {
    @Test
    void test() { /* ... */ }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Migrate your tests from JUnit4 to the new JUnit5 annotations (java:S5793)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://junit.org/junit5/docs/current/user-guide/#migrating-from-junit4">JUnit 5: Migrating from JUnit4</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>As mentioned in JUnit5 documentation, it is possible to integrate JUnit4 with JUnit5:</p>
<blockquote>
  <p>JUnit provides a gentle migration path via a JUnit Vintage test engine which allows existing tests based on JUnit 3 and JUnit 4 to be executed
  using the JUnit Platform infrastructure. Since all classes and annotations specific to JUnit Jupiter reside under a new org.junit.jupiter base
  package, having both JUnit 4 and JUnit Jupiter in the classpath does not lead to any conflicts.</p>
</blockquote>
<p>However, maintaining both systems is a temporary solution. This rule flags all the annotations from JUnit4 which would need to be migrated to
JUnit5, hence helping migration of a project.</p>
<p>Here is the list of JUnit4 annotations tracked by the rule, with their corresponding annotations in JUnit5:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>JUnit4</th>
      <th>JUnit5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><code>org.junit.Test</code></p></td>
      <td><p><code>org.junit.jupiter.api.Test</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.Before</code></p></td>
      <td><p><code>org.junit.jupiter.api.BeforeEach</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.After</code></p></td>
      <td><p><code>org.junit.jupiter.api.AfterEach</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.BeforeClass</code></p></td>
      <td><p><code>org.junit.jupiter.api.BeforeAll</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.AfterClass</code></p></td>
      <td><p><code>org.junit.jupiter.api.AfterAll</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.Ignore</code></p></td>
      <td><p><code>org.junit.jupiter.api.Disabled</code></p></td>
    </tr>
  </tbody>
</table>
<p>Note that the following annotations might requires some rework of the tests to have JUnit5 equivalent behavior. A simple replacement of the
annotation won’t work immediately:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>JUnit4</th>
      <th>JUnit5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><code>org.junit.experimental.categories.Category</code></p></td>
      <td><p><code>org.junit.jupiter.api.Tag</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.Rule</code></p></td>
      <td><p><code>org.junit.jupiter.api.extension.ExtendWith</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.ClassRule</code></p></td>
      <td><p><code>org.junit.jupiter.api.extension.RegisterExtension</code></p></td>
    </tr>
    <tr>
      <td><p><code>org.junit.runner.RunWith</code></p></td>
      <td><p><code>org.junit.jupiter.api.extension.ExtendWith</code></p></td>
    </tr>
  </tbody>
</table>
<h3>Noncompliant code example</h3>
<pre>
package org.foo;

import org.junit.After;
import org.junit.AfterClass;
import org.junit.Before;
import org.junit.BeforeClass;
import org.junit.Ignore;
import org.junit.Test;
import org.junit.experimental.categories.Category;
import org.junit.runner.RunWith;

@RunWith(MyJUnit4Runner.class)
public class MyJUnit4Test {

  @BeforeClass
  public static void beforeAll() {
    System.out.println("beforeAll");
  }

  @AfterClass
  public static void afterAll() {
    System.out.println("AfterAll");
  }

  @Before
  public void beforeEach() {
    System.out.println("beforeEach");
  }

  @After
  public void afterEach() {
    System.out.println("afterEach");
  }

  @Test
  public void test1() throws Exception {
    System.out.println("test1");
  }

  public interface SomeTests { /* category marker */ }

  @Test
  @Category(SomeTests.class)
  public void test2() throws Exception {
    System.out.println("test2");
  }

  @Test
  @Ignore("Requires fix of #42")
  public void ignored() throws Exception {
    System.out.println("ignored");
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
package org.foo;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;

@ExtendWith(MyJUnit5Extension.class)
class MyJUnit5Test {

  @BeforeAll
  static void beforeAll() {
    System.out.println("beforeAll");
  }

  @AfterAll
  static void afterAll() {
    System.out.println("afterAll");
  }

  @BeforeEach
  void beforeEach() {
    System.out.println("beforeEach");
  }

  @AfterEach
  void afterEach() {
    System.out.println("afterEach");
  }

  @Test
  void test1() {
    System.out.println("test1");
  }

  @Test
  @Tag("SomeTests")
  void test2() {
    System.out.println("test2");
  }

  @Test
  @Disabled("Requires fix of #42")
  void disabled() {
    System.out.println("ignored");
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Use switch instead of if-else chain to compare a variable against multiple cases (java:S6880)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Comparing a variable to multiple cases is a frequent operation. This can be done using a sequence of if-else statements. However, for many cases
like enums or simple value comparisons, a <code>switch</code> statement is the better alternative. With Java 21, the <code>switch</code> statement has
been significantly improved to support pattern matching and record pattern.</p>
<p>Using a <code>switch</code> statement instead of an if-else chain provides benefits like clearer code, certainty of covering all cases, and may
even improve performance.</p>
<p>This rule raises an issue when an if-else chain should be replaced by a <code>switch</code> statement.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.org/jeps/440">Record Patterns</a> </li>
  <li> <a href="https://openjdk.org/jeps/441">Pattern Matching for switch</a> </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/nutsandbolts/switch.html">The switch Statement</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace the chain of if-else with a switch expression.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
sealed interface Expression {}
record Plus(Expression left, Expression right) implements Expression {}
record Minus(Expression left, Expression right) implements Expression {}
record Div(Expression left, Expression right) implements Expression {}

int eval(Expression expr){
  if(expr instanceof Plus plus){ // Noncompliant; should be replaced by a switch expression
    return eval(plus.left) + eval(plus.right);
  }else if(expr instanceof Div div){
    return eval(div.left) / eval(div.right);
  }else if(expr instanceof Minus minus){
    return eval(minus.left) - eval(minus.right);
  } else {
    throw new IllegalArgumentException("Unknown expression");
  }
}
</pre>
<pre data-diff-id="2" data-diff-type="noncompliant">
enum Color{RED,GREEN,YELLOW}

String name(Color c){
  if(c == Color.RED){ // Noncompliant; should be replaced by a switch expression
    return "red";
  }else if(c == Color.GREEN){
    return "green";
  }else if(c == Color.YELLOW){
    return "yellow";
  }else{
    throw new IllegalArgumentException("Unknown color");
  }
}
</pre>
<pre data-diff-id="3" data-diff-type="noncompliant">
int points(int result){
  if(result == 2){ // Noncompliant; should be replaced by a switch expression
    return 10;
  } else if(result == 3 || result==4 ){
    return 20;
  } else if (result == 5) {
    return 50;
  }else{
    return 0;
  }
}
</pre>
<pre data-diff-id="4" data-diff-type="noncompliant">
class Circle{}
class Rectangle{}
class Square{}

String name(Object shape){
  if (shape instanceof Circle) { // Noncompliant; should be replaced by a switch expression
    return "circle";
  } else if (shape instanceof Rectangle) {
     return "rectangle";
  } else if (shape instanceof Square) {
    return "square";
  } else {
    throw new IllegalArgumentException();
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
sealed interface Expression {}
record Plus(Expression left, Expression right) implements Expression {}
record Minus(Expression left, Expression right) implements Expression {}
record Div(Expression left, Expression right) implements Expression {}

int eval(Expression expr){
  return switch(expr){
    case Div(var left, var right) -&gt; eval(left) / eval(right);
    case Plus(var left, var right) -&gt; eval(left) + eval(right);
    case Minus(var left, var right) -&gt; eval(left) - eval(right);
  };
}
</pre>
<pre data-diff-id="2" data-diff-type="compliant">
enum Color{RED,GREEN,YELLOW}
String name(Color c){
  return switch(c){
    case RED -&gt; "red";
    case GREEN -&gt; "green";
    case YELLOW -&gt; "yellow";
  };
}
</pre>
<pre data-diff-id="3" data-diff-type="compliant">
int points(int result){
  return switch(result){
    case 2 -&gt; 10;
    case 3,4 -&gt; 20;
    case 5 -&gt; 50;
    default -&gt; 0;
  };
}
</pre>
<pre data-diff-id="4" data-diff-type="compliant">
class Circle{}
class Rectangle{}
class Square{}

String name(Object shape){
  return switch(shape){
    case Circle c -&gt; "circle";
    case Rectangle r -&gt; "rectangle";
    case Square s -&gt; "square";
    default -&gt; throw new IllegalArgumentException();
  };
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Virtual threads should be used for tasks that include heavy blocking operations (java:S6881)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Whenever a virtual thread is started, the JVM will mount it on an OS thread. As soon as the virtual thread runs into a blocking operation like an
HTTP request or a filesystem read/write operation, the JVM will detect this and unmount the virtual thread. This allows another virtual thread to take
over the OS thread and continue its execution.</p>
<p>This is why virtual threads should be preferred to platform threads for tasks that involve blocking operations. By default, a Java thread is a
platform thread. To use a virtual thread it must be started either with <code>Thread.startVirtualThread(Runnable)</code> or
<code>Thread.ofVirtual().start(Runnable)</code>.</p>
<p>This rule raises an issue when a platform thread is created with a task that includes heavy blocking operations.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace platform thread instances or platform thread pools with virtual threads, if their task involves blocking operations.</p>

<h4>Noncompliant code example</h4>
<p>The following example creates a platform thread to handle a blocking operation, here denoted by <code>Thread.sleep(1000)</code>. The overhead for
instantiating a platform thread is higher than for a virtual thread. Further, instantiating too many platform threads can lead to problems if the
number of instantiated threads exceeds the maximum number of platform threads allowed by the OS.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
new Thread(() -&gt; {
    try {
        Thread.sleep(1000); // Noncompliant blocking operation in platform thread
    } catch (InterruptedException e) {
        throw new RuntimeException(e);
    }
});
</pre>
<p>In the context of thread pools, using platform threads for heavy blocking operations can lead to the thread pool running out of available threads.
Even though the threads spend most of their time waiting for e.g. I/O operations to complete and subsequently the CPU usage is low, the application
cannot continue processing efficiently, due to the lack of available threads.</p>
<h4>Compliant solution</h4>
<p>Using virtual threads allows the developer to abstract from any pooling logic as they are much lighter than platform threads, and the number of
virtual threads that can be instantiated is only limited by the available memory. In this example, the execution of 10000 requests would take just
over ~1 second without any risk of exceeding the allowed number of platform threads.</p>
<pre data-diff-id="1" data-diff-type="compliant">
Thread.ofVirtual().start(() -&gt; {
    try {
        Thread.sleep(1000); // Compliant
    } catch (InterruptedException e) {
        throw new RuntimeException(e);
    }
});
</pre></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>With the introduction of virtual threads in Java 21, it is now possible to optimize the usage of the operating system threads by avoiding blocking
them for asynchronous operations. Furthermore, virtual threads’s instantiation has very little overhead and they can be created in large quantities.
This means that it can be more efficient to use them over the default platform threads for tasks that involve I/O or some other blocking
operations.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> Java Documentation - <a href="https://docs.oracle.com/en/java/javase/21/core/virtual-threads.html">Virtual Threads</a> </li>
  <li> Java Documentation - <a
  href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Thread.html#startVirtualThread(java.lang.Runnable)">Thread.startVirtualThread(Runnable)</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"Serializable" inner classes of "Serializable" classes should be static (java:S2059)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ZTdGBQ">CERT, SER05-J.</a> - Do not serialize instances of inner classes </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Serializing a non-<code>static</code> inner class will result in an attempt at serializing the outer class as well. If the outer class is actually
serializable, then the serialization will succeed but possibly write out far more data than was intended.</p>
<p>Making the inner class <code>static</code> (i.e. "nested") avoids this problem, therefore inner classes should be <code>static</code> if possible.
However, you should be aware that there are semantic differences between an inner class and a nested one:</p>
<ul>
  <li> an inner class can only be instantiated within the context of an instance of the outer class. </li>
  <li> a nested (<code>static</code>) class can be instantiated independently of the outer class. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
public class Raspberry implements Serializable {
  // ...

  public class Drupelet implements Serializable {  // Noncompliant; output may be too large
    // ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Raspberry implements Serializable {
  // ...

  public static class Drupelet implements Serializable {
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Disclosing fingerprints from web application technologies is security-sensitive (java:S5689)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> Version information is accessible to end users. </li>
  <li> Internal systems do not benefit from timely patch management workflows. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
@GetMapping(value = "/example")
public ResponseEntity&lt;String&gt; example() {
  HttpHeaders responseHeaders = new HttpHeaders();
  responseHeaders.set("x-powered-by", "myproduct"); // Sensitive

  return new ResponseEntity&lt;String&gt;(
      "example",
      responseHeaders,
      HttpStatus.CREATED);
}
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Disclosure of version information, usually overlooked by developers but disclosed by default by the systems and frameworks in use, can pose a
significant security risk depending on the production environement.</p>
<p>Once this information is public, attackers can use it to identify potential security holes or vulnerabilities specific to that version.</p>
<p>Furthermore, if the published version information indicates the use of outdated or unsupported software, it becomes easier for attackers to exploit
known vulnerabilities. They can search for published vulnerabilities related to that version and launch attacks that specifically target those
vulnerabilities.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>In general, it is recommended to keep internal technical information within internal systems to control what attackers know about the underlying
architectures. This is known as the "need to know" principle.</p>
<p>The most effective solution is to remove version information disclosure from what end users can see, such as the "x-powered-by" header.<br> This
can be achieved directly through the web application code, server (nginx, apache) or firewalls.</p>
<p>Disabling the server signature provides additional protection by reducing the amount of information available to attackers. Note, however, that
this does not provide as much protection as regular updates and patches.<br> Security by obscurity is the least foolproof solution of all. It should
never be the only defense mechanism and should always be combined with other security measures.</p>
<h2>Compliant Solution</h2>
<p>Do not disclose version information unless necessary. The <code>x-powered-by</code> or <code>Server</code> HTTP headers should not be used.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Information Exposure</a> </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>Disclosure of version information, usually overlooked by developers but disclosed by default by the systems and frameworks in use, can pose a
significant security risk depending on the production environement.</p>
<p>Once this information is public, attackers can use it to identify potential security holes or vulnerabilities specific to that version.</p>
<p>Furthermore, if the published version information indicates the use of outdated or unsupported software, it becomes easier for attackers to exploit
known vulnerabilities. They can search for published vulnerabilities related to that version and launch attacks that specifically target those
vulnerabilities.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Version information is accessible to end users. </li>
  <li> Internal systems do not benefit from timely patch management workflows. </li>
</ul>
<p>There is a risk if you answered yes to any of these questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>In general, it is recommended to keep internal technical information within internal systems to control what attackers know about the underlying
architectures. This is known as the "need to know" principle.</p>
<p>The most effective solution is to remove version information disclosure from what end users can see, such as the "x-powered-by" header.<br> This
can be achieved directly through the web application code, server (nginx, apache) or firewalls.</p>
<p>Disabling the server signature provides additional protection by reducing the amount of information available to attackers. Note, however, that
this does not provide as much protection as regular updates and patches.<br> Security by obscurity is the least foolproof solution of all. It should
never be the only defense mechanism and should always be combined with other security measures.</p>
<h2>Sensitive Code Example</h2>
<pre>
@GetMapping(value = "/example")
public ResponseEntity&lt;String&gt; example() {
  HttpHeaders responseHeaders = new HttpHeaders();
  responseHeaders.set("x-powered-by", "myproduct"); // Sensitive

  return new ResponseEntity&lt;String&gt;(
      "example",
      responseHeaders,
      HttpStatus.CREATED);
}
</pre>
<h2>Compliant Solution</h2>
<p>Do not disclose version information unless necessary. The <code>x-powered-by</code> or <code>Server</code> HTTP headers should not be used.</p>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> <a
  href="https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/01-Information_Gathering/08-Fingerprint_Web_Application_Framework.html">OWASP Testing Guide - OTG-INFO-008</a> - Fingerprint Web Application Framework </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/200">CWE-200 - Information Exposure</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>High frame rates should not be used (java:S6898)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Standard applications don’t require a display refresh rate above 60Hz, hence it is advisable to avoid higher frequencies to avoid unnecessary
energy consumption.</p>
<p>The rule flags an issue when <code>setFrameRate()</code> is invoked with a frameRate higher than 60Hz for <code>android.view.Surface</code> and
<code>android.view.SurfaceControl.Transaction</code>.</p>
<p>It’s important to note that the scheduler considers several factors when determining the display refresh rate. Therefore, using
<code>setFrameRate()</code> doesn’t guarantee your app will achieve the requested frame rate.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <em>Usability</em>: the device may run out of battery faster than expected. </li>
  <li> <em>Sustainability</em>: the extra battery usage has a negative impact on the environment. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>The <em>Frame Rate API</em> allows applications to communicate their desired frame rate to the <em>Android platform</em> to enhance the user
experience. The API is useful since many devices now offer varying refresh rates like 60Hz, 90Hz, or 120Hz.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use a frame rate of maximum 60Hz, unless you have a strong reason to used higher rates. Valid exceptions are <em>gaming apps</em>, especially those
with fast-paced action or high-quality graphics, or <em>AR/VR apps</em>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        SurfaceView surfaceView = findViewById(R.id.my_surface_view);
        Surface surface = surfaceView.getHolder().getSurface();

        surface.setFrameRate(90.0f, Surface.FRAME_RATE_COMPATIBILITY_FIXED_SOURCE); // Noncompliant
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        SurfaceView surfaceView = findViewById(R.id.my_surface_view);
        Surface surface = surfaceView.getHolder().getSurface();

        surface.setFrameRate(60.0f, Surface.FRAME_RATE_COMPATIBILITY_FIXED_SOURCE); // Compliant
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://developer.android.com/media/optimize/performance/frame-rate">Android for Developers: Frame Rate</a> </li>
  <li> <a
  href="https://developer.apple.com/library/archive/documentation/3DDrawing/Conceptual/MTLBestPracticesGuide/FrameRate.html#//apple_ref/doc/uid/TP40016642-CH23-SW1">Developer Apple - Frame Rate</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Method names should comply with a naming convention (java:S100)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared naming conventions allow teams to collaborate efficiently.</p>
<p>This rule raises an issue when a method name does not match a provided regular expression.</p>
<p>For example, with the default provided regular expression <code>^[a-z][a-zA-Z0-9]*$</code>, the method:</p>
<pre>
public int DoSomething(){...} // Noncompliant
</pre>
<p>should be renamed to</p>
<pre>
public int doSomething(){...}
</pre>
<h3>Exceptions</h3>
<p>Overriding methods are excluded.</p>
<pre>
@Override
public int Do_Something(){...} // Compliant by exception
</pre></p>
            </div>
        <div class="rule">
            <h3>Class names should comply with a naming convention (java:S101)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared naming conventions allow teams to collaborate efficiently.</p>
<p>This rule raises an issue when a class name does not match a provided regular expression.</p>
<p>For example, with the default provided regular expression <code>^[A-Z][a-zA-Z0-9]*$</code>, the class:</p>
<pre>
class my_class {...} // Noncompliant
</pre>
<p>should be renamed to</p>
<pre>
class MyClass {...}
</pre></p>
            </div>
        <div class="rule">
            <h3>The non-serializable super class of a "Serializable" class should have a no-argument constructor (java:S2055)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Java serialization is the conversion from objects to byte streams for storage or transmission. And later, java deserialization is the reverse
conversion, it reconstructs objects from byte streams.</p>
<p>To make a java class serializable, this class should implement the <code>java.io.Serializable</code> interface directly or through its
inheritance.</p>
<pre>
import java.io.Serializable;

public class NonSerializableClass {
}

public class SerializableClass implements Serializable {
}

public class OtherSerializableClass extends SerializableClass {
  // is also serializable because it is a subtype of Serializable
}
</pre>
<p>Given a serializable class, it is important to note that not all its superclasses are serializable. Eventually, its superclasses stop implementing
<code>java.io.Serializable</code>. It could be at the end, once reaching the <code>java.lang.Object</code> class, or before.</p>
<p>This is important because the serialization/deserialization runs through the class hierarchy of an object to decide which object fields to write or
read, and applies two different logics:</p>
<ul>
  <li> When the class is serializable:
    <ul>
      <li> Serialization saves the class reference and the object fields of this class. </li>
      <li> Deserialization instantiates a new object of this class without using a constructor, and restores the object fields of this class. </li>
    </ul>  </li>
  <li> When the class is not serializable:
    <ul>
      <li> Serialization only saves the class reference and <strong>ignores</strong> the object fields of this class. </li>
      <li> Deserialization instantiates a new object of this class using the <strong>no-argument constructor</strong> and does not restore the object
      fields of this class. </li>
    </ul>  </li>
</ul>
<p>So developers should pay particular attention to the non-serializable classes in the class hierarchy, because the presence of an implicit or
explicit <strong>no-argument constructor</strong> is required in those classes.</p>
<p>This is an example of mandatory no-argument constructors in the hierarchy of <code>SerializableClass</code>:</p>
<pre>
public class NonSerializableClassWithoutConstructor {
  // after deserialization, "field1" will always be set to 42
  private int field1 = 42;

  // this non-serializable class has an implicit no-argument constructor
}

public class NonSerializableClass extends NonSerializableClassWithoutConstructor {
  // after deserialization, "field2" will always be set to 12 by the no-argument constructor
  private int field2;

  // this non-serializable class has an explicit no-argument constructor
  public NonSerializableClass() {
    field2 = 12;
  }

  public NonSerializableClass(int field2) {
    this.field2 = field2;
  }
}

public class SerializableClass extends NonSerializableClass implements Serializable {
  // after deserialization, "field3" will have the previously serialized value.
  private int field3;

  // deserialization does not use declared constructors
  public SerializableClass(int field3) {
    super(field3 * 2);
    this.field3 = field3;
  }
}
</pre>
<p>Unfortunately, there is no compilation error when a class implements <code>java.io.Serializable</code> and extends a non-serializable superclass
without a no-argument constructor. This is an issue because, at runtime, deserialization will fail to find the required constructor.</p>
<p>For example, deserialization of an instance of the following <code>SerializableClass</code> class, throws an <code>InvalidClassException: no valid
constructor</code>.</p>
<pre>
public class NonSerializableClass {
  private int field;
  // this class can not be deserialized because it does not have any implicit or explicit no-argument constructor
  public NonSerializableClass(int field) {
    this.field = field;
  }
}

public class SerializableClass extends NonSerializableClass implements Serializable {
}
</pre>
<p>This rule checks in the hierarchy of serializable classes and reports an issue when a non-serializable superclass does not have the required
no-argument constructor which will produce a runtime error.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/io/Serializable.html">Oracle SDK - java.io.Serializable</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>There are two solutions to fix the missing <strong>no-argument constructor</strong> issue on non-serializable classes:</p>
<ul>
  <li> <code>Solution 1</code> If the fields of a non-serializable class need to be persisted, add the <code>java.io.Serializable</code> interface to
  the class <code>implements</code> definition. </li>
  <li> <code>Solution 2</code> Otherwise, add a no-argument constructor and initialize the fields with some valid default values. </li>
</ul>

<p><strong>Example #1</strong></p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
// Noncompliant; this Raspberry's ancestor doesn't have a no-argument constructor
// this rule raises an issue on the Raspberry class declaration
public class Fruit {
  private Season pickingSeason;
  public Fruit(Season pickingSeason) {
    this.pickingSeason = pickingSeason;
  }
}
</pre>
<pre>
public class Raspberry extends Fruit implements Serializable {
  private static final long serialVersionUID = 1;
  private String variety;
  public Raspberry(String variety) {
    super(Season.SUMMER);
    this.variety = variety;
  }
}
</pre>
<h4>Compliant solution</h4>
<p><code>Solution 1</code></p>
<pre data-diff-id="1" data-diff-type="compliant">
// Compliant; this Raspberry's ancestor is serializable
public class Fruit implements Serializable {
  private static final long serialVersionUID = 1;
  private Season pickingSeason;
  public Fruit(Season pickingSeason) {
    this.pickingSeason = pickingSeason;
  }
}
</pre>
<p><strong>Example #2</strong></p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="2" data-diff-type="noncompliant">
public class Fruit {
  // Noncompliant; this Raspberry's ancestor doesn't have a no-argument constructor
  // this rule raises an issue on the Raspberry class declaration
  public Fruit(String debugMessage) {
    LOG.debug(debugMessage);
  }
}
</pre>
<pre>
public class Raspberry extends Fruit implements Serializable {
  private static final long serialVersionUID = 1;
  private String variety;
  public Raspberry(String variety) {
    super("From Raspberry constructor");
    this.variety = variety;
  }
}
</pre>
<h4>Compliant solution</h4>
<p><code>Solution 2</code></p>
<pre data-diff-id="2" data-diff-type="compliant">
public class Fruit {
  // Compliant; this Raspberry ancestor has a no-argument constructor
  public Fruit() {
    this("From serialization");
  }
  public Fruit(String debugMessage) {
    LOG.debug(debugMessage);
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Serializable" classes should have a "serialVersionUID" (java:S2057)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A <code>serialVersionUID</code> field is strongly recommended in all <code>Serializable</code> classes. If you do not provide one, one will be
calculated for you by the compiler. The danger in not explicitly choosing the value is that when the class changes, the compiler will generate an
entirely new id, and you will be suddenly unable to deserialize (read from file) objects that were serialized with the previous version of the
class.</p>
<p><code>serialVersionUID</code>'s should be declared with all of these modifiers: <code>static final long</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Raspberry extends Fruit  // Noncompliant; no serialVersionUID.
        implements Serializable {
  private String variety;

  public Raspberry(Season ripe, String variety) { ...}
  public void setVariety(String variety) {...}
  public String getVarity() {...}
}

public class Raspberry extends Fruit
        implements Serializable {
  private final int serialVersionUID = 1; // Noncompliant; not static &amp; int rather than long
</pre>
<h3>Compliant solution</h3>
<pre>
public class Raspberry extends Fruit
        implements Serializable {
  private static final long serialVersionUID = 1;
  private String variety;

  public Raspberry(Season ripe, String variety) { ...}
  public void setVariety(String variety) {...}
  public String getVarity() {...}
}
</pre>
<h3>Exceptions</h3>
<p>Records, Swing and AWT classes, <code>abstract</code> classes, <code>Throwable</code> and its subclasses (<code>Exception</code>s and
<code>Error</code>s), and classes marked with <code>@SuppressWarnings("serial")</code> are ignored.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/ajdGBQ">CERT, SER00-J.</a> - Enable serialization compatibility during class evolution </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/16/docs/specs/serialization/serial-arch.html#serialization-of-records">Record Serialization</a>
  - Serialization of Records </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Inappropriate "Collection" calls should not be made (java:S2175)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>java.util.Collection</code> type and its subtypes provide methods to access and modify collections such as <code>Collection.remove(Object
o)</code> and <code>Collection.contains(Object o)</code>. Some of these methods accept arguments of type <code>java.lang.Object</code> and will
compare said argument with objects already in the collection.</p>
<p>If the actual type of the argument is unrelated to the type of object contained in the collection, these methods will always return
<code>false</code>, <code>null</code>, or <code>-1</code>. This behavior is most likely unintended and can be indicative of a design issue.</p>
<p>This rule raises an issue when the type of the argument provided to one of the following methods is unrelated to the type used for the collection
declaration:</p>
<ul>
  <li> <code>Collection.remove(Object o)</code> </li>
  <li> <code>Collection.removeAll(Collection&lt;?&gt;)</code> </li>
  <li> <code>Collection.contains(Object o)</code> </li>
  <li> <code>List.indexOf(Object o)</code> </li>
  <li> <code>List.lastIndexOf(Object o)</code> </li>
  <li> <code>Map.containsKey(Object key)</code> </li>
  <li> <code>Map.containsValue(Object value)</code> </li>
  <li> <code>Map.get(Object key)</code> </li>
  <li> <code>Map.getOrDefault(Object key, V defaultValue)</code> </li>
  <li> <code>Map.remove(Object key)</code> </li>
  <li> <code>Map.remove(Object key, Object value)</code> </li>
</ul></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/uDdGBQ">CERT, EXP04-J.</a> - Do not pass arguments to certain Java Collections Framework methods
  that are a different type than the collection parameter type </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Collection.html">Java SE 17 &amp; JDK 17</a> - Collection
  interface </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ask yourself what the purpose of this method call is. Check whether the provided argument and collection are correct in this context and for the
desired purpose. Remove unnecessary calls and otherwise provide an argument of which the type is compatible with the list content’s type.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
void removeFromMap(Map&lt;Integer, Object&gt; map, String strKey) {
  map.remove(strKey); // Noncompliant, this call will remove nothing and always return 'null' because 'map' is handling only Integer keys and String cannot be cast to Integer.
}

void listContains(List&lt;String&gt; list, Integer integer) {
  if (list.contains(integer)) { // Noncompliant; always false as the list only contains Strings, not integers.
    // ...
  }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
void removeFromMap(Map&lt;Integer, Object&gt; map, String strKey) {
  map.remove(Integer.parseInt(strKey)); // Compliant, strKey is parsed into an Integer before trying to remove it from the map.
}

void listContains(List&lt;String&gt; list, Integer integer) {
  if (list.contains(integer.toString())) { // Compliant, 'integer' is converted to a String before checking if the list contains it.
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Class names should not shadow interfaces or superclasses (java:S2176)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-6.html#jls-6.4.1">Java SE Specifications &gt; Java Language Specification &gt;
  6.4.1. Shadowing</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Two classes can have the same simple name if they are in two different packages.</p>
<pre>
package org.foo.domain;

public class User {
  // ..
}
</pre>
<pre>
package org.foo.presentation;

public class User {
  // ..
}
</pre>
<p>However, this becomes an issue when a class has the same name as the superclass it extends or the interfaces it implements, also known as class
name shadowing. It is problematic because it can be unclear which class is being referred to in the code, leading to ambiguity and potential bugs.</p>
<p>Therefore, it is recommended to use unique and descriptive class names that do not conflict with the names of the superclass or interfaces.</p>
<p>This rule raises an issue when a class name shadows its superclass or interface names.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Rename the class using a more descriptive name.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
package org.foo.presentation;

public class User implements org.foo.domain.User { // Noncompliant
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
package org.foo.presentation;

import org.foo.domain.User;

public class UserView implements User { // Compliant
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Child class methods named for parent class methods should be overrides (java:S2177)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When a method in a child class has the same signature as a method in a parent class, it is assumed to be an override. However, that’s not the case
when:</p>
<ul>
  <li> the parent class method is <code>static</code> and the child class method is not. </li>
  <li> the arguments or return types of the child method are in different packages than those of the parent method. </li>
  <li> the parent class method is <code>private</code>. </li>
</ul>
<p>Typically, these things are done unintentionally; the private parent class method is overlooked, the <code>static</code> keyword in the parent
declaration is overlooked, or the wrong class is imported in the child. But if the intent is truly for the child class method to be different, then
the method should be renamed to prevent confusion.</p>
<h3>Noncompliant code example</h3>
<pre>
// Parent.java
import computer.Pear;
public class Parent {

  public void doSomething(Pear p) {
    //,,,
  }

  public static void doSomethingElse() {
    //...
  }
}

// Child.java
import fruit.Pear;
public class Child extends Parent {

  public void doSomething(Pear p) {  // Noncompliant; this is not an override
    // ...
  }


  public void doSomethingElse() {  // Noncompliant; parent method is static
    //...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
// Parent.java
import computer.Pear;
public class Parent {

  public void doSomething(Pear p) {
    //,,,
  }

  public static void doSomethingElse() {
    //...
  }
}

// Child.java
import computer.Pear;  // import corrected
public class Child extends Parent {

  public void doSomething(Pear p) {  // true override (see import)
    //,,,
  }

  public static void doSomethingElse() {
    //...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Short-circuit logic should be used in boolean contexts (java:S2178)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/WNYxBQ">CERT, EXP46-C.</a> - Do not use a bitwise operator with a Boolean-like operand </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The use of non-short-circuit logic in a boolean context is likely a mistake - one that could cause serious program errors as conditions are
evaluated under the wrong circumstances.</p>
<h3>Noncompliant code example</h3>
<pre>
if(getTrue() | getFalse()) { ... } // Noncompliant; both sides evaluated
</pre>
<h3>Compliant solution</h3>
<pre>
if(getTrue() || getFalse()) { ... } // true short-circuit logic
</pre></p>
            </div>
        <div class="rule">
            <h3>Receiving intents is security-sensitive (java:S5322)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The data extracted from intents is not sanitized. </li>
  <li> Intents broadcast is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    @RequiresApi(api = Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {
        context.registerReceiver(receiver, filter); // Sensitive
        context.registerReceiver(receiver, filter, flags); // Sensitive

        // Broadcasting intent with "null" for broadcastPermission
        context.registerReceiver(receiver, filter, null, scheduler); // Sensitive
        context.registerReceiver(receiver, filter, null, scheduler, flags); // Sensitive
    }
}
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-1677">CVE-2019-1677</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1275">CVE-2015-1275</a> </li>
</ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    @RequiresApi(api = Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {

        context.registerReceiver(receiver, filter, broadcastPermission, scheduler);
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler, flags);
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-PLATFORM/">Mobile AppSec Verification Standard - Platform Interaction Requirements</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">Mobile Top 10 2016 Category M1 - Improper
  Platform Usage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/925">CWE-925 - Improper Verification of Intent by Broadcast Receiver</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/926">CWE-926 - Improper Export of Android Application Components</a> </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>Android applications can receive broadcasts from the system or other applications. Receiving intents is security-sensitive. For example, it has led
in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-1677">CVE-2019-1677</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1275">CVE-2015-1275</a> </li>
</ul>
<p>Receivers can be declared in the manifest or in the code to make them context-specific. If the receiver is declared in the manifest Android will
start the application if it is not already running once a matching broadcast is received. The receiver is an entry point into the application.</p>
<p>Other applications can send potentially malicious broadcasts, so it is important to consider broadcasts as untrusted and to limit the applications
that can send broadcasts to the receiver.</p>
<p>Permissions can be specified to restrict broadcasts to authorized applications. Restrictions can be enforced by both the sender and receiver of a
broadcast. If permissions are specified when registering a broadcast receiver, then only broadcasters who were granted this permission can send a
message to the receiver.</p>
<p>This rule raises an issue when a receiver is registered without specifying any broadcast permission.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The data extracted from intents is not sanitized. </li>
  <li> Intents broadcast is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See the <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    @RequiresApi(api = Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {
        context.registerReceiver(receiver, filter); // Sensitive
        context.registerReceiver(receiver, filter, flags); // Sensitive

        // Broadcasting intent with "null" for broadcastPermission
        context.registerReceiver(receiver, filter, null, scheduler); // Sensitive
        context.registerReceiver(receiver, filter, null, scheduler, flags); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.IntentFilter;
import android.os.Build;
import android.os.Handler;
import android.support.annotation.RequiresApi;

public class MyIntentReceiver {

    @RequiresApi(api = Build.VERSION_CODES.O)
    public void register(Context context, BroadcastReceiver receiver,
                         IntentFilter filter,
                         String broadcastPermission,
                         Handler scheduler,
                         int flags) {

        context.registerReceiver(receiver, filter, broadcastPermission, scheduler);
        context.registerReceiver(receiver, filter, broadcastPermission, scheduler, flags);
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-PLATFORM/">Mobile AppSec Verification Standard - Platform Interaction Requirements</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">Mobile Top 10 2016 Category M1 - Improper
  Platform Usage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/925">CWE-925 - Improper Verification of Intent by Broadcast Receiver</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/926">CWE-926 - Improper Export of Android Application Components</a> </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Accessing Android external storage is security-sensitive (java:S5324)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use internal storage whenever possible as the system prevents other apps from accessing this location. </li>
  <li> Only use external storage if you need to share non-sensitive files with other applications. </li>
  <li> If your application has to use the external storage to store sensitive data, make sure it encrypts the files using <a
  href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a>. </li>
  <li> Data coming from external storage should always be considered untrusted and should be validated. </li>
  <li> As some external storage can be removed, make sure to never store files on it that are critical for the usability of your application. </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getFilesDir();
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> <a href="https://developer.android.com/privacy-and-security/security-tips#ExternalStorage">Android Security tips on external file storage</a>
  </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Data Storage and Privacy
  Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Storing data locally is a common task for mobile applications. Such data includes files among other things. One convenient way to store files is to
use the external file storage which usually offers a larger amount of disc space compared to internal storage.</p>
<p>Files created on the external storage are globally readable and writable. Therefore, a malicious application having the permissions
<code>WRITE_EXTERNAL_STORAGE</code> or <code>READ_EXTERNAL_STORAGE</code> could try to read sensitive information from the files that other
applications have stored on the external storage.</p>
<p>External storage can also be removed by the user (e.g when based on SD card) making the files unavailable to the application.</p>
</p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<p>Your application uses external storage to:</p>
<ul>
  <li> store files that contain sensitive data. </li>
  <li> store files that are not meant to be shared with other application. </li>
  <li> store files that are critical for the application to work. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getExternalFilesDir(null); // Sensitive
    }
}
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Storing data locally is a common task for mobile applications. Such data includes files among other things. One convenient way to store files is to
use the external file storage which usually offers a larger amount of disc space compared to internal storage.</p>
<p>Files created on the external storage are globally readable and writable. Therefore, a malicious application having the permissions
<code>WRITE_EXTERNAL_STORAGE</code> or <code>READ_EXTERNAL_STORAGE</code> could try to read sensitive information from the files that other
applications have stored on the external storage.</p>
<p>External storage can also be removed by the user (e.g when based on SD card) making the files unavailable to the application.</p>
<h2>Ask Yourself Whether</h2>
<p>Your application uses external storage to:</p>
<ul>
  <li> store files that contain sensitive data. </li>
  <li> store files that are not meant to be shared with other application. </li>
  <li> store files that are critical for the application to work. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use internal storage whenever possible as the system prevents other apps from accessing this location. </li>
  <li> Only use external storage if you need to share non-sensitive files with other applications. </li>
  <li> If your application has to use the external storage to store sensitive data, make sure it encrypts the files using <a
  href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile">EncryptedFile</a>. </li>
  <li> Data coming from external storage should always be considered untrusted and should be validated. </li>
  <li> As some external storage can be removed, make sure to never store files on it that are critical for the usability of your application. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getExternalFilesDir(null); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.Context;

public class AccessExternalFiles {

    public void accessFiles(Context context) {
        context.getFilesDir();
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> <a href="https://developer.android.com/privacy-and-security/security-tips#ExternalStorage">Android Security tips on external file storage</a>
  </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-STORAGE/">Mobile AppSec Verification Standard - Data Storage and Privacy
  Requirements</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m2-insecure-data-storage">Mobile Top 10 2016 Category M2 - Insecure
  Data Storage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/312">CWE-312 - Cleartext Storage of Sensitive Information</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Using publicly writable directories is security-sensitive (java:S5443)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
new File("/myDirectory/myfile.txt");  // Compliant

File.createTempFile("prefix", "suffix", new File("/mySecureDirectory"));  // Compliant

if(SystemUtils.IS_OS_UNIX) {
  FileAttribute&lt;Set&lt;PosixFilePermission&gt;&gt; attr = PosixFilePermissions.asFileAttribute(PosixFilePermissions.fromString("rwx------"));
  Files.createTempFile("prefix", "suffix", attr); // Compliant
}
else {
  File f = Files.createTempFile("prefix", "suffix").toFile();  // Compliant
  f.setReadable(true, true);
  f.setWritable(true, true);
  f.setExecutable(true, true);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222567">Application Security and
  Development: V-222567</a> - The application must not be vulnerable to race conditions. </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
new File("/tmp/myfile.txt"); // Sensitive
Paths.get("/tmp/myfile.txt"); // Sensitive

java.io.File.createTempFile("prefix", "suffix"); // Sensitive, will be in the default temporary-file directory.
java.nio.file.Files.createTempDirectory("prefix"); // Sensitive, will be in the default temporary-file directory.
</pre>
<pre>
Map&lt;String, String&gt; env = System.getenv();
env.get("TMP"); // Sensitive
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Files are read from or written into a publicly writable folder </li>
  <li> The application creates files with predictable names into a publicly writable folder </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Use a dedicated sub-folder with tightly controlled permissions </li>
  <li> Use secure-by-design APIs to create temporary files. Such API will make sure:
    <ul>
      <li> The generated filename is unpredictable </li>
      <li> The file is readable and writable only by the creating user ID </li>
      <li> The file descriptor is not inherited by child processes </li>
      <li> The file will be destroyed as soon as it is closed </li>
    </ul>  </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
new File("/tmp/myfile.txt"); // Sensitive
Paths.get("/tmp/myfile.txt"); // Sensitive

java.io.File.createTempFile("prefix", "suffix"); // Sensitive, will be in the default temporary-file directory.
java.nio.file.Files.createTempDirectory("prefix"); // Sensitive, will be in the default temporary-file directory.
</pre>
<pre>
Map&lt;String, String&gt; env = System.getenv();
env.get("TMP"); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<pre>
new File("/myDirectory/myfile.txt");  // Compliant

File.createTempFile("prefix", "suffix", new File("/mySecureDirectory"));  // Compliant

if(SystemUtils.IS_OS_UNIX) {
  FileAttribute&lt;Set&lt;PosixFilePermission&gt;&gt; attr = PosixFilePermissions.asFileAttribute(PosixFilePermissions.fromString("rwx------"));
  Files.createTempFile("prefix", "suffix", attr); // Compliant
}
else {
  File f = Files.createTempFile("prefix", "suffix").toFile();  // Compliant
  f.setReadable(true, true);
  f.setWritable(true, true);
  f.setExecutable(true, true);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A5_2017-Broken_Access_Control">Top 10 2017 Category A5 - Broken Access Control</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP, Insecure Temporary File</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222567">Application Security and
  Development: V-222567</a> - The application must not be vulnerable to race conditions. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Operating systems have global directories where any user has write access. Those folders are mostly used as temporary storage areas like
<code>/tmp</code> in Linux based systems. An application manipulating files from these folders is exposed to race conditions on filenames: a malicious
user can try to create a file with a predictable name before the application does. A successful attack can result in other files being accessed,
modified, corrupted or deleted. This risk is even higher if the application runs with elevated permissions.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2012-2451">CVE-2012-2451</a> </li>
  <li> <a href="https://nvd.nist.gov/vuln/detail/CVE-2015-1838">CVE-2015-1838</a> </li>
</ul>
<p>This rule raises an issue whenever it detects a hard-coded path to a publicly writable directory like <code>/tmp</code> (see examples bellow). It
also detects access to environment variables that point to publicly writable directories, e.g., <code>TMP</code> and <code>TMPDIR</code>.</p>
<ul>
  <li> <code>/tmp</code> </li>
  <li> <code>/var/tmp</code> </li>
  <li> <code>/usr/tmp</code> </li>
  <li> <code>/dev/shm</code> </li>
  <li> <code>/dev/mqueue</code> </li>
  <li> <code>/run/lock</code> </li>
  <li> <code>/var/run/lock</code> </li>
  <li> <code>/Library/Caches</code> </li>
  <li> <code>/Users/Shared</code> </li>
  <li> <code>/private/tmp</code> </li>
  <li> <code>/private/var/tmp</code> </li>
  <li> <code>\Windows\Temp</code> </li>
  <li> <code>\Temp</code> </li>
  <li> <code>\TMP</code> </li>
</ul>
</p>
            </div>
        <div class="rule">
            <h3>Insecure temporary file creation methods should not be used (java:S5445)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Introduction:</p>
            <p><p>Temporary files are considered insecurely created when the file existence check is performed separately from the actual file creation. Such a
situation can occur when creating temporary files using normal file handling functions or when using dedicated temporary file handling functions that
are not atomic.</p></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Creating temporary files in a non-atomic way introduces race condition issues in the application’s behavior. Indeed, a third party can create a
given file between when the application chooses its name and when it creates it.</p>
<p>In such a situation, the application might use a temporary file that it does not entirely control. In particular, this file’s permissions might be
different than expected. This can lead to trust boundary issues.</p>
<h3>What is the potential impact?</h3>
<p>Attackers with control over a temporary file used by a vulnerable application will be able to modify it in a way that will affect the application’s
logic. By changing this file’s Access Control List or other operating system-level properties, they could prevent the file from being deleted or
emptied. They may also alter the file’s content before or while the application uses it.</p>
<p>Depending on why and how the affected temporary files are used, the exploitation of a race condition in an application can have various
consequences. They can range from sensitive information disclosure to more serious application or hosting infrastructure compromise.</p>
<h4>Information disclosure</h4>
<p>Because attackers can control the permissions set on temporary files and prevent their removal, they can read what the application stores in them.
This might be especially critical if this information is sensitive.</p>
<p>For example, an application might use temporary files to store users' session-related information. In such a case, attackers controlling those
files can access session-stored information. This might allow them to take over authenticated users' identities and entitlements.</p>
<h4>Attack surface extension</h4>
<p>An application might use temporary files to store technical data for further reuse or as a communication channel between multiple components. In
that case, it might consider those files part of the trust boundaries and use their content without additional security validation or sanitation. In
such a case, an attacker controlling the file content might use it as an attack vector for further compromise.</p>
<p>For example, an application might store serialized data in temporary files for later use. In such a case, attackers controlling those files'
content can change it in a way that will lead to an insecure deserialization exploitation. It might allow them to execute arbitrary code on the
application hosting server and take it over.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code example is vulnerable to a race condition attack because it creates a temporary file using an unsafe API function.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import java.io.File;
import java.io.IOException;

protected void Example() throws IOException {
    File tempDir;
    tempDir = File.createTempFile("", ".");
    tempDir.delete();
    tempDir.mkdir();  // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;

protected void Example() throws IOException {
    Path tempPath = Files.createTempDirectory("");
    File tempDir = tempPath.toFile();
}
</pre>
<h3>How does this work?</h3>
<p>Applications should create temporary files so that no third party can read or modify their content. It requires that the files' name, location, and
permissions are carefully chosen and set. This can be achieved in multiple ways depending on the applications' technology stacks.</p>
<h4>Use a secure API function</h4>
<p>Temporary files handling APIs generally provide secure functions to create temporary files. In most cases, they operate in an atomical way,
creating and opening a file with a unique and unpredictable name in a single call. Those functions can often be used to replace less secure
alternatives without requiring important development efforts.</p>
<p>Here, the example compliant code uses the safer <code>Files.createTempDirectory</code> function to manage the creation of temporary
directories.</p>
<h4>Strong security controls</h4>
<p>Temporary files can be created using unsafe functions and API as long as strong security controls are applied. Non-temporary file-handling
functions and APIs can also be used for that purpose.</p>
<p>In general, applications should ensure that attackers can not create a file before them. This turns into the following requirements when creating
the files:</p>
<ul>
  <li> Files should be created in a non-public directory. </li>
  <li> File names should be unique. </li>
  <li> File names should be unpredictable. They should be generated using a cryptographically secure random generator. </li>
  <li> File creation should fail if a target file already exists. </li>
</ul>
<p>Moreover, when possible, it is recommended that applications destroy temporary files after they have finished using them.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://owasp.org/www-community/vulnerabilities/Insecure_Temporary_File">OWASP</a> - Insecure Temporary File </li>
</ul>
<h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">Top 10 2021 Category A1 - Broken Access Control</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A9_2017-Using_Components_with_Known_Vulnerabilities">Top 10 2017 Category A9 -
  Using Components with Known Vulnerabilities</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/377">CWE-377 - Insecure Temporary File</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/379">CWE-379 - Creation of Temporary File in Directory with Incorrect Permissions</a>
  </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222567">Application Security and
  Development: V-222567</a> - The application must not be vulnerable to race conditions. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Types used as keys in Maps should implement Comparable (java:S6411)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a
  href="https://dzone.com/articles/java-8-hashmaps-keys-and-the-comparable-interface">https://dzone.com/articles/java-8-hashmaps-keys-and-the-comparable-interface</a> </li>
  <li> <a
  href="https://github.com/openjdk/jdk/blob/4927ee426aedbeea0f4119bac0a342c6d3576762/src/hotspot/share/runtime/synchronizer.cpp#L760-L798">https://github.com/openjdk/jdk/blob/4927ee426aedbeea0f4119bac0a342c6d3576762/src/hotspot/share/runtime/synchronizer.cpp#L760-L798</a> </li>
  <li> <a
  href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Comparable.html">https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Comparable.html</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Maps use hashes of the keys to select a bucket to store data in. Objects that hash to the same value will be added to the same bucket.</p>
<p>When the hashing function has a poor distribution, buckets can grow to very large sizes. This may negatively affect lookup performance, as, by
default, matching a key within a bucket has linear complexity.</p>
<p>In addition, as the default hashCode function can be selected at runtime, performance expectations cannot be maintained.</p>
<p>Implementing Comparable mitigates the performance issue for objects that hash to the same value.</p>
<h3>Noncompliant code example</h3>
<pre>
class MyKeyType {
    // ...
}

class Program {
    Map&lt;MyKeyType, MyValueType&gt; data = new HashMap&lt;&gt;(); // Noncompliant

    Map&lt;MyKeyType, MyValueType&gt; buildMap() { // Noncompliant
        //...
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class MyKeyType implements Comparable&lt;MyKeyType&gt; {
    // ...
}

class MyChildKeyType extends MyKeyType {
    // ...
}

class Program {
    Map&lt;MyKeyType, MyValueType&gt; data = new HashMap&lt;&gt;();
    Map&lt;MyChildKeyType, MyValueType&gt; data = new HashMap&lt;&gt;();

    Map&lt;MyKeyType, MyValueType&gt; buildMap() {
        //...
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Password hashing functions should use an unpredictable salt (java:S2053)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>During the process of password hashing, an additional component, known as a "salt," is often integrated to bolster the overall security. This salt,
acting as a defensive measure, primarily wards off certain types of attacks that leverage pre-computed tables to crack passwords.</p>
<p>However, potential risks emerge when the salt is deemed insecure. This can occur when the salt is consistently the same across all users or when it
is too short or predictable. In scenarios where users share the same password and salt, their password hashes will inevitably mirror each other.
Similarly, a short salt heightens the probability of multiple users unintentionally having identical salts, which can potentially lead to identical
password hashes. These identical hashes streamline the process for potential attackers to recover clear-text passwords. Thus, the emphasis on
implementing secure, unique, and sufficiently lengthy salts in password-hashing functions is vital.</p>
<h3>What is the potential impact?</h3>
<p>Despite best efforts, even well-guarded systems might have vulnerabilities that could allow an attacker to gain access to the hashed passwords.
This could be due to software vulnerabilities, insider threats, or even successful phishing attempts that give attackers the access they need.</p>
<p>Once the attacker has these hashes, they will likely attempt to crack them using a couple of methods. One is brute force, which entails trying
every possible combination until the correct password is found. While this can be time-consuming, having the same salt for all users or a short salt
can make the task significantly easier and faster.</p>
<p>If multiple users have the same password and the same salt, their password hashes would be identical. This means that if an attacker successfully
cracks one hash, they have effectively cracked all identical ones, granting them access to multiple accounts at once.</p>
<p>A short salt, while less critical than a shared one, still increases the odds of different users having the same salt. This might create clusters
of password hashes with identical salt that can then be attacked as explained before.</p>
<p>With short salts, the probability of a collision between two users' passwords and salts couple might be low depending on the salt size. The shorter
the salt, the higher the collision probability. In any case, using longer, cryptographically secure salt should be preferred.</p>
<h3>Exceptions</h3>
<p>To securely store password hashes, it is a recommended to rely on key derivation functions that are computationally intensive. Examples of such
functions are:</p>
<ul>
  <li> Argon2 </li>
  <li> PBKDF2 </li>
  <li> Scrypt </li>
  <li> Bcrypt </li>
</ul>
<p>When they are used for password storage, using a secure, random salt is required.</p>
<p>However, those functions can also be used for other purposes such as master key derivation or password-based pre-shared key generation. In those
cases, the implemented cryptographic protocol might require using a fixed salt to derive keys in a deterministic way. In such cases, using a fixed
salt is safe and accepted.</p></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>This vulnerability increases the likelihood that attackers are able to compute the cleartext of password hashes.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>The following code contains examples of hard-coded salts.</p>
<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
import javax.crypto.spec.PBEParameterSpec;

public void hash() {
    byte[] salt = "salty".getBytes();
    PBEParameterSpec cipherSpec = new PBEParameterSpec(salt, 10000); // Noncompliant
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
import java.security.SecureRandom;
import javax.crypto.spec.PBEParameterSpec;

public void hash() {
    SecureRandom random = new SecureRandom();
    byte[] salt = new byte[32];
    random.nextBytes(salt);

    PBEParameterSpec cipherSpec = new PBEParameterSpec(salt, 10000);
}
</pre>
<h3>How does this work?</h3>
<p>This code ensures that each user’s password has a unique salt value associated with it. It generates a salt randomly and with a length that
provides the required security level. It uses a salt length of at least 32 bytes (256 bits), as recommended by industry standards.</p>
<p>Here, the compliant code example ensures the salt is random and has a sufficient length by calling the <code>nextBytes</code> method from the
<code>SecureRandom</code> class with a salt buffer of 16 bytes. This class implements a cryptographically secure pseudo-random number generator.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Standards</h3>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">Top 10 2021 Category A2 - Cryptographic Failures</a> </li>
  <li> OWASP - <a href="https://www.owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/759">CWE-759 - Use of a One-Way Hash without a Salt</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/760">CWE-760 - Use of a One-Way Hash with a Predictable Salt</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222542">Application Security and
  Development: V-222542</a> - The application must only store cryptographic representations of passwords. </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>The diamond operator ("<>") should be used (java:S2293)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>The type argument should be omitted in the initialization if it is already present in the declaration of a field or variable.</p>
<p>For instance, a field with type <code>List&lt;String&gt;</code> can be initialized with <code>ArrayList&lt;&gt;()</code>, as the compiler will
infer that <code>ArrayList&lt;String&gt;()</code> is the actually desired call.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
List&lt;String&gt; strings = new ArrayList&lt;String&gt;();                       // Noncompliant, the compiler can infer the type argument of the constructor invocation
Map&lt;String,List&lt;Integer&gt;&gt; map = new HashMap&lt;String,List&lt;Integer&gt;&gt;();  // Noncompliant, the compiler can also infer complex type arguments
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
List&lt;String&gt; strings = new ArrayList&lt;&gt;();        // Compliant, the compiler will infer the type argument
Map&lt;String,List&lt;Integer&gt;&gt; map = new HashMap&lt;&gt;(); // Compliant, the compiler will infer the type argument
</pre>
<h2>References</h2>
<ul>
  <li> <a href="https://docs.oracle.com/javase/tutorial/java/generics/genTypeInference.html">The Java™ Tutorials</a> - Type Inference (Generics) </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Java uses angular brackets (<code>&lt;</code> and <code>&gt;</code>) to provide a specific type (the "type argument") to a generic type. For
instance, <code>List</code> is a generic type, so a list containing strings can be declared with <code>List&lt;String&gt;</code>.</p>
<p>Prior to Java 7, the type argument had to be provided explicitly for every occurrence where generics were used. This often caused redundancy, as
the type argument would have to be provided both when a field is declared and initialized.</p>
<p>Java 7 introduced the diamond operator (<code>&lt;&gt;</code>) to reduce the code’s verbosity in some situations. The type argument between the
angular brackets should be omitted if the compiler can infer it.</p>
<p>Since the diamond operator was only introduced in Java 7, this rule is automatically disabled when the project’s <code>sonar.java.source</code> is
lower than <code>7</code>.</p></p>
            </div>
        <div class="rule">
            <h3>"Collection.toArray()" should be passed an array of the proper type (java:S3020)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#toArray-T:A-">docs.oracle</a> - Collection.toArray() </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Collection.toArray()</code> method returns an <code>Object[]</code> when no arguments are provided to it. This can lead to a
<code>ClassCastException</code> at runtime if you try to cast the returned array to an array of a specific type. Instead, use this method by providing
an array of the desired type as the argument.</p>
<p>Note that passing a <code>new T[0]</code> array of length zero as the argument is more efficient than a pre-sized array <code>new
T[size]</code>.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public String [] getStringArray(List&lt;String&gt; strings) {
  return (String []) strings.toArray();  // Noncompliant, a ClassCastException will be thrown here
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public String [] getStringArray(List&lt;String&gt; strings) {
  return strings.toArray(new String[0]); // Compliant, the toArray method will return an array of the desired type, and we can remove the casting operation
}
public String [] getPresizedStringArray(List&lt;String&gt; strings) {
  return strings.toArray(new String[strings.size()]); // Compliant, but slightly less efficient than the previous example
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Non-primitive fields should not be "volatile" (java:S3077)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Marking an array <code>volatile</code> means that the array itself will always be read fresh and never thread cached, but the items <em>in</em> the
array will not be. Similarly, marking a mutable object field <code>volatile</code> means the object <em>reference</em> is <code>volatile</code> but
the object itself is not, and other threads may not see updates to the object state.</p>
<p>This can be salvaged with arrays by using the relevant AtomicArray class, such as <code>AtomicIntegerArray</code>, instead. For mutable objects,
the <code>volatile</code> should be removed, and some other method should be used to ensure thread-safety, such as synchronization, or ThreadLocal
storage.</p>
<h3>Noncompliant code example</h3>
<pre>
private volatile int [] vInts;  // Noncompliant
private volatile MyObj myObj;  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
private AtomicIntegerArray vInts;
private MyObj myObj;
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/UzdGBQ">CERT, CON50-J.</a> - Do not assume that declaring a reference volatile guarantees safe
  publication of the members of the referenced object </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"volatile" variables should not be used with compound operators (java:S3078)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/SjdGBQ">CERT, VNA02-J.</a> - Ensure that compound operations on shared variables are atomic
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Using compound operators as well as increments and decrements (and toggling, in the case of <code>boolean</code>s) on primitive fields are not
atomic operations. That is, they don’t happen in a single step. For instance, when a <code>volatile</code> primitive field is incremented or
decremented you run the risk of data loss if threads interleave in the steps of the update. Instead, use a guaranteed-atomic class such as
<code>AtomicInteger</code>, or synchronize the access.</p>
<h3>Noncompliant code example</h3>
<pre>
private volatile int count = 0;
private volatile boolean boo = false;

public void incrementCount() {
  count++;  // Noncompliant
}

public void toggleBoo(){
  boo = !boo;  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
private AtomicInteger count = 0;
private boolean boo = false;

public void incrementCount() {
  count.incrementAndGet();
}

public synchronized void toggleBoo() {
  boo = !boo;
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"java.nio.Files#delete" should be preferred (java:S4042)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When <code>java.io.File#delete</code> fails, this <code>boolean</code> method simply returns <code>false</code> with no indication of the cause. On
the other hand, when <code>java.nio.file.Files#delete</code> fails, this <code>void</code> method returns one of a series of exception types to better
indicate the cause of the failure. And since more information is generally better in a debugging situation, <code>java.nio.file.Files#delete</code> is
the preferred option.</p>
<h3>Noncompliant code example</h3>
<pre>
public void cleanUp(Path path) {
  File file = new File(path);
  if (!file.delete()) {  // Noncompliant
    //...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void cleanUp(Path path) throws NoSuchFileException, DirectoryNotEmptyException, IOException {
  Files.delete(path);
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Methods should not have identical implementations (java:S4144)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Two methods having the same implementation are suspicious. It might be that something else was intended. Or the duplication is intentional, which
becomes a maintenance burden.</p>
<pre data-diff-id="1" data-diff-type="noncompliant">
private final static String CODE = "bounteous";

public String calculateCode() {
  doTheThing();
  return CODE;
}

public String getName() {  // Noncompliant: duplicates calculateCode
  doTheThing();
  return CODE;
}
</pre>
<p>If the identical logic is intentional, the code should be refactored to avoid duplication. For example, by having both methods call the same method
or by having one implementation invoke the other.</p>
<pre data-diff-id="1" data-diff-type="compliant">
private final static String CODE = "bounteous";

public String getCode() {
  doTheThing();
  return CODE;
}

public String getName() { // The intent is clear
  return getCode();
}
</pre>
<h3>Exceptions</h3>
<p>Methods that are not accessors (getters and setters), with fewer than 2 statements are ignored.</p></p>
            </div>
        <div class="rule">
            <h3>Assignments should not be redundant (java:S4165)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The transitive property says that if <code>a == b</code> and <code>b == c</code>, then <code>a == c</code>. In such cases, there’s no point in
assigning <code>a</code> to <code>c</code> or vice versa because they’re already equivalent.</p>
<p>This rule raises an issue when an assignment is useless because the assigned-to variable already holds the value on all execution paths.</p>
<h3>Noncompliant code example</h3>
<pre>
a = b;
c = a;
b = c; // Noncompliant: c and b are already the same
</pre>
<h3>Compliant solution</h3>
<pre>
a = b;
c = a;
</pre></p>
            </div>
        <div class="rule">
            <h3>Local constants should follow naming conventions for constants (java:S4174)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Shared coding conventions allow teams to collaborate efficiently. This rule checks that all local, <code>final</code>, initialized, primitive
variables, have names that match a provided regular expression.</p>
<h3>Noncompliant code example</h3>
<p>With the default regular expression <code>^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$</code>:</p>
<pre>
public void doSomething() {
  final int local = 42;
  ...
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void doSomething() {
  final int LOCAL = 42;
  ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"Stream.collect()" calls should not be redundant (java:S4266)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When using the <code>Stream</code> API, call chains should be simplified as much as possible to improve readability and maintainability.</p>
<p>This rule raises an issue when one of the following substitution can be made:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Original</th>
      <th>Preferred</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><code>stream.collect(counting())</code></p></td>
      <td><p><code>stream.count()</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.collect(maxBy(comparator))</code></p></td>
      <td><p><code>stream.max(comparator)</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.collect(minBy(comparator))</code></p></td>
      <td><p><code>stream.min(comparator)</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.collect(mapping(mapper))</code></p></td>
      <td><p><code>stream.map(mapper).collect()</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.collect(reducing(...))</code></p></td>
      <td><p><code>stream.reduce(...)</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.collect(summingInt(mapper))</code></p></td>
      <td><p><code>stream.mapToInt(mapper).sum()</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.collect(summingLong(mapper))</code></p></td>
      <td><p><code>stream.mapToLong(mapper).sum()</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.collect(summingDouble(mapper))</code></p></td>
      <td><p><code>stream.mapToDouble(mapper).sum()</code></p></td>
    </tr>
  </tbody>
</table>
<h3>Noncompliant code example</h3>
<pre>
int count = stream.collect(counting());  // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
int count = stream.count();
</pre></p>
            </div>
        <div class="rule">
            <h3>Spring components should use constructor injection (java:S4288)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Spring <code>@Controller</code>, <code>@Service</code>, and <code>@Repository</code> classes are singletons by default, meaning only one instance
of the class is ever instantiated in the application. Typically such a class might have a few <code>static</code> members, such as a logger, but all
non-static members should be managed by Spring and supplied via constructor injection rather than by field injection.</p>
<p>This rule raise an issue when any non-<code>static</code> member of a Spring component has an injection annotation.</p>
<h3>Noncompliant code example</h3>
<pre>
@Controller
public class HelloWorld {

  @Autowired
  private String name = null; // Noncompliant

}
</pre>
<h3>Compliant solution</h3>
<p>As of Spring 4.3</p>
<pre>
@Controller
public class HelloWorld {

  private String name = null;

  HelloWorld(String name) {
    this.name = name;
  }
}
</pre>
<p>Before Spring 4.3</p>
<pre>
@Controller
public class HelloWorld {

  private String name = null;

  @Autowired
  HelloWorld(String name) {
    this.name = name;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"compareTo" should not be overloaded (java:S4351)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When implementing the <code>Comparable&lt;T&gt;.compareTo</code> method, the parameter’s type has to match the type used in the
<code>Comparable</code> declaration. When a different type is used this creates an overload instead of an override, which is unlikely to be the
intent.</p>
<p>This rule raises an issue when the parameter of the <code>compareTo</code> method of a class implementing <code>Comparable&lt;T&gt;</code> is not
same as the one used in the <code>Comparable</code> declaration.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Foo {
  static class Bar implements Comparable&lt;Bar&gt; {
    public int compareTo(Bar rhs) {
      return -1;
    }
  }

  static class FooBar extends Bar {
    public int compareTo(FooBar rhs) {  // Noncompliant: Parameter should be of type Bar
      return 0;
    }
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Foo {
  static class Bar implements Comparable&lt;Bar&gt; {
    public int compareTo(Bar rhs) {
      return -1;
    }
  }

  static class FooBar extends Bar {
    public int compareTo(Bar rhs) {
      return 0;
    }
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"else" statements should be clearly matched with an "if" (java:S5261)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The dangling <code>else</code> problem appears when nested <code>if</code>/<code>else</code>&nbsp;statements are written without curly braces. In
this case, <code>else</code> is associated with the nearest&nbsp;<code>if</code> but that is not always obvious and sometimes the indentation can also
be misleading.</p>
<p>This rules reports <code>else</code> statements that are difficult to understand, because they are inside nested <code>if</code> statements without
curly braces.</p>
<p>Adding curly braces can generally make the code clearer (see rule <a href='/coding_rules#rule_key=java%3AS121'>S121</a> ), and in this situation of dangling <code>else</code>, it
really clarifies the intention of the code.</p>
<h3>Noncompliant code example</h3>
<pre>
 if (a)
   if (b)
     d++;
 else     // Noncompliant, is the "else" associated with "if(a)" or "if (b)"? (the answer is "if(b)")
   e++;
</pre>
<h3>Compliant solution</h3>
<pre>
 if (a) {
   if (b) {
     d++;
   }
 } else { // Compliant, there is no doubt the "else" is associated with "if(a)"
   e++;
 }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://en.wikipedia.org/wiki/Dangling_else">https://en.wikipedia.org/wiki/Dangling_else</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Broadcasting intents is security-sensitive (java:S5320)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The intent contains sensitive information. </li>
  <li> Intent reception is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    @RequiresApi(api = Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {
        context.sendBroadcast(intent); // Sensitive
        context.sendBroadcastAsUser(intent, user); // Sensitive

        // Broadcasting intent with "null" for receiverPermission
        context.sendBroadcast(intent, null); // Sensitive
        context.sendBroadcastAsUser(intent, user, null); // Sensitive
        context.sendOrderedBroadcast(intent, null); // Sensitive
        context.sendOrderedBroadcastAsUser(intent, user, null, resultReceiver,
                scheduler, initialCode, initialData, initialExtras); // Sensitive
    }
}
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>In Android applications, broadcasting intents is security-sensitive. For example, it has led in the past to the following vulnerability:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9489">CVE-2018-9489</a> </li>
</ul>
<p>By default, broadcasted intents are visible to every application, exposing all sensitive information they contain.</p>
<p>This rule raises an issue when an intent is broadcasted without specifying any "receiver permission".</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The intent contains sensitive information. </li>
  <li> Intent reception is not restricted. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Sensitive Code Example</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    @RequiresApi(api = Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {
        context.sendBroadcast(intent); // Sensitive
        context.sendBroadcastAsUser(intent, user); // Sensitive

        // Broadcasting intent with "null" for receiverPermission
        context.sendBroadcast(intent, null); // Sensitive
        context.sendBroadcastAsUser(intent, user, null); // Sensitive
        context.sendOrderedBroadcast(intent, null); // Sensitive
        context.sendOrderedBroadcastAsUser(intent, user, null, resultReceiver,
                scheduler, initialCode, initialData, initialExtras); // Sensitive
    }
}
</pre>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    @RequiresApi(api = Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {

        context.sendBroadcast(intent, broadcastPermission);
        context.sendBroadcastAsUser(intent, user, broadcastPermission);
        context.sendOrderedBroadcast(intent, broadcastPermission);
        context.sendOrderedBroadcastAsUser(intent, user,broadcastPermission, resultReceiver,
                scheduler, initialCode, initialData, initialExtras);
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-PLATFORM/">Mobile AppSec Verification Standard - Platform Interaction Requirements</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">Mobile Top 10 2016 Category M1 - Improper
  Platform Usage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/927">CWE-927 - Use of Implicit Intent for Sensitive Communication</a> </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Restrict the access to broadcasted intents. See <a
href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> for more
information.</p>
<h2>Compliant Solution</h2>
<pre>
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Build;
import android.os.Bundle;
import android.os.Handler;
import android.os.UserHandle;
import android.support.annotation.RequiresApi;

public class MyIntentBroadcast {
    @RequiresApi(api = Build.VERSION_CODES.JELLY_BEAN_MR1)
    public void broadcast(Intent intent, Context context, UserHandle user,
                          BroadcastReceiver resultReceiver, Handler scheduler, int initialCode,
                          String initialData, Bundle initialExtras,
                          String broadcastPermission) {

        context.sendBroadcast(intent, broadcastPermission);
        context.sendBroadcastAsUser(intent, user, broadcastPermission);
        context.sendOrderedBroadcast(intent, broadcastPermission);
        context.sendOrderedBroadcastAsUser(intent, user,broadcastPermission, resultReceiver,
                scheduler, initialCode, initialData, initialExtras);
    }
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://mas.owasp.org/checklists/MASVS-PLATFORM/">Mobile AppSec Verification Standard - Platform Interaction Requirements</a>
  </li>
  <li> OWASP - <a href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage">Mobile Top 10 2016 Category M1 - Improper
  Platform Usage</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/927">CWE-927 - Use of Implicit Intent for Sensitive Communication</a> </li>
  <li> <a href="https://developer.android.com/guide/components/broadcasts.html#restricting_broadcasts_with_permissions">Android documentation</a> -
  Broadcast Overview - Security considerations and best practices </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Android applications, broadcasting intents is security-sensitive. For example, it has led in the past to the following vulnerability:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9489">CVE-2018-9489</a> </li>
</ul>
<p>By default, broadcasted intents are visible to every application, exposing all sensitive information they contain.</p>
<p>This rule raises an issue when an intent is broadcasted without specifying any "receiver permission".</p>
</p>
            </div>
        <div class="rule">
            <h3>Collection constructors should not be used as java.util.function.Function (java:S5329)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>It is very common to pass a collection constructor reference as an argument, for example <code>Collectors.toCollection(ArrayList::new)</code> takes
the <code>ArrayList::new</code> constructor. When the method expects a <code>java.util.function.Supplier</code> it is perfectly fine. However when the
method argument type is <code>java.util.function.Function</code> it means that an argument will be passed to the constructor.</p>
<p>The first argument of Collections constructors is usually an integer representing its "initial capacity". This is generally not what the developer
expects, but the memory allocation is not visible at first glance.</p>
<p>This rule raises an issue when a collection constructor is passed by reference as a <code>java.util.function.Function</code> argument.</p>
<h3>Noncompliant code example</h3>
<pre>
Arrays.asList(1, 2, 54000).stream().collect(Collectors.toMap(Function.identity(), ArrayList::new)); // Noncompliant, "ArrayList::new" unintentionally refers to "ArrayList(int initialCapacity)" instead of "ArrayList()"
</pre>
<h3>Compliant solution</h3>
<pre>
Arrays.asList(1, 2, 54000).stream().collect(Collectors.toMap(Function.identity(), id -&gt; new ArrayList&lt;&gt;())); // Compliant, explicitly show the usage of "id -&gt; new ArrayList&lt;&gt;()" or "id -&gt; new ArrayList&lt;&gt;(id)"
</pre></p>
            </div>
        <div class="rule">
            <h3>AssertJ assertions with "Consumer" arguments should contain assertion inside consumers (java:S6103)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>AssertJ assertions taking <code>Consumer</code> objects as arguments are expected to contain "requirements", which should themselves be expressed
as assertions. This concerns the following methods: <a
href="http://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/AbstractIterableAssert.html#allSatisfy-java.util.function.Consumer-">allSatisfy</a>,
<a
href="http://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/AbstractIterableAssert.html#anySatisfy-java.util.function.Consumer-">anySatisfy</a>,
<a
href="http://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/AbstractIterableAssert.html#hasOnlyOneElementSatisfying-java.util.function.Consumer-">hasOnlyOneElementSatisfying</a>,&nbsp;<a
href="https://tinyurl.com/yxnzt6pj">isInstanceOfSatisfying</a>,&nbsp;<a
href="http://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/AbstractIterableAssert.html#noneSatisfy-java.util.function.Consumer-">noneSatisfy</a>,
<a
href="http://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/AbstractAssert.html#satisfies-java.util.function.Consumer-">satisfies</a>,
<a
href="http://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/AbstractAssert.html#satisfiesAnyOf-java.util.function.Consumer-java.util.function.Consumer-">satisfiesAnyOf</a>,&nbsp;<a
href="http://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/AbstractIterableAssert.html#zipSatisfy-java.lang.Iterable-java.util.function.BiConsumer-">zipSatisfy</a>.</p>
<p>These methods are assuming the&nbsp;<code>Consumer</code>&nbsp;will do the assertions itself. If you do not do any assertion in the
<code>Consumer</code>, it probably means that you are inadvertently only partially testing your object.</p>
<p>This rule raises an issue when a <code>Consumer</code> argument of any of the above methods does not contain any assertion.</p>
<h3>Noncompliant code example</h3>
<pre>
assertThat(myObject).isInstanceOfSatisfying(String.class, s -&gt; "Hello".equals(s)); // Noncompliant - not testing the string value
assertThat(myObject).satisfies("Hello"::equals); // Noncompliant - not testing the string value
</pre>
<h3>Compliant solution</h3>
<pre>
assertThat(myObject).isInstanceOfSatisfying(String.class, s -&gt; assertThat(s).isEqualTo("Hello"));
assertThat(myObject).satisfies(obj -&gt; assertThat(obj).isEqualTo("Hello"));
</pre></p>
            </div>
        <div class="rule">
            <h3>Map "computeIfAbsent()" and "computeIfPresent()" should not be used to add "null" values. (java:S6104)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Map <a
href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#computeIfAbsent-K-java.util.function.Function-">computeIfAbsent</a>&nbsp;and <a
href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#computeIfPresent-K-java.util.function.BiFunction-">computeIfPresent</a> methods are
convenient to avoid the cumbersome process to check if a key exists or not, followed by the addition of the entry. However, when the function used to
compute the value returns <code>null</code>, the entry <code>key-&gt;null</code> will not be added to the Map. Furthermore, in the case of
<code>computeIfPresent</code>, if the key is present the entry will be removed. These methods should therefore not be used to conditionally add an
entry with a null value. The traditional way should be used instead.</p>
<p>This rule raises an issue when <code>computeIfAbsent</code> or <code>computeIfPresent</code> is used with a lambda always returning null.</p>
<h3>Noncompliant code example</h3>
<pre>
map.computeIfAbsent(key, k -&gt; null); // Noncompliant, the map will not contain an entry key-&gt;null.
map.computeIfPresent(key, (k, oldValue) -&gt; null); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
if (!map.containsKey(key)) {
    map.put(key, null);
}
if (map.containsKey(key)) {
    map.put(key, null);
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS3824'>S3824</a> - "Map.get" and value test should be replaced with a single method call </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Pattern Matching for "instanceof" operator should be used instead of simple "instanceof" + cast (java:S6201)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 16, the feature "Pattern matching for instanceof" is finalized and can&nbsp;be used in production. Previously developers needed to do 3
operations in order to do this: check the variable type, cast it and assign the casted value to the new variable. This approach is quite verbose and
can be replaced with pattern matching for&nbsp;<code>instanceof</code>, doing these 3 actions (check, cast and assign) in one expression.</p>
<p>This rule raises an issue when an <code>instanceof</code> check followed by a cast and an assignment could be replaced by pattern matching.</p>
<h3>Noncompliant code example</h3>
<pre>
int f(Object o) {
  if (o instanceof String) {&nbsp; // Noncompliant
    String string = (String) o;
    return string.length();
  }
  return 0;
}
</pre>
<h3>Compliant solution</h3>
<pre>
int f(Object o) {
&nbsp; if (o instanceof String string) {&nbsp; // Compliant
&nbsp; &nbsp; return string.length();
&nbsp; }
&nbsp; return 0;
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/394">JEP 394: Pattern Matching for instanceof</a> &nbsp; </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Operator "instanceof" should be used instead of "A.class.isInstance()" (java:S6202)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>instanceof</code> construction is a preferred way to check whether a variable can be cast to some type statically because a compile-time
error will occur in case of incompatible types. The method <a
href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#isInstance-java.lang.Object-">isInstance()</a> from <code>java.lang.Class</code>
works differently and does type check at runtime only, incompatible types will therefore not be detected early in the development, potentially
resulting in dead code. The <code>isInstance()</code> method should only be used in dynamic cases when the <code>instanceof</code> operator can’t be
used.</p>
<p>This rule raises an issue when <code>isInstance()</code> is used and could be replaced with an <code>instanceof</code> check.</p>
<h3>Noncompliant code example</h3>
<pre>
int f(Object o) {
&nbsp; if (String.class.isInstance(o)) {&nbsp; // Noncompliant
&nbsp; &nbsp; return 42;
&nbsp; }
&nbsp; return 0;
}

int f(Number n) {
&nbsp; if (String.class.isInstance(n)) {&nbsp; // Noncompliant
&nbsp; &nbsp; return 42;
&nbsp; }
&nbsp; return 0;
}
</pre>
<h3>Compliant solution</h3>
<pre>
int f(Object o) {
&nbsp; if (o instanceof String) {&nbsp; // Compliant
&nbsp; &nbsp; return 42;
&nbsp; }
&nbsp; return 0;
}

int f(Number n) {
&nbsp; if (n instanceof String) {&nbsp; // Compile-time error
&nbsp; &nbsp; return 42;
&nbsp; }
&nbsp; return 0;
}

boolean fun(Object o, String c) throws ClassNotFoundException
{
  return Class.forName(c).isInstance(o); // Compliant, can't use instanceof operator here
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Text blocks should not be used in complex expressions (java:S6203)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/378">JEP 378: Text Blocks</a> </li>
  <li> <a href="https://openjdk.org/projects/amber/guides/text-blocks-guide">Programmer’s Guide To Text Blocks</a>, by Jim Laskey and Stuart Marks
  </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 15 Text Blocks are official and can be used just like an ordinary String. However, when they are used to represent a big chunk of text,
they should not be used directly in complex expressions, as it decreases the readability. In this case, it is better to extract the text block into a
variable or a field.</p>
<p>This rule reports an issue when a text block longer than a number of lines given as a parameter is directly used within a lambda expression.</p>
<h3>Noncompliant code example</h3>
<pre>
listOfString.stream()
  .map(str -&gt; !"""
    &lt;project&gt;
      &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
      &lt;parent&gt;
        &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
        &lt;artifactId&gt;my-app&lt;/artifactId&gt;
        &lt;version&gt;1&lt;/version&gt;
      &lt;/parent&gt;

      &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
      &lt;artifactId&gt;my-module&lt;/artifactId&gt;
      &lt;version&gt;1&lt;/version&gt;
    &lt;/project&gt;
    """.equals(str));
</pre>
<h3>Compliant solution</h3>
<pre>
String myTextBlock = """
    &lt;project&gt;
      &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
      &lt;parent&gt;
        &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
        &lt;artifactId&gt;my-app&lt;/artifactId&gt;
        &lt;version&gt;1&lt;/version&gt;
      &lt;/parent&gt;

      &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
      &lt;artifactId&gt;my-module&lt;/artifactId&gt;
      &lt;version&gt;1&lt;/version&gt;
    &lt;/project&gt;
    """;

listOfString.stream()
  .map(str -&gt; !myTextBlock.equals(str));
</pre></p>
            </div>
        <div class="rule">
            <h3>"Stream.toList()" method should be used instead of "collectors" when unmodifiable list needed (java:S6204)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 8 <code>Streams</code> were introduced to support chaining of operations over collections in a functional style. The most common way to
save a result of such chains is to save them to some collection (usually <code>List</code>). To do so there is a terminal method <code>collect</code>
that can be used with a library of <code>Collectors</code>. The key problem is that <code>.collect(Collectors.toList())</code> actually returns a
mutable kind of <code>List</code> while in the majority of cases unmodifiable lists are preferred. In Java 10 a new collector appeared to return an
unmodifiable list: <code>toUnmodifiableList()</code>. This does the trick but results in verbose code. Since Java 16 there is now a better variant to
produce an unmodifiable list directly from a stream: <code>Stream.toList()</code>.</p>
<p>This rule raises an issue when "collect" is used to create a list from a stream.</p>
<h3>Noncompliant code example</h3>
<pre>
List&lt;String&gt; list1 = Stream.of("A", "B", "C")
                           .collect(Collectors.toList()); // Noncompliant

List&lt;String&gt; list2 = Stream.of("A", "B", "C")
                           .collect(Collectors.toUnmodifiableList()); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
List&lt;String&gt; list1 = Stream.of("A", "B", "C").toList(); // Compliant

List&lt;String&gt; list2 = Stream.of("A", "B", "C")
                           .collect(Collectors.toList()); // Compliant, the list2 needs to be mutable

list2.add("X");
</pre></p>
            </div>
        <div class="rule">
            <h3>Switch arrow labels should not use redundant keywords (java:S6205)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Switch Expressions, an arrow label consisting of a block with a single <code>yield</code> can be simplified to directly return the value,
resulting in cleaner code.</p>
<p>Similarly, for Switch Statements and arrow labels, a <code>break</code> in a block is always redundant and should not be used. Furthermore, if the
resulting block contains only one statement, the curly braces of that block can also be omitted.</p>
<p>This rule reports an issue when a case of a Switch Expression contains a block with a single <code>yield</code> or when a Switch Statement contains
a block with a <code>break</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
int i = switch (mode) {
  case "a" -&gt; {        // Noncompliant: Remove the redundant block and yield.
    yield 1;
  }
  default -&gt; {         // Noncompliant: Remove the redundant block and yield.
    yield 2;
  }
};

switch (mode) {
  case "a" -&gt; {        // Noncompliant: Remove the redundant block and break.
    result = 1;
    break;
  }
  default -&gt; {         // Noncompliant: Remove the redundant break.
    doSomethingElse();
    result = 2;
    break;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
int i = switch (mode) {
  case "a" -&gt; 1;
  default -&gt; 2;
};

switch (mode) {
  case "a" -&gt; result = 1;
  default -&gt; {
   doSomethingElse();
   result = 2;
 }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/361">JEP 361: Switch Expressions</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Records should be used instead of ordinary classes when representing immutable data structure (java:S6206)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-8.html#jls-8.10">Records specification</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 16 <code>records</code> are finalized and can be safely used in production code. <code>Records</code> represent immutable read-only data
structure and should be used instead of creating immutable classes. Immutability of records is guaranteed by the Java language itself, while
implementing immutable classes on your own might lead to some bugs.</p>
<p>One of the important aspects of <code>records</code> is that final fields can’t be overwritten using reflection.</p>
<p>This rule reports an issue on classes for which all these statements are true:</p>
<ul>
  <li> all instance fields are private and final </li>
  <li> has only one constructor with a parameter for all fields </li>
  <li> has getters for all fields </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
final class Person { // Noncompliant
  private final String name;
  private final int age;

  public Person(String name, int age) {
    this.name = name;
    this.age = age;
  }

  public String getName() {...}

  public int getAge() {...}

  @Override
  public boolean equals(Object o) {...}

  @Override
  public int hashCode() {...}

  @Override
  public String toString() {...}
}
</pre>
<h3>Compliant solution</h3>
<pre>
record Person(String name, int age) { }
</pre></p>
            </div>
        <div class="rule">
            <h3>Redundant constructors/methods should be avoided in records (java:S6207)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 16 records represent a brief notation for immutable data structures. Records have autogenerated implementations for constructors with all
parameters, <code>getters</code>, <code>equals</code>, <code>hashcode</code> and <code>toString</code>. Although these methods can still be overridden
inside records, there is no use to do so if no special logic is required.</p>
<p>This rule reports an issue on empty compact constructors, trivial canonical constructors and simple getter methods with no additional logic.</p>
<h3>Noncompliant code example</h3>
<pre>
record Person(String name, int age) {
  Person(String name, int age) { // Noncompliant, already autogenerated
    this.name = name;
    this.age = age;
  }
}

record Person(String name, int age) {
  Person { // Noncompliant, no need for empty compact constructor
  }
  public String name() { // Noncompliant, already autogenerated
    return name;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
record Person(String name, int age) { } // Compliant

record Person(String name, int age) {
  Person(String name, int age) { // Compliant
    this.name = name.toLowerCase(Locale.ROOT);
    this.age = age;
  }
}

record Person(String name, int age) {
  Person { // Compliant
    if (age &lt; 0) {
      throw new IllegalArgumentException("Negative age");
    }
  }
  public String name() { // Compliant
    return name.toUpperCase(Locale.ROOT);
  }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-8.html#jls-8.10">Records specification</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Comma-separated labels should be used in Switch with colon case (java:S6208)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 14 there is a new way to write cases in Switch Statement and Expression when the same action should be performed for different cases.
Instead of declaring multiples branches with the same action, you can combine all of them in a single case group, separated with commas. It will
result in a more concise code and improved readability.</p>
<p>This rule reports an issue when multiple cases in a Switch can be grouped into a single comma-separated case.</p>
<h3>Noncompliant code example</h3>
<pre>
// Switch Expression
int i = switch (mode) {
  case "a":
  case "b":
    yield 1;
  default:
    yield 3;
};

// Switch Statement
switch (mode) {
  case "a":
  case "b":
    doSomething();
    break;
  default:
    doSomethingElse();
}
</pre>
<h3>Compliant solution</h3>
<pre>
// Switch Expression
int i = switch (mode) {
  case "a", "b":
    yield 1;
  default:
    yield 3;
};

// Switch Statement
switch (mode) {
  case "a", "b":
    doSomething();
    break;
  default:
    doSomethingElse();
}

// Or even better:
switch (mode) {
  case "a", "b" -&gt; doSomething();
  default -&gt; doSomethingElse();
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/361">JEP 361: Switch Expressions</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Members ignored during record serialization should not be used (java:S6209)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-8.html#jls-8.10">Records specification</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/16/docs/specs/serialization/serial-arch.html#serialization-of-records">serialization of
  records</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Records, serialization is not done the same way as for ordinary serializable or externalizable classes. The serialized representation of a
record object will be a sequence of values (record components). During the deserialization of records, the stream of components is read and components
are constructed. Then the record object is recreated by invoking the record’s canonical constructor with the component values serving as arguments (or
default values for absent arguments).</p>
<p>This process cannot be customized, so any class-specific <code>writeObject</code>, <code>readObject</code>, <code>readObjectNoData</code>,
<code>writeExternal</code>, and <code>readExternal</code> methods or <code>serialPersistentFields</code> fields in record classes are ignored during
serialization and deserialization.</p>
<p>However, there is a way to substitute serialized/deserialized objects in <code>writeReplace</code> and <code>readResolve</code>.</p>
<p>This rule raises an issue when any of <code>writeObject</code>, <code>readObject</code>, <code>readObjectNoData</code>, <code>writeExternal</code>,
<code>readExternal</code> or <code>serialPersistentFields</code> are present as members in a Record class.</p>
<h3>Noncompliant code example</h3>
<pre>
record Record() implements Serializable {
  @Serial
  private static final ObjectStreamField[] serialPersistentFields = new ObjectStreamField[0]; // Noncompliant
  @Serial
  private void writeObject(ObjectOutputStream out) throws IOException { // Noncompliant
    ...
  }
}
record Record() implements Externalizable {
  @Override
  public void writeExternal(ObjectOutput out) throws IOException { // Noncompliant
    ...
  }
  @Override
  public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException { // Noncompliant
    ...
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
record Record() implements Serializable {}

record Record() implements Serializable {
  private Object writeReplace() throws ObjectStreamException {
    ...
  }
  private Object readResolve() throws ObjectStreamException {
    ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Regular expressions should not contain multiple spaces (java:S6326)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Multiple spaces in a regular expression can make it hard to tell how many spaces should be matched. It’s more readable to use only one space and
then indicate with a quantifier how many spaces are expected.</p>
<h3>Noncompliant code example</h3>
<pre>
Pattern.compile("hello   world");
</pre>
<h3>Compliant solution</h3>
<pre>
Pattern.compile("hello {3}world");
</pre>
<h3>Exceptions</h3>
<p>In <a href="https://www.regular-expressions.info/freespacing.html">free-spacing mode</a> (<code>Pattern.COMMENTS</code> flag, or with embedded flag
expression <code>(?x)</code>), whitespaces are ignored. In this case no issue should be triggered, because the whitespaces may be intended to improve
readability.</p></p>
            </div>
        <div class="rule">
            <h3>Regular expression quantifiers and character classes should be used concisely (java:S6353)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>A regular expression is a sequence of characters that specifies a match pattern in text. Among the most important concepts are:</p>
<ul>
  <li> Character classes: defines a set of characters, any one of which can occur in an input string for a match to succeed. </li>
  <li> Quantifiers: used to specify how many instances of a character, group, or character class must be present in the input for a match. </li>
  <li> Wildcard (<code>.</code>): matches all characters except line terminators (also matches them if the <code>s</code> flag is set). </li>
</ul>
<p>Many of these features include shortcuts of widely used expressions, so there is more than one way to construct a regular expression to achieve the
same results. For example, to match a two-digit number, one could write <code>[0-9]{2,2}</code> or <code>\d{2}</code>. The latter is not only shorter
but easier to read and thus to maintain.</p>
<p>This rule recommends replacing some quantifiers and character classes with more concise equivalents:</p>
<ul>
  <li> <code>\d</code> for <code>[0-9]</code> and <code>\D</code> for <code>[^0-9]</code> </li>
  <li> <code>\w</code> for <code>[A-Za-z0-9_]</code> and <code>\W</code> for <code>[^A-Za-z0-9_]</code> </li>
  <li> <code>.</code> for character classes matching everything (e.g. <code>[\w\W]</code>, <code>[\d\D]</code>, or <code>[\s\S]</code> with
  <code>s</code> flag) </li>
  <li> <code>x?</code> for <code>x{0,1}</code>, <code>x*</code> for <code>x{0,}</code>, <code>x+</code> for <code>x{1,}</code>, <code>x{N}</code> for
  <code>x{N,N}</code> </li>
</ul>
<pre data-diff-id="1" data-diff-type="noncompliant">
"[0-9]"        // Noncompliant - same as "\\d"
"[^0-9]"       // Noncompliant - same as "\\D"
"[A-Za-z0-9_]" // Noncompliant - same as "\\w"
"[\\w\\W]"     // Noncompliant - same as "."
"a{0,}"        // Noncompliant - same as "a*"
</pre>
<p>Use the more concise version to make the regex expression more readable.</p>
<pre data-diff-id="1" data-diff-type="compliant">
"\\d"
"\\D"
"\\w"
"."
"a*"
</pre></p>
            </div>
        <div class="rule">
            <h3>Deprecated annotations should include explanations (java:S6355)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Since Java 9, <code>@Deprecated</code> has two additional arguments to the annotation:</p>
<ul>
  <li> <code>since</code> allows you to describe when the deprecation took place </li>
  <li> <code>forRemoval</code>, indicates whether the deprecated element will be removed at some future date </li>
</ul>
<p>In order to ease the maintainers work, it is recommended to always add one or both of these arguments.</p>
<p>This rule reports an issue when <code>@Deprecated</code> is used without any argument.</p>
<h3>Noncompliant code example</h3>
<pre>
@Deprecated
</pre>
<h3>Compliant solution</h3>
<pre>
@Deprecated(since="4.2", forRemoval=true)
</pre>
<h3>Exceptions</h3>
<p>The members and methods of a deprecated class or interface are ignored by this rule. The classes and interfaces themselves are still subject to
it.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS1123'>S1123</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Hard-coded secrets are security-sensitive (java:S6418)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Default:</p>
            <p><p>Because it is easy to extract strings from an application source code or binary, secrets should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25510">CVE-2022-25510</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42635">CVE-2021-42635</a> </li>
</ul>
<p>Secrets should be stored outside of the source code in a configuration file or a management service for secrets.</p>
<p>This rule detects variables/fields having a name matching a list of words (secret, token, credential, auth, api[_.-]?key) being assigned a
pseudorandom hard-coded value. The pseudorandomness of the hard-coded value is based on its entropy and the probability to be human-readable. The
randomness sensibility can be adjusted if needed. Lower values will detect less random values, raising potentially more false positives.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The secret allows access to a sensitive component like a database, a file storage, an API, or a service. </li>
  <li> The secret is used in a production environment. </li>
  <li> Application re-distribution is required before updating the secret. </li>
</ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the secret in a configuration file that is not pushed to the code repository. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a secret has been disclosed through the source code: revoke it and create a new one. </li>
</ul>
<h2>Sensitive Code Example</h2>
<pre>
private static final String MY_SECRET = "47828a8dd77ee1eb9dde2d5e93cb221ce8c32b37";

public static void main(String[] args) {
  MyClass.callMyService(MY_SECRET);
}
</pre>
<h2>Compliant Solution</h2>
<p>Using <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javav2/example_code/secrets-manager">AWS Secrets Manager</a>:</p>
<pre>
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueRequest;
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueResponse;

public static void main(String[] args) {
  SecretsManagerClient secretsClient = ...
  MyClass.doSomething(secretsClient, "MY_SERVICE_SECRET");
}

public static void doSomething(SecretsManagerClient secretsClient, String secretName) {
  GetSecretValueRequest valueRequest = GetSecretValueRequest.builder()
    .secretId(secretName)
    .build();

  GetSecretValueResponse valueResponse = secretsClient.getSecretValue(valueRequest);
  String secret = valueResponse.secretString();
  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<p>Using <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/quick-create-java?tabs=azure-cli">Azure Key Vault Secret</a>:</p>
<pre>
import com.azure.identity.DefaultAzureCredentialBuilder;

import com.azure.security.keyvault.secrets.SecretClient;
import com.azure.security.keyvault.secrets.SecretClientBuilder;
import com.azure.security.keyvault.secrets.models.KeyVaultSecret;

public static void main(String[] args) throws InterruptedException, IllegalArgumentException {
  String keyVaultName = System.getenv("KEY_VAULT_NAME");
  String keyVaultUri = "https://" + keyVaultName + ".vault.azure.net";

  SecretClient secretClient = new SecretClientBuilder()
    .vaultUrl(keyVaultUri)
    .credential(new DefaultAzureCredentialBuilder().build())
    .buildClient();

  MyClass.doSomething(secretClient, "MY_SERVICE_SECRET");
}

public static void doSomething(SecretClient secretClient, String secretName) {
  KeyVaultSecret retrievedSecret = secretClient.getSecret(secretName);
  String secret = retrievedSecret.getValue(),

  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> MSC - <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">MSC03-J - Never hard code sensitive information</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Because it is easy to extract strings from an application source code or binary, secrets should not be hard-coded. This is particularly true for
applications that are distributed or that are open-source.</p>
<p>In the past, it has led to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25510">CVE-2022-25510</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-42635">CVE-2021-42635</a> </li>
</ul>
<p>Secrets should be stored outside of the source code in a configuration file or a management service for secrets.</p>
<p>This rule detects variables/fields having a name matching a list of words (secret, token, credential, auth, api[_.-]?key) being assigned a
pseudorandom hard-coded value. The pseudorandomness of the hard-coded value is based on its entropy and the probability to be human-readable. The
randomness sensibility can be adjusted if needed. Lower values will detect less random values, raising potentially more false positives.</p>
</p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The secret allows access to a sensitive component like a database, a file storage, an API, or a service. </li>
  <li> The secret is used in a production environment. </li>
  <li> Application re-distribution is required before updating the secret. </li>
</ul>
<p>There would be a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<pre>
private static final String MY_SECRET = "47828a8dd77ee1eb9dde2d5e93cb221ce8c32b37";

public static void main(String[] args) {
  MyClass.callMyService(MY_SECRET);
}
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> Store the secret in a configuration file that is not pushed to the code repository. </li>
  <li> Use your cloud provider’s service for managing secrets. </li>
  <li> If a secret has been disclosed through the source code: revoke it and create a new one. </li>
</ul>
<h2>Compliant Solution</h2>
<p>Using <a href="https://github.com/awsdocs/aws-doc-sdk-examples/tree/main/javav2/example_code/secrets-manager">AWS Secrets Manager</a>:</p>
<pre>
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueRequest;
import software.amazon.awssdk.services.secretsmanager.model.GetSecretValueResponse;

public static void main(String[] args) {
  SecretsManagerClient secretsClient = ...
  MyClass.doSomething(secretsClient, "MY_SERVICE_SECRET");
}

public static void doSomething(SecretsManagerClient secretsClient, String secretName) {
  GetSecretValueRequest valueRequest = GetSecretValueRequest.builder()
    .secretId(secretName)
    .build();

  GetSecretValueResponse valueResponse = secretsClient.getSecretValue(valueRequest);
  String secret = valueResponse.secretString();
  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<p>Using <a href="https://docs.microsoft.com/en-us/azure/key-vault/secrets/quick-create-java?tabs=azure-cli">Azure Key Vault Secret</a>:</p>
<pre>
import com.azure.identity.DefaultAzureCredentialBuilder;

import com.azure.security.keyvault.secrets.SecretClient;
import com.azure.security.keyvault.secrets.SecretClientBuilder;
import com.azure.security.keyvault.secrets.models.KeyVaultSecret;

public static void main(String[] args) throws InterruptedException, IllegalArgumentException {
  String keyVaultName = System.getenv("KEY_VAULT_NAME");
  String keyVaultUri = "https://" + keyVaultName + ".vault.azure.net";

  SecretClient secretClient = new SecretClientBuilder()
    .vaultUrl(keyVaultUri)
    .credential(new DefaultAzureCredentialBuilder().build())
    .buildClient();

  MyClass.doSomething(secretClient, "MY_SERVICE_SECRET");
}

public static void doSomething(SecretClient secretClient, String secretName) {
  KeyVaultSecret retrievedSecret = secretClient.getSecret(secretName);
  String secret = retrievedSecret.getValue(),

  // do something with the secret
  MyClass.callMyService(secret);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A2_2017-Broken_Authentication">Top 10 2017 Category A2 - Broken Authentication</a>
  </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/798">CWE-798 - Use of Hard-coded Credentials</a> </li>
  <li> MSC - <a href="https://wiki.sei.cmu.edu/confluence/x/OjdGBQ">MSC03-J - Never hard code sensitive information</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Exact alarms should not be abused (java:S6891)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">How_to_fix:</p>
            <p><p>Replace occurrences of <code>setExact</code> with <code>set</code> and <code>setExactAndAllowWhileIdle</code> with
<code>setAndAllowWhileIdle</code>, and avoid to use <code>setWindow</code> with a window less than 10 minutes.</p>
<p>Alternatively, consider using <code>Handler</code>, <code>WorkManager</code> or <code>JobScheduler</code> instead of <code>AlarmManager</code> when
possible, depending on your use case.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class AlarmScheduler {
    private Context context;

    public AlarmScheduler(Context context) {
        this.context = context;
    }

    public void scheduleAlarm(long triggerTime) {
        AlarmManager alarmManager = (AlarmManager) context.getSystemService(Context.ALARM_SERVICE);
        Intent intent = new Intent(context, AlarmReceiver.class);
        PendingIntent pendingIntent = PendingIntent.getBroadcast(context, 0, intent, 0);

        alarmManager.setExact(AlarmManager.RTC_WAKEUP, triggerTime, pendingIntent); // Noncompliant, avoid using exact alarms unless necessary
        alarmManager.setExactAndAllowWhileIdle(AlarmManager.RTC_WAKEUP, triggerTime, pendingIntent); // Noncompliant, avoid using exact alarms unless necessary

        long windowLengthMillis = 5 * 60 * 1000; // 5 minutes in milliseconds
        alarmManager.setWindow(AlarmManager.RTC_WAKEUP, triggerTime, windowLengthMillis, pendingIntent); // Noncompliant, don't use windows below 10 minutes
    }
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class AlarmScheduler {
    private Context context;

    public AlarmScheduler(Context context) {
        this.context = context;
    }

    public void scheduleAlarm(long triggerTime) {
        AlarmManager alarmManager = (AlarmManager) context.getSystemService(Context.ALARM_SERVICE);
        Intent intent = new Intent(context, AlarmReceiver.class);
        PendingIntent pendingIntent = PendingIntent.getBroadcast(context, 0, intent, 0);

        alarmManager.set(AlarmManager.RTC_WAKEUP, triggerTime, pendingIntent); // Compliant
        alarmManager.setAndAllowWhileIdle(AlarmManager.RTC_WAKEUP, triggerTime, pendingIntent);  // Compliant

        long windowLengthMillis = 10 * 60 * 1000; // 10 minutes in milliseconds
        alarmManager.setWindow(AlarmManager.RTC_WAKEUP, triggerTime, windowLengthMillis, pendingIntent); // Compliant
    }
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://developer.android.com/reference/android/app/AlarmManager">Android for Developers - AlarmManager</a> </li>
  <li> <a href="https://developer.android.com/about/versions/kitkat/android-4.4">Android for Developers - AlarmManager with SDK Version 19</a> </li>
  <li> <a href="https://developer.android.com/develop/background-work/services/alarms/schedule#exact-acceptable-use-cases">Android for Developers -
  Schedule alarms</a> </li>
  <li> <a href="https://developer.android.com/reference/android/os/Handler">Android for Developers - Handler</a> </li>
  <li> <a href="https://developer.android.com/reference/androidx/work/WorkManager">Android for Developers - WorkManager</a> </li>
  <li> <a href="https://developer.android.com/reference/android/app/job/JobScheduler">Android for Developers - JobScheduler</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The use of exact alarms triggers the device to wake up at precise times that can lead several wake-ups in a short period of time. The wake-up
mechanism is a significant battery drain because it requires powering up the main processor and pulling it out of a low-power state.</p>
<p>It’s highly recommended to create an inexact alarm whenever possible.</p>
<p>It is also recommended for normal timing operations, such as ticks and timeouts, using the <code>Handler</code>, and for long-running operations,
such as network downloads, using <code>WorkManager</code> or <code>JobScheduler</code>.</p>
<h3>What is the potential impact?</h3>
<ul>
  <li> <em>Usability</em>: the device may run out of battery faster than expected. </li>
  <li> <em>Sustainability</em>: the extra battery usage has a negative impact on the environment. </li>
</ul></p>
            
            <p class="section-title">Introduction:</p>
            <p><p>The <code>AlarmManager</code> class provides access to the system alarm services. It allows you to schedule your application to run at some point
in the future, even when it’s not active.</p>
<p>From API 19 onwards, the alarm delivery is inexact in order to save battery life. The Android OS now batches together alarms from all apps that
occur at reasonably similar times so the system wakes the device once instead of several times to handle each alarm.</p>
<p>It is possible to use exact alarms with <code>setExact</code>, <code>setExactAndAllowWhileIdle</code>, <code>setWindow</code> and
<code>setAlarmClock</code>. Exact alarms should be used only when strict delivery guarantees are required, for example for an alarm clock application
or for calendar notifications.</p>
<p>The rule raises an issue when an exact alarm is set, or when a window is set to less than 10 minutes.</p></p>
            </div>
        <div class="rule">
            <h3>Fields should not be initialized to default values (java:S3052)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The compiler automatically initializes class fields to their default values before setting them with any initialization values, so there is no need
to explicitly set a field to its default value. Further, under the logic that cleaner code is better code, it’s considered poor style to do so.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {

  int count = 0;  // Noncompliant
  // ...

}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyClass {

  int count;
  // ...

}
</pre>
<h3>Exceptions</h3>
<p><code>final</code> fields are ignored.</p></p>
            </div>
        <div class="rule">
            <h3>Map values should not be replaced unconditionally (java:S4143)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Storing a value inside a collection at a given key or index and then unconditionally overwriting it without reading the initial value is a case of
a "dead store".</p>
<pre>
letters.put("a", "Apple");
letters.put("a", "Boy");  // Noncompliant

towns[i] = "London";
towns[i] = "Chicago";  // Noncompliant
</pre>
<p>This practice is redundant and will cause confusion for the reader. More importantly, it is often an error and not what the developer intended to
do.</p></p>
            </div>
        <div class="rule">
            <h3>"Bean Validation" (JSR 380) should be properly configured (java:S5128)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://beanvalidation.org/2.0/spec/">Bean Validation 2.0 (JSR 380)</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>Bean Validation</code> as per defined by JSR 380 can be triggered programmatically or also executed by the <code>Bean Validation</code>
providers. However something should tell the <code>Bean Validation</code> provider that a variable must be validated otherwise no validation will
happen. This can be achieved by annotating a variable with <code>javax.validation.Valid</code> and unfortunally it’s easy to forget to add this
annotation on complex Beans.</p>
<p>Not annotating a variable with <code>@Valid</code> means <code>Bean Validation</code> will not be triggered for this variable, but readers may
overlook this omission and assume the variable will be validated.</p>
<p>This rule will run by default on all <code>Class</code>'es and therefore can generate a lot of noise. This rule should be restricted to run only on
certain layers. For this reason, the "Restrict Scope of Coding Rules" feature should be used to check for missing <code>@Valid</code> annotations only
on some packages of the application.</p>
<h3>Noncompliant code example</h3>
<pre>
import javax.validation.Valid;
import javax.validation.constraints.NotNull;

public class User {
  @NotNull
  private String name;
}

public class Group {
  @NotNull
  private List&lt;User&gt; users; // Noncompliant; User instances are not validated
}

public class MyService {
  public void login(User user) { // Noncompliant; parameter "user" is not validated
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
import javax.validation.Valid;
import javax.validation.constraints.NotNull;

public class User {
  @NotNull
  private String name;
}

public class Group {
  @Valid
  @NotNull
  private List&lt;User&gt; users; // Compliant; User instances are validated

  @NotNull
  // preferred style as of Bean Validation 2.0
  private List&lt;@Valid User&gt; users2; // Compliant; User instances are validated
}

public class MyService {
  public void login(@Valid User user) { // Compliant
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Reflection should not be used to increase accessibility of records' fields (java:S6216)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-8.html#jls-8.10">Records specification</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In general, altering or bypassing the accessibility of classes, methods, or fields violates the encapsulation principle and could lead to runtime
errors. For records the case is even trickier: you cannot change the visibility of records’s fields and trying to update the existing value will lead
to <code>IllegalAccessException</code> at runtime.</p>
<p>This rule raises an issue when reflection is used to change the visibility of a record’s field, and when it is used to directly update a record’s
field value.</p>
<h3>Noncompliant code example</h3>
<pre>
record Person(String name, int age) {}

Person person = new Person("A", 26);
Field field = Person.class.getDeclaredField("name");
field.setAccessible(true); // secondary
field.set(person, "B"); // Noncompliant
</pre></p>
            </div>
        <div class="rule">
            <h3>Permitted types of a sealed class should be omitted if they are declared in the same file (java:S6217)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se17/html/jls-8.html#jls-8.1.1.2">Sealed Classes specification</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p><code>sealed</code> classes were introduced in Java 17. This feature is very useful if there is a need to define a strict hierarchy and restrict
the possibility of extending classes. In order to mention all the allowed subclasses, there is a keyword <code>permits</code>, which should be
followed by subclasses' names.</p>
<p>This notation is quite useful if subclasses of a given <code>sealed</code> class can be found in different files, packages, or even modules. In
case when all subclasses are declared in the same file there is no need to mention the explicitly and <code>permits</code> part of a declaration can
be omitted.</p>
<p>This rule reports an issue if all subclasses of a <code>sealed</code> class are declared in the same file as their superclass.</p>
<h3>Noncompliant code example</h3>
<pre>
sealed class A permits B, C, D, E {} // Noncompliant
final class B extends A {}
final class C extends A {}
final class D extends A {}
final class E extends A {}
</pre>
<h3>Compliant solution</h3>
<pre>
sealed class A {} // Compliant
final class B extends A {}
final class C extends A {}
final class D extends A {}
final class E extends A {}
</pre></p>
            </div>
        <div class="rule">
            <h3>'serialVersionUID' field should not be set to '0L' in records (java:S6219)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-8.html#jls-8.10">Records specification</a> </li>
  <li> <a href="https://docs.oracle.com/en/java/javase/16/docs/specs/serialization/serial-arch.html#serialization-of-records">Serialization of
  records</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Records serialization is not done the same way as for ordinary serializable or externalizable classes. Records serialization does not rely on
the <code>serialVersionUID</code> field, because the requirement to have this field equal is waived for record classes. By default, all records will
have this field equal to <code>0L</code> and there is no need to specify this field with <code>0L</code> value and it is possible to specify it with
some custom value to support serialization/deserialization involving ordinary classes.</p>
<p>This rule raises an issue when there is a <code>private static final long serialVersionUID</code> field which is set to <code>0L</code> in a Record
class.</p>
<h3>Noncompliant code example</h3>
<pre>
record Person(String name, int age) implements Serializable {
@Serial
  private static final long serialVersionUID = 0L; // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
record Person(String name, int age) implements Serializable {} // Compliant

record Person(String name, int age) implements Serializable {
@Serial
  private static final long serialVersionUID = 42L; // Compliant
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Equality operators should not be used in "for" loop termination conditions (java:S888)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/835">CWE-835 - Loop with Unreachable Exit Condition ('Infinite Loop')</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/x9YxBQ">CERT, MSC21-C.</a> - Use robust loop termination conditions </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Testing <code>for</code> loop termination using an equality operator (<code>==</code> and <code>!=</code>) is dangerous, because it could set up an
infinite loop. Using a broader relational operator instead casts a wider net, and makes it harder (but not impossible) to accidentally write an
infinite loop.</p>
<h3>Noncompliant code example</h3>
<pre>
for (int i = 1; i != 10; i += 2)  // Noncompliant. Infinite; i goes from 9 straight to 11.
{
  //...
}
</pre>
<h3>Compliant solution</h3>
<pre>
for (int i = 1; i &lt;= 10; i += 2)  // Compliant
{
  //...
}
</pre>
<h3>Exceptions</h3>
<p>Equality operators are ignored if the loop counter is not modified within the body of the loop and either:</p>
<ul>
  <li> starts below the ending value and is incremented by 1 on each iteration. </li>
  <li> starts above the ending value and is decremented by 1 on each iteration. </li>
</ul>
<p>Equality operators are also ignored when the test is against <code>null</code>.</p>
<pre>
for (int i = 0; arr[i] != null; i++) {
  // ...
}

for (int i = 0; (item = arr[i]) != null; i++) {
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"main" should not "throw" anything (java:S2096)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There’s no reason for a <code>main</code> method to <code>throw</code> anything. After all, what’s going to catch it?</p>
<p>Instead, the method should itself gracefully handle any exceptions that may bubble up to it, attach as much contextual information as possible, and
perform whatever logging or user communication is necessary, and <code>exit</code> with a non-zero (i.e. non-success) exit code if necessary.</p>
<h3>Noncompliant code example</h3>
<pre>
public static void main(String args[]) throws Exception { // Noncompliant
  doSomething();
}
</pre>
<h3>Compliant solution</h3>
<pre>
public static void main(String args[]) {
 try {
    doSomething();
  } catch (Throwable t) {
    log.error(t);
    System.exit(1);  // Default exit code, 0, indicates success. Non-zero value means failure.
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Assignment of lazy-initialized members should be the last step with double-checked locking (java:S3064)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/6zdGBQ">CERT, LCK10-J.</a> - Use a correct form of the double-checked locking idiom </li>
</ul>
<h3>Related rules</h3>
<ul>
  <li> <a href='/coding_rules#rule_key=java%3AS2168'>S2168</a> - Double-checked locking should not be used </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Double-checked locking can be used for lazy initialization of <code>volatile</code> fields, but only if field assignment is the last step in the
<code>synchronized</code> block. Otherwise you run the risk of threads accessing a half-initialized object.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {

  private volatile List&lt;String&gt; strings;

  public List&lt;String&gt; getStrings() {
    if (strings == null) {  // check#1
      synchronized(MyClass.class) {
        if (strings == null) {
          strings = new ArrayList&lt;&gt;();  // Noncompliant
          strings.add("Hello");  //When threadA gets here, threadB can skip the synchronized block because check#1 is false
          strings.add("World");
        }
      }
    }
    return strings;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyClass {

  private volatile List&lt;String&gt; strings;

  public List&lt;String&gt; getStrings() {
    if (strings == null) {  // check#1
      synchronized(MyClass.class) {
        if (strings == null) {
          List&lt;String&gt; tmpList = new ArrayList&lt;&gt;();
          tmpList.add("Hello");
          tmpList.add("World");
          strings = tmpList;
        }
      }
    }
    return strings;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>"enum" fields should not be publicly mutable (java:S3066)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>enum</code>s are generally thought of as constant, but an <code>enum</code> with a <code>public</code> field or <code>public</code> setter is
non-constant. Ideally fields in an <code>enum</code> are <code>private</code> and set in the constructor, but if that’s not possible, their visibility
should be reduced as much as possible.</p>
<h3>Noncompliant code example</h3>
<pre>
public enum Continent {

  NORTH_AMERICA (23, 24709000),
  // ...
  EUROPE (50, 39310000);

  public int countryCount;  // Noncompliant
  private int landMass;

  Continent(int countryCount, int landMass) {
    // ...
  }

  public void setLandMass(int landMass) {  // Noncompliant
    this.landMass = landMass;
  }
</pre>
<h3>Compliant solution</h3>
<pre>
public enum Continent {

  NORTH_AMERICA (23, 24709000),
  // ...
  EUROPE (50, 39310000);

  private int countryCount;
  private int landMass;

  Continent(int countryCount, int landMass) {
    // ...
  }
</pre></p>
            </div>
        <div class="rule">
            <h3>"getClass" should not be used for synchronization (java:S3067)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p><code>getClass</code> should not be used for synchronization in non-<code>final</code> classes because child classes will synchronize on a
different object than the parent or each other, allowing multiple threads into the code block at once, despite the <code>synchronized</code>
keyword.</p>
<p>Instead, hard code the name of the class on which to synchronize or make the class <code>final</code>.</p>
<h3>Noncompliant code example</h3>
<pre>
public class MyClass {
  public void doSomethingSynchronized(){
    synchronized (this.getClass()) {  // Noncompliant
      // ...
    }
  }
</pre>
<h3>Compliant solution</h3>
<pre>
public class MyClass {
  public void doSomethingSynchronized(){
    synchronized (MyClass.class) {
      // ...
    }
  }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/qTdGBQ">CERT, LCK02-J.</a> - Do not synchronize on the class object returned by getClass() </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Packages containing only "package-info.java" should be removed (java:S4032)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There is no reason to have a package that is empty except for "package-info.java". Such packages merely clutter a project, taking up space but
adding no value.</p></p>
            </div>
        <div class="rule">
            <h3>"Stream" call chains should be simplified when possible (java:S4034)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When using the <code>Stream</code> API, call chains should be simplified as much as possible. Not only does it make the code easier to read, it
also avoid creating unnecessary temporary objects.</p>
<p>This rule raises an issue when one of the following substitution is possible:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Original</th>
      <th>Preferred</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><code>stream.filter(predicate).findFirst().isPresent()</code></p></td>
      <td><p><code>stream.anyMatch(predicate)</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.filter(predicate).findAny().isPresent()</code></p></td>
      <td><p><code>stream.anyMatch(predicate)</code></p></td>
    </tr>
    <tr>
      <td><p><code>!stream.anyMatch(predicate)</code></p></td>
      <td><p><code>stream.noneMatch(predicate)</code></p></td>
    </tr>
    <tr>
      <td><p><code>!stream.anyMatch(x -&gt; !(...))</code></p></td>
      <td><p><code>stream.allMatch(...)</code></p></td>
    </tr>
    <tr>
      <td><p><code>stream.map(mapper).anyMatch(Boolean::booleanValue)</code></p></td>
      <td><p><code>stream.anyMatch(predicate)</code></p></td>
    </tr>
  </tbody>
</table>
<h3>Noncompliant code example</h3>
<pre>
boolean hasRed = widgets.stream().filter(w -&gt; w.getColor() == RED).findFirst().isPresent(); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
boolean hasRed = widgets.stream().anyMatch(w -&gt; w.getColor() == RED);
</pre></p>
            </div>
        <div class="rule">
            <h3>Searching OS commands in PATH is security-sensitive (java:S4036)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Compliant Solution</h2>
<p>The command is defined by its full path:</p>
<pre>
Runtime.getRuntime().exec("/usr/bin/make");  // Compliant
Runtime.getRuntime().exec(new String[]{"~/bin/make"});  // Compliant

ProcessBuilder builder = new ProcessBuilder("./bin/make");  // Compliant
builder.command("../bin/make");  // Compliant
builder.command(Arrays.asList("..\bin\make", "-j8")); // Compliant

builder = new ProcessBuilder(Arrays.asList(".\make"));  // Compliant
builder.command(Arrays.asList("C:\bin\make", "-j8"));  // Compliant
builder.command(Arrays.asList("\\SERVER\bin\make"));  // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a> </li>
</ul></p>
            
            <p class="section-title">Default:</p>
            <p><p>When executing an OS command and unless you specify the full path to the executable, then the locations in your application’s <code>PATH</code>
environment variable will be searched for the executable. That search could leave an opening for an attacker if one of the elements in
<code>PATH</code> is a directory under his control.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> The directories in the PATH environment variable may be defined by not trusted entities. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Fully qualified/absolute path should be used to specify the OS command to execute.</p>
<h2>Sensitive Code Example</h2>
<p>The full path of the command is not specified and thus the executable will be searched in all directories listed in the <code>PATH</code>
environment variable:</p>
<pre>
Runtime.getRuntime().exec("make");  // Sensitive
Runtime.getRuntime().exec(new String[]{"make"});  // Sensitive

ProcessBuilder builder = new ProcessBuilder("make");  // Sensitive
builder.command("make");  // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>The command is defined by its full path:</p>
<pre>
Runtime.getRuntime().exec("/usr/bin/make");  // Compliant
Runtime.getRuntime().exec(new String[]{"~/bin/make"});  // Compliant

ProcessBuilder builder = new ProcessBuilder("./bin/make");  // Compliant
builder.command("../bin/make");  // Compliant
builder.command(Arrays.asList("..\bin\make", "-j8")); // Compliant

builder = new ProcessBuilder(Arrays.asList(".\make"));  // Compliant
builder.command(Arrays.asList("C:\bin\make", "-j8"));  // Compliant
builder.command(Arrays.asList("\\SERVER\bin\make"));  // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">Top 10 2021 Category A8 - Software and Data Integrity
  Failures</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A1_2017-Injection">Top 10 2017 Category A1 - Injection</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/426">CWE-426 - Untrusted Search Path</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/427">CWE-427 - Uncontrolled Search Path Element</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> The directories in the PATH environment variable may be defined by not trusted entities. </li>
</ul>
<p>There is a risk if you answered yes to this question.</p>
<h2>Sensitive Code Example</h2>
<p>The full path of the command is not specified and thus the executable will be searched in all directories listed in the <code>PATH</code>
environment variable:</p>
<pre>
Runtime.getRuntime().exec("make");  // Sensitive
Runtime.getRuntime().exec(new String[]{"make"});  // Sensitive

ProcessBuilder builder = new ProcessBuilder("make");  // Sensitive
builder.command("make");  // Sensitive
</pre>
</p>
            </div>
        <div class="rule">
            <h3>Functional Interfaces should be as specialised as possible (java:S4276)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>java.util.function</code> package provides a large array of functional interface definitions for use in lambda expressions and method
references. In general it is recommended to use the more specialised form to avoid auto-boxing. For instance <code>IntFunction&lt;Foo&gt;</code>
should be preferred over <code>Function&lt;Integer, Foo&gt;</code>.</p>
<p>This rule raises an issue when any of the following substitution is possible:</p>
<table>
  <colgroup>
    <col style="width: 50%;">
    <col style="width: 50%;">
  </colgroup>
  <thead>
    <tr>
      <th>Current Interface</th>
      <th>Preferred Interface</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><p><code>Function&lt;Integer, R&gt;</code></p></td>
      <td><p><code>IntFunction&lt;R&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;Long, R&gt;</code></p></td>
      <td><p><code>LongFunction&lt;R&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;Double, R&gt;</code></p></td>
      <td><p><code>DoubleFunction&lt;R&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;Double,Integer&gt;</code></p></td>
      <td><p><code>DoubleToIntFunction</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;Double,Long&gt;</code></p></td>
      <td><p><code>DoubleToLongFunction</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;Long,Double&gt;</code></p></td>
      <td><p><code>LongToDoubleFunction</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;Long,Integer&gt;</code></p></td>
      <td><p><code>LongToIntFunction</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;R,Integer&gt;</code></p></td>
      <td><p><code>ToIntFunction&lt;R&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;R,Long&gt;</code></p></td>
      <td><p><code>ToLongFunction&lt;R&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;R,Double&gt;</code></p></td>
      <td><p><code>ToDoubleFunction&lt;R&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;T,T&gt;</code></p></td>
      <td><p><code>UnaryOperator&lt;T&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>BiFunction&lt;T,T,T&gt;</code></p></td>
      <td><p><code>BinaryOperator&lt;T&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Consumer&lt;Integer&gt;</code></p></td>
      <td><p><code>IntConsumer</code></p></td>
    </tr>
    <tr>
      <td><p><code>Consumer&lt;Double&gt;</code></p></td>
      <td><p><code>DoubleConsumer</code></p></td>
    </tr>
    <tr>
      <td><p><code>Consumer&lt;Long&gt;</code></p></td>
      <td><p><code>LongConsumer</code></p></td>
    </tr>
    <tr>
      <td><p><code>BiConsumer&lt;T,Integer&gt;</code></p></td>
      <td><p><code>ObjIntConsumer&lt;T&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>BiConsumer&lt;T,Long&gt;</code></p></td>
      <td><p><code>ObjLongConsumer&lt;T&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>BiConsumer&lt;T,Double&gt;</code></p></td>
      <td><p><code>ObjDoubleConsumer&lt;T&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>Predicate&lt;Integer&gt;</code></p></td>
      <td><p><code>IntPredicate</code></p></td>
    </tr>
    <tr>
      <td><p><code>Predicate&lt;Double&gt;</code></p></td>
      <td><p><code>DoublePredicate</code></p></td>
    </tr>
    <tr>
      <td><p><code>Predicate&lt;Long&gt;</code></p></td>
      <td><p><code>LongPredicate</code></p></td>
    </tr>
    <tr>
      <td><p><code>Supplier&lt;Integer&gt;</code></p></td>
      <td><p><code>IntSupplier</code></p></td>
    </tr>
    <tr>
      <td><p><code>Supplier&lt;Double&gt;</code></p></td>
      <td><p><code>DoubleSupplier</code></p></td>
    </tr>
    <tr>
      <td><p><code>Supplier&lt;Long&gt;</code></p></td>
      <td><p><code>LongSupplier</code></p></td>
    </tr>
    <tr>
      <td><p><code>Supplier&lt;Boolean&gt;</code></p></td>
      <td><p><code>BooleanSupplier</code></p></td>
    </tr>
    <tr>
      <td><p><code>UnaryOperator&lt;Integer&gt;</code></p></td>
      <td><p><code>IntUnaryOperator</code></p></td>
    </tr>
    <tr>
      <td><p><code>UnaryOperator&lt;Double&gt;</code></p></td>
      <td><p><code>DoubleUnaryOperator</code></p></td>
    </tr>
    <tr>
      <td><p><code>UnaryOperator&lt;Long&gt;</code></p></td>
      <td><p><code>LongUnaryOperator</code></p></td>
    </tr>
    <tr>
      <td><p><code>BinaryOperator&lt;Integer&gt;</code></p></td>
      <td><p><code>IntBinaryOperator</code></p></td>
    </tr>
    <tr>
      <td><p><code>BinaryOperator&lt;Long&gt;</code></p></td>
      <td><p><code>LongBinaryOperator</code></p></td>
    </tr>
    <tr>
      <td><p><code>BinaryOperator&lt;Double&gt;</code></p></td>
      <td><p><code>DoubleBinaryOperator</code></p></td>
    </tr>
    <tr>
      <td><p><code>Function&lt;T, Boolean&gt;</code></p></td>
      <td><p><code>Predicate&lt;T&gt;</code></p></td>
    </tr>
    <tr>
      <td><p><code>BiFunction&lt;T,U,Boolean&gt;</code></p></td>
      <td><p><code>BiPredicate&lt;T,U&gt;</code></p></td>
    </tr>
  </tbody>
</table>
<h3>Noncompliant code example</h3>
<pre>
public class Foo implements Supplier&lt;Integer&gt; {  // Noncompliant
    @Override
    public Integer get() {
      // ...
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
public class Foo implements IntSupplier {

  @Override
  public int getAsInt() {
    // ...
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Disabling auto-escaping in template engines is security-sensitive (java:S5247)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> Templates are used to render web content and
    <ul>
      <li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li>
      <li> there is no local mechanism in place to sanitize or validate the inputs. </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://github.com/samskivert/jmustache">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().escapeHTML(false).compile(template).execute(context); // Sensitive
Mustache.compiler().withEscaper(Escapers.NONE).compile(template).execute(context); // Sensitive
</pre>
<p>With <a href="https://freemarker.apache.org/">Freemarker</a>:</p>
<pre>
freemarker.template.Configuration configuration = new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(DISABLE_AUTO_ESCAPING_POLICY); // Sensitive
</pre>
</p>
            
            <p class="section-title">Default:</p>
            <p><p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a
href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> Templates are used to render web content and
    <ul>
      <li> dynamic variables in templates come from untrusted locations or are user-controlled inputs </li>
      <li> there is no local mechanism in place to sanitize or validate the inputs. </li>
    </ul>  </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Sensitive Code Example</h2>
<p>With <a href="https://github.com/samskivert/jmustache">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().escapeHTML(false).compile(template).execute(context); // Sensitive
Mustache.compiler().withEscaper(Escapers.NONE).compile(template).execute(context); // Sensitive
</pre>
<p>With <a href="https://freemarker.apache.org/">Freemarker</a>:</p>
<pre>
freemarker.template.Configuration configuration = new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(DISABLE_AUTO_ESCAPING_POLICY); // Sensitive
</pre>
<h2>Compliant Solution</h2>
<p>With <a href="https://github.com/samskivert/jmustache">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().compile(template).execute(context); // Compliant, auto-escaping is enabled by default
Mustache.compiler().escapeHTML(true).compile(template).execute(context); // Compliant
</pre>
<p>With <a href="https://freemarker.apache.org/">Freemarker</a>. See <a
href="https://freemarker.apache.org/docs/api/freemarker/template/Configuration.html#setAutoEscapingPolicy-int-">"setAutoEscapingPolicy"
documentation</a> for more details.</p>
<pre>
freemarker.template.Configuration configuration = new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(ENABLE_IF_DEFAULT_AUTO_ESCAPING_POLICY); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>To reduce the risk of cross-site scripting attacks, templating systems, such as <code>Twig</code>, <code>Django</code>, <code>Smarty</code>,
<code>Groovy's template engine</code>, allow configuration of automatic variable escaping before rendering templates. When escape occurs, characters
that make sense to the browser (eg: &lt;a&gt;) will be transformed/replaced with escaped/sanitized values (eg: &amp; lt;a&amp; gt; ).</p>
<p>Auto-escaping is not a magic feature to annihilate all cross-site scripting attacks, it depends on <a
href="https://twig.symfony.com/doc/3.x/filters/escape.html">the strategy applied</a> and the context, for example a "html auto-escaping" strategy
(which only transforms html characters into <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity">html entities</a>) will not be relevant
when variables are used in a <a href="https://en.wikipedia.org/wiki/HTML_attribute">html attribute</a> because '<code>:</code>' character is not
escaped and thus an attack as below is possible:</p>
<pre>
&lt;a href="{{ myLink }}"&gt;link&lt;/a&gt; // myLink = javascript:alert(document.cookie)
&lt;a href="javascript:alert(document.cookie)"&gt;link&lt;/a&gt; // JS injection (XSS attack)
</pre>
</p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<p>Enable auto-escaping by default and continue to review the use of inputs in order to be sure that the chosen auto-escaping strategy is the right
one.</p>
<h2>Compliant Solution</h2>
<p>With <a href="https://github.com/samskivert/jmustache">JMustache by samskivert</a>:</p>
<pre>
Mustache.compiler().compile(template).execute(context); // Compliant, auto-escaping is enabled by default
Mustache.compiler().escapeHTML(true).compile(template).execute(context); // Compliant
</pre>
<p>With <a href="https://freemarker.apache.org/">Freemarker</a>. See <a
href="https://freemarker.apache.org/docs/api/freemarker/template/Configuration.html#setAutoEscapingPolicy-int-">"setAutoEscapingPolicy"
documentation</a> for more details.</p>
<pre>
freemarker.template.Configuration configuration = new freemarker.template.Configuration();
configuration.setAutoEscapingPolicy(ENABLE_IF_DEFAULT_AUTO_ESCAPING_POLICY); // Compliant
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A03_2021-Injection/">Top 10 2021 Category A3 - Injection</a> </li>
  <li> <a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.md">OWASP Cheat
  Sheet</a> - XSS Prevention Cheat Sheet </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A7_2017-Cross-Site_Scripting_(XSS)">Top 10 2017 Category A7 - Cross-Site Scripting
  (XSS)</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/79">CWE-79 - Improper Neutralization of Input During Web Page Generation ('Cross-site
  Scripting')</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Local-Variable Type Inference should be used (java:S6212)</h3>
            <p class="severity">Severidad: INFO</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://openjdk.java.net/jeps/286">JEP 286: Local-Variable Type Inference</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In Java 10 <a href="https://openjdk.java.net/jeps/286">Local-Variable Type Inference</a> was introduced. It allows you to omit the expected type of
a variable by declaring it with the <code>var</code> keyword.</p>
<p>While it is not always possible or cleaner to use this new way of declaring a variable, when the type on the left is the same as the one on the
right in an assignment, using the <code>var</code> will result in a more concise code.</p>
<p>This rule reports an issue when the expected type of the variable is the same as the returned type of assigned expression and the type can be
easily inferred by the reader, either when the type is already mentioned in the name or the initializer, or when the expression is
self-explanatory.</p>
<h3>Noncompliant code example</h3>
<pre>
MyClass myClass = new MyClass();

int i = 10; // Type is self-explanatory

MyClass something = MyClass.getMyClass(); // Type is already mentioned in the initializer

MyClass myClass = get(); // Type is already mentioned in the name
</pre>
<h3>Compliant solution</h3>
<pre>
var myClass = new MyClass();

var i = 10;

var something = MyClass.getMyClass();

var myClass = get();
</pre></p>
            </div>
        <div class="rule">
            <h3>Restricted Identifiers should not be used as Identifiers (java:S6213)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-3.html#jls-3.8">JLS16, 3.8: Identifiers</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Even if it is technically possible, <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-3.html#jls-3.8">Restricted Identifiers</a>
should not be used as identifiers. This is only possible for compatibility reasons, using it in Java code is confusing and should be avoided.</p>
<p>Note that this applies to any version of Java, including the one where these identifiers are not yet restricted, to avoid future confusion.</p>
<p>This rule reports an issue when restricted identifiers:</p>
<ul>
  <li> var </li>
  <li> yield </li>
  <li> record </li>
</ul>
<p>are used as identifiers.</p>
<h3>Noncompliant code example</h3>
<pre>
var var = "var"; // Noncompliant: compiles but this code is confusing
var = "what is this?";

int yield(int i) { // Noncompliant
  return switch (i) {
    case 1: yield(0); // This is a yield from switch expression, not a recursive call.
    default: yield(i-1);
  };
}

String record = "record"; // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
var myVariable = "var";

int minusOne(int i) {
  return switch (i) {
    case 1: yield(0);
    default: yield(i-1);
  };
}

String myRecord = "record";
</pre></p>
            </div>
        <div class="rule">
            <h3>Equals method should be overridden in records containing array fields (java:S6218)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-8.html#jls-8.10">Records specification</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>In records, the default behavior of the <code>equals()</code> method is to check the equality by field values. This works well for primitive fields
or fields, whose type overrides <code>equals()</code>, but this behavior doesn’t work as expected for array fields.</p>
<p>By default, array fields are compared by their reference, and overriding <code>equals()</code> is highly appreciated to achieve the deep equality
check. The same strategy applies to <code>hashCode()</code> and <code>toString()</code> methods.</p>
<p>This rule reports an issue if a record class has an array field and is not overriding <code>equals()</code>, <code>hashCode()</code> or
<code>toString()</code> methods.</p>
<h3>Noncompliant code example</h3>
<pre>
record Person(String[] names, int age) {} // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
record Person(String[] names, int age) {
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Person person = (Person) o;
        return age == person.age &amp;&amp; Arrays.equals(names, person.names);
    }

    @Override
    public int hashCode() {
        int result = Objects.hash(age);
        result = 31 * result + Arrays.hashCode(names);
        return result;
    }

    @Override
    public String toString() {
        return "Person{" +
                "names=" + Arrays.toString(names) +
                ", age=" + age +
                '}';
    }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Creating cookies without the "secure" flag is security-sensitive (java:S2092)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Default:</p>
            <p><p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setSecure(false);  // Sensitive: a security-ensitive cookie is created with the secure flag set to false
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setSecure(boolean)"><code>secure</code></a> flag is set
to <em>false:</em></p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);  // Sensitive: a security-sensitive cookie is created with the secure flag not defined (by default set to false)
</pre>
<h2>Compliant Solution</h2>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setSecure(true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag set to true
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222576">Application Security and
  Development: V-222576</a> - The application must set the secure flag on session cookies. </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> It is recommended to use <code>HTTPs</code> everywhere so setting the <code>secure</code> flag to <em>true</em> should be the default behaviour
  when creating cookies. </li>
  <li> Set the <code>secure</code> flag to <em>true</em> for session-cookies. </li>
</ul>
<h2>Compliant Solution</h2>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setSecure(true); // Compliant: the sensitive cookie will not be send during an unencrypted HTTP request thanks to the secure flag set to true
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">Top 10 2021 Category A4 - Insecure Design</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure">Top 10 2017 Category A3 - Sensitive Data
  Exposure</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/311">CWE-311 - Missing Encryption of Sensitive Data</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/315">CWE-315 - Cleartext Storage of Sensitive Information in a Cookie</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/614">CWE-614 - Sensitive Cookie in HTTPS Session Without 'Secure' Attribute</a> </li>
  <li> STIG Viewer - <a href="https://stigviewer.com/stig/application_security_and_development/2023-06-08/finding/V-222576">Application Security and
  Development: V-222576</a> - The application must set the secure flag on session cookies. </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When a cookie is protected with the <code>secure</code> attribute set to <em>true</em> it will not be send by the browser over an unencrypted HTTP
request and thus cannot be observed by an unauthorized person during a man-in-the-middle attack.</p>
</p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> the cookie is for instance a <em>session-cookie</em> not designed to be sent over non-HTTPS communication. </li>
  <li> it’s not sure that the website contains <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content">mixed content</a> or not
  (ie HTTPS everywhere or not) </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>If you create a security-sensitive cookie in your JAVA code:</p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);
c.setSecure(false);  // Sensitive: a security-ensitive cookie is created with the secure flag set to false
</pre>
<p>By default the <a href="https://docs.oracle.com/javaee/6/api/javax/servlet/http/Cookie.html#setSecure(boolean)"><code>secure</code></a> flag is set
to <em>false:</em></p>
<pre>
Cookie c = new Cookie(COOKIENAME, sensitivedata);  // Sensitive: a security-sensitive cookie is created with the secure flag not defined (by default set to false)
</pre>
</p>
            </div>
        <div class="rule">
            <h3>Classes should not be empty (java:S2094)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There is no good excuse for an empty class. If it’s being used simply as a common extension point, it should be replaced with an
<code>interface</code>. If it was stubbed in as a placeholder for future development it should be fleshed-out. In any other case, it should be
eliminated.</p>
<h3>Noncompliant code example</h3>
<pre>
public class Nothing {  // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
public interface Nothing {
}
</pre>
<h3>Exceptions</h3>
<p>Empty classes can be used as marker types (for Spring for instance), therefore empty classes that are annotated will be ignored.</p>
<pre>
@Configuration
@EnableWebMvc
public final class ApplicationConfiguration {

}
</pre></p>
            </div>
        <div class="rule">
            <h3>Resources should be closed (java:S2095)</h3>
            <p class="severity">Severidad: BLOCKER</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Connections, streams, files, and other classes that implement the <code>Closeable</code> interface or its super-interface,
<code>AutoCloseable</code>, needs to be closed after use. Further, that <code>close</code> call must be made in a <code>finally</code> block otherwise
an exception could keep the call from being made. Preferably, when class implements <code>AutoCloseable</code>, resource should be created using
"try-with-resources" pattern and will be closed automatically.</p>
<p>Failure to properly close resources will result in a resource leak which could bring first the application and then perhaps the box the application
is on to their knees.</p>
<h3>Noncompliant code example</h3>
<pre>
private void readTheFile() throws IOException {
  Path path = Paths.get(this.fileName);
  BufferedReader reader = Files.newBufferedReader(path, this.charset);
  // ...
  reader.close();  // Noncompliant
  // ...
  Files.lines("input.txt").forEach(System.out::println); // Noncompliant: The stream needs to be closed
}

private void doSomething() {
  OutputStream stream = null;
  try {
    for (String property : propertyList) {
      stream = new FileOutputStream("myfile.txt");  // Noncompliant
      // ...
    }
  } catch (Exception e) {
    // ...
  } finally {
    stream.close();  // Multiple streams were opened. Only the last is closed.
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
private void readTheFile(String fileName) throws IOException {
    Path path = Paths.get(fileName);
    try (BufferedReader reader = Files.newBufferedReader(path, StandardCharsets.UTF_8)) {
      reader.readLine();
      // ...
    }
    // ..
    try (Stream&lt;String&gt; input = Files.lines("input.txt"))  {
      input.forEach(System.out::println);
    }
}

private void doSomething() {
  OutputStream stream = null;
  try {
    stream = new FileOutputStream("myfile.txt");
    for (String property : propertyList) {
      // ...
    }
  } catch (Exception e) {
    // ...
  } finally {
    stream.close();
  }
}
</pre>
<h3>Exceptions</h3>
<p>Instances of the following classes are ignored by this rule because <code>close</code> has no effect:</p>
<ul>
  <li> <code>java.io.ByteArrayOutputStream</code> </li>
  <li> <code>java.io.ByteArrayInputStream</code> </li>
  <li> <code>java.io.CharArrayReader</code> </li>
  <li> <code>java.io.CharArrayWriter</code> </li>
  <li> <code>java.io.StringReader</code> </li>
  <li> <code>java.io.StringWriter</code> </li>
</ul>
<p>Java 7 introduced the try-with-resources statement, which implicitly closes <code>Closeables</code>. All resources opened in a try-with-resources
statement are ignored by this rule.</p>
<pre>
try (BufferedReader br = new BufferedReader(new FileReader(fileName))) {
  //...
}
catch ( ... ) {
  //...
}
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/459">CWE-459 - Incomplete Cleanup</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/772">CWE-772 - Missing Release of Resource after Effective Lifetime</a> </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/vjdGBQ">CERT, FIO04-J.</a> - Release resources when they are no longer needed </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/QtUxBQ">CERT, FIO42-C.</a> - Close files when they are no longer needed </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">Try With Resources</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>"equals(Object obj)" should test the argument's type (java:S2097)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><h3>Documentation</h3>
<ul>
  <li> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)">Oracle SDK -
  java.lang.Object#equals(Object obj)</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>The <code>Object#equals(Object obj)</code> method is used to compare two objects to see if they are equal.</p>
<p>The <code>obj</code> parameter’s type is <code>Object</code>, this means that an object of any type can be passed as a parameter to this
method.</p>
<p>Any class overriding <code>Object#equals(Object obj)</code> should respect this contract, accept any object as an argument, and return
<code>false</code> when the argument’s type differs from the expected type. The <code>obj</code> parameter’s type can be checked using
<code>instanceof</code> or by comparing the <code>getClass()</code> value:</p>
<pre>
@Override
public boolean equals(Object obj) {
  // ...
  if (this.getClass() != obj.getClass()) {
    return false;
  }
  // ...
}
</pre>
<p>However, it is an issue to assume that the <code>equals</code> method will only be used to compare objects of the same type. Casting the
<code>obj</code> parameter without a prior test will throw a <code>ClassCastException</code> instead of returning false.</p>
<pre>
public class MyClass {
  @Override
  public boolean equals(Object obj) {
    MyClass that = (MyClass) obj; // may throw a ClassCastException
    // ...
  }
  // ...
}
</pre>
<p>This rule raises an issue when <code>obj</code> parameter’s type has not been tested before a cast operation.</p></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Ensure the <code>obj</code> parameter’s type is checked by comparing <code>this.getClass()</code> and <code>obj.getClass()</code>, or use the
<code>instanceof</code> operator to test `obj’s type.</p>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
public class MyClass {
  @Override
  public boolean equals(Object obj) {
    if (this == obj) {
      return true;
    }
    if (obj == null) {
      return false;
    }
    MyClass that = (MyClass) obj; // Noncompliant, may throw a ClassCastException
    // ...
  }
  // ...
}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
public class MyClass {
  @Override
  public boolean equals(Object obj) {
    if (this == obj) {
      return true;
    }
    if (obj == null || this.getClass() != obj.getClass()) {
      return false;
    }
    MyClass that = (MyClass) obj; // Compliant, obj's type is MyClass
    // ...
  }
  // ...
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Min and max used in combination should not always return the same value (java:S3065)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>When using <code>Math.min()</code> and <code>Math.max()</code> together for bounds checking, it’s important to feed the right operands to each
method. <code>Math.min()</code> should be used with the <strong>upper</strong> end of the range being checked, and <code>Math.max()</code> should be
used with the <strong>lower</strong> end of the range. Get it backwards, and the result will always be the same end of the range.</p>
<h3>Noncompliant code example</h3>
<pre>
  private static final int UPPER = 20;
  private static final int LOWER = 0;

  public int doRangeCheck(int num) {    // Let's say num = 12
    int result = Math.min(LOWER, num);  // result = 0
    return Math.max(UPPER, result);     // Noncompliant; result is now 20: even though 12 was in the range
  }
</pre>
<h3>Compliant solution</h3>
<p>Swapping method <code>min()</code> and <code>max()</code> invocations without changing parameters.</p>
<pre>
  private static final int UPPER = 20;
  private static final int LOWER = 0;

  public int doRangeCheck(int num) {    // Let's say num = 12
    int result = Math.max(LOWER, num);  // result = 12
    return Math.min(UPPER, result);     // Compliant; result is still 12
  }
</pre>
<p>or swapping bounds <code>UPPER</code> and <code>LOWER</code> used as parameters without changing the invoked methods.</p>
<pre>
  private static final int UPPER = 20;
  private static final int LOWER = 0;

  public int doRangeCheck(int num) {    // Let's say num = 12
    int result = Math.min(UPPER, num);  // result = 12
    return Math.max(LOWER, result);     // Compliant; result is still 12
  }
</pre></p>
            </div>
        <div class="rule">
            <h3>Asserts should not be used to check the parameters of a public method (java:S4274)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>An <code>assert</code> is inappropriate for parameter validation because assertions can be disabled at runtime in the JVM, meaning that a bad
operational setting would completely eliminate the intended checks. Further, <code>assert</code>s that fail throw <code>AssertionError</code>s, rather
than throwing some type of <code>Exception</code>. Throwing <code>Error</code>s is completely outside of the normal realm of expected
<code>catch</code>/<code>throw</code> behavior in normal programs.</p>
<p>This rule raises an issue when a <code>public</code> method uses one or more of its parameters with <code>assert</code>s.</p>
<h3>Noncompliant code example</h3>
<pre>
 public void setPrice(int price) {
  assert price &gt;= 0 &amp;&amp; price &lt;= MAX_PRICE;
  // Set the price
 }
</pre>
<h3>Compliant solution</h3>
<pre>
 public void setPrice(int price) {
  if (price &lt; 0 || price &gt; MAX_PRICE) {
    throw new IllegalArgumentException("Invalid price: " + price);
  }
  // Set the price
 }
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><p><a href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/assert.html">Programming With Assertions</a></p></p>
            </div>
        <div class="rule">
            <h3>Getters and setters should access the expected fields (java:S4275)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Getters and setters provide a way to enforce encapsulation by providing <code>public</code> methods that give controlled access to
<code>private</code> fields. However, in classes with multiple fields, it is not unusual that copy and paste is used to quickly create the needed
getters and setters, which can result in the wrong field being accessed by a getter or setter.</p>
<p>This rule raises an issue in any of these cases:</p>
<ul>
  <li> A setter does not update the field with the corresponding name. </li>
  <li> A getter does not access the field with the corresponding name. </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
class A {
  private int x;
  private int y;

  public void setX(int val) { // Noncompliant: field 'x' is not updated
    this.y = val;
  }

  public int getY() { // Noncompliant: field 'y' is not used in the return value
    return this.x;
  }
}
</pre>
<h3>Compliant solution</h3>
<pre>
class A {
  private int x;
  private int y;

  public void setX(int val) {
    this.x = val;
  }

  public int getY() {
    return this.y;
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive (java:S5122)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Default:</p>
            <p><p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
<h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Sensitive Code Example</h2>
<p>Java servlet framework:</p>
<pre>
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader("Content-Type", "text/plain; charset=utf-8");
    resp.setHeader("Access-Control-Allow-Origin", "*"); // Sensitive
    resp.setHeader("Access-Control-Allow-Credentials", "true");
    resp.setHeader("Access-Control-Allow-Methods", "GET");
    resp.getWriter().write("response");
}
</pre>
<p>Spring MVC framework:</p>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html">CrossOrigin</a>
  </li>
</ul>
<pre>
@CrossOrigin // Sensitive
@RequestMapping("")
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute("message", "ok ");
        return "view";
    }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html">cors.CorsConfiguration</a> </li>
</ul>
<pre>
CorsConfiguration config = new CorsConfiguration();
config.addAllowedOrigin("*"); // Sensitive
config.applyPermitDefaultValues(); // Sensitive
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html">servlet.config.annotation.CorsConfiguration</a> </li>
</ul>
<pre>
class Insecure implements WebMvcConfigurer {
  @Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
      .allowedOrigins("*"); // Sensitive
  }
}
</pre>
<p>User-controlled origin:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(@RequestHeader("Origin") String origin) {
  HttpHeaders responseHeaders = new HttpHeaders();
  responseHeaders.add("Access-Control-Allow-Origin", origin); // Sensitive

  return new ResponseEntity&lt;&gt;("content", responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>Compliant Solution</h2>
<p>Java Servlet framework:</p>
<pre>
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader("Content-Type", "text/plain; charset=utf-8");
    resp.setHeader("Access-Control-Allow-Origin", "trustedwebsite.com"); // Compliant
    resp.setHeader("Access-Control-Allow-Credentials", "true");
    resp.setHeader("Access-Control-Allow-Methods", "GET");
    resp.getWriter().write("response");
}
</pre>
<p>Spring MVC framework:</p>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html">CrossOrigin</a>
  </li>
</ul>
<pre>
@CrossOrigin("trustedwebsite.com") // Compliant
@RequestMapping("")
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute("message", "ok ");
        return "view";
    }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html">cors.CorsConfiguration</a> </li>
</ul>
<pre>
CorsConfiguration config = new CorsConfiguration();
config.addAllowedOrigin("http://domain2.com"); // Compliant
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html">servlet.config.annotation.CorsConfiguration</a> </li>
</ul>
<pre>
class Safe implements WebMvcConfigurer {
  @Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
      .allowedOrigins("safe.com"); // Compliant
  }
}
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(@RequestHeader("Origin") String origin) {
  HttpHeaders responseHeaders = new HttpHeaders();
  if (trustedOrigins.contains(origin)) {
    responseHeaders.add("Access-Control-Allow-Origin", origin);
  }

  return new ResponseEntity&lt;&gt;("content", responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><h2>Recommended Secure Coding Practices</h2>
<ul>
  <li> The <code>Access-Control-Allow-Origin</code> header should be set only for a trusted origin and for specific resources. </li>
  <li> Allow only selected, trusted domains in the <code>Access-Control-Allow-Origin</code> header. Prefer whitelisting domains over blacklisting or
  allowing any domain (do not use * wildcard nor blindly return the <code>Origin</code> header content without any checks). </li>
</ul>
<h2>Compliant Solution</h2>
<p>Java Servlet framework:</p>
<pre>
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader("Content-Type", "text/plain; charset=utf-8");
    resp.setHeader("Access-Control-Allow-Origin", "trustedwebsite.com"); // Compliant
    resp.setHeader("Access-Control-Allow-Credentials", "true");
    resp.setHeader("Access-Control-Allow-Methods", "GET");
    resp.getWriter().write("response");
}
</pre>
<p>Spring MVC framework:</p>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html">CrossOrigin</a>
  </li>
</ul>
<pre>
@CrossOrigin("trustedwebsite.com") // Compliant
@RequestMapping("")
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute("message", "ok ");
        return "view";
    }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html">cors.CorsConfiguration</a> </li>
</ul>
<pre>
CorsConfiguration config = new CorsConfiguration();
config.addAllowedOrigin("http://domain2.com"); // Compliant
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html">servlet.config.annotation.CorsConfiguration</a> </li>
</ul>
<pre>
class Safe implements WebMvcConfigurer {
  @Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
      .allowedOrigins("safe.com"); // Compliant
  }
}
</pre>
<p>User-controlled origin validated with an allow-list:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(@RequestHeader("Origin") String origin) {
  HttpHeaders responseHeaders = new HttpHeaders();
  if (trustedOrigins.contains(origin)) {
    responseHeaders.add("Access-Control-Allow-Origin", origin);
  }

  return new ResponseEntity&lt;&gt;("content", responseHeaders, HttpStatus.CREATED);
}
</pre>
<h2>See</h2>
<ul>
  <li> OWASP - <a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">Top 10 2021 Category A5 - Security Misconfiguration</a> </li>
  <li> OWASP - <a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">Top 10 2021 Category A7 - Identification and
  Authentication Failures</a> </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org</a> - CORS </li>
  <li> <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">developer.mozilla.org</a> - Same origin policy </li>
  <li> OWASP - <a href="https://owasp.org/www-project-top-ten/2017/A6_2017-Security_Misconfiguration">Top 10 2017 Category A6 - Security
  Misconfiguration</a> </li>
  <li> <a href="https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html#cross-origin-resource-sharing">OWASP HTML5 Security
  Cheat Sheet</a> - Cross Origin Resource Sharing </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/346">CWE-346 - Origin Validation Error</a> </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/942">CWE-942 - Overly Permissive Cross-domain Whitelist</a> </li>
</ul></p>
            
            <p class="section-title">Assess_the_problem:</p>
            <p><h2>Ask Yourself Whether</h2>
<ul>
  <li> You don’t trust the origin specified, example: <code>Access-Control-Allow-Origin: untrustedwebsite.com</code>. </li>
  <li> Access control policy is entirely disabled: <code>Access-Control-Allow-Origin: *</code> </li>
  <li> Your access control policy is dynamically defined by a user-controlled input like <a
  href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin"><code>origin</code></a> header. </li>
</ul>
<p>There is a risk if you answered yes to any of those questions.</p>
<h2>Sensitive Code Example</h2>
<p>Java servlet framework:</p>
<pre>
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    resp.setHeader("Content-Type", "text/plain; charset=utf-8");
    resp.setHeader("Access-Control-Allow-Origin", "*"); // Sensitive
    resp.setHeader("Access-Control-Allow-Credentials", "true");
    resp.setHeader("Access-Control-Allow-Methods", "GET");
    resp.getWriter().write("response");
}
</pre>
<p>Spring MVC framework:</p>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/CrossOrigin.html">CrossOrigin</a>
  </li>
</ul>
<pre>
@CrossOrigin // Sensitive
@RequestMapping("")
public class TestController {
    public String home(ModelMap model) {
        model.addAttribute("message", "ok ");
        return "view";
    }
}
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html">cors.CorsConfiguration</a> </li>
</ul>
<pre>
CorsConfiguration config = new CorsConfiguration();
config.addAllowedOrigin("*"); // Sensitive
config.applyPermitDefaultValues(); // Sensitive
</pre>
<ul>
  <li> <a
  href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/CorsRegistration.html">servlet.config.annotation.CorsConfiguration</a> </li>
</ul>
<pre>
class Insecure implements WebMvcConfigurer {
  @Override
  public void addCorsMappings(CorsRegistry registry) {
    registry.addMapping("/**")
      .allowedOrigins("*"); // Sensitive
  }
}
</pre>
<p>User-controlled origin:</p>
<pre>
public ResponseEntity&lt;String&gt; userControlledOrigin(@RequestHeader("Origin") String origin) {
  HttpHeaders responseHeaders = new HttpHeaders();
  responseHeaders.add("Access-Control-Allow-Origin", origin); // Sensitive

  return new ResponseEntity&lt;&gt;("content", responseHeaders, HttpStatus.CREATED);
}
</pre>
</p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Having a permissive Cross-Origin Resource Sharing policy is security-sensitive. It has led in the past to the following vulnerabilities:</p>
<ul>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-0269">CVE-2018-0269</a> </li>
  <li> <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14460">CVE-2017-14460</a> </li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same origin policy</a> in browsers prevents, by default and for
security-reasons, a javascript frontend to perform a cross-origin HTTP request to a resource that has a different origin (domain, protocol, or port)
from its own. The requested target can append additional HTTP headers in response, called <a
href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">CORS</a>, that act like directives for the browser and change the access control policy
/ relax the same origin policy.</p>
</p>
            </div>
        <div class="rule">
            <h3>"String#replace" should be preferred to "String#replaceAll" (java:S5361)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>The underlying implementation of <code>String::replaceAll</code> calls the <code>java.util.regex.Pattern.compile()</code> method each time it is
called even if the first argument is not a regular expression. This has a significant performance cost and therefore should be used with care.</p>
<p>When <code>String::replaceAll</code> is used, the first argument should be a real regular expression. If it’s not the case,
<code>String::replace</code> does exactly the same thing as <code>String::replaceAll</code> without the performance drawback of the regex.</p>
<p>This rule raises an issue for each <code>String::replaceAll</code> used with a <code>String</code> as first parameter which doesn’t contains
special regex character or pattern.</p>
<h3>Noncompliant code example</h3>
<pre>
String init = "Bob is a Bird... Bob is a Plane... Bob is Superman!";
String changed = init.replaceAll("Bob is", "It's"); // Noncompliant
changed = changed.replaceAll("\\.\\.\\.", ";"); // Noncompliant
</pre>
<h3>Compliant solution</h3>
<pre>
String init = "Bob is a Bird... Bob is a Plane... Bob is Superman!";
String changed = init.replace("Bob is", "It's");
changed = changed.replace("...", ";");
</pre>
<p>Or, with a regex:</p>
<pre>
String init = "Bob is a Bird... Bob is a Plane... Bob is Superman!";
String changed = init.replaceAll("\\w*\\sis", "It's");
changed = changed.replaceAll("\\.{3}", ";");
</pre></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href='/coding_rules#rule_key=java%3AS4248'>S4248</a> - Regex patterns should not be created needlessly </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Custom getter method should not be used to override record's getter behavior (java:S6211)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>Before records appeared in Java 16, there was a common way to represent getters for private fields of a class:&nbsp; a method named "get" with a
capitalized field name. For example, for a&nbsp;<code>String</code> field named "myField" the signature of the getter method will be: <code>public
String getMyField()</code></p>
<p>In records, getters are named differently. Getters created by default do not contain the "get" prefix. So for a record’s <code>String</code> field
"myField" the getter method will be: <code>public String myField()</code></p>
<p>This means that if you want to override the default getter behavior it is better to use the method provided by records instead of creating a new
one. Otherwise, this will bring confusion to the users of the record as two getters will be available and even leads to bugs if the behavior is
different from the default one.</p>
<p>This rule raises an issue when a record contains a getter named "get" with a capitalized field name that is not behaving the same as the default
one.</p>
<h3>Noncompliant code example</h3>
<pre>
record Person(String name, int age) {
    public String getName() { // Noncompliant
        return name.toUpperCase(Locale.ROOT);
    }
}
</pre>
<h3>Compliant solution</h3>
<pre>
record Person(String name, int age) {
    @Override
    public String name() { // Compliant
        return name.toUpperCase(Locale.ROOT);
    }
}

record Person(String name, int age) {
    public String getNameUpperCase() { // Compliant
        return name.toUpperCase(Locale.ROOT);
    }
}
record Person(String name, int age) {
    public String getName() { // Compliant, is equivalent to 'name()'
        return name;
    }
}
record Person(String name, int age) {
    @Override
    public String name() { // Compliant
        return name.toUpperCase(Locale.ROOT);
    }
    public String getName() { // Compliant, equal to 'name()'
        return name.toUpperCase(Locale.ROOT);
    }
}
</pre>
<h3>Exceptions</h3>
<p>If the implementations of <code>getMyField()</code> and <code>myField()</code> methods are equivalent, the issue should not be raised as this was
probably done to support compatibility with the previous convention.</p></p>
            
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://docs.oracle.com/javase/specs/jls/se16/html/jls-8.html#jls-8.10">Records specification</a> </li>
</ul></p>
            </div>
        <div class="rule">
            <h3>Regular expressions should not contain empty groups (java:S6331)</h3>
            <p class="severity">Severidad: MAJOR</p>
        
            <p class="section-title">Root_cause:</p>
            <p><p>There are several reasons to use a group in a regular expression:</p>
<ul>
  <li> to change the precedence (e.g. <code>do(g|or)</code> will match 'dog' and 'door') </li>
  <li> to remember parenthesised part of the match in the case of capturing group </li>
  <li> to improve readability </li>
</ul>
<p>In any case, having an empty group is most probably a mistake. Either it is a leftover after refactoring and should be removed, or the actual
parentheses were intended and were not escaped.</p>
<h3>Noncompliant code example</h3>
<pre>
"foo()"  // Noncompliant, will match only 'foo'
</pre>
<h3>Compliant solution</h3>
<pre>
"foo\\(\\)"  // Matches 'foo()'
</pre></p>
            </div>
        <div class="rule">
            <h3>Return values should not be ignored when they contain the operation status code (java:S899)</h3>
            <p class="severity">Severidad: MINOR</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/xzdGBQ">CERT, EXP00-J.</a> - Do not ignore values returned by methods </li>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/TTZGBQ">CERT, FIO02-J.</a> - Detect and handle file-related errors </li>
  <li> CWE - <a href="https://cwe.mitre.org/data/definitions/754">CWE-754 - Improper Check for Unusual Exceptional Conditions</a> </li>
</ul></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>When the return value of a function call contains the operation status code, this value should be tested to make sure the operation completed
successfully.</p>
<p>This rule raises an issue when the return values of the following are ignored:</p>
<ul>
  <li> <code>java.io.File</code> operations that return a status code (except <code>mkdirs</code>) </li>
  <li> <code>Iterator.hasNext()</code> </li>
  <li> <code>Enumeration.hasMoreElements()</code> </li>
  <li> <code>Lock.tryLock()</code> </li>
  <li> non-void <code>Condition.await*</code> methods </li>
  <li> <code>CountDownLatch.await(long, TimeUnit)</code> </li>
  <li> <code>Semaphore.tryAcquire</code> </li>
  <li> <code>BlockingQueue</code>: <code>offer</code>, <code>remove</code> </li>
</ul>
<h3>Noncompliant code example</h3>
<pre>
public void doSomething(File file, Lock lock) {
  file.delete();  // Noncompliant
  // ...
  lock.tryLock(); // Noncompliant
}
</pre>
<h3>Compliant solution</h3>
<pre>
public void doSomething(File file, Lock lock) {
  if (!lock.tryLock()) {
    // lock failed; take appropriate action
  }
  if (!file.delete()) {
    // file delete failed; take appropriate action
  }
}
</pre></p>
            </div>
        <div class="rule">
            <h3>Try-with-resources should be used (java:S2093)</h3>
            <p class="severity">Severidad: CRITICAL</p>
        
            <p class="section-title">Resources:</p>
            <p><ul>
  <li> <a href="https://wiki.sei.cmu.edu/confluence/x/6DZGBQ">CERT, ERR54-J.</a> - Use a try-with-resources statement to safely handle closeable
  resources </li>
  <li> <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">The Java™ Tutorials - The try-with-resources
  Statement</a> </li>
</ul></p>
            
            <p class="section-title">How_to_fix:</p>
            <p><p>Use the try-with-resources syntax by moving the <code>Closable</code> variable declarations after the <code>try</code> keyword surrounded by
parentheses and separated by <code>;</code>:</p>
<pre>
try (/* resources declarations */) {
  // resources usage ...
}
</pre>

<h4>Noncompliant code example</h4>
<pre data-diff-id="1" data-diff-type="noncompliant">
FileReader fr = null;
BufferedReader br = null;

try { // Noncompliant, the FileReader and BufferedReader are instantiated without try-with-resources
  fr = new FileReader(fileName);
  br = new BufferedReader(fr);
  return br.readLine();
} catch (...) {
  ...
} finally {

  if (br != null) { // br has to be closed manually
    try {
      br.close();
    } catch(IOException e){...}
  }

  if (fr != null ) { // fr has to be closed manually
    try {
      br.close();
    } catch(IOException e){...}
  }

}
</pre>
<h4>Compliant solution</h4>
<pre data-diff-id="1" data-diff-type="compliant">
try ( // Compliant, all resources are instantiated within a try-with-resources statement and hence automatically closed after use
    FileReader fr = new FileReader(fileName);
    BufferedReader br = new BufferedReader(fr)
  ) {
  return br.readLine();
}
catch (...) {}
</pre></p>
            
            <p class="section-title">Root_cause:</p>
            <p><p>Many resources in Java need be closed after they have been used. If they are not, the garbage collector cannot reclaim the resources' memory, and
they are still considered to be in use by the operating system. Such resources are considered to be leaked, which can lead to performance issues.</p>
<p>Java 7 introduced the try-with-resources statement, which guarantees that the resource in question will be closed.</p>
<pre>
try (InputStream input = Files.newInputStream(path)) {
  // "input" will be closed after the execution of this block
}
</pre>
<p>This syntax is safer than the traditional method using <code>try</code>, <code>catch</code>, and <code>finally</code> and hence should be
preferred.</p>
<p>This rule raises an issue if a closeable resources is not opened using a try-with-resources statement.</p>
<p>This rule is automatically disabled when the project’s <code>sonar.java.source</code> is lower than <code>7</code> as the close-with-resources
statement was unavailable prior to Java 7.</p></p>
            </div><div class="page-number">Página <span class="pageNumber"></span></div></body></html>